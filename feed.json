{"title":"Aotu.io","description":"å‡¹å‡¸å®éªŒå®¤(Aotu.io) å§‹å»ºäº2015å¹´ï¼Œæ˜¯ä¸€ä¸ªå¹´è½»åŸºæƒ…çš„æŠ€æœ¯ç¤¾åŒºç»„ç»‡ã€‚<br/>O2é¢å‘å¤šç»ˆç«¯æŠ€æœ¯ä½“ç³»ï¼Œè‡´åŠ›äºæ„å»ºæ²‰æ·€ä¸åˆ†äº«åŒ…æ‹¬ä½†ä¸é™äºäº¤äº’ã€é¡µé¢åˆ¶ä½œæŠ€å·§ã€å‰ç«¯å¼€å‘ã€åŸç”ŸAPPå¼€å‘ç­‰æ–¹é¢çš„ä¸“ä¸šçŸ¥è¯†åŠæ¡ˆä¾‹ã€‚","language":"zh-cn","link":"https://aotu.io","pubDate":"Thu, 05 Nov 2020 07:40:20 GMT","lastBuildDate":"Thu, 05 Nov 2020 08:20:09 GMT","generator":"hexo-generator-json-feed","webMaster":"å‡¹å‡¸å®éªŒå®¤","items":[{"title":"EaseJsä¸­regX/regYçš„ç”¨æ³•","link":"https://aotu.io/notes/2020/11/05/easeJs-center-setting/","description":"å‰æƒ…æè¦åŠ¨æ•ˆå¼€å‘ä¸­æœ€å¸¸ç”¨çš„åŸºæœ¬å˜å½¢åŠ¨ä½œå°±æ˜¯ç¼©æ”¾ã€æ—‹è½¬ç­‰ï¼Œè¯¥å˜å½¢ä¼šæ¶‰åŠåˆ°ä¸­å¿ƒç‚¹çš„è®¾ç½®ã€‚ç”±äºæˆ‘ä»¬é‡‡ç”¨äº†createJsä¸­çš„easeJsåº“è¿›è¡Œå›¾å½¢ç»˜åˆ¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¼šç”¨åˆ°regX/regYã€‚ä¸‹é¢å…ˆçœ‹ä¸€ä¸ªå°demo: æˆ‘ä»¬å…ˆåœ¨é¡µé¢ä¸­ç”»ä¸€ä¸ª100x100çš„çŸ©å½¢ï¼Œå¹¶æ”¾ç½®åœ¨canvasä¸­é—´ï¼Œä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233import React, &#123; useRef, useEffect &#125; from \"react\";import &#123; Power0, TweenMax as Tween &#125; from \"gsap\";import &#123; Stage, Shape, Graphics, Ticker &#125; from \"@createjs/easeljs\";import \"./App.css\";function MotionDemo() &#123; const canvasRef = useRef(null); Tween.ticker.fps(24); useEffect(() =&gt; &#123; canvasRef.current.width = 400; canvasRef.current.height = 400; let stage; window.stage = stage = new Stage(canvasRef.current); const graphics = new Graphics().beginFill(\"#0ff\").drawRect(0, 0, 100, 100); const shape = new Shape(graphics); window.stage.addChild(shape); //å°†çŸ©å½¢æ”¾ç½®åœ¨canvasä¸­ shape.x = 150; shape.y = 150; shape.alpha = 0.3; Ticker.on(\"tick\", e =&gt; &#123; stage.update(); &#125;); &#125;, []); return ( &lt;div style=&#123;&#123; position: \"relative\", width: \"100%\", height: \"100%\" &#125;&#125;&gt; &lt;div style=&#123;&#123; position: \"absolute\", left: \"10%\", top: \"20%\" &#125;&#125;&gt; &lt;canvas className=\"canvas\" ref=&#123;canvasRef&#125; width=&#123;200&#125; height=&#123;200&#125; /&gt; &lt;/div&gt; &lt;/div&gt; );&#125;export default MotionDemo æ•ˆæœå¦‚ä¸‹ï¼š ^_^ ç»§ç»­è¯´å›regX/regYä»€ä¹ˆæ˜¯regX/regY å®˜æ–¹æ–‡æ¡£è§£é‡Šï¼š regXï¼šThe left offset for this display objectâ€™s registration point.å³è¯¥æ˜¾ç¤ºå¯¹è±¡æ³¨å†Œç‚¹çš„å·¦åç§»é‡ã€‚ regY:The y offset for this display objectâ€™s registration point.å³è¯¥æ˜¾ç¤ºå¯¹è±¡æ³¨å†Œç‚¹çš„ä¸Šåç§»é‡ã€‚ éœ€è¦æ˜ç¡®çš„æ˜¯ï¼š regX/regYä¸ºæ­£æ—¶ï¼Œå¯¹è±¡å¾€å·¦ä¸Šåç§»ï¼›regX/regYä¸ºè´Ÿï¼Œåˆ™å‘å³ä¸‹åç§»ã€‚ç°åœ¨æˆ‘ä»¬è®©ä¸­é—´çš„çŸ©å½¢åŠ¨èµ·æ¥,å‘useEffect åº•éƒ¨æ·»åŠ å¦‚ä¸‹ä»£ç :12345Tween.to(shape, 2, &#123; rotation: 360, repeat: -1, ease: Power0.easeNone, &#125;) æ•ˆæœå¦‚ä¸‹ï¼š å¾ˆæ˜¾ç„¶æˆ‘ä»¬èƒ½å‘ç°ï¼Œè¯¥å¯¹è±¡çš„æ³¨å†Œç‚¹å³å·¦é¡¶ç‚¹ã€‚ è®¾ç½®regX/regYç»•å›¾å½¢ä¸­å¿ƒæ—‹è½¬ å®˜æ–¹è¯´æ˜ï¼š For example, to make a 100x100px Bitmap rotate around its center, you would set regX and regY to 50.è®©ä¸€ä¸ª100x100çš„çŸ©å½¢ï¼Œå›´ç»•èµ·ä¸­å¿ƒç‚¹æ—‹è½¬ï¼Œåˆ™éœ€è¦å°†regX/regYè®¾ä¸º50. ç°åœ¨æˆ‘ä»¬è®¾ç½®regX/regYï¼Œæ˜¾ç¤ºå¯¹è±¡å®½åº¦/é«˜åº¦çš„ä¸€åŠï¼ˆ100 / 2 = 50ï¼‰, ä¸ºäº†å¯¹æ¯”ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªåŒä½ç½®çš„çŸ©å½¢,ï¼ˆåœ¨useEffectåº•éƒ¨æ·»åŠ )12345678910111213141516const createShape = () =&gt; &#123; const graphics = new Graphics() .beginFill(\"#0f0\") .drawRect(0, 0, 100, 100); const shape = new Shape(graphics); shape.x = 150; shape.y = 150; shape.regX = 50; shape.regY = 50; window.stage.addChild(shape); Tween.to(shape, 2, &#123; rotation: 360, repeat: -1, ease: Power0.easeNone &#125;); &#125;;createShape(); æ•ˆæœå¦‚ä¸‹ï¼š æ·¡è“è‰²çš„ä¸ºè¯¥çŸ©å½¢åŸæœ¬çš„ä½ç½®ï¼Œè®¾ç½®regX/regYåï¼Œå¯çŸ¥å›¾å½¢ç¡®å®æ˜¯ç»•ä¸­å¿ƒæ—‹è½¬ã€‚åªæ˜¯è¯¥çŸ©å½¢ä½ç½®å‘ç”Ÿäº†åç§»ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´æ˜¾ç¤ºå¯¹è±¡çš„ä½ç½®ï¼Œå°†å…¶ä½ç½®è¿˜åŸä¸ºåˆå§‹çŠ¶æ€å¹¶å›´ç»•ä¸­å¿ƒæ—‹è½¬ã€‚123//å°†createShapeä¸­shapeçš„ä½ç½®å¾€å³ä¸‹è°ƒæ•´shapeå®½åº¦çš„ä¸€åŠ shape.x += 50 shape.y += 50 æ•ˆæœå¦‚ä¸‹ï¼š è®¾ç½®ä»»æ„æ—‹è½¬ä¸­å¿ƒç°åœ¨æˆ‘ä»¬æ¸…æ¥šäº†ï¼ŒregX/regYä¼šæ”¹å˜æ˜¾ç¤ºå¯¹è±¡çš„æ³¨å†Œç‚¹ä½ç½®ï¼Œå¹¶ä½¿è¯¥å¯¹è±¡ä½ç½®å‘ç”Ÿåç§»ã€‚é‚£æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„åˆ©ç”¨è¿™ä¸€ç‰¹æ€§å’Œæ˜¾ç¤ºå¯¹è±¡çš„x,yå±æ€§è”åˆä½¿ç”¨è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨æˆ‘ä»¬æƒ³è®©çŸ©å½¢ç»•å…¶å³ä¸Šé¡¶ç‚¹æ—‹åˆ©ç”¨regX/regY ï¼Œä½¿å…¶ç»•å³é¡¶ç‚¹æ—‹è½¬åˆ©ç”¨x, yå°†åç§»åçš„å¯¹è±¡è¿˜åŸè‡³åˆå§‹ä½ç½®ä»£ç å¦‚ä¸‹ï¼š1234567// ç¬¬ä¸€æ­¥å®ç°ï¼Œå°†æ—‹è½¬ä¸­å¿ƒç§»è‡³å³é¡¶ç‚¹shape.regX = 100shape.regY = 0// ç¬¬äºŒæ­¥å®ç°ï¼Œè®¾ç½®x,yå°†æ˜¾ç¤ºå¯¹è±¡ç§»å›åˆå§‹ä½ç½®shape.x += 100shape.y = 0 æ•ˆæœå¦‚ä¸‹ï¼š ä¾é ä¸Šé¢æ‹†åˆ†çš„åŠæ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ—‹è½¬ä¸­å¿ƒè®¾ç½®ä¸ºè¯¥æ˜¾ç¤ºå¯¹è±¡ä¸Šçš„ä»»æ„ä¸€ç‚¹å•¦ã€‚ï¼ˆå¤§å®¶ä¼šä¸ä¼šå› æ­¤è¿·ç³Š å¦‚æœæ—‹è½¬ä¸­å¿ƒä¸åœ¨æ˜¾ç¤ºå¯¹è±¡ä¸Šè¯¥å¦‚ä½•å¤„ç†ï¼Œä¸‹é¢ä¹Ÿåšä¸€ä¸‹è¯´æ˜ï¼‰ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨æˆ‘ä»¬å¸Œæœ›çŸ©å½¢ç»•ã€ç”»å¸ƒçš„å·¦é¡¶ç‚¹ã€‘æ—‹è½¬ã€‚ åˆ©ç”¨regX/regYå°†æ˜¾ç¤ºå¯¹è±¡æ³¨å†Œç‚¹è°ƒæ•´ä¸ºç”»å¸ƒå·¦é¡¶ç‚¹ã€‚ åˆ©ç”¨x,yå°†æ˜¾ç¤ºå¯¹è±¡è¿˜åŸè‡³åˆå§‹ä½ç½® æ‰€ä»¥ å…¶å®å’Œæ—‹è½¬ä¸­å¿ƒåœ¨æ˜¾ç¤ºå¯¹è±¡ä¸Šæ˜¯ä¸€è‡´çš„ã€‚1234567// ç¬¬ä¸€æ­¥shape.regX = -150shape.regY = -150// ç¬¬äºŒæ­¥shape.x -= 150 shape.y -= 150 æ•ˆæœå¦‚ä¸‹ï¼šï¼ˆé€Ÿç‡è°ƒå¿«äº†ï¼Œæ–¹ä¾¿çœ‹æ•ˆæœï¼‰ æ€»ç»“ï¼š regX/regYä¼šæ”¹å˜å…¶æ—‹è½¬ä¸­å¿ƒï¼Œå¹¶ä¼´éšæ˜¾ç¤ºå¯¹è±¡ä½ç½®åç§»ï¼ˆç›¸å¯¹äºåŸæ˜¾ç¤ºå¯¹è±¡è€Œè¨€ï¼‰ å½“æ˜¾ç¤ºå¯¹è±¡å­˜åœ¨ç¼©æ”¾å’Œæ—‹è½¬æ—¶ï¼Œæƒ…å†µä¼šä¸ä¼šä¸åŒå‘¢ï¼Ÿ æœ‰ç¼©æ”¾çš„æƒ…å†µ ç»™æ˜¾ç¤ºå¯¹è±¡è®¾ç½®ç¼©æ”¾å€¼1shape.scale = 0.5; è®¾ç½®ä¸­å¿ƒç‚¹ï¼š1234567// ç¬¬ä¸€æ­¥å®ç°ï¼Œè®¾ç½®æ˜¾ç¤ºå¯¹è±¡æ³¨å†Œç‚¹åç§»è‡³ä¸­å¿ƒç‚¹å¤„shape.regX = (width / 2) * scaleshape.regY = (height / 2) * scale // ç¬¬äºŒæ­¥å®ç°ï¼Œè®¾ç½®x/yå°†æ˜¾ç¤ºå¯¹è±¡åç§»åˆ°åŸæ¥çš„ä½ç½®ï¼Œshape.x += (width / 2) * scaleshape.y += (height / 2) * scale å¾ˆæ˜¾ç„¶ï¼Œä½ç½®è®¡ç®—å¹¶ä¸æ­£ç¡®ã€‚å› ä¸ºç¼©æ”¾ä¸ä¼šå½±å“æ³¨å†Œç‚¹æ‰€åœ¨åæ ‡ç³»ã€‚è°ƒæ•´regX/regYå–å€¼12shape.regX = width / 2shape.regY = height / 2 åˆ™å¾—åˆ°ç»•ä¸­å¿ƒç‚¹æ—‹è½¬ç»“æœï¼Œæ•ˆæœå¦‚ä¸‹ï¼š æœ‰æ—‹è½¬çš„æƒ…å†µ ç»™æ˜¾ç¤ºå¯¹è±¡æœ¬èº«è®¾ç½®æ—‹è½¬è§’åº¦1234567shape.rotation = 30; //å¤„ç†ä¸­å¿ƒç‚¹è®¾ç½®shape.regX = width / 2shape.regY = height / 2shape.x += width / 2shape.y += height / 2 å³ï¼šæ˜¾ç¤ºå¯¹è±¡çš„æ—‹è½¬ï¼Œä¸ä¼šå½±å“æ—‹è½¬ä¸­å¿ƒçš„è®¾ç½® æ€»ç»“ï¼š regX/regYã€x/yé…åˆä½¿ç”¨å¯ä»¥è®¾ç½®ä»»æ„ä¸­å¿ƒç‚¹ã€‚å¦å¤–é€šè¿‡æ—‹è½¬å’Œç¼©æ”¾ä¸¤ç§æƒ…å†µä¸­å¿ƒç‚¹çš„è®¾ç½®å’Œæ•ˆæœå¯çŸ¥ï¼šç¼©æ”¾åœ¨ä¸­å¿ƒç‚¹è®¾ç½®ä¹‹å‰å°±å·²ç”Ÿæ•ˆæ‰€ä»¥ç¼©æ”¾æ˜¯ä»¥å…¶å·¦é¡¶ç‚¹è¿›è¡Œç¼©æ”¾ï¼Œè€Œæ—‹è½¬æ˜¯åœ¨è®¾ç½®å®Œä¸­å¿ƒç‚¹ä¹‹åç”Ÿæ•ˆï¼Œæ‰€ä»¥å…¶æ˜¯ç»•å…¶ä¸­å¿ƒç‚¹è¿›è¡Œæ—‹è½¬çš„ã€‚é¢å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è®¾å®Œä¸­å¿ƒç‚¹ï¼Œå¯¹è±¡ç»è¿‡æ—‹è½¬åŠ¨æ•ˆåï¼Œå¦‚éœ€è¦å°†ä¸­å¿ƒç‚¹é‡ç½®ä¸ºå·¦é¡¶ç‚¹æ—¶ã€‚æ­¤æ—¶æ³¨å†Œç‚¹çš„åç§»é‡é‡ç½®ä¸º0ã€‚ä½†x, yçš„ä½ç½®éœ€è¦é€šè¿‡æ—‹è½¬å…¬å¼æ±‚å‡ºæ—‹è½¬åå·¦é¡¶ç‚¹çš„åæ ‡ï¼Œè€Œä¸æ˜¯å•çº¯çš„è¿˜åŸä½ç½®ã€‚","pubDate":"Thu, 05 Nov 2020 07:40:20 GMT","guid":"https://aotu.io/notes/2020/11/05/easeJs-center-setting/","category":"ç»éªŒåˆ†äº«"},{"title":"node.js æ²™ç›’é€ƒé€¸åˆ†æ","link":"https://aotu.io/notes/2020/10/28/node-sandbox-escape-analysis/","description":"èƒŒæ™¯æ—¥å¸¸å¼€å‘éœ€æ±‚ä¸­æœ‰æ—¶å€™ä¸ºäº†è¿½æ±‚çµæ´»æ€§æˆ–é™ä½å¼€å‘éš¾åº¦ï¼Œä¼šåœ¨ä¸šåŠ¡ä»£ç é‡Œç›´æ¥ä½¿ç”¨ eval/Function/vm ç­‰åŠŸèƒ½ï¼Œå…¶ä¸­ eval/Function ç®—æ˜¯åŠ¨æ€æ‰§è¡Œ JSï¼Œä½†æ— æ³•å±è”½å½“å‰æ‰§è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œä½† node.js é‡Œæä¾›äº† vm æ¨¡å—ï¼Œç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¯ä»¥è®©ä½ åœ¨æ‰§è¡Œä»£ç æ—¶å€™éš”ç¦»å½“å‰çš„æ‰§è¡Œç¯å¢ƒï¼Œé¿å…è¢«æ¶æ„ä»£ç æ”»å‡»ã€‚ vm åŸºæœ¬ä»‹ç»vm æ¨¡å—å¯åœ¨ V8 è™šæ‹Ÿæœºä¸Šä¸‹æ–‡ä¸­ç¼–è¯‘å’Œè¿è¡Œä»£ç ï¼Œè™šæ‹Ÿæœºä¸Šä¸‹æ–‡å¯è‡ªè¡Œé…ç½®ï¼Œåˆ©ç”¨è¯¥ç‰¹æ€§åšåˆ°æ²™ç›’çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼š 12345678910111213const vm = require(\"vm\");const x = 1;const y = 2;const context = &#123; x: 2, console &#125;;vm.createContext(context); // ä¸Šä¸‹æ–‡éš”ç¦»åŒ–å¯¹è±¡ã€‚const code = \"console.log(x); console.log(y)\";vm.runInContext(code, context);// è¾“å‡º 2// Uncaught ReferenceError: y is not defin æ ¹æ®ä»¥ä¸Šç¤ºä¾‹ï¼Œå¯ä»¥çœ‹å‡ºå’Œ eval/Function æœ€å¤§çš„åŒºåˆ«å°±æ˜¯å¯è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±å¯ä»¥æ§åˆ¶è¢«æ‰§è¡Œä»£ç çš„è®¿é—®èµ„æºã€‚ä¾‹å¦‚ä»¥ä¸Šç¤ºä¾‹ï¼Œé™¤äº†è¯­è¨€çš„è¯­æ³•ã€å†…ç½®å¯¹è±¡ç­‰ï¼Œæ— æ³•è®¿é—®åˆ°è¶…å‡ºä¸Šä¸‹æ–‡å¤–çš„ä»»ä½•ä¿¡æ¯ï¼Œæ‰€ä»¥ç¤ºä¾‹ä¸­å‡ºç°äº†é”™è¯¯æç¤º: y æœªå®šä¹‰ã€‚ä»¥ä¸‹æ˜¯ vm çš„çš„æ‰§è¡Œç¤ºä¾‹å›¾ï¼š æ²™ç›’ç¯å¢ƒä»£ç åªèƒ½è¯»å– VM ä¸Šä¸‹æ–‡ æ•°æ®ã€‚ æ²™ç›’é€ƒé€¸node.js åœ¨ vm çš„æ–‡æ¡£é¡µä¸Šæœ‰å¦‚ä¸‹æè¿°ï¼š vm æ¨¡å—ä¸æ˜¯å®‰å…¨çš„æœºåˆ¶ã€‚ ä¸è¦ä½¿ç”¨å®ƒæ¥è¿è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ã€‚ åˆšå¼€å§‹çœ‹åˆ°è¿™å¥è¯çš„å¾ˆå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸæŒ‰ç…§åˆšæ‰çš„ç†è§£ä»–åº”è¯¥æ˜¯å®‰å…¨çš„ï¼Ÿæœç´¢åæˆ‘ä»¬æ‰¾åˆ°ä¸€æ®µé€ƒé€¸ç¤ºä¾‹ï¼š 123456789const vm = require(\"vm\");const ctx = &#123;&#125;;vm.runInNewContext( 'this.constructor.constructor(\"return process\")().exit()', ctx);console.log(\"Never gets executed.\"); ä»¥ä¸Šç¤ºä¾‹ä¸­ this æŒ‡å‘ ctx å¹¶é€šè¿‡åŸå‹é“¾çš„æ–¹å¼æ‹¿åˆ°æ²™ç›’å¤–çš„ Funtionï¼Œå®Œæˆé€ƒé€¸ï¼Œå¹¶æ‰§è¡Œé€ƒé€¸åçš„ JS ä»£ç ã€‚ ä»¥ä¸Šç¤ºä¾‹å¤§è‡´æ‹†åˆ†ï¼š 12345tmp = ctx.constructor; // Objectexec = tmp.constructor; // Functionexec(\"return Process\"); ä»¥ä¸Šæ˜¯é€šè¿‡åŸå‹é“¾æ–¹å¼å®Œæˆé€ƒé€¸ï¼Œå¦‚æœå°†ä¸Šä¸‹æ–‡å¯¹è±¡çš„åŸå‹é“¾è®¾ç½®ä¸º null å‘¢ï¼Ÿ 1const ctx = Object.create(null); è¿™æ—¶æ²™ç›’åœ¨é€šè¿‡ ctx.constructorï¼Œå°±ä¼šå‡ºé”™ï¼Œä¹Ÿå°±æ— æ³•å®Œæˆæ²™ç›’é€ƒé€¸ï¼Œå®Œæ•´ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789const vm = require(\"vm\");const ctx = Object.create(null);vm.runInNewContext( 'this.constructor.constructor(\"return process\")().exit()', ctx);// throw Error ä½†ï¼ŒçœŸçš„è¿™æ ·ç®€å•å—ï¼Ÿ å†æ¥çœ‹çœ‹ä»¥ä¸‹æˆåŠŸé€ƒé€¸ç¤ºä¾‹ï¼š 1234567891011const vm = require(\"vm\");const ctx = Object.create(null);ctx.data = &#123;&#125;;vm.runInNewContext( 'this.data.constructor.constructor(\"return process\")().exit()', ctx);// é€ƒé€¸æˆåŠŸï¼console.log(\"Never gets executed.\"); ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ åŸå›  ç”±äº JS é‡Œæ‰€æœ‰å¯¹è±¡çš„åŸå‹é“¾éƒ½ä¼šæŒ‡å‘ Object.prototypeï¼Œä¸” Object.prototype å’Œ Function ä¹‹é—´æ˜¯ç›¸äº’æŒ‡å‘çš„ï¼Œæ‰€æœ‰å¯¹è±¡é€šè¿‡åŸå‹é“¾éƒ½èƒ½æ‹¿åˆ° Functionï¼Œæœ€ç»ˆå®Œæˆæ²™ç›’é€ƒé€¸å¹¶æ‰§è¡Œä»£ç ã€‚ é€ƒé€¸åä»£ç å¯ä»¥æ‰§è¡Œå¦‚ä¸‹ä»£ç æ‹¿åˆ° requireï¼Œä»è€Œå¹¶åŠ è½½å…¶ä»–æ¨¡å—åŠŸèƒ½ï¼Œç¤ºä¾‹ï¼š 1234567891011121314const vm = require(\"vm\");const ctx = &#123; console,&#125;;vm.runInNewContext( ` var exec = this.constructor.constructor; var require = exec('return process.mainModule.constructor._load')(); console.log(require('fs'));`, ctx); æ²™ç›’æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯éš”ç¦»çš„ï¼Œä½†å¯é€šè¿‡åŸå‹é“¾çš„æ–¹å¼è·å–åˆ°æ²™ç›’å¤–çš„ Functionï¼Œä»è€Œå®Œæˆé€ƒé€¸ï¼Œæ‹¿åˆ°å…¨å±€æ•°æ®ï¼Œç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š æ€»ç»“ç”±äºè¯­è¨€çš„ç‰¹æ€§ï¼Œåœ¨æ²™ç›’ç¯å¢ƒä¸‹é€šè¿‡åŸå‹é“¾çš„æ–¹å¼èƒ½è·å–å…¨å±€çš„ Functionï¼Œå¹¶é€šè¿‡å®ƒæ¥æ‰§è¡Œä»£ç ã€‚ æœ€ç»ˆç¡®å®å¦‚å®˜æ–¹æ‰€è¯´ï¼Œåœ¨ä½¿ç”¨ vm çš„æ—¶åº”ç¡®ä¿æ‰€è¿è¡Œçš„ä»£ç æ˜¯å¯ä¿¡ä»»çš„ã€‚ eval/Function/vm ç­‰å¯åŠ¨æ€æ‰§è¡Œä»£ç çš„åŠŸèƒ½åœ¨ JavaScript é‡Œä¸€å®šæ˜¯ç”¨æ¥æ‰§è¡Œå¯ä¿¡ä»»ä»£ç ã€‚ ä»¥ä¸‹å¯èƒ½æ˜¯æ¯”è¾ƒå¸¸è§ä¼šç”¨åˆ°åŠ¨æ€æ‰§è¡Œè„šæœ¬çš„åœºæ™¯ï¼šæ¨¡æ¿å¼•æ“ï¼ŒH5 æ¸¸æˆã€è¿½æ±‚é«˜åº¦çµæ´»é…ç½®çš„åœºæ™¯ã€‚ è§£å†³æ–¹æ¡ˆ äº‹å‰å¤„ç†ï¼Œå¦‚ï¼šä»£ç å®‰å…¨æ‰«æã€è¯­æ³•é™åˆ¶ ä½¿ç”¨ vm2 æ¨¡å—ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯é€šè¿‡ä»£ç†çš„æ–¹å¼æ¥è¿›è¡Œå®‰å…¨æ ¡éªŒï¼Œè™½ç„¶ä¹Ÿå¯èƒ½è¿˜å­˜åœ¨æœªå‡ºç°çš„é€ƒé€¸æ–¹å¼ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æ—¶ä¹Ÿè°¨æ…å¯¹å¾…ã€‚ è‡ªå·±å®ç°è§£é‡Šå™¨ï¼Œå¹¶åœ¨è§£é‡Šå™¨å±‚æ¥ç®¡æ‰€æœ‰å¯¹è±¡åˆ›å»ºåŠå±æ€§è®¿é—®ã€‚","pubDate":"Wed, 28 Oct 2020 07:40:20 GMT","guid":"https://aotu.io/notes/2020/10/28/node-sandbox-escape-analysis/","category":"node.js"},{"title":"ä»æµè§ˆå™¨æ¸²æŸ“å±‚é¢è§£æcss3åŠ¨æ•ˆä¼˜åŒ–åŸç†","link":"https://aotu.io/notes/2020/10/13/css3-optimization/","description":"å¼•è¨€åœ¨h5å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦å®ç°ä¸€äº›åŠ¨æ•ˆæ¥è®©é¡µé¢è§†è§‰æ•ˆæœæ›´å¥½ï¼Œè°ˆåŠåŠ¨æ•ˆä¾¿ä¸å¯é¿å…åœ°ä¼šæƒ³åˆ°åŠ¨æ•ˆæ€§èƒ½ä¼˜åŒ–è¿™ä¸ªè¯é¢˜: å‡å°‘é¡µé¢DOMæ“ä½œï¼Œå¯ä»¥å…ƒç´ ä½¿ç”¨CSSå®ç°çš„åŠ¨æ•ˆä¸å¤šå‡ºä¸€è¡Œjsä»£ç  ä½¿ç”¨ç»å¯¹å®šä½è„±ç¦»è®©DOMè„±ç¦»æ–‡æ¡£æµï¼Œå‡å°‘é¡µé¢çš„é‡æ’(relayout) ä½¿ç”¨CSS3 3Då±æ€§å¼€å¯ç¡¬ä»¶åŠ é€Ÿ é‚£ä¹ˆï¼ŒCSS3ä¸åŠ¨æ•ˆä¼˜åŒ–æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Œæœ¬æ–‡å°†ä»æµè§ˆå™¨æ¸²æŸ“å±‚é¢è®²è¿°CSS3çš„åŠ¨æ•ˆä¼˜åŒ–åŸç† æµè§ˆå™¨é¡µé¢å±•ç¤ºè¿‡ç¨‹é¦–é¡µï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹æµè§ˆå™¨çš„é¡µé¢å±•ç¤ºè¿‡ç¨‹: Javascriptï¼šä¸»è¦è´Ÿè´£ä¸šåŠ¡äº¤äº’é€»è¾‘ã€‚ Style: æ ¹æ® CSS é€‰æ‹©å™¨ï¼Œå¯¹æ¯ä¸ª DOM å…ƒç´ åŒ¹é…å¯¹åº”çš„ CSS æ ·å¼ã€‚ Layout: å…·ä½“è®¡ç®— DOM å…ƒç´ æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„å¤§å°åŠä½ç½®ã€‚ Paint: å®ç°ä¸€ä¸ª DOM å…ƒç´ çš„å¯è§†æ•ˆæœ(é¢œè‰²ã€è¾¹æ¡†ã€é˜´å½±ç­‰)ï¼Œä¸€èˆ¬æ¥è¯´ç”±å¤šä¸ªæ¸²æŸ“å±‚å®Œæˆã€‚ Composite: å½“æ¯ä¸ªå±‚ç»˜åˆ¶å®Œæˆåï¼Œæµè§ˆå™¨ä¼šå°†æ‰€æœ‰å±‚æŒ‰ç…§åˆç†é¡ºåºåˆå¹¶ä¸ºä¸€ä¸ªå›¾å±‚ï¼Œæ˜¾ç¤ºåˆ°å±å¹•ã€‚æœ¬æ–‡æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ Composite è¿‡ç¨‹ã€‚ æµè§ˆå™¨æ¸²æŸ“åŸç†åœ¨è®¨è®º Composite ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸€ä¸‹æµè§ˆå™¨æ¸²æŸ“åŸç† ä»è¯¥å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š DOM å…ƒç´ ä¸ Layout Object å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„å…³ç³» ä¸€èˆ¬æ¥è¯´ï¼Œæ‹¥æœ‰ç›¸åŒåæ ‡ç©ºé—´çš„ Layout Object å±äºåŒä¸€ä¸ª Paint Layer (æ¸²æŸ“å±‚)ï¼Œé€šè¿‡ positionã€opacityã€filterç­‰ CSS å±æ€§å¯ä»¥åˆ›å»ºæ–°çš„ Paint Layer æŸäº›ç‰¹æ®Šçš„ Paint Layer ä¼šè¢«è®¤ä¸ºæ˜¯ Composite Layer (åˆæˆå±‚/å¤åˆå±‚)ï¼ŒComposite Layer æ‹¥æœ‰å•ç‹¬çš„ Graphics Layer (å›¾å½¢å±‚)ï¼Œè€Œé‚£äº›é Composite Layer çš„ Paint Layerï¼Œä¼šä¸æ‹¥æœ‰ Graphics Layer çš„çˆ¶å±‚å…±ç”¨ä¸€ä¸ª Graphics Layeræˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­æ‰€çœ‹åˆ°å±å¹•å¯è§†æ•ˆæœå¯ä»¥ç†è§£ä¸ºï¼šç”±å¤šä¸ªä½å›¾é€šè¿‡ GPU åˆæˆæ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œè€Œä½å›¾çš„æœ€å°å•ä½æ˜¯åƒç´ ã€‚å¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆä½å›¾æ˜¯æ€ä¹ˆè·å¾—çš„å‘¢ï¼ŒGraphics Layer ä¾¿èµ·åˆ°äº†å…³é”®ä½œç”¨,æ¯ä¸ª Graphics Layer éƒ½æœ‰ä¸€ä¸ª Graphics Context, ä½å›¾æ˜¯å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ï¼ŒGraphics Context ä¼šè´Ÿè´£å°†ä½å›¾ä½œä¸ºçº¹ç†ä¸Šä¼ åˆ°GPUä¸­ï¼Œå†ç”±GPUè¿›è¡Œåˆæˆæ¸²æŸ“ã€‚å¦‚ä¸‹å›¾ï¼š CSSåœ¨æµè§ˆå™¨æ¸²æŸ“å±‚é¢æ‰¿æ‹…äº†æ€æ ·çš„è§’è‰²å¤§å¤šæ•°äººå¯¹äºCSS3çš„ç¬¬ä¸€å°è±¡ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡3D(å¦‚transform)å±æ€§æ¥å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼Œè®¸å¤šåŒå­¦åœ¨é‡æ„æŸä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œè€ƒè™‘åˆ°åŠ¨ç”»æ€§èƒ½é—®é¢˜ï¼Œéƒ½ä¼šå€¾å‘: å°†2Dtransformæ”¹ä¸º3Dtransform2.å°† left ( topã€bottomã€right )çš„ç§»åŠ¨æ”¹ä¸º 3Dtransformä½†å¼€å¯ç¡¬ä»¶åŠ é€Ÿçš„åº•å±‚åŸç†å…¶å®å°±åœ¨äºå°† Paint Layer æå‡åˆ°äº† Composite Layerä»¥ä¸‹çš„å‡ ç§æ–¹å¼éƒ½ç”¨ç›¸åŒçš„ä½œç”¨ï¼š 3Då±æ€§å¼€å¯ç¡¬ä»¶åŠ é€Ÿ(3d-transform) will-change: (opacityã€transformã€topã€leftã€bottomã€right) ä½¿ç”¨fixedæˆ–stickyå®šä½ å¯¹opacityã€transformã€filteråº”ç”¨äº† animation(actived) or transition(actived)ï¼Œæ³¨æ„è¿™é‡Œçš„ animation åŠ transition éœ€è¦æ˜¯å¤„äºæ¿€æ´»çŠ¶æ€æ‰è¡Œ æˆ‘ä»¬æ¥å†™ä¸¤æ®µ demo ä»£ç ï¼Œå¸¦å¤§å®¶å…·ä½“åˆ†æä¸€ä¸‹å®é™…æƒ…å†µ demo1. 3Då±æ€§å¼€å¯ç¡¬ä»¶åŠ é€Ÿ(3d-transform) 1234567891011.composited&#123; width: 200px; height: 200px; background: red; transform: translateZ(0)&#125;&lt;/style&gt;&lt;div class=\"composited\"&gt; composited - 3dtransform&lt;/div&gt; å¯ä»¥çœ‹åˆ°æ˜¯å› ä¸ºä½¿ç”¨çš„CSS 3D transformï¼Œåˆ›å»ºäº†ä¸€ä¸ªå¤åˆå±‚ demo2. å¯¹opacityã€transformã€filteråº”ç”¨ animation(actived) or transition(actived) 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950&lt;style&gt;@keyframes move&#123; 0%&#123; top: 0; &#125; 50%&#123; top: 600px; &#125; 100%&#123; top: 0; &#125;&#125;@keyframes opacity&#123; 0%&#123; opacity: 0; &#125; 50%&#123; opacity: 1; &#125; 100%&#123; opacity: 0; &#125;&#125;#composited&#123; width: 200px; height: 200px; background: red; position: absolute; left: 0; top: 0; &#125;.both&#123; animation: move 2s infinite, opacity 2s infinite;&#125;.move&#123; animation: move 2s infinite;&#125;&lt;/style&gt;&lt;div id=\"composited\" class=\"both\"&gt; composited - animation&lt;/div&gt;&lt;script&gt;setTimeout(function()&#123; const dom = document.getElementById('composited') dom.className = 'move'&#125;,5000)&lt;/script&gt; è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªkeyframes(moveã€opacity)ï¼Œè¿˜æœ‰ä¸¤ä¸ªclass(bothã€move)ï¼Œèµ·åˆ #composited çš„ className = &#39;both&#39;ï¼Œ5ç§’å»¶æ—¶å™¨åï¼ŒclassName = &#39;move&#39;ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æµè§ˆå™¨çš„å®é™…å˜åŒ–ã€‚ èµ·åˆï¼š#composited åˆ›å»ºäº†ä¸€ä¸ªå¤åˆå±‚ï¼Œå¹¶ä¸”è¿åŠ¨æ—¶ fps æ²¡æœ‰æ³¢åŠ¨ï¼Œæ€§èƒ½å¾ˆç¨³å®š 5ç§’åï¼šå¤åˆå±‚æ¶ˆå¤±ï¼Œè¿åŠ¨æ—¶ fps ä¼šå‘ç”ŸæŠ–åŠ¨ï¼Œæ€§èƒ½å¼€å§‹å˜å¾—ä¸å†ç¨³å®š å¦‚ä½•æŸ¥çœ‹å¤åˆå±‚åŠfpsåœ¨æµè§ˆå™¨çš„ Dev Tools ä¸­é€‰æ‹© More toolsï¼Œå¹¶å‹¾é€‰ Rendering ä¸­çš„ FPS meter åŠ¨ç”»æ€§èƒ½æœ€ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬æåˆ°äº†é¡µé¢å‘ˆç°å‡ºæ¥æ‰€ç»å†çš„æ¸²æŸ“æµæ°´çº¿ï¼Œå…¶å®ä»æ€§èƒ½æ–¹é¢è€ƒè™‘ï¼Œæœ€ç†æƒ³çš„æ¸²æŸ“æµæ°´çº¿æ˜¯æ²¡æœ‰å¸ƒå±€å’Œç»˜åˆ¶ç¯èŠ‚çš„ï¼Œä¸ºäº†å®ç°ä¸Šè¿°æ•ˆæœï¼Œå°±éœ€è¦åªä½¿ç”¨é‚£äº›ä»…è§¦å‘ Composite çš„å±æ€§ã€‚ç›®å‰ï¼Œåªæœ‰ä¸¤ä¸ªå±æ€§æ˜¯æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„ï¼štransforms å’Œ opacityï¼ˆä»…éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰ã€‚ç›¸å…³ä¿¡æ¯å¯æŸ¥çœ‹ï¼šcss Triggers æ€»ç»“æå‡ä¸ºåˆæˆå±‚ç®€å•è¯´æ¥æœ‰ä»¥ä¸‹å‡ ç‚¹å¥½å¤„ï¼š åˆæˆå±‚çš„ä½å›¾ï¼Œä¼šäº¤ç”± GPU åˆæˆï¼Œæ¯” CPU å¤„ç†è¦å¿« å½“éœ€è¦ repaint æ—¶ï¼Œåªéœ€è¦ repaint æœ¬èº«ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„å±‚ å¯¹äº transform å’Œ opacity æ•ˆæœï¼Œéƒ¨åˆ†æµè§ˆå™¨ä¸ä¼šè§¦å‘ Layout å’Œ Paintï¼Œ ç›¸å…³ä¿¡æ¯å¯æŸ¥çœ‹ï¼šcss Triggers ç¼ºç‚¹ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„åˆæˆå±‚å¹¶ä¸æ˜¯å…è´¹çš„ï¼Œå®ƒå¾—æ¶ˆè€—é¢å¤–çš„å†…å­˜å’Œç®¡ç†èµ„æºã€‚ çº¹ç†ä¸Šä¼ åä¼šäº¤ç”± GPU å¤„ç†ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ CPU å’Œ GPU ä¹‹é—´çš„å¸¦å®½é—®é¢˜ã€ä»¥åŠæœ‰å¤šå¤§å†…å­˜ä¾› GPU å¤„ç†è¿™äº›çº¹ç†çš„é—®é¢˜ å¤§å¤šæ•°äººéƒ½å¾ˆå–œæ¬¢ä½¿ç”¨3Då±æ€§ translateZ(0) æ¥è¿›è¡Œæ‰€è°“çš„ç¡¬ä»¶åŠ é€Ÿï¼Œä»¥æå‡æ€§èƒ½ã€‚ä½†æˆ‘ä»¬è¿˜éœ€è¦åˆ‡å®çš„å»åˆ†æé¡µé¢çš„å®é™…æ€§èƒ½è¡¨ç°ï¼Œä¸æ–­çš„æ”¹è¿›æµ‹è¯•ï¼Œè¿™æ ·æ‰æ˜¯æ­£ç¡®çš„æ€§èƒ½ä¼˜åŒ–é€”å¾„ã€‚ å‚è€ƒèµ„æ–™æ— çº¿æ€§èƒ½ä¼˜åŒ–ï¼šComposite - æ·˜ç³»å‰ç«¯å›¢é˜Ÿ","pubDate":"Tue, 13 Oct 2020 13:00:00 GMT","guid":"https://aotu.io/notes/2020/10/13/css3-optimization/","category":"ç»éªŒåˆ†äº«"},{"title":"Flutter æ€§èƒ½ä¼˜åŒ–ï¼šå›¾ç‰‡å ä½ç¬¦ã€é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»","link":"https://aotu.io/notes/2020/10/13/improving-perceived-performance-with-image-placeholders-precaching-and-disabled-navigation/","description":"æœ¬æ–‡æ˜¯ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—æ–‡ç« ä¹‹ä¸€ï¼Œè®°å½•äº† Flutter å›¢é˜Ÿä¼˜åŒ– Flutter Galleryï¼ˆhttps://gallery.flutter.dev/#/ï¼‰ çš„å®è·µã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•åˆ©ç”¨å›¾ç‰‡å ä½ç¬¦ã€é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»æé«˜ç”¨æˆ·æ„ŸçŸ¥æ€§èƒ½ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/flutter/improving-perceived-performance-with-image-placeholders-precaching-and-disabled-navigation-6b3601087a2b æ„ŸçŸ¥æ€§èƒ½æ˜¯æŒ‡ç”¨æˆ·æ„Ÿè§‰ app æœ‰å¤šå¿«ï¼ˆè¯‘è€…æ³¨ï¼šæ„Ÿæ€§æ€§èƒ½æ˜¯ç”¨æˆ·è§†è§’ï¼Œè€Œä¸æ˜¯æŒ‡æ ‡ï¼‰ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸‰ä¸ªæé«˜æ„ŸçŸ¥æ€§èƒ½çš„ç­–ç•¥ï¼šå›¾ç‰‡å ä½ç¬¦ã€å›¾ç‰‡é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»ã€‚ åˆ©ç”¨å›¾ç‰‡å ä½ç¬¦é˜²æ­¢å¸ƒå±€è·³åŠ¨ç”¨æˆ·ç­‰å¾…å›¾ç‰‡åŠ è½½ï¼Œåœ¨å›¾ç‰‡æœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥æ—¶ï¼Œå¸ƒå±€å¯èƒ½ä¼šè·³æ¥è·³å»ã€‚é€šè¿‡åœ¨å¸ƒå±€ä¸­ä½¿ç”¨å›¾ç‰‡å ä½ç¬¦ï¼Œä½ å¯ä»¥é¿å…è¿™ç§è·³åŠ¨ï¼Œæ¥ç¡®ä¿æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ä»¥ä¸‹è¿™ä¸ª GIF å›¾å±•ç¤ºäº†æ²¡æœ‰å›¾ç‰‡å ä½ç¬¦æ—¶å¸ƒå±€çš„è·³åŠ¨ï¼š åœ¨ DartPad ä¸­æŸ¥çœ‹å®Œæ•´ä¾‹å­ å¦‚æœä½ çš„ app ä¸­å·²ç»ç¼“å­˜äº†ä¸€ä¸ªå›¾ç‰‡å ä½ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ FadeInImage widget æ¥æ˜¾ç¤ºå ä½ç¬¦ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ä¸€ä¸ª widget è€Œä¸æ˜¯å›¾ç‰‡ä½œä¸ºå ä½ç¬¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ Image.frameBuilder å±æ€§ã€‚ Image.frameBuilder å±æ€§è´Ÿè´£æ„å»ºä¸€ä¸ªå›¾ç‰‡ widget ï¼Œå®ƒæœ‰å››ä¸ªå‚æ•°ï¼š contextï¼šæ„å»ºä¸Šä¸‹æ–‡ childï¼š widget å­å…ƒç´  frameï¼šä¸€ä¸ªä»£ç è¯¥ frame çš„æ•°å­—ï¼Œå¦‚æœå›¾ç‰‡è¿˜åœ¨åŠ è½½ä¸­çš„è¯ï¼Œä¸º null wasSynchronousLoaded ï¼šå¸ƒå°”å€¼ï¼Œå›¾ç‰‡åŠ è½½å®Œæˆåä¸º true å®ç°å ä½ç¬¦ widget æ—¶ï¼Œé¦–å…ˆè¦é€šè¿‡ wasSynchronousLoaded æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å·²ç»åŠ è½½å®Œæˆï¼Œå¦‚æœåŠ è½½å®Œæˆï¼Œè¿”å› child ã€‚å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨ AnimatedSwitcher widget æ¥åˆ›å»ºä¸€ä¸ªå ä½ç¬¦åˆ°æ˜¾ç¤ºå›¾ç‰‡çš„æ¸ç°åŠ¨ç”»ï¼š 123456789101112131415161718192021222324252627class ImageWidgetPlaceholder extends StatelessWidget &#123; const ImageWidgetPlaceholder(&#123; Key key, this.image, this.placeholder, &#125;) : super(key: key); final ImageProvider image; final Widget placeholder; @override Widget build(BuildContext context) &#123; return Image( image: image, frameBuilder: (context, child, frame, wasSynchronousLoaded) &#123; if (wasSynchronousLoaded) &#123; return child; &#125; else &#123; return AnimatedSwitcher( duration: const Duration(milliseconds: 500), child: frame != null ? child : placeholder, ); &#125; &#125;, ); &#125;&#125; æœ‰äº†å ä½ç¬¦ï¼Œå¸ƒå±€å†ä¹Ÿä¸ä¼šè·³æ¥è·³å»äº†ï¼Œè€Œä¸”å›¾ç‰‡ä¹Ÿæœ‰äº†æ¸ç°æ•ˆæœï¼š åœ¨ DartPad ä¸­æŸ¥çœ‹å®Œæ•´ä¾‹å­ é¢„ç¼“å­˜å›¾ç‰‡å¦‚æœä½ çš„ app åœ¨æ˜¾ç¤ºå›¾ç‰‡ç•Œé¢ä¹‹å‰æœ‰æ¬¢è¿ç•Œé¢ï¼Œä½ å¯ä»¥è°ƒç”¨ precacheImage æ–¹æ³•æ¥é¢„ç¼“å­˜å›¾ç‰‡ã€‚ 1precacheImage(NetworkImage(url), context); æ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š åœ¨ DartPad ä¸­æŸ¥çœ‹å®Œæ•´ä¾‹å­ åœ¨ Flutter web app ä¸­ç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»ä¸€èˆ¬åœ¨ç”¨æˆ·åˆ‡æ¢é¡µé¢æ—¶ä½¿ç”¨ï¼Œåœ¨ç§»åŠ¨ app ä¸­ï¼Œè¿™ç§æ–¹å¼å¯ä»¥å¾ˆå¥½åœ°è®©ç”¨æˆ·çŸ¥é“çŸ¥é“è‡ªå·±åœ¨å“ªé‡Œã€‚ä½†æ˜¯ï¼Œåœ¨ web ä¸­ï¼Œå¾ˆå°‘çœ‹åˆ°è¿™æ ·çš„äº¤äº’ã€‚æ‰€ä»¥ä¸ºäº†æé«˜æ„ŸçŸ¥æ€§èƒ½ï¼Œä½ å¯ä»¥ç¦ç”¨é¡µé¢é—´çš„è¿‡æ¸¡åŠ¨ç”»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ MaterialApp ä¼šæ ¹æ®ä¸åŒå¹³å°æ¥ä½¿ç”¨ä¸åŒçš„è¿‡æ¸¡åŠ¨ç”»ï¼ˆAndroid å‘ä¸Šæ»‘åŠ¨ï¼Œè€Œ iOS æ˜¯å‘å³ï¼ˆå·¦ï¼‰æ»‘åŠ¨ï¼‰ã€‚ä¸ºäº†è¦†ç›–è¿™ä¸ªé»˜è®¤è¡Œä¸ºï¼Œä½ éœ€è¦åˆ›å»ºè‡ªå®šä¹‰çš„ PageTransitionsTheme ç±»ã€‚ä½ å¯ä»¥ä½¿ç”¨ kIsWeb å¸¸é‡æ¥åˆ¤æ–­ app æ˜¯å¦åœ¨ web ä¸­è¿è¡Œã€‚å¦‚æœæ˜¯ï¼Œé€šè¿‡è¿”å› child æ¥ç¦ç”¨è¿‡æ¸¡åŠ¨ç”»ï¼š 123456789101112131415161718192021222324import 'package:flutter/foundation.dart';import 'package:flutter/material.dart';class NoTransitionsOnWeb extends PageTransitionsTheme &#123; @override Widget buildTransitions&lt;T&gt;( route, context, animation, secondaryAnimation, child, ) &#123; if (kIsWeb) &#123; return child; &#125; return super.buildTransitions( route, context, animation, secondaryAnimation, child, ); &#125;&#125; è®¾ç½® MaterialApp çš„ pageTransitionsTheme é€‰é¡¹ï¼š 12345MaterialApp( theme: ThemeData( pageTransitionsTheme: NoTransitionsOnWeb(), ),) æ²¡æœ‰ä»»ä½•è¿‡æ¸¡åŠ¨ç”»çš„é¡µé¢åˆ‡æ¢æ•ˆæœå¦‚ä¸‹ï¼š åœ¨ DartPad ä¸­æŸ¥çœ‹å®Œæ•´çš„äº¤äº’ä¾‹å­ ç»“è¯­å¸Œæœ›ä½ åœ¨æœ¬æ–‡ä¸­æ‰¾åˆ°ä¸€äº›æœ‰ç”¨çš„æŠ€å·§æ¥æé«˜ Flutter web app çš„æ„ŸçŸ¥æ€§èƒ½ã€‚åœ¨ Flutter Gallery ä¸­ï¼Œæˆ‘ä»¬ç¦ç”¨äº† web ç«¯çš„å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»å’Œä½¿ç”¨äº†å›¾ç‰‡å ä½ç¬¦æ¥é¿å…åŠ è½½é¡µé¢æ—¶å¸ƒå±€çš„è·³åŠ¨ï¼Œå…¶ä¸­çš„å®ç°å’Œæœ¬æ–‡æ‰€æè¿°çš„æ˜¯ç±»ä¼¼ï¼Œå¦‚æœä½ æƒ³çœ‹ä»£ç ï¼Œå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚ æ„Ÿè°¢é˜…è¯»ï¼ è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»¬åœ¨æé«˜ Flutter Gallery æ€§èƒ½ä¸­å­¦ä¹ åˆ°çš„ç³»åˆ—å†…å®¹ä¹‹ä¸€ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œèƒ½è®©ä½ å­¦åˆ°å¯ä»¥åœ¨ä½ çš„ Flutter app ä¸­ç”¨ä¸Šçš„å†…å®¹ã€‚ç³»åˆ—æ–‡ç« å¦‚ä¸‹ï¼š Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹ tree shaking å’Œå»¶è¿ŸåŠ è½½ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹å›¾ç‰‡å ä½ç¬¦ã€é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”»ï¼ˆæœ¬æ–‡ï¼‰ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹æ‰“é€ é«˜æ€§èƒ½ widget","pubDate":"Tue, 13 Oct 2020 12:45:00 GMT","guid":"https://aotu.io/notes/2020/10/13/improving-perceived-performance-with-image-placeholders-precaching-and-disabled-navigation/","category":"Flutter"},{"title":"Flutter æ€§èƒ½ä¼˜åŒ–ï¼štree shaking å’Œå»¶è¿ŸåŠ è½½","link":"https://aotu.io/notes/2020/10/13/optimizing-performance-in-flutter-web-apps-with-tree-shaking-and-deferred-loading/","description":"æœ¬æ–‡æ˜¯ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—æ–‡ç« ä¹‹ä¸€ï¼Œè®°å½•äº† Flutter å›¢é˜Ÿä¼˜åŒ– Flutter Galleryï¼ˆhttps://gallery.flutter.dev/#/ï¼‰ çš„å®è·µã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº† tree shaking å’Œå»¶è¿ŸåŠ è½½åœ¨æ€§èƒ½ä¼˜åŒ–ä¸­çš„ä½¿ç”¨ã€‚åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/flutter/optimizing-performance-in-flutter-web-apps-with-tree-shaking-and-deferred-loading-535fbe3cd67 åœ¨ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒä¸­ï¼Œapp çš„åŠ è½½é€Ÿåº¦æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚Flutter web app çš„åˆæ¬¡åŠ è½½æ—¶é—´å¯ä»¥é€šè¿‡æœ€å°åŒ– JS åŒ…ä½“ç§¯æ¥æé«˜ã€‚Dart ç¼–è¯‘å™¨è‡ªå¸¦ tree shaking å’Œå»¶è¿ŸåŠ è½½ç‰¹æ€§ï¼Œè¿™ä¸¤è€…éƒ½å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ JS åŒ…ä½“ç§¯ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†è¿™ä¸¤ä¸ªç‰¹æ€§çš„å·¥ä½œåŸç†ï¼Œä»¥åŠå¦‚ä½•åº”ç”¨ã€‚ é»˜è®¤å¼€å¯çš„ tree shaking ç‰¹æ€§ç¼–è¯‘ Flutter web app æ—¶ï¼ŒJS åŒ…æ˜¯é€šè¿‡ dart2js ç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚ä¸€æ¬¡ release æ„å»ºå°†ä¼šå¾—åˆ°æœ€é«˜çº§åˆ«çš„ä¼˜åŒ–ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† tree shakingã€‚ Tree shaking æ˜¯ä¸€ä¸ªé€šè¿‡åªå°†ä¸€å®šä¼šè¢«æ‰§è¡Œåˆ°çš„ä»£ç åŒ…å«è¿›æ¥ï¼Œä»è€Œå‰”é™¤æ— ç”¨ä»£ç çš„è¿‡ç¨‹ã€‚æ‰€ä»¥è¯´ï¼Œä½ ä¸ç”¨æ‹…å¿ƒä½ çš„ app å¼•ç”¨çš„å„ç§åº“ï¼Œå› ä¸ºæ²¡æœ‰ç”¨åˆ°çš„ class æˆ–è€… function ä¼šè¢«æ’é™¤æ‰ã€‚ æ¥çœ‹ä¸€ä¸‹ tree shaking çš„å®é™…æ•ˆæœï¼š åˆ›å»ºä¸€ä¸ª Dart æ–‡ä»¶ greeter.dart : 123456789101112131415abstract class Greeter &#123; String greet(String name);&#125;class EnglishGreeter implements Greeter &#123; String greet(String name) =&gt; 'Hello $name';&#125;class SwedishGreeter implements Greeter &#123; String greet(String name) =&gt; 'Hej $name';&#125;void main() &#123; print(EnglishGreeter().greet('World'));&#125; æ‰§è¡Œ dart2js -04 greeter.dart å‘½ä»¤ï¼Œç„¶åçœ‹ä¸€ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ out.jsã€‚ åœ¨ç”Ÿæˆçš„ JS ä»£ç ä¸­ï¼Œæ²¡æœ‰ SwedishGreeter ç±»ï¼Œä¹Ÿæ‰¾ä¸åˆ° Hej $nameï¼Œå› ä¸ºå®ƒä»¬åœ¨ tree shaking è¿‡ç¨‹ä¸­è¢«ç¼–è¯‘å™¨ç§»é™¤äº†ã€‚ å¦‚æœåªé€šè¿‡é™æ€åˆ†æï¼Œç¼–è¯‘å™¨åªèƒ½æ‰¾å‡ºå“ªäº›ä»£ç æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œå“ªäº›ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚ greeter çš„å®šä¹‰ä¾èµ–ç³»ç»Ÿåœ°åŒºè®¾ç½®ï¼š 123456Locale locale = Localizations.localeOf(context);if (locale.languageCode == 'sv') &#123; greeter = SwedishGreeter();&#125; else &#123; greeter = EnglishGreeter();&#125; ç¼–è¯‘å™¨ä¸çŸ¥é“ç”¨æˆ·çš„ç³»ç»Ÿåœ°åŒºè®¾ç½®ï¼Œå› æ­¤ EnglishGreeter å’Œ SwedishGreeter éƒ½ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå»¶è¿ŸåŠ è½½å¯ä»¥å¸®åŠ©å‡å°‘åˆå§‹åŒ–çš„åŒ…ä½“ç§¯ã€‚ å»¶è¿ŸåŠ è½½å»¶è¿ŸåŠ è½½ï¼Œä¹Ÿå«æ‡’åŠ è½½ï¼Œå…è®¸ä½ åœ¨éœ€è¦æ—¶å†åŠ è½½å„ç§åº“ã€‚å®ƒå¯ä»¥ç”¨æ¥åŠ è½½ app ä¸­å¾ˆå°‘ç”¨åˆ°çš„åŠŸèƒ½ã€‚è¯·æ³¨æ„å»¶è¿ŸåŠ è½½æ˜¯ä¸€ä¸ª dart2js ç‰¹æ€§ï¼Œæ‰€ä»¥è¿™ä¸ªç‰¹æ€§å¯¹ç§»åŠ¨ç«¯ Flutter app ä¸å¯ç”¨ã€‚åœ¨ä»¥ä¸‹è¿™ä¸ªæœ€ç®€å•çš„ä¾‹å­ä¸­ï¼Œå°†åŒ…æˆ–è€…æ–‡ä»¶å¼•å…¥ä¸º deferredï¼Œç„¶ååœ¨ä½¿ç”¨æ—¶å…ˆç­‰å¾…åŠ è½½ï¼š 123456import 'greeter.dart' deferred as greeter;void main() async &#123; await greeter.loadLibrary(); runApp(App(title: greeter.EnglishGreeter().greet('World')));&#125; åœ¨ Flutter ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ widgetï¼Œæ‰€ä»¥ä½ å¯èƒ½ä¼šéœ€è¦ç”¨åˆ° FutureBuilderã€‚å› ä¸ºä¸€ä¸ª widget çš„æ„å»ºæ–¹æ³•åº”è¯¥æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤ä½ ä¸èƒ½åœ¨ä¸€ä¸ªæ„å»ºæ–¹æ³•ä¸­å» await loadLibrary æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥åœ¨æ„å»ºæ–¹æ³•ä¸­è¿”å›ä¸€ä¸ª FutureBuilderï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ç­‰å¾…åŠ è½½åº“æ—¶ä½¿ç”¨å®ƒæ¥æ˜¾ç¤ºä¸åŒçš„ UIï¼š 123456789101112import 'greeter.dart' deferred as greeter;FutureBuilder( future: greeter.loadLibrary(), builder: (context, snapshot) &#123; if (snapshot.connectionState == ConnectionState.done) &#123; return Text(greeter.greet('World')); &#125; else &#123; return Text('Loading...'); &#125; &#125;,) ä½ å¯ä»¥å°è¯•è¿è¡Œè¿™ä¸ªä»“åº“ä¸­å®Œæ•´çš„ä¾‹å­ï¼Œæ‰“å¼€ Chrome å¼€å‘è€…å·¥å…·ï¼Œç„¶åç‚¹å‡»ç½‘ç»œ tab æŸ¥çœ‹ç½‘ç»œæ´»åŠ¨ã€‚åˆ·æ–°é¡µé¢æ¥è§‚å¯Ÿåº“æ˜¯ä»€ä¹ˆæ—¶å€™å¼•å…¥å’ŒåŠ è½½çš„ã€‚åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ï¼Œæ–‡ä»¶ main.dart.js_1.part.js çš„åŠ è½½æ˜¯å»¶è¿Ÿçš„ï¼š Flutter Gallery ä¸­çš„æœ¬åœ°åŒ–å»¶è¿ŸåŠ è½½Flutter Gallery æ”¯æŒè¶…è¿‡ 70 ä¸­è¯­è¨€ï¼Œä½†æ˜¯å¤§å¤šæ•°ç”¨æˆ·åªç”¨åˆ°ä¸€ç§ã€‚å»¶è¿ŸåŠ è½½æœ¬åœ°åŒ–å­—ç¬¦ä¸²æ˜¯è¿™ä¸ªç‰¹æ€§éå¸¸æ£’çš„åº”ç”¨ã€‚æ¯”å¦‚ï¼Œå®ç°äº†å»¶è¿ŸåŠ è½½æœ¬åœ°åŒ–å­—ç¬¦ä¸²ä¹‹åï¼Œapp çš„åˆå§‹åŒ– JS åŒ…ä½“ç§¯å‡å°‘äº†ä¸€åŠã€‚å¦‚æœä½ çš„ Flutter web app ä¸­æœ‰å¾ˆå¤šæœ¬åœ°åŒ–å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹å»¶è¿ŸåŠ è½½è¿™äº›æ–‡ä»¶ã€‚gen_l10n.dart è„šæœ¬ ä½¿ç”¨äº† â€“use-deferred-loading é€‰é¡¹æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼ˆç›®å‰åªåœ¨ 1.19 SDK master channel ä¸Šå¯ç”¨ï¼‰ã€‚ è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»¬åœ¨æé«˜ Flutter Gallery æ€§èƒ½ä¸­å­¦ä¹ åˆ°çš„ç³»åˆ—å†…å®¹ä¹‹ä¸€ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œèƒ½è®©ä½ å­¦åˆ°å¯ä»¥åœ¨ä½ çš„ Flutter app ä¸­ç”¨ä¸Šçš„å†…å®¹ã€‚ç³»åˆ—æ–‡ç« å¦‚ä¸‹ï¼š Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹ tree shaking å’Œå»¶è¿ŸåŠ è½½ï¼ˆæœ¬æ–‡ï¼‰ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹å›¾ç‰‡å ä½ç¬¦ã€é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”» Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹æ‰“é€ é«˜æ€§èƒ½ widget","pubDate":"Tue, 13 Oct 2020 12:45:00 GMT","guid":"https://aotu.io/notes/2020/10/13/optimizing-performance-in-flutter-web-apps-with-tree-shaking-and-deferred-loading/","category":"Flutter"},{"title":"Flutter æ€§èƒ½ä¼˜åŒ–ï¼šæ‰“é€ é«˜æ€§èƒ½ widget","link":"https://aotu.io/notes/2020/10/13/build-performant-flutter-widget/","description":"æœ¬æ–‡æ˜¯ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—æ–‡ç« ä¹‹ä¸€ï¼Œè®°å½•äº† Flutter å›¢é˜Ÿä¼˜åŒ– Flutter Galleryï¼ˆhttps://gallery.flutter.dev/#/ï¼‰ çš„å®è·µã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å¦‚ä½•æ‰“é€ é«˜æ€§èƒ½çš„ widgetã€‚åŸæ–‡é“¾æ¥ï¼šhttps://medium.com/flutter/building-performant-flutter-widgets-3b2558aa08fa æ‰€æœ‰æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€ widget éƒ½ä¼šå®ç° build() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å†³å®šäº†å®ƒä»¬æ˜¯å¦‚ä½•æ¸²æŸ“çš„ã€‚app ä¸­çš„ä¸€å±å°±å¯èƒ½æœ‰æˆç™¾ä¸Šåƒä¸ªéƒ¨ä»¶ï¼Œè¿™äº›éƒ¨ä»¶å¯èƒ½åªä¼šæ„å»ºä¸€æ¬¡ï¼Œæˆ–è€…åœ¨æœ‰åŠ¨ç”»æˆ–è€…æŸç§ç‰¹å®šçš„äº¤äº’æƒ…å†µä¸‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ„å»ºå¤šæ¬¡ã€‚å¦‚æœæƒ³æ„å»ºå¿«é€Ÿçš„ widgetï¼Œä½ ä¸€å®šè¦å¾ˆè°¨æ…åœ°é€‰æ‹©æ„å»ºå“ªäº› widgetï¼Œä»¥åŠåœ¨ä»€ä¹ˆæ—¶å€™æ„å»ºã€‚ è¿™ç¯‡æ–‡ç« ä¸»è¦è®¨è®ºåªæ„å»ºå¿…è¦çš„å’Œåªåœ¨å¿…è¦æ—¶æ„å»ºï¼Œç„¶åä¼šåˆ†äº«æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåŠæ³•æ¥æ˜¾è‘—æé«˜ Flutter Gallery çš„æ€§èƒ½ã€‚æˆ‘ä»¬è¿˜ä¼šåˆ†äº«ä¸€äº›é«˜çº§æŠ€å·§ç”¨äºè¯Šæ–­ä½ çš„ web app ä¸­ç±»ä¼¼çš„é—®é¢˜ã€‚ åªåœ¨å¿…è¦æ—¶æ„å»ºä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–æ–¹æ³•æ˜¯ï¼Œåªåœ¨ç»å¯¹å¿…è¦æ—¶æ‰æ„å»º widgetã€‚ è°¨æ…åœ°è°ƒç”¨ setState()è°ƒç”¨ setState æ–¹æ³•ä¼šå¼•èµ· build() æ–¹æ³•è°ƒç”¨ã€‚å¦‚æœè°ƒç”¨å¤ªå¤šæ¬¡ï¼Œä¼šä½¿æ€§èƒ½å˜æ…¢ã€‚ çœ‹ä¸€ä¸‹ä¸‹é¢çš„åŠ¨ç”»ï¼Œæ˜¾ç¤ºåœ¨å‰é¢çš„é»‘è‰² widget å‘ä¸‹æ»‘åŠ¨ï¼Œéœ²å‡ºåé¢ç±»ä¼¼æ£‹ç›˜çš„é¢æ¿ï¼Œç±»ä¼¼äº bottom sheet çš„è¡Œä¸ºã€‚å‰é¢é»‘è‰² widget å¾ˆç®€å•ï¼Œä½†æ˜¯åé¢çš„ widget å¾ˆå¿™ç¢Œã€‚ 123456789101112Stack( children: [ Back(), PositionedTransition( rect: RelativeRectTween( begin: RelativeRect.fromLTRB(0, 0, 0, 0), end: RelativeRect.fromLTRB(0, MediaQuery.of(context).size.height, 0, 0), ).animate(_animationController), child: Front(), ) ], ), ä½ å¯èƒ½ä¼šåƒä»¥ä¸‹è¿™æ ·å†™çˆ¶ widgetï¼Œä½†åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œè¿™æ ·æ˜¯é”™è¯¯çš„ï¼š 1234567891011121314// BAD CODE@overridevoid initState() &#123; super.initState(); _animationController = AnimationController( duration: Duration(seconds: 3), vsync: this, ); _animationController.addListener(() &#123; setState(() &#123; // Rebuild when animation ticks &#125;); &#125;);&#125; è¿™æ ·æ€§èƒ½å¹¶ä¸å¥½ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºåŠ¨ç”»åœ¨åšä¸å¿…è¦çš„å·¥ä½œã€‚ ä»¥ä¸‹æ˜¯æœ‰é—®é¢˜çš„ä»£ç ï¼š 123456// BAD CODE_animationController.addListener(() &#123; setState(() &#123; // Rebuild when animation ticks. &#125;);&#125;); è¿™ç§ç±»å‹çš„åŠ¨ç”»åªåœ¨ä½ éœ€è¦è®©æ•´ä¸ª widget åŠ¨èµ·æ¥æ—¶æ‰æ¨èä½¿ç”¨ï¼Œä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬åœ¨è¿™ç§å¸ƒå±€ä¸­éœ€è¦çš„ã€‚ åœ¨åŠ¨ç”»ç›‘å¬å™¨ä¸­è°ƒç”¨ setState() ä¼šå¼•èµ·æ•´ä¸ª Stack é‡æ–°æ„å»ºï¼Œè¿™æ˜¯å®Œå…¨æ²¡å¿…è¦çš„ PositionedTransition éƒ¨ä»¶å·²ç»ä¸€ä¸ª AnimatedWidget äº†ï¼Œæ‰€ä»¥å®ƒä¼šåœ¨åŠ¨ç”»å¼€å§‹çš„æ—¶å€™è‡ªåŠ¨é‡æ–°æ„å»º ä¸éœ€è¦åœ¨è¿™é‡Œè°ƒç”¨ setState() å³ä½¿åé¢çš„ç»„ä»¶æ˜¯å¾ˆå¿™ç¢Œçš„ï¼Œå‰é¢çš„ç»„ä»¶åŠ¨ç”»ä¹Ÿå¯ä»¥è¾¾åˆ° 60 FPSã€‚æ›´å¤šæœ‰å…³åˆç†åœ°è°ƒç”¨ setState æ–¹æ³•çš„å†…å®¹ï¼Œè¯·çœ‹ Flutter å¡é¡¿çš„åŠ¨ç”»ï¼šä½ ä¸è¯¥è¿™æ · setState åªæ„å»ºå¿…è¦çš„éƒ¨åˆ†é™¤äº†åªåœ¨å¿…è¦çš„æ—¶å€™è¿›è¡Œæ„å»ºï¼Œä½ è¿˜éœ€è¦åªæ„å»º UI ä¸­å˜åŒ–çš„éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸»è¦å…³æ³¨å¦‚ä½•åˆ›å»ºä¸€ä¸ªé«˜æ€§èƒ½çš„ listã€‚ ä¼˜å…ˆä½¿ç”¨ ListView.builder()é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç®€å•åœ°çœ‹çœ‹æ˜¾ç¤º list çš„åŸºç¡€ï¼š ç«– list ä½¿ç”¨ Column å¦‚æœ list éœ€è¦æ»šåŠ¨ï¼Œä½¿ç”¨ ListView å¦‚æœ list æœ‰å¾ˆå¤š itemï¼Œä½¿ç”¨ ListView.builderï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨ item æ»šåŠ¨è¿›å…¥å±å¹•çš„æ—¶å€™æ‰åˆ›å»º itemï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„ itemã€‚è¿™åœ¨ list å¾ˆå¤æ‚å’Œ widget åµŒå¥—å¾ˆæ·±çš„æƒ…å†µä¸‹ï¼Œæœ‰æ˜æ˜¾çš„æ€§èƒ½ä¼˜åŠ¿ã€‚ ä¸ºäº†è§£é‡Šå¤š item æƒ…å†µä¸‹ ListView.builder ç›¸è¾ƒäº ListView çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚ åœ¨è¿™ä¸ª DartPad ä¾‹å­ä¸­è¿è¡Œä»¥ä¸‹ ListViewã€‚ä½ å¯ä»¥çœ‹åˆ° 8 ä¸ª item éƒ½åˆ›å»ºå¥½äº†ã€‚ï¼ˆç‚¹å‡»å·¦ä¸‹è§’çš„ Console æŒ‰é’®ï¼Œç„¶åç‚¹å‡»RunæŒ‰é’®ã€‚å³è¾¹çš„è¾“å‡ºé¢æ¿æ²¡æœ‰æ»šåŠ¨æ¡ï¼Œä½†æ˜¯ä½ å¯ä»¥æ»šåŠ¨å†…å®¹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°çœ‹åˆ°ä»€ä¹ˆè¢«åˆ›å»ºäº†ä»¥åŠä»€ä¹ˆæ—¶å€™è¿›è¡Œæ„å»ºï¼‰ 123456789101112ListView( children: [ _ListItem(index: 0), _ListItem(index: 1), _ListItem(index: 2), _ListItem(index: 3), _ListItem(index: 4), _ListItem(index: 5), _ListItem(index: 6), _ListItem(index: 7), ],); æ¥ä¸‹æ¥ï¼Œåœ¨è¿™ä¸ª DartPad ä¾‹å­ä¸­è¿è¡Œ ListView.builderã€‚ä½ å¯ä»¥çœ‹åªæœ‰å¯è§çš„ item è¢«åˆ›å»ºäº†ï¼Œå½“ä½ æ»šåŠ¨æ—¶ï¼Œæ–°çš„ item æ‰è¢«åˆ›å»ºã€‚ 123456ListView.builder( itemBuilder: (context, index) &#123; return _ListItem(index: index); &#125;, itemCount: 8,); ç°åœ¨ï¼Œè¿è¡Œè¿™ä¸ªä¾‹å­ã€‚åœ¨è¿™é‡Œä¾‹å­ä¸­ï¼ŒListViewçš„å­©å­éƒ½æ˜¯æå‰ä¸€æ¬¡æ€§åˆ›å»ºå¥½çš„ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ ListView çš„æ•ˆç‡æ›´é«˜ã€‚ 1234567891011121314151617181920final listItems = [ _ListItem(index: 0), _ListItem(index: 1), _ListItem(index: 2), _ListItem(index: 3), _ListItem(index: 4), _ListItem(index: 5), _ListItem(index: 6), _ListItem(index: 7),];@overrideWidget build(BuildContext context) &#123; // è¿™ç§æƒ…å†µä¸‹ ListView.builder å¹¶ä¸ä¼šæœ‰æ€§èƒ½ä¸Šçš„å¥½å¤„ return ListView.builder( itemBuilder: (context, index) &#123; return listItems[index]; &#125;, itemCount: 8, );&#125; æ›´å¤šæœ‰å…³å»¶è¿Ÿæ„å»º list çš„å†…å®¹ï¼Œè¯·çœ‹ Slivers, Demystifiedã€‚ æ€æ ·é€šè¿‡ä¸€è¡Œä»£ç ï¼Œæå‡è¶…è¿‡ä¸¤å€çš„æ€§èƒ½Flutter Gallery æ”¯æŒè¶…è¿‡ 100 ä¸ªåœ°åŒºï¼›è¿™äº›åœ°åŒºï¼Œå¯èƒ½ä½ ä¹ŸçŒœåˆ°äº†ï¼Œæ˜¯é€šè¿‡ ListView.builder() æ¥å±•ç¤ºçš„ã€‚é€šè¿‡æŸ¥çœ‹ widget é‡æ–°æ„å»ºçš„æ¬¡æ•°ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°è¿™äº› item ä¼šåœ¨å¯åŠ¨æ—¶è¿›è¡Œä¸å¿…è¦çš„æ„å»ºã€‚è¿™ä¸ªæƒ…å†µæœ‰ç‚¹éš¾å‘ç°ï¼Œå› ä¸ºè¿™äº› item è—åœ¨æŠ˜å äº†ä¸¤å±‚çš„èœå•ä¸‹ï¼šè®¾ç½®é¢æ¿å’Œåœ°åŒºåˆ—è¡¨ã€‚ï¼ˆåæ¥æˆ‘ä»¬å‘ç°ï¼Œå› ä¸ºä½¿ç”¨äº† ScaleTransitioin ï¼Œè®¾ç½®é¢æ¿åœ¨ä¸å¯è§çŠ¶æ€ä¸‹ä¹Ÿä¼šè¿›è¡Œæ¸²æŸ“ï¼Œæ„å‘³ç€å®ƒä¼šä¸æ–­åœ°è¢«æ„å»ºï¼‰ã€‚ é€šè¿‡ç®€å•åœ°å°† ListView.builder çš„ itemCount åœ¨æœªå±•å¼€çŠ¶æ€ä¸‹è®¾ç½®ä¸º 0ï¼Œæˆ‘ä»¬ç¡®ä¿äº† item åªä¼šåœ¨å±•å¼€çš„ã€å¯è§çš„è®¾ç½®é¢æ¿ä¸­æ‰è¿›è¡Œæ„å»ºã€‚è¿™ä¸€è¡Œæ”¹åŠ¨æé«˜äº†åœ¨ web ç¯å¢ƒä¸‹æ¸²æŸ“æ—¶é—´å°†è¿‘ä¸¤å€ï¼Œå…¶ä¸­çš„å…³é”®æ˜¯å®šä½è¿‡åº¦çš„ widget æ„å»ºã€‚ å¦‚ä½•æŸ¥çœ‹ widget çš„æ„å»ºæ¬¡æ•°è™½ç„¶ Flutter çš„æ„å»ºæ˜¯å¾ˆé«˜æ•ˆçš„ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°è¿‡åº¦æ„å»ºå¯¼è‡´æ€§èƒ½é—®é¢˜çš„æƒ…å†µã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¸®åŠ©å®šä½è¿‡åº¦çš„ widget æ„å»ºï¼š ä½¿ç”¨ Android Studio/IntelliJAndroid Studio å’Œ IntelliJ å¼€å‘è€…å¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„å·¥å…·æ¥æŸ¥çœ‹ widget é‡æ–°æ„å»ºä¿¡æ¯ã€‚ ä¿®æ”¹ Flutter æ¡†æ¶æœ¬èº«å¦‚æœä½¿ç”¨çš„ä¸æ˜¯ä»¥ä¸Šçš„ç¼–è¾‘å™¨ï¼Œæˆ–è€…å¸Œæœ›å¯ä»¥çŸ¥é“ web ç¯å¢ƒä¸‹ widget çš„é‡æ–°æ„å»ºæ¬¡æ•°ï¼Œä½ å¯ä»¥åœ¨ Flutter æ¡†æ¶ä¸­åŠ å…¥å‡ è¡Œç®€å•çš„ä»£ç ã€‚ å…ˆçœ‹ä¸€ä¸‹è¾“å‡ºæ•ˆæœï¼š 1234RaisedButton 1RawMaterialButton 2ExpensiveWidget 538Header 5 å…ˆå®šä½åˆ°æ–‡ä»¶ï¼š&lt;Flutter path&gt;/packages/flutter/lib/src/widgets/framework.dart ï¼Œç„¶ååŠ å…¥ä»¥ä¸‹ä»£ç ã€‚è¿™äº›ä»£ç ä¼šåœ¨å¯åŠ¨æ—¶ç»Ÿè®¡ widget çš„æ„å»ºæ¬¡æ•°ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´ï¼ˆè¿™é‡Œè®¾ç½®çš„æ˜¯ 10 ç§’ï¼‰åè¾“å‡ºç»“æœã€‚ 123456789101112131415161718192021222324252627bool _outputScheduled = false;Map&lt;String, int&gt; _outputMap = &lt;String, int&gt;&#123;&#125;;void _output(Widget widget) &#123; final String typeName = widget.runtimeType.toString(); if (_outputMap.containsKey(typeName)) &#123; _outputMap[typeName] = _outputMap[typeName] + 1; &#125; else &#123; _outputMap[typeName] = 1; &#125; if (_outputScheduled) &#123; return; &#125; _outputScheduled = true; Timer(const Duration(seconds: 10), () &#123; _outputMap.forEach((String key, int value) &#123; switch (widget.runtimeType.toString()) &#123; // Filter out widgets whose build counts we don't care about case 'InkWell': case 'RawGestureDetector': case 'FocusScope': break; default: print('$key $value'); &#125; &#125;); &#125;);&#125; ç„¶åï¼Œä¿®æ”¹ StatelessElement å’Œ StatelessElement çš„ build æ–¹æ³•æ¥è°ƒç”¨ _output(widget)ã€‚ 12345678910111213141516class StatelessElement extends ComponentElement &#123; ...@override Widget build() &#123; final Widget w = widget.build(this); _output(w); return w; &#125;class StatefulElement extends ComponentElement &#123;...@override Widget build() &#123; final Widget w = _state.build(this); _output(w); return w; &#125; ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ä¿®æ”¹åçš„ framework.dart æ–‡ä»¶ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡ æ¬¡é‡æ–°æ„å»ºä¸ä¸€å®šä¼šå¼•èµ·é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªåŠæ³•å¯ä»¥é€šè¿‡éªŒè¯ä¸å¯è§çš„ widget æ˜¯å¦åœ¨æ„å»ºæ¥å¸®ä½  debug æ€§èƒ½é—®é¢˜ã€‚ web ä¸“ç”¨ tipsï¼šä½ å¯ä»¥æ·»åŠ ä¸€ä¸ª resetOutput å‡½æ•°ï¼ˆå¯ä»¥åœ¨æµè§ˆå™¨çš„æ§åˆ¶å°ä¸­è°ƒç”¨ï¼‰æ¥è·å–éšæ—¶è·å– widget çš„æ„å»ºæ¬¡æ•°ã€‚ import 'dart:js' as js; void resetOutput() { _outputScheduled = false; _outputMap = &lt;String, int&gt;{}; } void _output(Widget widget) { // Add this line js.context['resetOutput'] = resetOutput; ... æŸ¥çœ‹ä¿®æ”¹åçš„ framework.dart æ–‡ä»¶ã€‚ ç»“è¯­é«˜æ•ˆçš„æ€§èƒ½è°ƒä¼˜éœ€è¦æˆ‘ä»¬æ˜ç™½åº•å±‚çš„å·¥ä½œåŸç†ã€‚æ–‡ç« é‡Œçš„ tips å¯ä»¥å¸®åŠ©ä½ å†³å®šä»€ä¹ˆæ—¶å€™æ„å»º widget æ¥ä½¿ä½ çš„ app åœ¨æ‰€æœ‰åœºæ™¯éƒ½ä¿æŒé«˜æ€§èƒ½ã€‚ è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ä»¬åœ¨æé«˜ Flutter Gallery æ€§èƒ½ä¸­å­¦ä¹ åˆ°çš„ç³»åˆ—å†…å®¹ä¹‹ä¸€ã€‚å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œèƒ½è®©ä½ å­¦åˆ°å¯ä»¥åœ¨ä½ çš„ Flutter app ä¸­ç”¨ä¸Šçš„å†…å®¹ã€‚ç³»åˆ—æ–‡ç« å¦‚ä¸‹ï¼š Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹ tree shaking å’Œå»¶è¿ŸåŠ è½½ Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹å›¾ç‰‡å ä½ç¬¦ã€é¢„ç¼“å­˜å’Œç¦ç”¨å¯¼èˆªè¿‡æ¸¡åŠ¨ç”» Flutter æ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹æ‰“é€ é«˜æ€§èƒ½ widgetï¼ˆæœ¬æ–‡ï¼‰ ä½ è¿˜å¯ä»¥æŸ¥çœ‹é€‚ç”¨æ‰€æœ‰æ°´å¹³å¼€å‘è€…çš„ Flutter UI æ€§èƒ½æ–‡æ¡£ã€‚","pubDate":"Tue, 13 Oct 2020 12:00:00 GMT","guid":"https://aotu.io/notes/2020/10/13/build-performant-flutter-widget/","category":"Flutter"},{"title":"ä½ å¯èƒ½ä¸çŸ¥é“çš„AnimationåŠ¨ç”»æŠ€å·§ä¸ç»†èŠ‚","link":"https://aotu.io/notes/2020/10/13/animation-skill/","description":"å¼•è¨€åœ¨ web åº”ç”¨ä¸­ï¼Œå‰ç«¯åŒå­¦åœ¨å®ç°åŠ¨ç”»æ•ˆæœæ—¶å¾€å¾€å¸¸ç”¨çš„å‡ ç§æ–¹æ¡ˆï¼š css3 transition / animation - å®ç°è¿‡æ¸¡åŠ¨ç”» setInterval / setTimeout - é€šè¿‡è®¾ç½®ä¸€ä¸ªé—´éš”æ—¶é—´æ¥ä¸æ–­çš„æ”¹å˜å›¾åƒçš„ä½ç½® requestAnimationFrame - é€šè¿‡ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ”¹å˜å›¾åƒä½ç½®ï¼Œç”±ç³»ç»Ÿæ¥å†³å®šè¿™ä¸ªå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼Œæ¯”å®šæ—¶ä¿®æ”¹çš„æ€§èƒ½æ›´å¥½ï¼Œä¸å­˜åœ¨å¤±å¸§ç°è±¡ åœ¨å¤§å¤šæ•°éœ€æ±‚ä¸­ï¼Œcss3 çš„ transition / animation éƒ½èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¹¶ä¸”ç›¸å¯¹äº js å®ç°ï¼Œå¯ä»¥å¤§å¤§æå‡æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œé™ä½å¼€å‘æˆæœ¬ã€‚ æœ¬ç¯‡æ–‡ç« å°†ç€é‡å¯¹ animation çš„ä½¿ç”¨åšä¸ªæ€»ç»“ï¼Œå¦‚æœä½ çš„å·¥ä½œä¸­åŠ¨ç”»éœ€æ±‚è¾ƒå¤šï¼Œç›¸ä¿¡æœ¬ç¯‡æ–‡ç« èƒ½å¤Ÿè®©ä½ æœ‰æ‰€æ”¶è·ï¼š Animation å¸¸ç”¨åŠ¨ç”»å±æ€§ Animation å®ç°ä¸é—´æ–­æ’­æŠ¥ Animation å®ç°å›å¼¹æ•ˆæœ Animation å®ç°ç›´æ’­ç‚¹èµæ•ˆæœ â¤ï¸ Animation ä¸ Svg åˆä¼šæ“¦å‡ºæ€æ ·çš„ç«èŠ±å‘¢ï¼ŸğŸ”¥ Loading ç»„ä»¶ è¿›åº¦æ¡ç»„ä»¶ Animation steps() è¿ç”¨ â° å®ç°æ‰“å­—æ•ˆæœ ç»˜åˆ¶å¸§åŠ¨ç”» Animation å¸¸ç”¨åŠ¨ç”»å±æ€§ ä»‹ç»å®Œ animation å¸¸ç”¨å±æ€§ï¼Œä¸ºäº†å°†è¿™äº›å±æ€§æ›´å¥½åœ°ç†è§£ä¸è¿ç”¨ï¼Œä¸‹é¢å°†æ‰‹æŠŠæ‰‹å®ç°ä¸€äº› DEMO å…·ä½“è®²è¿° Animation å®ç°ä¸é—´æ–­æ’­æŠ¥ å®ç°ä¸é—´æ–­æ’­æŠ¥ DEMO é€šè¿‡ä¿®æ”¹å†…å®¹åœ¨çˆ¶å…ƒç´ ä¸­çš„ y è½´çš„ä½ç½®æ¥å®ç°å¹¿æ’­æ•ˆæœ 12345678910111213141516@keyframes scroll &#123; 0%&#123; transform: translate(0, 0); &#125; 100%&#123; transform: translate(0, -$height); &#125;&#125;.ul &#123; animation-name: scroll; animation-duration: 5s; animation-timing-function: linear; animation-iteration-count: infinite; /* animation: scroll 5s linear infinite; åŠ¨ç”»å±æ€§ç®€å†™ */&#125; æ­¤å¤„ä¸ºäº†ä¿å­˜å¹¿æ’­æ»šåŠ¨æ•ˆæœçš„è¿è´¯æ€§ï¼Œé˜²æ­¢æ»šåŠ¨åˆ°æœ€åä¸€å¸§æ—¶æ²¡æœ‰å†…å®¹ï¼Œéœ€è¦å¤šæ·»åŠ ä¸€æ¡é‡å¤æ•°æ®è¿›è¡Œå¡«å…… 12345678&lt;div class=\"ul\"&gt; &lt;div class=\"li\"&gt;å°åˆ˜åŒå­¦åŠ å…¥äº†å‡¹å‡¸å®éªŒå®¤&lt;/div&gt; &lt;div class=\"li\"&gt;å°é‚“åŒå­¦åŠ å…¥äº†å‡¹å‡¸å®éªŒå®¤&lt;/div&gt; &lt;div class=\"li\"&gt;å°æåŒå­¦åŠ å…¥äº†å‡¹å‡¸å®éªŒå®¤&lt;/div&gt; &lt;div class=\"li\"&gt;å°ç‹åŒå­¦åŠ å…¥äº†å‡¹å‡¸å®éªŒå®¤&lt;/div&gt; &lt;!-- æ’å…¥ç”¨äºå¡«å……çš„æ•°æ®æ•°æ® --&gt; &lt;div class=\"li\"&gt;å°åˆ˜åŒå­¦åŠ å…¥äº†å‡¹å‡¸å®éªŒå®¤&lt;/div&gt;&lt;/div&gt; Animation å®ç°å›å¼¹æ•ˆæœé€šè¿‡å°†è¿‡æ¸¡åŠ¨ç”»æ‹†åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µçš„ top å±æ€§åœç•™åœ¨ä¸åŒçš„ä½ç½®æ¥å®ç° å®ç°å›å¼¹æ•ˆæœ DEMO 1234567891011121314151617181920212223/* è§„å®šåŠ¨ç”»ï¼Œæ”¹å˜top,opacity */@keyframes animate &#123; 0% &#123; top: -100%; opacity: 0; &#125; 25% &#123; top: 60; opacity: 1; &#125; 50% &#123; top: 48%; opacity: 1; &#125; 75% &#123; top: 52%; opacity: 1; &#125; 100%&#123; top: 50%; opacity: 1; &#125;&#125; ä¸ºäº†è®©è¿‡æ¸¡æ•ˆæœæ›´è‡ªç„¶ï¼Œè¿™é‡Œé€šè¿‡ cubic-bezier() å‡½æ•°å®šä¹‰ä¸€ä¸ªè´å¡å°”æ›²çº¿æ¥æ§åˆ¶åŠ¨ç”»æ’­æ”¾é€Ÿåº¦ è¿‡æ¸¡åŠ¨ç”»æ‰§è¡Œå®Œåï¼Œä¸ºäº†å°†è®©å…ƒç´ åº”ç”¨åŠ¨ç”»æœ€åä¸€å¸§çš„å±æ€§å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ animation-fill-mode: forwards 12345678.popup &#123; animation-name: animate; animation-duration: 0.5s; animation-timing-function: cubic-bezier(0.21, 0.85, 1, 1); animation-iteration-count: 1; animation-fill-mode: forwards; /* animation: animate 0.5s cubic-bezier(0.21, 0.85, 1, 1) 1 forwards; åŠ¨ç”»å±æ€§ç®€å†™ */&#125; Animation å®ç°ç‚¹èµæ•ˆæœ Online Code å®ç°ç‚¹èµæ•ˆæœ DEMO ç›¸ä¿¡å¤§å¤šæ•°åŒå­¦éƒ½çŸ¥é“ç‚¹èµæ•ˆæœï¼Œæœ¬æ–‡ç« ä¼šå®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ç‚¹èµæ•ˆæœï¼Œä¸»è¦è®²è¿°ä¸€ä¸‹å®ç°æ€è·¯ï¼š ä¸ºäº†è®©æ°”æ³¡å¯ä»¥å‘ä¸Šåç§»ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®ç°ä¸€ä¸ª y è½´æ–¹å‘ä¸Šç§»åŠ¨çš„ @keyframes åŠ¨ç”» 123456789101112/* è§„å®šåŠ¨ç”»ï¼Œæ”¹å˜yè½´åç§»è·ç¦»*/@keyframes animation-y &#123; 0%&#123; transform: translate(-50%, 100px) scale(0); &#125; 50%&#123; transform: translate(-50%, -100px) scale(1.5); &#125; 100%&#123; transform: translate(-50%, -300px) scale(1.5); &#125;&#125; ä¸ºäº†è®©æ°”æ³¡å‘ä¸Šåç§»æ—¶æ˜¾å¾—ä¸å¤ªå•è°ƒï¼Œæˆ‘ä»¬å¯ä»¥å†å®ç°ä¸€ä¸ª x è½´æ–¹å‘ä¸Šç§»åŠ¨çš„ @keyframes åŠ¨ç”» 123456789101112131415/* è§„å®šåŠ¨ç”»ï¼Œæ”¹å˜xè½´åç§»è·ç¦» */@keyframes animation-x &#123; 0%&#123; margin-left: 0px; &#125; 25%&#123; margin-left: 25px; &#125; 75%&#123; margin-left: -25px; &#125; 100%&#123; margin-left: 0px; &#125;&#125; è¿™é‡Œæˆ‘ç†è§£ï¼š è™½ç„¶æ˜¯ä¿®æ”¹ margin æ¥æ”¹å˜ x è½´åç§»è·ç¦»ï¼Œä½†å®é™…ä¸Šä¸ä¿®æ”¹ transformæ²¡æœ‰å¤ªå¤§çš„æ€§èƒ½å·®å¼‚ å› ä¸ºé€šè¿‡ @keyframes animation-y ä¸­çš„ transform å·²ç»æ–°å»ºäº†ä¸€ä¸ªæ¸²æŸ“å±‚ ( PaintLayers ) animation å±æ€§ å¯ä»¥è®©è¯¥æ¸²æŸ“å±‚æå‡è‡³ åˆæˆå±‚(Compositing Layers) æ‹¥æœ‰å•ç‹¬çš„å›¾å½¢å±‚ ( GraphicsLayer )ï¼Œå³å¼€å¯äº†ç¡¬ä»¶åŠ é€Ÿ ï¼Œä¸ä¼šå½±å“å…¶ä»–æ¸²æŸ“å±‚çš„ paintã€layout å¯¹äºåˆæˆå±‚(Compositing Layers)ç›¸å…³çŸ¥è¯†ä¸æ˜¯å¾ˆäº†è§£çš„åŒå­¦ï¼Œå¯ä»¥é˜…è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ä»æµè§ˆå™¨æ¸²æŸ“å±‚é¢è§£æ css3 åŠ¨æ•ˆä¼˜åŒ–åŸç† å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ç¬”è€…è¿™é‡Œç†è§£æœ‰è¯¯ï¼Œè¿˜è¯·è¯»è€…å¤§ä½¬æŒ‡å‡ºï¼Œæ„Ÿæ¿€ä¸å°½~ ç»™æ°”æ³¡åº”ç”¨ä¸Šæˆ‘ä»¬æ‰€å®ç°çš„ä¸¤ä¸ª @keyframes åŠ¨ç”» 1234.bubble &#123; animation: animation-x 3s -2s linear infinite,animation-y 4s 0s linear 1;/* ç»™ bubble å¼€å¯äº†ç¡¬ä»¶åŠ é€Ÿ */&#125; åœ¨ç‚¹èµäº‹ä»¶ä¸­ï¼Œé€šè¿‡ js æ“ä½œåŠ¨æ€æ·»åŠ /ç§»é™¤æ°”æ³¡å…ƒç´  12345678function like() &#123; const likeDom = document.createElement('div'); likeDom.className = 'bubble'; // æ·»åŠ æ ·å¼ document.body.appendChild(likeDom); // æ·»åŠ å…ƒç´  setTimeout( () =&gt; &#123; document.body.removeChild(likeDom); // ç§»é™¤å…ƒç´  &#125;, 4000)&#125; Animation ä¸ Svg ç»˜åˆ¶ loading/è¿›åº¦æ¡ ç»„ä»¶ ğŸ”¥ Online Code Animation ä¸ Svg ç»˜åˆ¶ loading/è¿›åº¦æ¡ ç»„ä»¶ ğŸ”¥ DEMO é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨ svg ç»˜åˆ¶ä¸€ä¸ªåœ†å‘¨é•¿ä¸º2 * 25 * PI = 157 çš„åœ† 123&lt;svg with='200' height='200' viewBox=\"0 0 100 100\" &gt; &lt;circle cx=\"50\" cy=\"50\" r=\"25\" fill=\"transparent\" stroke-width=\"4\" stroke=\"#0079f5\" &gt;&lt;/circie&gt;&lt;/svg&gt; å°†å®çº¿åœ†ç»˜åˆ¶æˆè™šçº¿åœ†ï¼Œè¿™é‡Œéœ€è¦ç”¨ stoke-dasharray:50, 50 (å¯ç®€å†™ä¸º50) å±æ€§æ¥ç»˜åˆ¶è™šçº¿, stoke-dasharray å‚è€ƒèµ„æ–™ å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæ•°åˆ—ï¼Œæ•°ä¸æ•°ä¹‹é—´ç”¨é€—å·æˆ–è€…ç©ºç™½éš”å¼€ï¼ŒæŒ‡å®šçŸ­åˆ’çº¿(50px)å’Œç¼ºå£(50px)çš„é•¿åº¦ã€‚ ç”±äº50(çŸ­åˆ’çº¿) + 50(ç¼ºå£) + 50(æ®µåˆ’çº¿) = 150, 150 &lt; 157ï¼Œæ— æ³•ç»˜åˆ¶å‡ºå®Œæ•´çš„åœ†ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å³è¾¹å­˜åœ¨ç¼ºå£(7px) 123&lt;svg with='200' height='200' viewBox=\"0 0 100 100\" &gt; &lt;circle cx=\"50\" cy=\"50\" r=\"25\" fill=\"transparent\" stroke-width=\"4\" stroke-dasharray=\"50\" stroke=\"#0079f5\" &gt;&lt;/circie&gt;&lt;/svg&gt; stroke-dashoffset å±æ€§å¯ä»¥ä½¿åœ†çš„çŸ­åˆ’çº¿å’Œç¼ºå£äº§ç”Ÿåç§»ï¼Œæ·»åŠ  @keyframes åŠ¨ç”»åèƒ½å¤Ÿå®ç°ä»æ— åˆ°æœ‰çš„æ•ˆæœï¼Œstoke-dashoffset å‚è€ƒèµ„æ–™ è®¾ç½® stroke-dasharray=&quot;157 157â€œ,æŒ‡å®š çŸ­åˆ’çº¿(157px) å’Œ ç¼ºå£(157px) çš„é•¿åº¦ã€‚ æ·»åŠ  @keyframes åŠ¨ç”» ä¿®æ”¹stroke-dashoffsetå€¼, å€¼ä¸ºæ­£æ•°æ—¶é€†æ—¶é’ˆåç§»ğŸ”„,ï¼Œ å€¼ä¸ºè´Ÿæ•°æ—¶ï¼Œé¡ºæ—¶é’ˆåç§»ğŸ”ƒ 1234567891011@keyframes loading &#123; 0%&#123; stroke-dashoffset: 0; &#125; 100%&#123; stroke-dashoffset: -157; /* çº¿æ¡é¡ºæ—¶é’ˆåç§» */ &#125;&#125;circle&#123; animation: loading 1s 0s ease-out infinite;&#125; ä¿®æ”¹çŸ­åˆ’çº¿å’Œç¼ºå£å€¼ ä¸ºäº†è®© loading ç»„ä»¶çº¿æ¡å¯è§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª50pxçš„çŸ­åˆ’çº¿,è®¾ç½® stroke-dasharray=&quot;50&quot; ä¸ºäº†è®©çŸ­åˆ’çº¿å‘ç”Ÿåç§»åå¯ä»¥å®Œå…¨æ¶ˆå¤±ï¼Œç¼ºå£éœ€è¦å¤§äºæˆ–ç­‰äºåœ†å‘¨é•¿157ï¼Œè®¾ç½® stroke-dasharray=&quot;50 157&quot; æ·»åŠ  @keyframes åŠ¨ç”»,ä¸ºäº†è®©åŠ¨ç”»ç»“æŸæ—¶ä»å¤„ç†åŠ¨ç”»å¼€å§‹ä½ç½®ï¼Œéœ€è¦ä¿®æ”¹ stroke-dashoffset:-207(çŸ­åˆ’çº¿+ç¼ºå£é•¿åº¦) è¿›åº¦æ¡ä¹Ÿæ˜¯ç±»ä¼¼åŸç†ï¼Œå¸®åŠ©ç†è§£ stroke-dashoffset å±æ€§ï¼Œå…·ä½“å®ç°è¯·æŸ¥çœ‹ç¤ºä¾‹ 1234567891011@keyframes loading &#123; 0%&#123; stroke-dashoffset: 0; &#125; 100%&#123; stroke-dashoffset: -207; /* ä¿è¯åŠ¨ç”»ç»“æŸæ—¶ä»å¤„ç†åŠ¨ç”»å¼€å§‹ä½ç½® */ &#125;&#125;circle&#123; animation: loading 1s 0s ease-out infinite;&#125; Animation steps()è¿ç”¨steps() æ˜¯ animation-timing-function çš„å±æ€§å€¼ 1animation-timing-function : steps(number[, end | start]) steps å‡½æ•°æŒ‡å®šäº†ä¸€ä¸ªé˜¶è·ƒå‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•° ç¬¬ä¸€ä¸ªå‚æ•°æ¥å—ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¡¨ç¤ºä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´åˆ†å‡ æ­¥å®Œæˆ ç¬¬äºŒä¸ªå‚æ•°æœ‰ä¸¤ä¸ªå€¼ start or endã€‚é»˜è®¤å€¼ä¸º end step-start ç­‰åŒäº step(1, start)ã€‚step-end ç­‰åŒäº step(1, end) steps é€‚ç”¨äºå…³é”®å¸§åŠ¨ç”»ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°†ä¸¤ä¸ªå…³é”®å¸§ç»†åˆ†ä¸ºNå¸§ï¼Œç¬¬äºŒä¸ªå‚æ•°å†³å®šä»ä¸€å¸§åˆ°å¦ä¸€å¸§çš„ä¸­é—´é—´éš”æ˜¯ç”¨å¼€å§‹å¸§è¿˜æ˜¯ç»“æŸå¸§æ¥è¿›è¡Œå¡«å……ã€‚ çœ‹ä¸‹å›¾å¯ä»¥å‘ç°: steps(N, start)å°†åŠ¨ç”»åˆ†ä¸ºNæ®µï¼ŒåŠ¨ç”»åœ¨æ¯ä¸€æ®µçš„èµ·ç‚¹å‘ç”Ÿé˜¶è·ƒ(å³å›¾ä¸­çš„ç©ºå¿ƒåœ† â†’ å®å¿ƒåœ†),åŠ¨ç”»ç»“æŸæ—¶åœç•™åœ¨äº†ç¬¬ N å¸§ steps(N, end)å°†åŠ¨ç”»åˆ†ä¸ºNæ®µï¼ŒåŠ¨ç”»åœ¨æ¯ä¸€æ®µçš„ç»ˆç‚¹å‘ç”Ÿé˜¶è·ƒ(å³å›¾ä¸­çš„ç©ºå¿ƒåœ† â†’ å®å¿ƒåœ†),åŠ¨ç”»ç»“æŸæ—¶ç¬¬ N å¸§å·²ç»è¢«è·³è¿‡(å³å›¾ä¸­çš„ç©ºå¿ƒåœ† â†’ å®å¿ƒåœ†)ï¼Œåœç•™åœ¨äº† N+1 å¸§ã€‚ å®è·µå‡ºçœŸçŸ¥ï¼Animation å®ç°æ‰“å­—æ•ˆæœ Animation å®ç°æ‰“å­—æ•ˆæœ DEMO æ­¤å¤„ç”¨è‹±æ–‡å­—æ¯(Iâ€™m an O2man.)ä¸¾ä¾‹ï¼Œä¸€å…±æœ‰13ä¸ªå­—ç¬¦ã€‚[ç»æµ‹è¯•ï¼Œå¤šæ•°ä¸­æ–‡å­—ä½“æ¯ä¸ªå­—ç¬¦å®½é«˜éƒ½ç›¸ç­‰] steps(13)å¯ä»¥å°† @keyframes åŠ¨ç”»åˆ†ä¸º13é˜¶æ®µè¿è¡Œ,ä¸”æ¯ä¸€é˜¶æ®µè¿è¡Œè·ç¦»ç›¸ç­‰ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š 12345678910111213/* æ”¹å˜å®¹å™¨å®½åº¦ */@keyframes animate-x &#123; 0%&#123; width: 0; &#125;&#125;p &#123; width: 125px; overflow: hidden; border-right: 1px solid transparent; animation: animate-x 3s 0s steps(13) 1 forwards;&#125; å¯ä»¥å‘ç°ä»…ä»…è¿™æ ·è¿˜ä¸å¤Ÿï¼ŒåŠ¨ç”»è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å­—ç¬¦è¢«æˆªæ–­çš„æƒ…å†µ,ä¸ºäº†ä¿è¯æ¯ä¸ªé˜¶æ®µè¿è¡Œåèƒ½å‡†ç¡®æ— è¯¯åœ°æ˜¾ç¤ºå½“å‰æ‰€å¤„é˜¶æ®µçš„å­—ç¬¦ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿è¯æ¯ä¸ªå­—ç¬¦çš„widthä¸åŠ¨ç”»æ¯ä¸€é˜¶æ®µè¿è¡Œçš„è·ç¦»ç›¸ç­‰ è®¾ç½®Monacoå­—ä½“å±æ€§ï¼Œç”¨ä»¥ä¿è¯æ¯ä¸ªå­—ç¬¦çš„ width ç›¸åŒï¼Œå…·ä½“åƒç´ å—fontSizeå±æ€§å½±å“ï¼Œç¤ºä¾‹ä¸­çš„å­—ä½“å®½åº¦çº¦ä¸º 9.6pxï¼Œ9.6px * 13(æ®µæ•°) = 124.8px (125px)ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è®¾ç½®å®¹å™¨å®½åº¦ä¸º 125pxï¼Œå³å¯çš„è¾¾æˆç›®çš„ï¼šæ¯ä¸ªå­—ç¬¦çš„ width ä¸åŠ¨ç”»æ¯ä¸€é˜¶æ®µè¿è¡Œçš„è·ç¦»ç›¸ç­‰(çº¦ä¸º 9.6px )ã€‚ 1234567891011p &#123; /* è®¾ç½® Monaco å­—ä½“å±æ€§ï¼Œå­—ä½“å¤§å°ä¸º16pxï¼Œç”¨ä»¥ä¿è¯æ¯ä¸ªå­—ç¬¦çš„ width ç›¸åŒï¼Œwidth çº¦ä¸º9.6p */ font-family: Monaco; /* 9.6px * 13 = 124.8px (125px) */ width: 125px ; font-size: 16px; overflow: hidden; border-right: 1px solid transparent; /* åŒæ—¶åº”ç”¨åŠ¨ç”» animate-xã€cursor-x */ animation: animate-x 3s 0s steps(13) 1 forwards,cursor-x 0.4s 0s linear infinite;&#125; Animation å®ç°å¸§åŠ¨ç”» â° Animation å®ç°å¸§åŠ¨ç”» â° DEMO è¿™é‡Œæˆ‘ä»¬æ‹¿åˆ°äº†ä¸€å¼ 47å¸§çš„é›ªç¢§å›¾ï¼ˆcss spiritï¼‰,è®¾ç½®èƒŒæ™¯å›¾ 1234567.main &#123; width: 260px; height: 200px; background: url(url) no-repeat; background-size: 100%; background-position: 0 0;&#125; æ·»åŠ  @keyframes ä¿®æ”¹ background-positionï¼Œè®©èƒŒæ™¯å›¾ç§»åŠ¨ 1234567891011121314151617@keyframes animate &#123; 0% &#123; background-position: 0 0; &#125; 100% &#123; background-position: 0 100%; &#125;&#125;.main&#123; width: 260px; height: 200px; background: url(url) no-repeat; background-size: 100%; background-position: 0 0; animation: animate 2s 1s steps(47) infinite alternate;&#125; åŒæ—¶, css è¿˜æä¾›äº†animation-play-stateç”¨äºæ§åˆ¶åŠ¨ç”»æ˜¯å¦æš‚åœ 123input:checked+.main&#123; animation-play-state: paused;&#125; æ–‡ç« ç¯‡å¹…è¾ƒé•¿ï¼Œæ„Ÿè°¢å¤§å®¶çš„é˜…è¯»ï¼Œå¸Œæœ›å„ä½çœ‹å®¢èƒ½å¤Ÿæœ‰æ‰€æ”¶è·~ ~ ~ å‚è€ƒèµ„æ–™Animation å¸¸ç”¨åŠ¨ç”»å±æ€§CSS å‚è€ƒæ‰‹å†Œsteps() å‚è€ƒèµ„æ–™SVG å­¦ä¹ ä¹‹ stroke-dasharray å’Œ stroke-dashoffset è¯¦è§£ç†è§£ CSS3 Animation ä¸­çš„ steps()ã€è¯‘ã€‘css åŠ¨ç”»é‡Œçš„ steps()ç”¨æ³•è¯¦è§£CSS Will Change","pubDate":"Tue, 13 Oct 2020 12:00:00 GMT","guid":"https://aotu.io/notes/2020/10/13/animation-skill/","category":"ç»éªŒåˆ†äº«"},{"title":"ä½¿ç”¨ Vue3 å¼€å‘å°ç¨‹åº","link":"https://aotu.io/notes/2020/09/28/taro-vue3/","description":"å‰è¨€9 æœˆ 19 æ—¥å‡Œæ™¨ï¼ŒVue3 åœ¨ç»è¿‡å¤šä¸ªå¼€å‘ç‰ˆæœ¬çš„è¿­ä»£åï¼Œç»ˆäºè¿æ¥äº†å®ƒçš„æ­£å¼ç‰ˆæœ¬ï¼Œâ€One Pieceâ€ çš„ä»£å·ä¹Ÿæ˜­ç¤ºäº†å…¶å¼€æ‹“ä¼Ÿå¤§èˆªè·¯çš„é‡å¿ƒã€‚ Vue3 çš„æ–°ç‰¹æ€§ä¸»è¦æœ‰ Composition APIã€Teleportã€Fragments å’Œ &lt;script setup /&gt; &amp; &lt;style vars /&gt; ç­‰ã€‚æˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥åœ¨å°ç¨‹åºå¼€å‘ä¸­ä½¿ç”¨è¿™äº›ç‰¹æ€§å‘¢ï¼Ÿåœ¨ Taro çš„æ–‡æ¡£é‡Œæˆ‘ä»¬æ‰¾åˆ°äº†å…³äº Vue3 çš„ç« èŠ‚ï¼Œäº‹ä¸å®œè¿Ÿï¼Œè®©æˆ‘ä»¬å¼€å§‹å°è¯•å§ã€‚ Vue3 éƒ¨åˆ†æ–°ç‰¹æ€§è¿˜æ²¡äº†è§£è¿‡ Vue3 çš„åŒå­¦ä¹Ÿåˆ«æ€¥ï¼Œå…ˆäº†è§£ä¸‹ Vue3 çš„æ–°ç‰¹æ€§å§ï¼š 1.Composition APIVue2.X åŸºäº Option APIï¼ˆé€‰é¡¹ APIï¼‰æ„å»ºç»„ä»¶ï¼Œä¸€èˆ¬æ¥è¯´ç»„ä»¶æ‹¥æœ‰ dataã€methodsã€computed ç­‰é€‰é¡¹ã€‚è¿™æ˜¯ä¸€ç§å±æ€§ç›¸äº’éš”ç¦»çš„æ¨¡å¼ï¼Œå¥½å¤„æ˜¯å„å±æ€§å†…å®¹åˆ†ç¦»å¼€ï¼Œå¯¹äºæ–°æ‰‹æ¥è¯´æ¯”è¾ƒå‹å¥½ï¼›ä½†å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´ï¼Œä¸ºäº†ä¿®æ”¹æŸä¸ªåŠŸèƒ½ï¼Œå¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­æ¥å›ç¿»é¡µã€‚Vue3 å¢åŠ äº† Composition API æ–¹å¼ï¼ˆç»„åˆ API ï¼‰ï¼ŒåŸºäº reactivityï¼ˆå“åº”å¼ï¼‰çš„æ€æƒ³è¿›è¡Œç»„ä»¶æ„å»ºï¼Œå°†é€»è¾‘å°è£…åˆ°å‡½æ•°ä¸­ï¼Œå¯ä»¥å®ç°ç±»ä¼¼ ReactHooks çš„é€»è¾‘ç»„åˆå’Œé‡ç”¨ã€‚å¯¹äºå¤§å‹é¡¹ç›®ï¼Œä»£ç æŒ‰ç…§å…·ä½“åŠŸèƒ½åˆ’åˆ†ï¼Œè€Œä¸æ˜¯åˆ†æ•£åœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œé€»è¾‘æ›´åŠ ä¸€ç›®äº†ç„¶ã€‚ 2.Teleportï¼ˆä¼ å…¥ï¼‰Teleport åŠŸèƒ½ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†å…¨å±çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ Toastï¼‰ç§»åˆ° Vue APP èŠ‚ç‚¹å¤–ï¼Œè€Œä¸éœ€è¦åœ¨ UI ç•Œé¢ä¸Šä¿®æ”¹å…¶ä»–ç»„ä»¶æ ·å¼ï¼Œæ–¹ä¾¿å®ç°å…¨å±è’™å±‚ã€æµ®å±‚å¼¹çª—ç­‰æ•ˆæœã€‚ 3.Fragmentsï¼ˆç¢ç‰‡ï¼‰Vue2.x ç‰ˆæœ¬ä¸­ï¼Œ&lt;template /&gt; æ ‡ç­¾ä¸‹ä¸æ”¯æŒæ”¾ç½®å¤šä¸ªç»„ä»¶ï¼Œè¿™ä¸ªé™åˆ¶åœ¨ Vue3 ä¸­ä¸å†å­˜åœ¨ã€‚è¿™ç‚¹æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸‹è¿°ç»„ä»¶è®¾è®¡åœ¨ Vue3 ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼š 123456&lt;!-- Layout.vue --&gt;&lt;template&gt; &lt;header&gt;...&lt;/header&gt; &lt;main v-bind=\"$attrs\"&gt;...&lt;/main&gt; &lt;footer&gt;...&lt;/footer&gt;&lt;/template&gt; 4.å®éªŒæ€§è´¨çš„è¯­æ³•ç³– &lt;script setup&gt;ã€&lt;style vars&gt;a.&lt;script setup&gt;:ç”¨äºåœ¨ SFC ä¸­ä½¿ç”¨ Composition API çš„è¯­æ³•ç³–ï¼Œæ”¹å–„åœ¨å•ä¸ªæ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ Composition API æ—¶çš„ä½“éªŒã€‚ b.&lt;style vars&gt;: SFC ä¸­çŠ¶æ€é©±åŠ¨çš„ CSS å˜é‡ï¼Œå®ƒæä¾›äº†ç›´æ¥çš„ CSS é…ç½®å’Œå°è£…ï¼Œæ”¯æŒå°†ç»„ä»¶çŠ¶æ€é©±åŠ¨çš„ CSS å˜é‡æ³¨å…¥åˆ°â€œå•ä¸ªæ–‡ä»¶ç»„ä»¶â€æ ·å¼ä¸­ã€‚ é™¤äº†ä»¥ä¸Š 4 ç‚¹ä¹‹å¤–ï¼ŒVue3 è¿˜æä¾›äº†è‡ªå®šä¹‰æ¸²æŸ“ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒæ–‡æœ«çš„æ¨èé˜…è¯»æ–‡ç« ã€‚ å¦‚ä½•åœ¨ Taro é‡Œä½¿ç”¨ Vue3Vue3 å¸¦æ¥çš„æ–°ç‰¹æ€§å¯ä»¥è®©æˆ‘ä»¬æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆåœ°è¿›è¡Œå¼€å‘ï¼Œç°åœ¨ï¼Œæ¥å¼€å¯æˆ‘ä»¬åœ¨ Taro é‡Œä½¿ç”¨ Vue3 çš„ä½“éªŒä¹‹æ—…å§ã€‚ Taro å·²ç»é»˜è®¤å®‰è£… Taro3 ï¼Œæ‰€ä»¥æ­£å¸¸å®‰è£…å³å¯ï¼š 123456# ä½¿ç”¨ npm å®‰è£… CLI$ npm install -g @tarojs/cli# OR ä½¿ç”¨ yarn å®‰è£… CLI$ yarn global add @tarojs/cli# OR å®‰è£…äº† cnpmï¼Œä½¿ç”¨ cnpm å®‰è£… CLI$ cnpm install -g @tarojs/cli å®‰è£…å®Œæˆä¹‹åï¼Œä½¿ç”¨taro --versionæŸ¥çœ‹ä¸€ä¸‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœè¾“å‡ºç‰ˆæœ¬å·è¯´æ˜å®‰è£…æˆåŠŸã€‚å®‰è£…æˆåŠŸåï¼Œåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›® 1$ taro init å°†å‡ºç°å¦‚ä¸‹å›¾çš„ä¸€äº›é€‰å‹ å¦‚ä¸Šå›¾ï¼š è¯·è¾“å…¥é¡¹ç›®åç§°ï¼Ÿè¾“å…¥é¡¹ç›®åç§°vuedemo è¯·è¾“å…¥é¡¹ç›®ä»‹ç»ï¼Ÿè¾“å…¥é¡¹ç›®ä»‹ç»a demo project è¯·é€‰æ‹©æ¡†æ¶ï¼Ÿå½“ç„¶æ˜¯Vue3å•¦ ä½™ä¸‹é€‰é¡¹ï¼Œå¦‚ä¸Šé¢ 3 ä¸ªé€‰é¡¹ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©å°±å¥½ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¾ç…§æç¤ºé€‰å‹å¥½ä»¥åï¼Œ Taro ä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ã€‚å¦‚æœç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´å®‰è£…ä¸æˆåŠŸï¼Œå°±éœ€è¦æ‰‹åŠ¨åœ¨é¡¹ç›®è·¯å¾„ä¸‹è¿›è¡Œå®‰è£…ã€‚ 123456# ä½¿ç”¨ yarn å®‰è£…ä¾èµ–$ yarn# OR ä½¿ç”¨ cnpm å®‰è£…ä¾èµ–$ cnpm install# OR ä½¿ç”¨ npm å®‰è£…ä¾èµ–$ npm install å®‰è£…åç›®å½•ç»“æ„ï¼š appé»˜è®¤ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒTaro3 åœ¨æ–°å»º Vue3 é¡¹ç›®æ—¶å·²ç»ä¿®æ”¹äº†å…¥å£ç»„ä»¶å†™æ³•ã€‚ 1234567import &#123; createApp &#125; from 'vue'import './app.scss'const App = createApp(&#123; onShow (options) &#123;&#125;, // å…¥å£ç»„ä»¶ä¸éœ€è¦å®ç° render æ–¹æ³•ï¼Œå³ä½¿å®ç°äº†ä¹Ÿä¼šè¢« taro æ‰€è¦†ç›–&#125;)export default App page/indexç›®å½•ä¸‹indexæ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š 1234567891011121314151617&lt;template&gt; &lt;view class=\"index\"&gt; &lt;text&gt;&#123;&#123; msg &#125;&#125;&lt;/text&gt; &lt;/view&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref &#125; from 'vue'import './index.scss'export default &#123; setup () &#123; const msg = ref('Hello world') return &#123; msg &#125; &#125;&#125;&lt;/script&gt; ç¼–è¯‘è¿è¡Œå¾®ä¿¡å°ç¨‹åº 1npm run dev:weapp ç¼–è¯‘åï¼Œæ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·å¯¼å…¥ç¼–è¯‘åçš„distç›®å½•ï¼Œé¦–é¡µå†…å®¹å’Œç¼–è¯‘æˆ H5 çš„è¡¨ç°éƒ½å¦‚ä¸‹å›¾ï¼š éªŒè¯ Taro3 å¯¹ Vue3 çš„æ”¯æŒåº¦Composition APIå†™ä¸ªæ¯”è¾ƒç®€å•çš„ todolist è®¡æ•°ç»„ä»¶ï¼Œå‡è®¾ç›®å‰å·²æœ‰ 4 é¡¹ä»£åŠäº‹é¡¹ï¼Œç‚¹å‡»åå°†æ–°å¢ä¸€é¡¹ã€‚è¿™é‡Œä¼šä½¿ç”¨åˆ° Composition API æ€è·¯ï¼Œä»¥åŠ computed è®¡ç®—å±æ€§ã€‚ åœ¨ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œç¬¬äºŒè¡Œâ€œå½“å‰æ“ä½œæ–°å¢â€ä¼šæ ¹æ®ç‚¹å‡»æ¬¡æ•°é€’å¢ï¼Œæ€»è®¡æ¡æ•°ä¼šåœ¨ 4 çš„åŸºç¡€ä¸Šç´¯åŠ ã€‚ 123456789101112131415161718192021222324252627282930313233&lt;template&gt; &lt;button @tap=\"increment\"&gt; å¢åŠ  1 &lt;/button&gt; &lt;view&gt;å½“å‰todolistäº‹é¡¹å·²æœ‰ï¼š&#123;&#123; existCount &#125;&#125;æ¡ï¼›&lt;/view&gt; &lt;view&gt;å½“å‰æ“ä½œå·²æ–°å¢ï¼š&#123;&#123; count &#125;&#125; ï¼Œå…±æœ‰&#123;&#123; total &#125;&#125;æ¡ã€‚&lt;/view&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref, computed, onMounted, toRefs, watch &#125; from 'vue'export default &#123; name: 'case1', setup(props) &#123; // refå“åº”å¼å˜é‡ const count = ref(0) const existCount = ref(4) // computedæ–¹æ³•ï¼Œåœ¨countçš„valueå‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘è®¡ç®—total const total = computed(() =&gt; count.value + existCount.value ) function increment() &#123; count.value++ &#125; onMounted(() =&gt; console.log('component mounted!')) return &#123; // è¿”å›incrementæ–¹æ³•ï¼ŒexistCountã€countã€totalå±æ€§ï¼Œä¾›æ¨¡æ¿ä¸­è°ƒç”¨ increment, existCount, count, total, &#125; &#125;&#125;&lt;/script&gt; é¡µé¢è¡¨ç°å¦‚ä¸‹æ‰€ç¤ºï¼Œå¯è§å¯¹äº Composition API çš„æ”¯æŒçš„è¿˜æ˜¯ä¸é”™çš„ã€‚ Teleportå†™ä¸ªåˆæ¬¡ç™»å½•ç”¨æˆ·çš„æ¬¢è¿å¼¹çª—ã€‚ç”¨æˆ·åä»index.vueä¼ å…¥ã€‚é¦–é¡µä»£ç å¦‚ä¸‹ï¼š 123456&lt;template&gt; &lt;view class=\"index\"&gt; &lt;Toast :user = username /&gt; &lt;view id=\"teleportToast\"&gt;&lt;/view&gt; &lt;/view&gt;&lt;/template&gt; åœ¨ Toast.vue ä¸­ï¼Œæˆ‘ä»¬ä¼šå†™ä¸ªå±æ€§ to ä¸º teleportToast çš„ Teleport ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;template&gt; &lt;button @tap=\"showToast\" class=\"btn\"&gt;æ‰“å¼€å¼¹çª—&lt;/button&gt; &lt;!-- toå’Œindex.htmlä¸­çš„view idä¸€è‡´ --&gt; &lt;teleport to=\"#teleportToast\"&gt; &lt;view v-if=\"toastFlag\" class=\"toast__wrap\" @tap=\"hideToast\"&gt; &lt;view class=\"h2\"&gt;å¼¹çª—æ ‡é¢˜ï¼š&lt;/view&gt; &lt;view class=\"toast__wrap--msg\"&gt;æ¬¢è¿&#123;&#123; user &#125;&#125;ï¼Œç‚¹å‡»å…³é—­&lt;/view&gt; &lt;/view&gt; &lt;/teleport&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref,toRefs &#125; from 'vue';export default &#123; props:&#123; user: &#123;type: String&#125; &#125;, setup(props) &#123; // è·å–ç”¨æˆ·å const &#123; user &#125; = toRefs(props) // Toastï¼šæ˜¾ç¤ºflag const toastFlag = ref(false) let timer const showToast = ()=&gt;&#123; toastFlag.value = true &#125; const hideToast = ()=&gt;&#123; toastFlag.value = false &#125; return &#123; user, toastFlag, showToast, hideToast, &#125; &#125;&#125;&lt;/script&gt;&lt;style lang=\"scss\"&gt;.toast__wrap&#123; position: fixed; width:100%; height: 100%; background: rgba(0,0,0,.8); top: 0; left: 0; z-index: 101; color: #fff; .h2&#123; margin: 20px; &#125; &amp;--msg&#123; text-align: center; &#125;&#125;&lt;/style&gt; åœ¨ H5 ä¸‹æ˜¯æ­£å¸¸æ˜¾ç¤ºçš„ï¼Œå¼¹çª—å±•ç¤ºä»¥åŠå…³é—­åŠŸèƒ½æ•ˆæœå¦‚ä¸‹ï¼›åœ¨å°ç¨‹åºä¸Šå´æŠ¥é”™äº†ï¼ŒTaro å›¢é˜Ÿè¿˜éœ€è¦åŠ æŠŠåŠ²ï¼š FragmentsFragments ç‰¹æ€§å·²ç»åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­å¾—åˆ°éªŒè¯ï¼Œä½¿ç”¨æ²¡æœ‰é—®é¢˜ã€‚ script setup è¯­æ³•ç³–æˆ‘ä»¬å°è¯•ä¸€ä¸‹&lt;script setup&gt;ï¼Œç»„ä»¶é‡Œçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122&lt;template&gt; &lt;view&gt; &lt;view&gt;count:&#123;&#123; count &#125;&#125;,msg:&#123;&#123; info &#125;&#125;&lt;/view&gt; &lt;button @tap=\"incAndChangeInfo\"&gt; å¢åŠ  1ä¿®æ”¹msg &lt;/button&gt; &lt;/view&gt;&lt;/template&gt;&lt;script setup=\" props \"&gt; import &#123; ref, toRefs &#125; from 'vue' export default&#123; props: &#123; msg: String, &#125;, &#125; export const count = ref(0) export const info = ref(props.msg) export const incAndChangeInfo = () =&gt; &#123; count.value++ info.value = \"change hello\" + count.value &#125;&lt;/script&gt; ä¸Šè¿°scriptæ ‡ç­¾é‡Œçš„ä»£ç æ•ˆæœç­‰åŒäºä¸‹é¢ï¼š 123456789101112131415161718192021&lt;script&gt;import &#123; ref, toRefs &#125; from 'vue'export default &#123; props: &#123; msg: String, &#125;, setup(props) &#123; const count = ref(0) const info = ref(props.msg) const incAndChangeInfo = () =&gt; &#123; count.value++ info.value = \"change hello\" + count.value &#125; return &#123; count, info, incAndChangeInfo, &#125; &#125;&#125;&lt;/script&gt; è°ƒç”¨å®ƒçš„ä»£ç ä¼ å…¥ mgs å¦‚ä¸‹ï¼š 1&lt;Setup msg=\"hello\"/&gt; è¿è¡Œåï¼Œå°ç¨‹åºå’Œ H5 éƒ½æ˜¯æ”¯æŒçš„ï¼Œé¡µé¢æ•´ä½“è¡¨ç°å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¿ç”¨æ–°ç‰¹æ€§è¿›è¡Œå¼€å‘ï¼Œä»£ç ä¹¦å†™æ›´åŠ ä¾¿æ·ï¼Œé€»è¾‘æ›´æ¸…æ™°ã€‚ style vars è¯­æ³•ç³–&lt;style vars&gt;ï¼Œç»„ä»¶é‡Œçš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627&lt;template&gt; &lt;view class=\"text\"&gt;æ–‡å­—é¢œè‰²ä¸º&#123;&#123; color &#125;&#125;,ç‚¹å‡»åå˜ä¸ºçº¢è‰²&lt;/view&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref,toRefs &#125; from 'vue'export default &#123; props:&#123; color: &#123;type: String&#125; &#125;, data(props) &#123; return &#123; color: ref(props) //'red' &#125; &#125;, setup(props)&#123; const &#123; color &#125; = toRefs(props) return &#123; color, &#125; &#125;&#125;&lt;/script&gt;&lt;style vars=\"&#123; color &#125;\"&gt;.text &#123; color: var(--color);&#125;&lt;/style&gt; è°ƒç”¨å®ƒçš„é¡µé¢é‡Œçš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324&lt;template&gt; &lt;view class=\"index\"&gt; &lt;Styledemo :color = color @tap=\"changeColor\"/&gt; &lt;/view&gt;&lt;/template&gt;&lt;script&gt;import &#123; ref, computed, onMounted, toRefs, watch &#125; from 'vue'import Styledemo from \"@/floors/styledemo\"export default &#123; components:&#123; Styledemo &#125;, setup () &#123; const color = ref('blue') const changeColor = ()=&gt;&#123; color.value = 'red' &#125; return &#123; changeColor, color &#125; &#125;&#125;&lt;/script&gt; å°ç¨‹åºå’Œ H5 éƒ½æ²¡æœ‰é—®é¢˜ï¼ŒåŠŸèƒ½æ•ˆæœå¦‚ä¸‹ï¼š ç»“è¯­æˆ‘ä»¬å°†ä¸Šè¿°å‡ ä¸ª Demo æ•´åˆåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæ”¾åœ¨Githubä¸Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹ã€‚åœ¨çº¿é¢„è§ˆåœ°å€åœ¨è¿™é‡Œã€‚ ç»è¿‡éªŒè¯ï¼ŒTaro3 æ”¯æŒä½¿ç”¨æœ€æ–°çš„ Vue3 å¼€å‘å¤šç«¯åº”ç”¨ï¼Œç›¸æ¯”ä¹‹ä¸‹ H5 çš„æ”¯æŒåº¦æ›´å¥½ä¸€äº›ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒTaro å›¢é˜Ÿåœ¨æŠ€æœ¯ä¸Šä¸€ç›´ä¿æŒè¿›å–ï¼Œåœ¨ Taro2.0 ç‰ˆæœ¬æ”¯æŒäº† ReactHooksï¼›æ ¹æ®Taro RFCSï¼Œæ—©åœ¨2020-06-03ä¹Ÿå·²ç»æ‰“ç®—æ”¯æŒ Vue3 äº†ã€‚æˆªè‡³ç›®å‰ï¼ŒTaro å¯¹ Vue3 çš„æ”¯æŒåœ¨å°ç¨‹åºç«¯çš„ç¨æœ‰è¡¥è¶³ï¼Œå¸Œæœ› Taro å›¢é˜Ÿå¯ä»¥æ—©æ—¥è¡¥è¶³è¿™ä¸ªçŸ­æ¿ã€‚ æ¨èæ–‡ç« ï¼š Vue3 å’Œ React Hooks å¯¹æ¯” SWR è‡ªå®šä¹‰æ¸²æŸ“å™¨çš„åº”ç”¨ å‚è€ƒæ–‡ç« ï¼š [1]compsition api [2]teleport [3]taro3å®‰è£…åŠä½¿ç”¨","pubDate":"Mon, 28 Sep 2020 01:00:00 GMT","guid":"https://aotu.io/notes/2020/09/28/taro-vue3/","category":"å°ç¨‹åº"},{"title":"äº¬å–œå°ç¨‹åºé¦–é¡µæ— éšœç¢ä¼˜åŒ–å®è·µ","link":"https://aotu.io/notes/2020/09/21/jx-weapp-accessible/","description":"å‰è¨€æœ¬æ–‡å‚è€ƒ WCAG 2.1 ã€WAI-ARIA å’Œ Web å¯è®¿é—®æ€§ä¸æ— éšœç¢æœ€ä½³å®è·µï¼Œåœ¨äº¬å–œå°ç¨‹åºé¦–é¡µæ— éšœç¢ä¼˜åŒ–å¼€å‘ä¸­ï¼Œæ€»ç»“äº†ä¸€äº›â€œæ— éšœç¢ä¼˜åŒ–â€åœ¨å°ç¨‹åºç«¯çš„å®è·µï¼Œå¸Œæœ›ä»¥æ­¤æ¨åŠ¨æ— éšœç¢åœ¨å°ç¨‹åºæ›´å¤šåœ°è½åœ°ã€‚ æ— éšœç¢æ— éšœç¢æ˜¯ä»€ä¹ˆï¼Ÿåœ¨äº†è§£æ— éšœç¢ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€äº›æ•°æ®ï¼š æ®ä¸­å›½ç›²åçš„æœ€æ–°æ•°æ®æ˜¾ç¤ºï¼Œä¸­å›½ç›®å‰è§†éšœè€…æœ‰ 1700 å¤šä¸‡ï¼Œéšç€è€é¾„åŒ–çš„ä¸¥é‡ï¼Œè§†éšœç¾¤ä½“æœ‰è¿›ä¸€æ­¥æ‰©å¤§çš„è¶‹åŠ¿ã€‚ åœ¨ä¸­å›½ï¼Œæœ‰ç€åºå¤§çš„ä¿¡æ¯éšœç¢ç¾¤ä½“ï¼ŒåŒ…æ‹¬ï¼š8500 å¤šä¸‡æ®‹éšœäººå£«ï¼Œä¸¤äº¿å¤šè€å¹´äººï¼Œå¤§é‡è®¤çŸ¥éšœç¢äººå£«ã€‚ â€¦ æ— éšœç¢æ— éšœç¢ (Accessibility)ï¼Œæ˜¯æŒ‡åœ¨å‘å±•è¿‡ç¨‹ä¸­æ²¡æœ‰é˜»ç¢ï¼Œæ´»åŠ¨èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œã€‚ä»æ— éšœç¢å¼•ç”³çš„ç›¸å…³è¯æ±‡æœ‰ï¼Œæ— éšœç¢è®¾æ–½ã€ä¿¡æ¯æ— éšœç¢ã€æ— éšœç¢äº¤æµç­‰ç­‰ã€‚ ä¿¡æ¯æ— éšœç¢å¯¹äºä¿¡æ¯æ— éšœç¢ï¼Œä¸­å›½äº’è”ç½‘åä¼šç»™å‡ºäº†ä¸€ä¸ªå®šä¹‰ï¼šä»»ä½•äººï¼ˆæ— è®ºæ˜¯å¥å…¨äººè¿˜æ˜¯æ®‹ç–¾äººï¼Œæ— è®ºæ˜¯å¹´è½»äººè¿˜æ˜¯è€å¹´äººï¼‰åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å¹³ç­‰åœ°ã€æ–¹ä¾¿åœ°ã€æ— éšœç¢åœ°è·å–ä¿¡æ¯ã€åˆ©ç”¨ä¿¡æ¯ã€‚ ä»¥ä¸Šé‡Šä¹‰ï¼Œæºè‡ªç™¾åº¦ç™¾ç§‘ æ— éšœç¢è®¾æ–½å¦‚æœçœ‹ä¸è§ã€å¬ä¸è§ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆç”Ÿæ´»å‘¢ï¼Ÿ åœ¨ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šçœ‹åˆ°ä¸€äº›è®¾æ–½ï¼šç¼˜çŸ³å¡é“ã€ç›²é“ã€æ— éšœç¢å‚ç›´ç”µæ¢¯ã€æ— éšœç¢æ‰¶æ‰‹ã€äººè¡Œæ¨ªé“çš„è­¦ç¤ºä¿¡å·ç­‰ç­‰ã€‚è¿™äº›ç»™éšœç¢ç¾¤ä½“ä½¿ç”¨çš„å®‰å…¨è®¾æ–½ï¼Œå°±æ˜¯æ— éšœç¢è®¾æ–½ (Accessibility Facilities)ã€‚æ— éšœç¢è®¾æ–½ä¸»è¦æ˜¯ä¸ºäº†è®©éšœç¢ç¾¤ä½“èƒ½å¤Ÿè‡ªä¸»ã€å®‰å…¨ã€æ–¹ä¾¿åœ°é€šè¡Œå’Œæ´»åŠ¨ï¼Œå®ƒæ˜¯éšœç¢ç¾¤ä½“ç”Ÿæ´»é¡ºç•…çš„é‡è¦ä¿è¯ã€‚é™¤ç‰©è´¨ç¯å¢ƒçš„æ— éšœç¢è®¾æ–½ï¼Œæ— éšœç¢è®¾æ–½è¿˜å¯ä»¥æ‰©å±•åˆ°ä¿¡æ¯å’Œäº¤æµçš„æ— éšœç¢ï¼Œæ¯”å¦‚äº’è”ç½‘ä¸­çš„ç½‘ç«™è®¾è®¡ã€ç½‘ä¸ŠåŠäº‹ã€è´­ç‰©äº¤äº’ç­‰ã€‚ ä¿¡æ¯æ— éšœç¢çš„ç°çŠ¶éšç€äº’è”ç½‘ä¸æ–­å‘å±•ï¼Œäº’è”ç½‘åº”ç”¨å·²ç»èå…¥åˆ°æˆ‘ä»¬ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ï¼Œè¡ŒåŠ¨ä¸ä¾¿çš„éšœç¢ç¾¤ä½“åˆ™æ›´å¸Œæœ›ä¹Ÿæ›´éœ€è¦é€šè¿‡æ–¹ä¾¿çš„äº’è”ç½‘åº”ç”¨è·å–ä¿¡æ¯ã€å­¦ä¹ å’Œç”Ÿæ´»ã€‚å› æ­¤ï¼Œäº’è”ç½‘åº”ç”¨è¿›è¡Œæ— éšœç¢ä¼˜åŒ–ï¼Œå¯¹éšœç¢ç¾¤ä½“æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ æ—©åœ¨ 1997 å¹´ 2 æœˆï¼Œä¸‡ç»´ç½‘è”ç›Ÿ (W3C) ä¸ºäº†æå‡ç½‘ç»œçš„æ— éšœç¢æ€§ï¼Œæˆç«‹äº†ç½‘ç»œæ— éšœç¢æ¨åŠ¨ (WAI)å°ç»„ï¼Œå¹¶åˆ¶å®šäº†ä¸€ç³»åˆ—çš„å…³äºç½‘ç»œæ— éšœç¢çš„æ ‡å‡†ã€è§„èŒƒã€æ£€æµ‹è¡¨ã€æ— éšœç¢çš„æŠ€æœ¯ï¼Œå¹¶ä¸ä¸–ç•Œå„åœ°çš„ç»„ç»‡æºæ‰‹åˆä½œï¼Œåœ¨å…¨çƒèŒƒå›´æ¨åŠ¨æ— éšœç¢ç½‘ç»œè¿åŠ¨ã€‚ ä½†è‡³ä»Šä¸ºæ­¢ï¼Œäº’è”ç½‘äº§å“çš„æ— éšœç¢ä¼˜åŒ–è¿›å±•ä»ç„¶ç¼“æ…¢ï¼Œå¾ˆå¤šç½‘ç«™å»ºè®¾å’Œç§»åŠ¨ç«¯ APP çš„å¼€å‘éƒ½è¿˜æœªè€ƒè™‘æ— éšœç¢ä¼˜åŒ–ï¼Œå³ä½¿æ˜¯é€šè¿‡è¯»å±è½¯ä»¶ï¼Œä¹Ÿå¾ˆéš¾è·å–æƒ³è¦çš„ä¿¡æ¯ã€‚ éšœç¢ç¾¤ä½“è°ƒç ” æˆ‘ä»¬ä»¥ç”µå•†å¹³å°è´­ç‰© APP ä¸ºè°ƒç ”å¯¹è±¡ï¼ŒåŒä¿¡æ¯æ— éšœç¢ç ”ç©¶ä¼šåˆä½œåšäº†ä¸€ä¸ªè°ƒç ”ã€‚æ ¹æ®æ”¶é›†åˆ°çš„èˆ†æƒ…åé¦ˆï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼š åœ¨æ¶ˆè´¹é™çº§çš„å½“ä¸‹ï¼Œä½ä»·å•†å“ç«éäº’è”ç½‘çš„æ¯ä¸ªè§’è½ï¼Œéšœç¢ç¾¤ä½“æ˜¯å…¶ä¸­éœ€æ±‚åº¦æœ€å¤§çš„äººç¾¤ä¹‹ä¸€ã€‚äº¬å–œï¼Œä½œä¸ºäº¬ä¸œæ——ä¸‹çš„æ‹¼è´­ç”µå•†å¹³å°ï¼Œä¸æ‹¼å¤šå¤šå’Œæ·˜å®ç‰¹ä»·ç‰ˆä¸€æ ·ï¼Œåœ¨éšœç¢äººå£«èšé›†çš„è®ºå›å’ŒQQä¸­ï¼Œæœ‰éå¸¸å¤šçš„è®¨è®ºã€‚ç”¨æˆ·ä»¬å¯¹äº¬å–œæ²¡åšæ— éšœç¢è¡¨ç¤ºé—æ†¾ï¼Œä¹ŸæœŸå¾…äº¬å–œå¯ä»¥å°½å¿«å¼€å±•æ— éšœç¢ä¼˜åŒ–ï¼Œäº«å—ä½ä»·æ‹¼è´­çš„ä¹è¶£ã€‚ æ ¹æ®ç ”ç©¶ä¼šä¿¡æ¯æ— éšœç¢å·¥ç¨‹å¸ˆåˆæ­¥æ£€æµ‹ï¼Œç›®å‰å½±å“éšœç¢ç”¨æˆ·ä»¬ä½¿ç”¨ç¼ºé™·é›†ä¸­åœ¨ä»¥ä¸‹å‡ ç±»ä¸­ï¼š æŒ‰é’®æœªåŠ æ ‡ç­¾ï¼Œç”¨æˆ·éš¾ä»¥äº†è§£å¯¹åº”æŒ‰é’®ç‚¹æŒ‰åˆ†åˆ«ä¼šè§¦å‘å“ªäº›åŠŸèƒ½ã€‚ ç²¾ç®€çŠ¶æ€ä¸æç¤ºæˆ–æç¤ºä¸ç¬¦åˆéšœç¢ç”¨æˆ·ç†è§£ä¹ æƒ¯ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•äº†è§£æ­£ç¡®çš„ä¿¡æ¯ï¼Œè¯¸å¦‚æ˜¯å¦å·²åŠ å…¥è´­ç‰©è½¦ç­‰ã€‚ ç„¦ç‚¹é€»è¾‘æ··ä¹±æˆ–æ²¡æœ‰éµå¾ªæ­£ç¡®çš„è¯»å±æµè§ˆæ¨¡å¼ï¼Œè‡´ä½¿ç”¨æˆ·ä¸èƒ½ä¾¿æ·ã€æ¸…æ™°åœ°äº†è§£ç•Œé¢ä¿¡æ¯ï¼Œä¸¥é‡å½±å“æ“ä½œæ•ˆç‡ã€‚ æ´»åŠ¨ä¿¡æ¯æˆ–å¼¹çª—ç­‰é¡µé¢ï¼Œç”±äºä½¿ç”¨å¤§é‡å­—ç»˜æ¶æ„ä¸”æ²¡æœ‰é›†æˆæ— éšœç¢ç‰¹æ€§ï¼Œç”¨æˆ·æ— æ³•ä¾¿æ·åœ°å‚ä¸å¹³å°è¥é”€æ´»åŠ¨ã€‚ ä»¥ä¸Šå‡ ç±»å±äºéšœç¢ç”¨æˆ·èƒ½å¤Ÿæ— éšœç¢ä½¿ç”¨çš„åŸºæœ¬æ”¯æ’‘ï¼Œéƒ¨åˆ†æˆ–å®Œå…¨é€‚é…åå°†èƒ½ä¿ƒä½¿ APP å®ç°è¾ƒå¥½çš„æ— éšœç¢ä½“éªŒã€‚ æ— éšœç¢ä¼˜åŒ–å¼€å‘åœ¨äº†è§£å°ç¨‹åºçš„æ— éšœç¢ä¼˜åŒ–ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦äº†è§£ Web æ— éšœç¢å¼€å‘çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŠè¯»å±è½¯ä»¶çš„å·¥ä½œæ–¹å¼ã€‚ è¯»å±è½¯ä»¶æ— éšœç¢è®¿é—®çš„å…³é”®ç‚¹ â€”â€” ä½¿ç”¨å±å¹•é˜…è¯»å™¨ã€‚ ç§»åŠ¨ç«¯ APP è®¿é—®æ— éšœç¢ç‰¹æ€§ï¼Œå¼€å¯è¯»å±æ¨¡å¼çš„è®¾ç½®è·¯å¾„ï¼š iOSï¼š è®¾ç½® -&gt; é€šç”¨ -&gt; è¾…åŠ©åŠŸèƒ½ -&gt; æ—ç™½ï¼ˆVoiceOverï¼‰ ã€‚ å®‰å“ï¼šè®¾ç½® -&gt; è¾…åŠ©åŠŸèƒ½ -&gt; æ— éšœç¢ -&gt; TalkBackï¼ˆä¸åŒæœºå‹è·¯å¾„å¯èƒ½ä¸ä¸€æ ·ï¼‰ ä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦çš„ VoiceOver æ‰‹åŠ¿ï¼š è½»ç‚¹ï¼šé€‰æ‹©å¹¶æœ—è¯»é¡¹ç›®ã€‚ è½»ç‚¹ä¸¤ä¸‹ï¼šæ¿€æ´»æ‰€é€‰é¡¹ç›®ã€‚ å·¦å³è½»æ‰«ï¼šé€‰æ‹©ä¸‹ä¸€é¡¹æˆ–ä¸Šä¸€é¡¹ã€‚ ä¸‰ä¸ªæ‰‹æŒ‡å‘ä¸Šæˆ–å‘ä¸‹è½»æ‰«ï¼šæ»‘åŠ¨å±å¹•ä¸Šçš„åˆ—è¡¨æˆ–åŒºã€‚ åŒæŒ‡æ“æ“¦ï¼šå¿«é€Ÿæ¥å›ç§»åŠ¨ä¸¤ä¸ªæ‰‹æŒ‡ä¸‰æ¬¡ï¼ˆå½¢æˆâ€œzâ€å­—å½¢ï¼‰ä»¥è§£é™¤æé†’ï¼Œæˆ–è€…è¿”å›ä¸Šä¸€ä¸ªå±å¹•ã€‚ æ›´å¤šæ‰‹åŠ¿å¯ä»¥æŸ¥çœ‹ ï¼šVoiceOver - iPhone ä½¿ç”¨æ‰‹å†Œã€‚ å®‰å“çš„ TalkBack æ‰‹åŠ¿ä¸ VoiceOver æœ‰ä¸€äº›å·®å¼‚ï¼Œåé¢è¿˜ä¼šæåˆ°â€¦â€¦ WAI-ARIA WAI-ARIA é€šè¿‡æµè§ˆå™¨æŠŠä¿¡æ¯æš´éœ²ç»™ accessibility APIs (æ— éšœç¢API)ï¼Œä½œä¸ºè¯»å±è½¯ä»¶çš„ä¿¡æ¯æºã€‚ WAI-ARIA ( Accessible Rich Internet Applications (WAI-ARIA) 1.1) æ˜¯ä¸€é¡¹æŠ€æœ¯ï¼Œå®ƒå¯ä»¥é€šè¿‡æµè§ˆå™¨å’Œä¸€äº›è¾…åŠ©æŠ€æœ¯æ¥å¸®åŠ©æˆ‘ä»¬è¿›ä¸€æ­¥åœ°è¯†åˆ«ä»¥åŠå®ç°è¯­ä¹‰åŒ–ï¼Œè¿™æ ·ä¸€æ¥èƒ½å¸®åŠ©æˆ‘ä»¬è§£å†³é—®é¢˜ï¼Œä¹Ÿè®©ç”¨æˆ·å¯ä»¥äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚WAI-ARIA æ˜¯ W3C ç¼–å†™çš„è§„èŒƒï¼Œå®šä¹‰äº†ä¸€ç»„å¯ç”¨äºå…¶ä»–å…ƒç´ çš„ HTML ç‰¹æ€§ï¼Œç”¨äºæä¾›é¢å¤–çš„è¯­ä¹‰åŒ–ä»¥åŠæ”¹å–„ç¼ºä¹çš„å¯è®¿é—®æ€§ã€‚ ä»¥ä¸‹æ˜¯è§„èŒƒä¸­ä¸‰ä¸ªä¸»è¦çš„ç‰¹æ€§ï¼š è§’è‰² â€”â€” å®šä¹‰å…ƒç´ æ˜¯å¹²ä»€ä¹ˆçš„ã€‚å¦‚ role=&#39;button&#39; è¡¨ç¤ºå…ƒç´ æ˜¯æŒ‰é’®ï¼Œè¯»å±è½¯ä»¶ä¼šè¯»ä½œâ€œæŒ‰é’®â€ã€role=&#39;searchbox&#39; è¡¨ç¤ºå…ƒç´ ç”¨äºæœç´¢ï¼Œè¯»å±è½¯ä»¶ä¼šè¯»ä½œâ€æœç´¢â€ã€‚ å±æ€§ â€”â€” è®©å…ƒç´ å…·å¤‡æ›´å¤šçš„æ„ä¹‰ã€‚å¦‚ aria-required=&#39;true&#39; è¡¨ç¤ºå…ƒç´ åœ¨è¡¨å•ä¸Šæ˜¯å¿…å¡«çš„ã€aria-label=&#39;æè¿°æ–‡å­—&#39; ç”¨æ¥ç»™å½“å‰å…ƒç´ æ ‡ç­¾åŠ ä¸Šæè¿°ï¼Œç”¨ä¸å¯è§†çš„æ–¹å¼ç»™å…ƒç´ åŠ  labelï¼Œæ¥å—å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œè¯»å±è½¯ä»¶ä¼šå°†æè¿°æ–‡å­—æœ—è¯»å‡ºæ¥ã€‚ çŠ¶æ€ â€”â€” ç”¨äºè¡¨è¾¾å…ƒç´ å½“å‰æ¡ä»¶çš„ç‰¹æ®Šå±æ€§ã€‚å¦‚ aria-disabled=&#39;true&#39;è¡¨ç¤ºè¡¨å•ç¦æ­¢è¾“å…¥ã€aria-hidden=&#39;true&#39; è¡¨ç¤ºå…ƒç´ ä¼šè¢«è¯»å±è½¯ä»¶å¿½ç•¥ã€‚ æ›´å¤šå±æ€§å¯ä»¥å‚è€ƒ Using Aria ä¸­çš„ States and propertiesï¼Œéƒ¨åˆ†å±æ€§å¯èƒ½åœ¨å°ç¨‹åºè®¾ç½®ä¸ç”Ÿæ•ˆã€‚ æ›´å¤š role å¯ä»¥å‚è€ƒ Using Aria ä¸­çš„ Widget Rolesï¼Œéƒ¨åˆ† role å¯èƒ½åœ¨å°ç¨‹åºè®¾ç½®ä¸ç”Ÿæ•ˆã€‚ å› æ­¤ï¼Œæ— éšœç¢ä¼˜åŒ–ä¾¿å¯ä»¥å€ŸåŠ©è¯»å±è½¯ä»¶ï¼Œç»“åˆ WAI-ARIA çš„ç‰¹æ€§è¿›è¡Œå¼€å‘ã€‚äº’è”ç½‘åº”ç”¨å¼•å…¥æ— éšœç¢ç‰¹æ€§ï¼Œä½¿å¾—éšœç¢ç”¨æˆ·å¯ä»¥æ¸…æ™°å‡†ç¡®çš„è·å–åˆ°é¡µé¢ä¿¡æ¯ï¼Œè·å¾—æ›´å¥½çš„äº§å“ä½“éªŒï¼Œæ–¹ä¾¿åœ°å®ç°ç½‘ä¸ŠåŠäº‹ã€è´­ç‰©ç­‰ã€‚ äº¬å–œå°ç¨‹åºé¦–é¡µæ— éšœç¢ä¼˜åŒ–èƒŒæ™¯æ­¤å‰ï¼Œäº¬å–œå°ç¨‹åºæœªè¿›è¡Œæ— éšœç¢ä¼˜åŒ–ï¼Œéšœç¢ç¾¤ä½“åœ¨è¯»å±è½¯ä»¶çš„è¾…åŠ©ä¸‹ï¼ŒåŸºæœ¬ä¸èƒ½ä½¿ç”¨ã€‚è¿™ä½¿å¾—å¹³å°å¤±å»äº†éšœç¢ç¾¤ä½“çš„å¸‚åœºï¼ŒåŒæ—¶éšœç¢ç¾¤ä½“ä¹Ÿå¤±å»äº†ä½“éªŒäº¬å–œå°ç¨‹åºå¹³å°æœåŠ¡çš„æœºä¼šã€‚å› æ­¤ï¼Œå¸Œæœ›å¯¹å¹³å°è¿›è¡Œæ— éšœç¢ä¼˜åŒ–ï¼Œæå‡å¹³å°çš„å¯ç”¨æ€§ã€æ˜“ç”¨æ€§ï¼Œè®©éšœç¢ç¾¤ä½“äº«å—æ›´å¥½çš„è´­ç‰©ä½“éªŒã€‚ ä¼˜åŒ–æ–¹æ¡ˆäº§å“æä¾›ç„¦ç‚¹åˆ’åˆ†è§„åˆ™ã€æœ—è¯»è§„åˆ™ã€é˜…è¯»é¡ºåºï¼Œä¸ºäº¬å–œå°ç¨‹åºé¦–é¡µé‡èº«å®šåˆ¶æ— éšœç¢ä¼˜åŒ–æ–¹æ¡ˆã€‚å†…éƒ¨æ–¹æ¡ˆï¼Œè¿™é‡Œå°±ä¸é€éœ²äº†ã€‚ï¼ˆæƒ³äº†è§£çš„è¯ï¼Œæ¥æŠ•ä¸€æ³¢ç®€å†å•Š~ï¼‰ å¼€å‘å®ç°ç›®å‰å°ç¨‹åºå®˜æ–¹å·²ç»æ”¯æŒæ— éšœç¢è®¿é—®ç‰¹æ€§ï¼Œç”¨æˆ·åœ¨è¯»å±æ¨¡å¼ä¸‹å¯ä»¥ä½“éªŒæ— éšœç¢è®¿é—®ã€‚ å¼€å‘ç»†åˆ™DOM é¡ºåºå¾ˆé‡è¦ è¯»å±è½¯ä»¶åœ¨è¯»å±æ—¶é»˜è®¤æŒ‰ç…§ DOM çš„é¡ºåºæœ—è¯»ã€‚å¦‚æœ DOM çš„é¡ºåºä¸å†…å®¹çš„è¯­ä¹‰é¡ºåºä¸ä¸€è‡´ï¼Œä¼šä½¿å¾—å†…å®¹éš¾ä»¥ç†è§£ã€‚ä¾‹å¦‚é¦–é¡µä¸­çš„å•†å“ç€‘å¸ƒæµï¼ŒæŒ‰å·¦å³ä¸¤åˆ—å¸ƒå±€ï¼š åœ¨å¼€å‘è¿‡ç¨‹ä¸­åº”å°½é‡é¿å…ä½¿ç”¨ä¼šå½±å“åˆ° DOM è§†è§‰é¡ºåºçš„æ ·å¼ï¼Œå¦‚æœæ— æ³•é¿å…ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½® tabIndex å±æ€§ï¼Œå‘ŠçŸ¥è¯»å±è½¯ä»¶æ­£ç¡®çš„å†…å®¹é¡ºåºã€‚ éæ–‡æœ¬å…ƒç´ å¢åŠ æè¿°å’Œè§’è‰²å±æ€§ é€šè¿‡ç»™éæ–‡æœ¬å…ƒç´ å¢åŠ æè¿°å’Œè§’è‰²å±æ€§ï¼Œå…ƒç´ çš„å†…å®¹å°±å¯ä»¥è¢«è¯»å±è½¯ä»¶æ¸…æ™°å‡†ç¡®åœ°æœ—è¯»ã€‚ å›¾åƒå¯ä½¿ç”¨ alt å±æ€§æè¿°å›¾åƒå†…å®¹ï¼Œè¯»å±è½¯ä»¶ä¼šæ ¹æ® alt ä¸­çš„å†…å®¹æœ—è¯»å‡º â€œæè¿°å›¾åƒå†…å®¹ å›¾åƒâ€ã€‚ view æœ¬èº«æ˜¯æ— è¯­ä¹‰çš„ï¼Œå¯ä»¥ç»™å…ƒç´ å¢åŠ  aria-role å’Œ aria-label å±æ€§ã€‚ è¯»å±è½¯ä»¶ä¼šæœ—è¯»å‡º â€œlabel æè¿°å†…å®¹ + role ç±»å‹â€ã€‚ æ•´å—å…ƒç´ è¯»å– ä¸€ä¸ªå…ƒç´ å¯èƒ½ç”±å¾ˆå¤šå­å…ƒç´ ç»„æˆã€‚åœ¨æ— éšœç¢æ¨¡å¼ä¸‹ï¼Œè¯»å±è½¯ä»¶åªèƒ½åˆ†åˆ«èšç„¦å­å…ƒç´ ï¼Œå•ç‹¬å°†æ¯ä¸ªå­å…ƒç´ ä¿¡æ¯è¯»å‡ºæ¥ã€‚éšœç¢ç”¨æˆ·åœ¨è¯»å±è½¯ä»¶çš„è¾…åŠ©ä¸‹ï¼Œè·å–åˆ°çš„éƒ½æ˜¯å…ƒç´ é›¶é›¶ç¢ç¢çš„ä¿¡æ¯ï¼Œè¿™æ ·çš„ä½“éªŒå¾ˆä¸å‹å¥½ã€‚ å› æ­¤ï¼Œåœ¨æ— éšœç¢ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†å…ƒç´ å½“ä½œæŒ‰é’®æ•´å—æœ—è¯»ï¼Œå°†å­å…ƒç´ çš„ä¿¡æ¯æ•´åˆä½œä¸ºæè¿°ï¼Œå¹¶å°½é‡ç²¾ç®€æè¿°å†…å®¹ï¼Œç¼©çŸ­æœ—è¯»æ–‡æ¡ˆçš„æ—¶é—´ã€‚ éšè—å…ƒç´ è¯»å– å¦‚æœä¸å¸Œæœ›éƒ¨åˆ†å†…å®¹è¢«è¯»å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨ aria-hidden=â€™trueâ€™ æ¥å£°æ˜ï¼Œè¿™æ ·è¯»å±æ—¶å°±ä¼šå¿½ç•¥è¿™äº›å…ƒç´ ã€‚ 1&lt;Text aria-hidden='true'&gt;è¯»å±æ—¶ä¼šå¿½ç•¥è¿™è¡Œæ–‡æœ¬&lt;/Text&gt; åœ¨æ— éšœç¢æ¨¡å¼ä¸‹ï¼Œè¿™ä¸ªå±æ€§å¯ç”¨æ¥éšè—è¾…åŠ©ä½œç”¨ä¸å¤§æˆ–æ˜¯å…·æœ‰å¹²æ‰°æ€§çš„å†…å®¹ã€‚ åœºæ™¯å®ç°éæ–‡æœ¬å…ƒç´ è¯»å– é¦–é¡µå¤´éƒ¨ä¸­äº¬å–œ Logo å’Œæ–‡å­—æ˜¯ä¸€æ•´å¼ å›¾ç‰‡ã€‚èšç„¦åï¼Œè¯»å±è½¯ä»¶é»˜è®¤ä¼šè¯»æˆå›¾åƒï¼Œæ— æ³•å°†å›¾ç‰‡ä¸­çš„æ–‡å­—æœ—è¯»å‡ºæ¥ã€‚è¿™æ ·çš„æ— éšœç¢ä½“éªŒæ˜¯éå¸¸å·®çš„ã€‚ åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¯é€šè¿‡ç»™ Logo å›¾ç‰‡å¢åŠ æè¿°æ¥è¿›è¡Œæ— éšœç¢ä¼˜åŒ–ã€‚ 1234&lt;View className='index__main'&gt; &lt;View className='index__logo' aria-role='text' aria-label='äº¬å–œ' /&gt; &lt;View className='index__title'&gt;äº¬ä¸œæ——ä¸‹ç¤¾äº¤ç”µå•†å¹³å°&lt;/View&gt;&lt;/View&gt; ç±»ä¼¼çš„è¿˜æœ‰å…³é—­æŒ‰é’®ã€è¿”å›é¡¶éƒ¨æŒ‰é’®ã€èœå•æ æŒ‰é’®â€¦â€¦ 12345&lt;View className='back-top' aria-role='button' aria-label='è¿”å›é¡¶éƒ¨'/&gt; æœç´¢æ¡†è¯»å– é¦–é¡µæœç´¢æ¡†èšç„¦åï¼Œè¯»å±è½¯ä»¶é»˜è®¤ä¼šå°†æœç´¢æ¡†ä¸­çš„æš—çº¹è¯»å‡ºæ¥ã€‚ä½†æ˜¯éšœç¢ç”¨æˆ·å¹¶ä¸èƒ½æ˜æ˜¾çš„æ„ŸçŸ¥åˆ°æœç´¢æ¡†å…ƒç´ ã€‚ åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ç»™æœç´¢æ¡†å¢åŠ è§’è‰²å±æ€§æ¥è¿›è¡Œæ— éšœç¢ä¼˜åŒ–ã€‚ 123&lt;View aria-role='searchbox'&gt; &lt;SearchBar /&gt;&lt;/View&gt; è½®æ’­å›¾è¯»å– è½®æ’­å›¾ç”±å¤šä¸ªå­å…ƒç´ ç»„æˆï¼Œä½†ç‚¹å‡»ä¸ºæ•´å—ç‚¹å‡»ï¼Œä¸”æ¯ä¸ªå­å…ƒç´ éƒ½æ˜¯å›¾ç‰‡ï¼Œè¯»å±è½¯ä»¶æ— æ³•è®©ç”¨æˆ·æ¸…æ™°æ„ŸçŸ¥å…ƒç´ çš„å«ä¹‰ã€‚ åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå­å…ƒç´ æ ‡ç­¾å¢åŠ æè¿°ï¼Œè¯»å±è½¯ä»¶å°±å¯ä»¥è¯†åˆ«åˆ°å­å…ƒç´ äº†ã€‚ 12345678&lt;View className='banner'&gt; &lt;Swiper&gt; &lt;SwiperItem aria-role='text' aria-label='æ´»åŠ¨æ¨è1'&gt;æ´»åŠ¨1&lt;/SwiperItem&gt; &lt;SwiperItem aria-role='text' aria-label='æ´»åŠ¨æ¨è2'&gt;æ´»åŠ¨2&lt;/SwiperItem&gt; &lt;SwiperItem aria-role='text' aria-label='æ´»åŠ¨æ¨è3'&gt;æ´»åŠ¨3&lt;/SwiperItem&gt; &lt;SwiperItem aria-role='text' aria-label='æ´»åŠ¨æ¨è4'&gt;æ´»åŠ¨4&lt;/SwiperItem&gt; &lt;/Swiper&gt;&lt;/View&gt; ä½†è¿™æ ·çš„æ— éšœç¢ä¼˜åŒ–åœ¨å®‰å“æ‰‹æœºä¸Šä½“éªŒå¹¶ä¸å‹å¥½ã€‚ å½“éšœç¢ç”¨æˆ·èšç„¦åˆ°è½®æ’­å›¾åï¼Œè¯»å±è½¯ä»¶å°†å­å…ƒç´ çš„æè¿°æœ—è¯»è¯»æ¥ã€‚è½®æ’­å›¾ç»§ç»­è½®æ’­ï¼Œç„¦ç‚¹ç´¢å¼•å´ä¸ä¼šéšè½®æ’­çŠ¶æ€è‡ªåŠ¨æ›´æ–°ï¼Œè€Œæ˜¯è·Ÿéšå½“å‰å­å…ƒç´ æ»‘åŠ¨æ¶ˆå¤±åœ¨å±å¹•ä¸­ã€‚è‹¥è¦è·å–æ›´æ–°åçš„è½®æ’­ä¿¡æ¯ï¼Œéœ€è¦é‡æ–°èšç„¦ã€‚ åœ¨è¿™æ ·çš„åœºæ™¯ä¸‹ï¼Œå»ºè®®åœ¨è½®æ’­å›¾çš„æœ€å¤–å±‚å¢åŠ æè¿°ï¼Œå°†æ•´å—å†…å®¹å½“ä½œæŒ‰é’®å¤„ç†ï¼Œè®©éšœç¢ç”¨æˆ·æ¸…æ¥šè¿™æ˜¯æ•´ä½“ç‚¹å‡»çš„æŒ‰é’®ã€‚ 12345678&lt;View className='banner' aria-role='button' aria-label='æ´»åŠ¨æ¨èï¼Œå…±4ä¸ª'&gt; &lt;Swiper&gt; &lt;SwiperItem&gt;æ´»åŠ¨1&lt;/SwiperItem&gt; &lt;SwiperItem&gt;æ´»åŠ¨2&lt;/SwiperItem&gt; &lt;SwiperItem&gt;æ´»åŠ¨3&lt;/SwiperItem&gt; &lt;SwiperItem&gt;æ´»åŠ¨4&lt;/SwiperItem&gt; &lt;/Swiper&gt;&lt;/View&gt; å•†å“å¡ç‰‡è¯»å– å•†å“å¡ç‰‡ç”±å¤šä¸ªå­å…ƒç´ ç»„æˆï¼Œè¯»å±è½¯ä»¶ä¼šå°†èšç„¦çš„å­å…ƒç´ ï¼ˆå•†å“å›¾ã€åå­—ã€ä»·æ ¼ã€åˆ©ç›Šç‚¹ç­‰ï¼‰ä¸€ä¸ªä¸ªçš„è¯»å‡ºæ¥ã€‚ ä½†å•ç‹¬è¯»å‡ºæ¯ä¸ªå­å…ƒç´ ï¼Œä¸ä¾¿äºéšœç¢ç”¨æˆ·ç†è§£å•†å“å¡ç‰‡çš„å®Œæ•´å«ä¹‰ã€‚ ç±»ä¼¼è¿™æ ·çš„åœºæ™¯ï¼Œå¯ä»¥å°†å•†å“å¡ç‰‡å½“ä½œä¸€ä¸ªæŒ‰é’®æ•´å—å¤„ç†ã€‚åœ¨å•†å“å¡ç‰‡æœ€å¤–å±‚æ ‡ç­¾åŠ ä¸Š aria-role=&#39;button&#39;ï¼Œè¿˜å¯ä»¥é€šè¿‡ aria-label æ ‡ç­¾ï¼Œå°†å•†å“ä¿¡æ¯è¿›è¡Œæ•´åˆï¼Œç²¾ç®€æè¿°ï¼Œç¼©çŸ­å•†å“åå­—çš„æœ—è¯»æ—¶é—´ï¼Œè®©éšœç¢ç”¨æˆ·è·å¾—æ›´å¥½çš„ä½“éªŒã€‚ éšè—å…ƒç´ è¯»å– ä¸Šæ–‡æåˆ°å•†å“å¡ç‰‡çš„æ— éšœç¢ä¼˜åŒ–å¯é€šè¿‡ aria-role=&#39;button&#39; å’Œ aria-label æ¥å®ç°ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå½“éšœç¢ç”¨æˆ·èšç„¦åˆ°å•†å“å¡ç‰‡ï¼Œè¯»å±è½¯ä»¶å°†æ•´åˆçš„å•†å“ä¿¡æ¯æœ—è¯»å‡ºæ¥ï¼Œå¹¶æç¤ºæ˜¯æŒ‰é’®ç±»å‹ã€‚ ä½†å®é™…æƒ…å†µå¹¶éå¦‚æ­¤ã€‚å½“éšœç¢ç”¨æˆ·åœ¨å®‰å“æ‰‹æœºä¸Šèšç„¦åï¼Œè¯»å±è½¯ä»¶ä¸ä»…ä¼šå°†æ•´åˆçš„å•†å“ä¿¡æ¯å’Œ role æœ—è¯»å‡ºæ¥ï¼Œè¿˜ä¼šå°†å•†å“å¡ç‰‡å­å…ƒç´ çš„æ–‡æœ¬å†…å®¹æœ—è¯»å‡ºæ¥ã€‚ï¼ˆåæ–‡ä¼šæåˆ° iOS çš„è¡¨ç°ï¼‰ ä¸ºäº†é¿å…å•†å“ä¿¡æ¯é‡å¤æœ—è¯»ï¼Œå¯ä»¥åœ¨å…ƒç´ æ–‡æœ¬æ ‡ç­¾ä¸ŠåŠ ä¸Š aria-hidden=&#39;true&#39; ï¼Œéšè—å­å…ƒç´ æ–‡æœ¬æè¿°ï¼Œè®©éšœç¢ç”¨æˆ·èƒ½å¤Ÿè·å–åˆ°æ¸…æ™°ç®€æ´çš„å•†å“ä¿¡æ¯ã€‚ 123456&lt;View aria-role='button' aria-label='å•†å“æ•´åˆä¿¡æ¯'&gt; &lt;View aria-hidden='true'&gt; &lt;Image className='goods__img' src='https://img20.360buyimg.com/ling/jfs/t1/129045/25/12798/233574/5f61ffdbE248117d0/52fd1d1ee42b4443.png' lazyLoad /&gt; &lt;View className='goods__info'&gt;å•†å“ä¿¡æ¯â€¦&lt;/View&gt; &lt;/View&gt;&lt;/View&gt; iOS å’Œå®‰å“ç«¯çš„å·®å¼‚æ»‘å±æ‰‹åŠ¿å·®å¼‚ å®‰å“ï¼šåŒæŒ‡æ»‘åŠ¨ï¼Œæ ¹æ®æ‰‹åŠ¿è‡ªé€‚åº”æ»‘åŠ¨ï¼› iOSï¼šä¸‰æŒ‡æ»‘åŠ¨ï¼Œä¸€å±ä¸€å±åˆ†é¡µæ»‘åŠ¨ã€‚ è½®æ’­å›¾ç„¦ç‚¹å·®å¼‚ å®‰å“ï¼šç„¦ç‚¹ä½ç½®ä¼šè·Ÿéšå­å…ƒç´ æ»‘åŠ¨æ¶ˆå¤±ï¼› iOSï¼šç„¦ç‚¹ä½ç½®å›ºå®šä¸å˜ï¼Œä¸ä¼šéšå­å…ƒç´ æ»‘åŠ¨è€Œæ¶ˆå¤±ã€‚ ä»·æ ¼è¯»å–å·®å¼‚ ç”±äºæ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†å­—ä½“å¤§å°ä¸åŒï¼Œä»·æ ¼æ–‡æœ¬æ˜¯ç”¨å¤šä¸ªæ ‡ç­¾å®ç°çš„ã€‚ 12345&lt;View&gt; &amp;yen; &lt;Text&gt;259&lt;/Text&gt; &lt;Text&gt;.2&lt;/Text&gt;&lt;/View&gt; å®‰å“ï¼šå®Œæ•´æœ—è¯» â€œ259.2å…ƒâ€ï¼› iOSï¼šå•ç‹¬æœ—è¯»å•ä½ã€æ•´æ•°ã€å°æ•°ï¼Œå¹¶ä¸”ä¼šå°† â€œï¿¥â€ è¯»ä½œâ€œç¾å…ƒç¬¦å·â€ã€‚ aria-role=â€™buttonâ€™ è¯»å–å·®å¼‚ å®‰å“ï¼šè¯»ä½œâ€œæè¿°+æŒ‰é’®+å­å…ƒç´ æ–‡æœ¬æè¿°â€ï¼Œéœ€å€ŸåŠ© aria-hidden=&#39;true&#39; éšè—å­å…ƒç´ æ–‡æœ¬æè¿°ï¼Œé¿å…ä¿¡æ¯é‡å¤æœ—è¯»ã€‚ iOSï¼šæœ‰ä¸¤ç§æƒ…å†µã€‚ å¦‚æœæ ‡ç­¾åŒæ—¶è®¾ç½®äº† aria-label ï¼Œåˆ™è¯»ä½œâ€œæè¿° æŒ‰é’®â€ï¼Œä¸é‡å¤æœ—è¯»å­å…ƒç´ æ–‡æœ¬ã€‚ å¦‚æœæ ‡ç­¾ä»…è®¾ç½®äº† aria-role=&#39;button&#39; ï¼Œä¼šç»§ç»­è¯†åˆ«å­å…ƒç´ æ–‡æœ¬ï¼Œè¯»ä½œâ€œæè¿°+æŒ‰é’®+å­å…ƒç´ æ–‡æœ¬æè¿°â€ã€‚ä¸ºé¿å…é‡å¤æœ—è¯»ï¼Œä¹Ÿéœ€è¦ç»™å­å…ƒç´ åŠ ä¸Š aria-hidden=&#39;true&#39;ã€‚ å°ç¨‹åºæ— éšœç¢å±•æœ›å°ç¨‹åºåŸºç¡€åº“è‡ª 2.7.1 èµ·ï¼Œæ”¯æŒéƒ¨åˆ† ARIA æ ‡ç­¾ï¼Œä½†æ˜¯ä»æœ‰éƒ¨åˆ†å±æ€§å’Œ role åœ¨å°ç¨‹åºä¸­ä¸ç”Ÿæ•ˆï¼Œå¸Œæœ›æœªæ¥å¯ä»¥æ”¯æŒæ‰€æœ‰çš„ ARIA æ ‡ç­¾ï¼Œç»™éšœç¢ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒã€‚ å¦å¤–ï¼Œå°ç¨‹åºç›®å‰è¿˜æ²¡æœ‰ç›¸å…³ API æ”¯æŒè¯†åˆ«ç”¨æˆ·æ‰‹æœºæ˜¯å¦å¼€å¯æ— éšœç¢ï¼ˆè¯»å±ï¼‰æ¨¡å¼ï¼ˆåŸç”Ÿ APP å¯ä»¥é€šè¿‡ç›¸å…³ APIè¯†åˆ«ï¼‰ã€‚å¦‚æœèƒ½é¢„çŸ¥ç”¨æˆ·æ‰‹æœºå¼€å¯äº†æ— éšœç¢æ¨¡å¼ï¼Œå°±å¯ä»¥é€šè¿‡åŠ¨æ€æ§åˆ¶å‰ç«¯æ¨¡å—å±•ç¤ºï¼Œä»è€Œæ›´å¥½çš„éšè—æ— ç”¨ä¿¡æ¯ã€æ’é™¤å¹²æ‰°ä¿¡æ¯ï¼ˆæµ®å±‚å¼¹çª—ã€åŠ¨ç”»ç­‰ï¼‰ã€‚åœ¨å¯æ— éšœç¢æ¨¡å¼ä¸‹ï¼Œè®¾ç½®æ•°æ®åŸ‹ç‚¹ä¸ŠæŠ¥ï¼Œè¿˜å¯ä»¥ä¸ºéšœç¢ç”¨æˆ·æä¾›æ›´å¥½çš„ä½“éªŒã€‚ å¸Œæœ›å¾®ä¿¡å°ç¨‹åºèƒ½å°½å¿«åŠ å¼ºå¯¹æ— éšœç¢ä¼˜åŒ–å¼€å‘çš„æ”¯æŒåŠ›åº¦ï¼Œè®©éšœç¢ç¾¤ä½“èƒ½å¤Ÿäº«å—ä¿¡æ¯åŒ–æ‰€å¸¦æ¥çš„æˆæœï¼Œäº«å—ä¾¿æ·ç¾å¥½çš„ç”Ÿæ´»ã€‚ æ— éšœç¢ä½“éªŒæ‰‹æœºå¼€å¯è¯»å±æ¨¡å¼ï¼Œæ‰«ç äºŒç»´ç ä½“éªŒï¼š ç»“è¯­äº¬å–œå°ç¨‹åºé¦–é¡µæ— éšœç¢ä¼˜åŒ–ä¸Šçº¿åï¼Œæˆ‘ä»¬å¯¹è°ƒç ”çš„éšœç¢ç¾¤ä½“è¿›è¡Œäº†å›è®¿ï¼Œå¹¶ä¸”å¾—åˆ°äº†ä¸é”™çš„ä½“éªŒåé¦ˆã€‚ è¿™æ˜¯æˆ‘ä»¬åœ¨å°ç¨‹åºæ— éšœç¢ä¼˜åŒ–ä¸Šè¿ˆå‡ºçš„ç¬¬ä¸€æ­¥ï¼Œè¦è·å¾—æ›´å¥½çš„å°ç¨‹åºæ— éšœç¢è®¿é—®ä½“éªŒè¿˜æœ‰å¾ˆé•¿ä¸€æ®µè·¯è¦èµ°â€¦â€¦ å¸Œæœ›æ­¤æ¬¡å°ç¨‹åºæ— éšœç¢ä¼˜åŒ–å®è·µï¼Œèƒ½è®©éšœç¢ç¾¤ä½“äº«å—äº’è”ç½‘åº”ç”¨æ‰€å¸¦æ¥çš„ä¾¿åˆ©ï¼Œæ›´å¥½çš„äº«å—ç”Ÿæ´»ã€‚","pubDate":"Mon, 21 Sep 2020 09:08:08 GMT","guid":"https://aotu.io/notes/2020/09/21/jx-weapp-accessible/","category":"å°ç¨‹åº"},{"title":"è§„èŒƒGITä»£ç æäº¤ä¿¡æ¯&è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç®¡ç†","link":"https://aotu.io/notes/2020/09/10/git-commit-control/","description":"å‰è¨€gitä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜å¿…ä¸å¯å°‘çš„å·¥å…·ï¼Œä»£ç æäº¤ä¹Ÿæ˜¯æ—¥å¸¸ä¸€ä¸ªéå¸¸é¢‘ç¹çš„æ“ä½œï¼Œå¦‚æœä½ æˆ–ä½ çš„å›¢é˜Ÿç›®å‰å¯¹æäº¤ä¿¡æ¯è¿˜æ²¡æœ‰ä¸€ä¸ªè§„èŒƒæˆ–çº¦æŸï¼Œé‚£ä¹ˆä½ æœ‰å¿…è¦çœ‹çœ‹æœ¬æ–‡çš„å†…å®¹äº†ã€‚ ä¸ºä»€ä¹ˆè¦è§„èŒƒæäº¤ä¿¡æ¯é¦–å…ˆè§„èŒƒæäº¤ä¿¡æ¯è‚¯å®šæ˜¯æœ‰å¿…è¦çš„ï¼Œç®€å•æ€»ç»“ä¸‹å‡ ç‚¹å¥½å¤„ï¼š è®©é¡¹ç›®çš„ç»´æŠ¤æˆ–ä½¿ç”¨äººå‘˜èƒ½äº†è§£æäº¤äº†å“ªäº›æ›´æ”¹ æ¸…æ™°çš„å†å²è®°å½•ï¼Œå¯èƒ½æŸå¤©è‡ªå·±å°±éœ€è¦æŸ¥åˆ°å‘¢ è§„èŒƒçš„æäº¤è®°å½•å¯ç”¨äºè‡ªåŠ¨ç”Ÿæˆä¿®æ”¹æ—¥å¿—(CHANGELOG.MD) åŸºäºæäº¤ç±»å‹ï¼Œè§¦å‘æ„å»ºå’Œéƒ¨ç½²æµç¨‹ ä½¿ç”¨ä»€ä¹ˆè§„èŒƒConventional Commits(çº¦å®šå¼æäº¤è§„èŒƒ)ï¼Œæ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æäº¤ä¿¡æ¯è§„èŒƒï¼Œå…¶ä¸»è¦å—AngularJSè§„èŒƒçš„å¯å‘,ä¸‹é¢æ˜¯ä¸€ä¸ªè§„èŒƒä¿¡æ¯çš„ç»“æ„ï¼š12345&lt;type&gt;[optional scope]: &lt;subject&gt;//ç©ºä¸€è¡Œ[optional body]//ç©ºä¸€è¡Œ[optional footer(s)] è§„èŒƒè¯´æ˜type æäº¤çš„ç±»åˆ«ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¸­çš„ä¸€ä¸ª 12345678featï¼šå¢åŠ ä¸€ä¸ªæ–°åŠŸèƒ½fixï¼šä¿®å¤bugdocsï¼šåªä¿®æ”¹äº†æ–‡æ¡£styleï¼šåšäº†ä¸å½±å“ä»£ç å«ä¹‰çš„ä¿®æ”¹ï¼Œç©ºæ ¼ã€æ ¼å¼åŒ–ã€ç¼ºå°‘åˆ†å·ç­‰ç­‰refactorï¼šä»£ç é‡æ„ï¼Œæ—¢ä¸æ˜¯ä¿®å¤bugï¼Œä¹Ÿä¸æ˜¯æ–°åŠŸèƒ½çš„ä¿®æ”¹perfï¼šæ”¹è¿›æ€§èƒ½çš„ä»£ç testï¼šå¢åŠ æµ‹è¯•æˆ–æ›´æ–°å·²æœ‰çš„æµ‹è¯•choreï¼šæ„å»ºæˆ–è¾…åŠ©å·¥å…·æˆ–ä¾èµ–åº“çš„æ›´æ–° scope å¯é€‰ï¼Œè¡¨ç¤ºå½±å“çš„èŒƒå›´ã€åŠŸèƒ½ã€æ¨¡å— subjectå¿…å¡«ï¼Œç®€å•è¯´æ˜ï¼Œä¸è¶…è¿‡50ä¸ªå­— bodyé€‰å¡«ï¼Œç”¨äºå¡«å†™æ›´è¯¦ç»†çš„æè¿° footeré€‰å¡«ï¼Œç”¨äºå¡«å…³è”issus,æˆ–BREAK CHANGE BREAKING CHANGE å¿…é¡»æ˜¯å¤§å†™ï¼Œè¡¨ç¤ºå¼•å…¥äº†ç ´åæ€§ API å˜æ›´ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤§ç‰ˆæœ¬çš„æ”¹åŠ¨ï¼ŒBREAKING CHANGE: ä¹‹åå¿…é¡»æä¾›æè¿°ï¼Œä¸‹é¢ä¸€ä¸ªåŒ…å«ç ´åæ€§å˜æ›´çš„æäº¤ç¤ºä¾‹123feat: allow provided config object to extend other configsBREAKING CHANGE: `extends` key in config file is now used for extending other config files æ›´è¯¦ç»†çš„è¯´æ˜è¯·çœ‹çº¦å®šå¼æäº¤è§„èŒƒ å¦‚ä½•çº¦æŸè§„èŒƒæ€ä¹ˆç¡®ä¿æ¯ä¸ªæäº¤éƒ½èƒ½ç¬¦åˆè§„èŒƒå‘¢ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯é€šè¿‡å·¥å…·æ¥ç”Ÿæˆå’Œæ ¡éªŒï¼Œcommitizenæ˜¯ä¸€ä¸ªnodejså‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡äº¤äº’çš„æ–¹å¼ï¼Œç”Ÿæˆç¬¦åˆè§„èŒƒçš„git commitï¼Œç•Œé¢å¦‚ä¸‹ï¼š å¼€å§‹å®‰è£…: 123456# å…¨å±€å®‰è£…npm install -g commitizen # æˆ–è€…æœ¬åœ°å®‰è£…$ npm install --save-dev commitizen# å®‰è£…é€‚é…å™¨npm install cz-conventional-changelog packages.jsonåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä½¿ç”¨å“ªç§è§„èŒƒ 123456... \"config\": &#123; \"commitizen\": &#123; \"path\": \"cz-conventional-changelog\" &#125; &#125; å®‰è£…å®Œæˆåå¯ä»¥ä½¿ç”¨git cz æ¥ä»£æ›¿git commit,ç„¶åæ ¹æ®æç¤ºä¸€æ­¥æ­¥è¾“å…¥å³å¯ æ ¼å¼æ ¡éªŒcommitlintå¯èƒ½ä½ ä¸æƒ³æ¯æ¬¡éƒ½é€šè¿‡äº¤äº’ç•Œé¢æ¥ç”Ÿæˆï¼Œè¿˜æ˜¯æƒ³ä½¿ç”¨git commit -m &#39;message&#39;ï¼Œé‚£ä¹ˆä¸ºäº†ç¡®ä¿ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œå¯ä»¥ç»“åˆhuskyå¯¹æäº¤çš„ä¿¡æ¯è¿›è¡Œæ ¼å¼éªŒè¯ å®‰è£…ä¾èµ–123npm install --save-dev @commitlint/&#123;config-conventional,cli&#125;# å®‰è£…huskynpm install --save-dev husky æ·»åŠ  commitlint.config.jsæ–‡ä»¶åˆ°é¡¹ç›®123echo \"module.exports = &#123;extends: ['@commitlint/config-conventional']&#125;\" &gt; commitlint.config.js``` `package.json`é…ç½® #gitæäº¤éªŒè¯â€œhuskyâ€: { â€œhooksâ€: { â€œcommit-msgâ€: â€œcommitlint -E HUSKY_GIT_PARAMSâ€ } },12OKåˆ°è¿™ä¸€æ­¥å°±å®Œæˆäº†ï¼Œæœ€åç»™ä½ é¡¹ç›®README.MDåŠ ä¸Šä¸€ä¸ª`commitizen-friendly`çš„æ ‡è¯†å§ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[![Commitizen friendly](https://img.shields.io/badge/commitizen-friendly-brightgreen.svg)](http://commitizen.github.io/cz-cli/)## è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†å’Œç”ŸæˆCHANGELOGè§„èŒƒåŒ–çš„æäº¤ä¿¡æ¯é™¤äº†èƒ½å¾ˆå¥½æè¿°é¡¹ç›®çš„ä¿®æ”¹ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä½œç”¨å°±æ˜¯èƒ½æ ¹æ®æäº¤è®°å½•æ¥ç”ŸæˆCHANGELOG.MDå’Œè‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·ç­‰åŠŸèƒ½ã€‚### standard-versionä¸€ä¸ªç”¨äºç”Ÿæˆ`CHANGELOG.md`å’Œè¿›è¡Œ`SemVer(è¯­ä¹‰åŒ–ç‰ˆæœ¬å·)`å‘ç‰ˆçš„å‘½ä»¤è¡Œå·¥å…·ä¸»è¦åŠŸèƒ½ï¼š* è‡ªåŠ¨ä¿®æ”¹æœ€æ–°ç‰ˆæœ¬å·ï¼Œå¯ä»¥æ˜¯`package.json`æˆ–è€…è‡ªå®šä¹‰ä¸€ä¸ªæ–‡ä»¶* è¯»å–æœ€æ–°ç‰ˆæœ¬å·ï¼Œåˆ›å»ºä¸€ä¸ªæœ€æ–°çš„`git tag`* æ ¹æ®æäº¤ä¿¡æ¯ï¼Œç”Ÿæˆ`CHANGELOG.md`* åˆ›å»ºä¸€ä¸ªæ–°æäº¤åŒ…æ‹¬ `CHANGELOG.md`å’Œ`package.json`### è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶(SemVer)å…ˆç®€å•äº†è§£ä¸‹ä»€ä¹ˆæ˜¯è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œå…¶æ˜¯ç”±`GitHub`å‘èµ·çš„ä¸€ä»½ç”¨äºè§„èŒƒç‰ˆæœ¬å·é€’å¢çš„è§„åˆ™ï¼Œ##### ç‰ˆæœ¬æ ¼å¼ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼Œç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š* ä¸»ç‰ˆæœ¬å·(major)ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ* æ¬¡ç‰ˆæœ¬å·(minor)ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œå¯ä»¥ç†è§£ä¸ºFeatureç‰ˆæœ¬ï¼Œ* ä¿®è®¢å·(patch)ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ï¼Œå¯ä»¥ç†è§£ä¸ºBug fixç‰ˆæœ¬ã€‚å…ˆè¡Œç‰ˆæœ¬å·å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚##### å…ˆè¡Œç‰ˆæœ¬å½“å³å°†å‘å¸ƒå¤§ç‰ˆæœ¬æ”¹åŠ¨å‰ï¼Œä½†æ˜¯åˆä¸èƒ½ä¿è¯è¿™ä¸ªç‰ˆæœ¬çš„åŠŸèƒ½ 100% æ­£å¸¸ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å‘å¸ƒå…ˆè¡Œç‰ˆæœ¬ï¼š* alpha: å†…éƒ¨ç‰ˆæœ¬* beta: å…¬æµ‹ç‰ˆæœ¬* rc: å€™é€‰ç‰ˆæœ¬(Release candiate)æ¯”å¦‚ï¼š1.0.0-alpha.0,1.0.0-alpha.1,1.0.0-rc.0,1.0.0-rc.1ç­‰ã€‚ `standard-version` ä¼šæ ¹æ®æäº¤çš„ä¿¡æ¯ç±»å‹æ¥è‡ªåŠ¨æ›´æ”¹å¯¹åº”çš„ç‰ˆæœ¬å·,å¦‚ä¸‹:* feat: æ¬¡ç‰ˆæœ¬(minor)+1* fix: ä¿®è®¢å·(patch) +1* BREAK CHANGE: ä¸»æ¿å·(marjor) +1&gt; `standard-verstion` ç”Ÿæˆçš„`CHANGELOG`åªä¼šåŒ…å«`feat`,`fix`,`BREACK-CHANGE`ç±»å‹çš„æäº¤è®°å½•#### ä½¿ç”¨``` bashnpm i --save-dev standard-version æ·»åŠ npm script 1234567&#123; scripts:&#123; \"release\": \"standard-version\", \"release:alpha\": \"standard-version --prerelease alpha\", \"release:rc\": \"standard-version --prerelease rc\" &#125;&#125; æ‰§è¡Œï¼š1234# npm run scriptnpm run release# or global binstandard-version æˆ–è€…ä½ æƒ³æŒ‡å®šå‘è¡Œç‰ˆæœ¬å·ï¼š 1234#æŒ‡å®šç±»å‹ patch/minor/marjornpm run release -- --release-as patch#æŒ‡å®šç‰ˆæœ¬å·npm run release -- -- release-as 1.1.0 ç”Ÿå‘½å‘¨æœŸ prerelease:æ‰€æœ‰è„šæœ¬æ‰§è¡Œä¹‹å‰ prebump/postbump: ä¿®æ”¹ç‰ˆæœ¬å·ä¹‹å‰å’Œä¹‹å prechangelog/postchangelog:ç”Ÿæˆchangelogå’Œç”Ÿæˆchangelogä¹‹å pretag/postag:ç”Ÿæˆtagæ ‡ç­¾å’Œä¹‹å standard-versionæœ¬èº«åªé’ˆå¯¹æœ¬åœ°ï¼Œå¹¶æ²¡æœ‰pushæ‰æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ€åä¸€æ­¥ç”Ÿæˆtagåï¼Œæ‰§è¡Œpushæ“ä½œï¼Œåœ¨paceage.jsonä¸­æ·»åŠ 12345\"standard-version\": &#123; \"scripts\": &#123; \"posttag\": \"git push --follow-tags origin master &amp;&amp; npm publish\" &#125; &#125; è¿˜æœ‰æ›´å¤šé…ç½®åŠŸèƒ½è‡ªè¡ŒæŸ¥é˜… å®˜æ–¹æ–‡æ¡£ å…¶å®ƒç±»ä¼¼å·¥å…·é™¤äº†standard-version,è¿˜æœ‰å…¶å®ƒç±»ä¼¼çš„å·¥å…·,æœ‰å…´è¶£å¯ä»¥å»äº†è§£ä¸‹ semantic-release lerna ä¿®æ”¹Git Commitä¸ºäº†ä½¿CHANGELOG.MDæ›´èƒ½åŠ ç›´è§‚çœ‹åˆ°æ¯ä¸ªç‰ˆæœ¬çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬å°½é‡ä¿è¯æ¯æ¬¡æäº¤éƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼Œä½†å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…ä¼šæäº¤äº†ä¸€äº›é”™è¯¯çš„commit messageï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ªgitå‘½ä»¤æ¥ä¿®æ”¹commit 1 ä¿®æ”¹æœ€åä¸€æ¬¡æäº¤git commit --amend è¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæäº¤å¹¶è¦†ç›–ä¸Šæ¬¡æäº¤ï¼Œå¦‚æœæ˜¯å› ä¸ºå†™é”™æˆ–è€…ä¸æ»¡æ„ä¸Šæ¬¡çš„æäº¤ä¿¡æ¯ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å°±éå¸¸é€‚åˆã€‚ 2 åˆå¹¶å¤šæ¡æäº¤git reset --soft [commitID] å¦‚æœä½ æƒ³åˆå¹¶æœ€è¿‘å‡ æ¡æäº¤ä¿¡æ¯çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æ¥æ“ä½œï¼ŒæŒ‡å®šè¦æ’¤é”€çš„ccommitId,è¯¥å‘½ä»¤ä¼šä¿ç•™å½“å‰æ”¹åŠ¨å¹¶æ’¤é”€æŒ‡å®šæäº¤åçš„æ‰€æœ‰commitè®°å½•ï¼Œå¦‚æœä¸æŒ‡å®šIDçš„è¯å¯ä»¥ä½¿ç”¨HEAD~{num} æ¥é€‰æ‹©æœ€è¿‘{num}æ¡æäº¤12git reset --soft HEAD~2 #åˆå¹¶æœ€è¿‘ä¸¤æ¡æäº¤git commit -m 'feat: add new feat' å¸¦ --soft å‚æ•°çš„åŒºåˆ«åœ¨äºæŠŠæ”¹åŠ¨å†…å®¹æ·»åŠ åˆ°æš‚å­˜åŒº ç›¸å½“äºæ‰§è¡Œäº†git add . git rebase -igit rebaseçš„åŠŸèƒ½ä¼šæ›´åŠ å¼ºå¤§ï¼Œå¦‚æœæˆ‘æƒ³ä¿®æ”¹æœ€è¿‘3æ¡æäº¤è®°å½•ï¼Œæ‰§è¡Œ1git rebase -i HEAD~3 ä¼šå‡ºç°å¦‚ä¸‹ç¼–è¾‘å™¨ç•Œé¢(vimç¼–è¾‘å™¨): ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯æˆ‘æœ€è¿‘3æ¡æäº¤ä¿¡æ¯ ï¼Œä¸‹é¢æ˜¯å‘½ä»¤è¯´æ˜ï¼Œä¿®æ”¹æ–¹å¼å°±æ˜¯å°†commitä¿¡æ¯å‰çš„pickæ”¹ä¸ºä½ éœ€è¦çš„å‘½ä»¤ï¼Œç„¶åé€€å‡º:wqä¿å­˜ ä¸‹é¢æ˜¯å¸¸ç”¨çš„å‘½ä»¤è¯´æ˜ï¼š123456p,pick = ä½¿ç”¨æäº¤r,reword = ä½¿ç”¨æäº¤ï¼Œä½†ä¿®æ”¹æäº¤è¯´æ˜e,edit = ä½¿ç”¨æäº¤ï¼Œé€€å‡ºåä½¿ç”¨git commit --amend ä¿®æ”¹s,squash = ä½¿ç”¨æäº¤ï¼Œåˆå¹¶å‰ä¸€ä¸ªæäº¤f,fixup = å’Œsquashç›¸åŒï¼Œä½†ä¸¢å¼ƒæäº¤è¯´æ˜æ—¥å¿—d,drop = åˆ é™¤æäº¤ï¼Œä¸¢å¼ƒæäº¤è®°å½• æœ€åæ–‡æœ¬ä¸»è¦ä»‹ç»äº†å¦‚ä½•è§„èŒƒgit commitå’Œè‡ªåŠ¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ç®¡ç†ï¼Œä»¥åŠå¦‚ä½•ä¿®æ”¹git commit,éµå¾ªä¸€ä¸ªè§„èŒƒå…¶å®æ²¡æ¯”ä¹‹å‰éšæ„å¡«å†™ä¿¡æ¯å¢åŠ å¤šå°‘å·¥ä½œé‡ï¼Œä½†ä¾èµ–è§„èŒƒå´å¯ä»¥å®ç°æ›´å¤šæå‡æ•ˆç‡çš„äº‹æƒ…ã€‚ å‚è€ƒ conventional commits standard version semver.org Semver(è¯­ä¹‰åŒ–ç‰ˆæœ¬å·)æ‰«ç›²","pubDate":"Thu, 10 Sep 2020 09:00:00 GMT","guid":"https://aotu.io/notes/2020/09/10/git-commit-control/","category":"ç»éªŒåˆ†äº«"},{"title":"ç¡¬æ ¸çœ‹æˆ¿åˆ©å™¨â€”â€”Web å…¨æ™¯çš„å®ç°","link":"https://aotu.io/notes/2020/09/08/web-vr/","description":"ç–«æƒ…æœŸé—´ï¼Œæ‰“ç ´ç¤¾äº¤è·ç¦»é™åˆ¶çš„äº¤äº’æ¨¡å¼è¢«æ¨å‘å‰å°ï¼Œä¸ºä¸å°‘è¡Œä¸šçš„ä¼ ç»Ÿäº¤æ˜“æä¾›äº†æƒ³è±¡çš„ç©ºé—´ã€‚ ç–«æƒ…æ—¶æœŸï¼Œæˆ¿åœ°äº§ç§Ÿå”®ä¸šå—åˆ°çš„å†²å‡»æ— ç–‘æ˜¯å·¨å¤§çš„ï¼Œç”±äºäººå£æµåŠ¨çš„é™åˆ¶ï¼Œéœ€æ±‚é‡å¤§å¹…å‡å°‘ï¼Œæ— æ³•ç°åœºçœ‹æˆ¿æ›´åŠ é‡äº†è¿™ä¸€å±æœºã€‚ä½†æœ‰å±å°±æœ‰æœºï¼Œå€’æ˜¯æ„å¤–æ¨åŠ¨äº†ä¸€é¡¹æŠ€æœ¯çš„æ¨å¹¿â€”â€”VR çœ‹æˆ¿ã€‚ä½œä¸º WebVR çš„å­é›†ï¼ŒWeb å…¨æ™¯æ˜¯å¤šæ•° WebVR éœ€æ±‚çš„é™çº§é€‰æ‹©ï¼Œä¾‹å¦‚è¡—æ™¯åœ°å›¾ï¼Œæœ¬æ–‡å°†å¸¦å¤§å®¶å®ç°ä¸€ä¸ªç®€å•çš„ Web å…¨æ™¯ã€‚","pubDate":"Tue, 08 Sep 2020 13:24:35 GMT","guid":"https://aotu.io/notes/2020/09/08/web-vr/","category":"æŠ€æœ¯é¢„ç ”"},{"title":"ç¾šç‘è§†é¢‘ç¼–è¾‘å™¨å¼€å‘æ€»ç»“","link":"https://aotu.io/notes/2020/09/01/video-editor-summary/","description":"é¡¹ç›®èƒŒæ™¯ç¾šç‘å¹³å°åœ¨é™æ€ç±»çš„è®¾è®¡ä¸­ï¼Œå·²ç»å–å¾—äº†ç›¸åº”çš„æˆç»©ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šç»“åˆå½“å‰å¤§ç¯å¢ƒï¼Œæˆ‘ä»¬è®¤ä¸ºå¯ä»¥å»åšä¸€äº›åŠ¨æ€ç±»çš„è®¾è®¡ï¼Œå°†åŠ¨ç”»å’ŒéŸ³æ•ˆè½¬åŒ–ä¸ºå¯å‚¨å­˜ï¼Œå¯ç§»æ¤ï¼Œå¯å¤ç”¨çš„æ•°æ®ã€‚ä»è€Œç”¨æˆ·è¿›è¡Œåˆ›ä½œçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ç›¸å¯¹å¾ˆç®€å•çš„æ–¹å¼å»ä½¿ç”¨è¿™äº›é«˜å“è´¨çš„åŠ¨ç”»å’Œæ•ˆæœã€‚ è§†é¢‘ç¼–è¾‘å™¨è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿè§†é¢‘ç¼–è¾‘å™¨çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æˆ·å¯ä»¥é€šè¿‡æ“ä½œé™æ€çš„PSDä»è€Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„åŠ¨æ€è®¾è®¡æ•ˆæœã€‚å¯¹æ¯”AEç­‰å¤æ‚çš„è§†é¢‘ç¼–è¾‘è½¯ä»¶ï¼Œå­¦ä¹ æˆæœ¬å¤§å¤§é™ä½ï¼Œä¸”åŠ¨æ•ˆçš„å¯å¤ç”¨æ€§ã€ç§»æ¤æ€§ç­‰ä¹Ÿå‡è½»äº†ç”¨æˆ·çš„å·¥ä½œé‡ã€‚ ä»¥ä¸‹ä¸ºè®¾è®¡æ•ˆæœï¼š å¼€å‘å®å½•å¦‚ä½•è®©ä½ çš„é™æ€PSDâ€åŠ¨â€èµ·æ¥ï¼Ÿå‚è€ƒ AE çš„åˆ¶ä½œåŠ¨ç”»çš„è¿‡ç¨‹ï¼Œé¦–å…ˆä¼šé¢„è®¾å‰§æœ¬å’Œåˆ†é•œï¼Œå…¶æ¬¡è§„åˆ’å¥½åˆ†é•œä¸­çš„é•œå¤´å¦‚ä½•è¿åŠ¨ï¼Œè§’è‰²å¦‚ä½•è¿åŠ¨ï¼Œä»¥åŠå¤„ç†å’Œè§„åˆ’ç´ æã€‚æˆ‘ä»¬å¯ä»¥æç‚¼å‡ºå‡ ä¸ªå…³é”®ç‚¹ï¼šå¤šåœºæ™¯ã€é•œå¤´ç§»åŠ¨ï¼ˆå³åœºæ™¯æ•´ä½“çš„åŠ¨æ•ˆï¼‰ã€è§„åˆ’ç´ æï¼ˆå›¾å±‚å†…å®¹å‡ºç°æ—¶åˆ»åŠæ—¶é—´é•¿çŸ­çµæ´»å¯æ§ï¼‰è§†é¢‘ç¼–è¾‘å™¨æ“ä½œä¸»è¦æ¶‰åŠåŠŸèƒ½ç‚¹å¦‚ä¸‹ï¼š å¤šåœºæ™¯çš„åˆ‡æ¢ä¸è½¬åœºæ•ˆæœçš„èåˆï¼Œä½¿è§†é¢‘æ•ˆæœæ›´åŠ ç”ŸåŠ¨çµæ´»ï¼› åœºæ™¯åŠ¨æ•ˆä»¥åŠåŠ¨æ•ˆå‚æ•°çš„è®¾ç½®ï¼Œå‡å°‘äº†åŒç±»å‹åŠ¨æ•ˆçš„å¼€å‘ï¼ˆå¦‚ä½ç§»åŠ¨æ•ˆåˆå¹¶ä¸ºä¸€ä¸ªï¼‰ï¼Œä¹Ÿæ‰“å¼€äº†è®¾è®¡å¸ˆå¯¹åŠ¨æ•ˆä½¿ç”¨çš„æƒ³è±¡åŠ›ï¼Œæ”¶è·é¢å¤–çš„è§†é¢‘æ•ˆæœï¼› å›¾å±‚æ“ä½œï¼Œè°ƒæ•´å‡ºç°æ—¶åˆ»åŠæŒç»­æ—¶é—´ï¼› ç¼–è¾‘å™¨ç•Œé¢å¦‚ä¸‹å›¾ï¼š çŠ¶æ€ç®¡ç†è§†é¢‘ç¼–è¾‘å™¨çš„å®ç°ä¸»è¦åˆ†ä¸º 5 ä¸ªéƒ¨åˆ†ï¼Œè§†é¢‘é¢„è§ˆåŒºã€åŠ¨æ•ˆæ·»åŠ åŒºã€å‚æ•°ç¼–è¾‘åŒºã€å›¾å±‚æ“ä½œåŒºã€åœºæ™¯æ“ä½œåŒºï¼Œå¦‚ä¸‹å›¾å…¶ä»–éƒ¨åˆ†çš„æ¯ä¸€ä¸ªæ“ä½œéƒ½ä¼šæ˜ å°„åˆ°è§†é¢‘é¢„è§ˆåŒºï¼Œä¸”å„ä¸ªéƒ¨åˆ†æ•°æ®å…±äº«ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç¼–è¾‘å™¨çš„æ¯ä¸€æ­¥æ“ä½œéƒ½éœ€è¦è¢«â€è®°ä½â€œï¼Œä¾¿äºç¼–è¾‘çš„äººå›é€€ã€è¿˜åŸå…¶æ“ä½œã€‚ ç»åˆ†æä¼šæ¶‰åŠåˆ°ä»¥ä¸‹åœºæ™¯ï¼Œå¦‚ï¼š é¢„è§ˆåŒºç»„ä»¶çš„çŠ¶æ€éœ€è¦å…±äº« å…¶ä»–æ“ä½œåŒºçš„å˜åŠ¨ä¼šæ”¹å˜é¢„è§ˆåŒºç»„ä»¶çš„çŠ¶æ€ ç»„ä»¶çŠ¶æ€éƒ½éœ€è¦å¯æ’¤é”€/è¿˜åŸ æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ redux é›†ä¸­ç®¡ç†çŠ¶æ€ä»¥å‡å°‘ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµä¼ é€’ï¼›å¯¹äºæ’¤é”€è¿˜åŸåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ redux-undoï¼Œæ ¹æ®ç°æœ‰çš„ reducer å’Œé…ç½®å¯¹è±¡ï¼Œå¢å¼ºç°æœ‰å…¶æ’¤æ¶ˆè¿˜åŸåŠŸèƒ½ã€‚12345678910111213141516171819202122232425262728import ReduxUndo from 'redux-undo'//å®šä¹‰åŸæœ‰çš„ reducerconst editReducer = (state = null, action) =&gt; &#123; switch (action.type) &#123; case VIDEO_INIT: &#123; const &#123; templates &#125; = action.payload return &#123; templates &#125; &#125; case VIDEO_TPL_CLEAR: &#123; return &#123;&#125; &#125;&#125;//é€šè¿‡ ReduxUndo å¢å¼º reducer çš„å¯æ’¤é”€åŠŸèƒ½export const undoEditReducer = ReduxUndo(editReducer, &#123; initTypes: [VIDEO_TPL_CLEAR], filter: function filterActions (action, currentState, previousHistory) &#123; const &#123; isUndoIgnore = false &#125; = action return !isUndoIgnore &#125;, groupBy: groupByActionTypes([SOME_ACTION]), /* è‡ªå®šä¹‰åˆ†ç»„ groupBy:(action, currentState, previousHistory) =&gt; &#123; &#125;, */&#125;) å‚æ•°è¯´æ˜ initTypesï¼šå†å²è®°å½•å°†æ ¹æ®åˆå§‹åŒ–æ“ä½œç±»å‹è¿›è¡Œè®¾ç½®ï¼ˆé‡ç½®) filterï¼šè¿‡æ»¤å™¨, å¯ä»¥å¸®åŠ©è¿‡æ»¤æ‰ä¸æƒ³åœ¨æ’¤æ¶ˆ/é‡åšå†å²ä¸­åŒ…å«çš„æ“ä½œï¼› groupByï¼šå¯ä»¥é€šè¿‡é»˜è®¤çš„ groupByActionTypes æ–¹æ³•å°†åŠ¨ä½œç»„åˆä¸ºå•ä¸ªæ’¤æ¶ˆ/é‡åšæ­¥éª¤ã€‚ä¹Ÿå¯ä»¥å®ç°è‡ªå®šä¹‰åˆ†ç»„è¡Œä¸ºï¼Œå¦‚æœè¿”å›å€¼ä¸ä¸º nullï¼Œåˆ™æ–°çŠ¶æ€å°†æŒ‰è¯¥è¿”å›å€¼åˆ†ç»„ã€‚å¦‚æœä¸‹ä¸€ä¸ªçŠ¶æ€ä¸ä¸Šä¸€ä¸ªçŠ¶æ€å½’ä¸ºåŒä¸€ç»„ï¼Œåˆ™è¿™ä¸¤ä¸ªçŠ¶æ€å°†åœ¨ä¸€ä¸ªæ­¥éª¤ä¸­å½’ä¸ºä¸€ç»„ï¼›å¦‚æœè¿”å›å€¼ä¸º nullï¼Œåˆ™ redux-undo ä¸ä¼šå°†ä¸‹ä¸€ä¸ªçŠ¶æ€ä¸å‰ä¸€ä¸ªçŠ¶æ€åˆ†ç»„ã€‚ ä½¿ç”¨ store.dispatch() å’Œ Undo/Redo Actions å¯¹ä½ çš„çŠ¶æ€æ‰§è¡Œæ’¤æ¶ˆ/é‡åšæ“ä½œ1234567891011import &#123; ActionCreators &#125; from 'redux-undo'export const undo = () =&gt; (dispatch, getState) =&gt; &#123; dispatch(ActionCreators.undo())&#125;export const redo = () =&gt; (dispatch, getState) =&gt; &#123; dispatch(ActionCreators.redo())&#125;export const recovery = () =&gt; (dispatch, getState) =&gt; &#123; dispatch(ActionCreators.jumpToPast(0)) dispatch(ActionCreators.clearHistory())&#125; æ€»ç»“ å¯¹äºçŠ¶æ€ç®¡ç†ï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹å‡ ç‚¹è€ƒè™‘æ˜¯å¦éœ€è¦å¼•å…¥reduxã€mobxç­‰å·¥å…·: çŠ¶æ€æ˜¯å¦è¢«å¤šä¸ªç»„ä»¶æˆ–è€…è·¨é¡µé¢å…±äº«ï¼› ç»„ä»¶çŠ¶æ€éœ€è¦è·¨è¶Šç”Ÿå‘½å‘¨æœŸï¼› çŠ¶æ€éœ€è¦å¦‚æŒä¹…åŒ–ï¼Œå¯æ¢å¤/æ’¤é”€ç­‰æ“ä½œã€‚åœ¨ä½¿ç”¨reduxç®¡ç†çŠ¶æ€æ—¶ï¼Œé¿å…å°†æ‰€æœ‰çŠ¶æ€æŠ½ç¦»è‡³redux storeä¸­ï¼Œå¦‚ ç»„ä»¶çš„ç§æœ‰çŠ¶æ€ï¼› ç»„ä»¶çŠ¶æ€ä¼ é€’å±‚çº§è¾ƒå°‘ï¼› å½“ç»„ä»¶è¢«unmountåå¯ä»¥é”€æ¯çš„æ•°æ®ç­‰åŸåˆ™ä¸Šæ˜¯èƒ½æ”¾åœ¨ç»„ä»¶å†…éƒ¨å°±æ”¾åœ¨ç»„ä»¶å†…éƒ¨ã€‚å…¶æ¬¡ä¸ºäº†çŠ¶æ€çš„å¯è¯»æ€§å’Œå¯æ“ä½œæ€§ï¼Œåœ¨çŠ¶æ€ç»“æ„è®¾è®¡å‰ï¼Œéœ€è¦ç†æ¸…æ¥šå„ä¸ªæ•°æ®å¯¹è±¡çš„å…³ç³»ï¼Œå¹³è¡¡æ•°æ®è·å–åŠæ“ä½œå¤æ‚åº¦ï¼Œæ¨èæ‰å¹³åŒ–æ•°æ®ç»“æ„ä»¥å‡å°‘åµŒå¥—å’Œæ•°æ®å†—ä½™ã€‚ å›¾å±‚äº¤äº’åœ¨ä½¿ç”¨ç¼–è¾‘å™¨çš„è¿‡ç¨‹ä¸­ï¼Œå›¾å±‚çš„äº¤äº’æ“ä½œæ˜¯æœ€å¤šæœ€é¢‘ç¹çš„ï¼Œæˆ‘ä»¬å‚è€ƒäº†å¸¸ç”¨çš„å®¢æˆ·ç«¯è§†é¢‘ç¼–è¾‘è½¯ä»¶ AEã€Final Cut çš„äº¤äº’ï¼Œå°½å¯èƒ½åœ¨ Web ä¸Šæä¾›ç”¨æˆ·æ“ä½œçš„ä¾¿åˆ©æ€§åŠå›¾å±‚å¯è§†åŒ–ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š æ¢³ç†å›¾å±‚æ“ä½œéœ€æ±‚ï¼Œä¸»è¦åŒ…å«ï¼š å›¾å±‚è½¨é“éœ€è¦ä¼¸ç¼© ï¼ˆ è°ƒæ•´å›¾å±‚æŒç»­æ—¶é—´ å›¾å±‚ä¸Šçš„åŠ¨æ•ˆè½¨é“å¯ä»¥å•ç‹¬ä¼¸ç¼©ï¼ˆ è°ƒæ•´åŠ¨æ•ˆæŒç»­æ—¶é—´ å›¾å±‚è½¨é“éœ€è¦å·¦å³ç§»åŠ¨ï¼Œä¸”åŠ¨æ•ˆè½¨é“è·Ÿéšç§»åŠ¨ï¼ˆè°ƒæ•´å‡ºç°çš„æ—¶åˆ» åŠ¨æ•ˆè½¨é“å¯ä»¥å•ç‹¬å·¦å³ç§»åŠ¨ ï¼ˆè°ƒæ•´åŠ¨æ•ˆå‡ºç°çš„æ—¶åˆ» ä¸åŒå›¾å±‚è½¨é“å¯ä»¥ä¸Šä¸‹è°ƒæ•´é¡ºåºï¼ŒåŠ¨æ•ˆè½¨é“è·Ÿéšå›¾å±‚è½¨é“ç§»åŠ¨ ï¼ˆè°ƒæ•´å›¾å±‚é¡ºåº æ‹–åŠ¨æ—¶æ˜¾ç¤ºä¸åŒçš„å¤–è§‚ åˆå§‹çš„æ—¶å€™é¦–å…ˆè€ƒè™‘åˆ°éœ€è¦ç§»åŠ¨å›¾å±‚é¡ºåºï¼Œæˆ‘ä»¬åŸºäº react-sortable-hoc å®ç°äº†åŸºæœ¬çš„å›¾å±‚é¡ºåºæ‹–æ›³ç§»åŠ¨ , ä½†æ˜¯å¯¹äºå›¾å±‚çš„æ‹‰ä¼¸ã€å·¦å³æ‹–åŠ¨å¤„ç†éœ€è¦è‡ªå®šä¹‰é¼ æ ‡äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶éœ€è¦è‡ªå®šä¹‰è®¡ç®—æ§åˆ¶å›¾å±‚çš„ç§»åŠ¨ï¼Œè€Œä¸”æœ€åˆæ²¡æœ‰è€ƒè™‘åˆ°æ‹–åŠ¨è¿‡ç¨‹ä¸­æ‹–åŠ¨æºçš„å¤–è§‚éœ€è¦è°ƒæ•´ï¼Œæœ€ç»ˆï¼Œæˆ‘ä»¬æ”¾å¼ƒè¿™ç§å®ç°ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯å®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜çš„æ‹–æ›³ç»„ä»¶ï¼Œç»è¿‡ä¸€ç•ªæ¯”è¾ƒåï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰å®šäº† react-dnd æ‹–æ‹½ç»„ä»¶ï¼ŒæŸ¥çœ‹å…¶å®˜æ–¹è¯´æ˜ï¼š å¯å¸®åŠ©æ‚¨æ„å»ºå¤æ‚çš„æ‹–æ”¾ç•Œé¢ï¼ŒåŒæ—¶ä¿æŒç»„ä»¶çš„åˆ†ç¦»ï¼›ä¸”é€‚ç”¨äºæ‹–åŠ¨æ—¶åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ è¾“æ•°æ®ï¼Œæ›´å®Œç¾çš„æ˜¯ç»„ä»¶å¯ä»¥å“åº”æ‹–æ”¾äº‹ä»¶æ›´æ”¹å…¶å¤–è§‚å’Œåº”ç”¨ç¨‹åºçŠ¶æ€ã€‚ è¯¦ç»†è¯´æ˜ä¸‹ï¼Œreact-dnd å»ºç«‹åœ¨ HTML5 æ‹–æ”¾ API ä¹‹ä¸Š,å®ƒå¯ä»¥å¯¹å·²æ‹–åŠ¨çš„ DOM èŠ‚ç‚¹è¿›è¡Œå±å¹•å¿«ç…§ï¼Œå¹¶ç›´æ¥å°†å…¶ç”¨ä½œâ€œæ‹–åŠ¨é¢„è§ˆâ€, ç®€åŒ–äº†æˆ‘ä»¬åœ¨å…‰æ ‡ç§»åŠ¨æ—¶è¿›è¡Œç»˜åˆ¶çš„æ“ä½œã€‚ä¸è¿‡ï¼ŒHTML5 æ‹–æ”¾ API ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚å®ƒåœ¨è§¦æ‘¸å±ä¸Šä¸èµ·ä½œç”¨ï¼Œå¹¶ä¸”åœ¨ IE ä¸Šæä¾›çš„è‡ªå®šä¹‰æœºä¼šå°‘äºå…¶ä»–æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ react-dnd ä¸­ä»¥å¯æ’å…¥æ–¹å¼å®ç° HTML5 æ‹–æ”¾æ”¯æŒçš„åŸå› ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å®ƒï¼Œæ ¹æ®è§¦æ‘¸äº‹ä»¶ï¼Œé¼ æ ‡äº‹ä»¶ç­‰è‡ªå·±æ¥ç¼–å†™å…¶ä»–å®ç°ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬ä»å¤–åˆ°å†…ï¼Œä»‹ç»åŸºæœ¬çš„å®ç°ã€‚ åœºæ™¯å±‚é¢å¼•å…¥æ‰€éœ€ç»„ä»¶ 12import &#123; DndProvider &#125; from 'react-dnd'import HTML5Backend from 'react-dnd-html5-backend' å°† DndProvider æ”¾åœ¨æ•´ä¸ªåœºæ™¯çš„å¤–å±‚ï¼Œè®¾ç½® backend ä¸º HTML5Backend123456789&lt;DndProvider backend=&#123;HTML5Backend&#125;&gt; &lt;TemplateViewer // ----- å•ä¸ªåœºæ™¯å±•ç¤ºç»„ä»¶ template=&#123;tpl&#125; handleLayerSort=&#123;handleLayerSort&#125; onLayerDrop=&#123;onLayerDrop&#125; onLayerStretch=&#123;onLayerStretch&#125; /&gt; &lt;CustomDragLayer /&gt; // --- è‡ªå®šä¹‰æ‹–æ‹½é¢„è§ˆå›¾å±‚&lt;/DndProvider&gt; é‡ŒåŒ…å«ä¸åŒç±»å‹çš„å›¾å±‚ç»„ä»¶ã€‚æ¯ä¸ªå›¾å±‚ç»„ä»¶éƒ½æä¾›ä¸€ä¸ªçº¯æ¸²æŸ“ç»„ä»¶çš„æ–¹æ³• renderLayerContentï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š 12345678export function renderLayerContent (layer) &#123; return &lt;div style=&#123;&#123;...&#125;&#125;&gt;...&lt;/div&gt;&#125;export default function XxxxLayerComponent (layer) &#123; ... return &lt;div&gt;&#123;renderLayerContent(layer)&#125;&lt;/div&gt;&#125; é‡Œæ ¹æ®å½“å‰æ‹–æ‹½çš„å¯¹è±¡çš„ç»„ä»¶ç±»å‹ï¼Œè°ƒç”¨ç›¸åº” renderLayerContent ç»˜åˆ¶æ‹–æ‹½å¯è§†å†…å®¹ï¼Œä»¥å®ç°æ‹–æ‹½å‰åçš„è§†å›¾ä¸€è‡´ã€‚ å›¾å±‚å±‚é¢å›¾å±‚å¯ä»¥ä¸Šä¸‹æ‹–åŠ¨ï¼Œä¹Ÿå¯ä»¥å·¦å³æ‹–åŠ¨ï¼Œæ„å‘³å®ƒæœ¬èº«å³æ˜¯æ‹–æ‹½æºï¼Œä¹Ÿæ˜¯æ”¾ç½®çš„ç›®æ ‡ã€‚ ä¸ºäº†åŒºåˆ†æ‹–æ‹½çš„ç›®çš„ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ‹–æ‹½æº12345678910111213141516const [&#123; isHorizontalDragging &#125;, horizontalDrag, preview] = useDrag(&#123; item: &#123; type: DragTypes.Horizontal, &#125;, collect: monitor =&gt; (&#123; isHorizontalDragging: monitor.isDragging(), &#125;),&#125;)const [&#123; isVerticalDragging &#125;, verticalDrag, verticalPreview] = useDrag(&#123; item: &#123; type: DragTypes.Vertical, &#125;, collect: monitor =&gt; (&#123; isVerticalDragging: monitor.isDragging(), &#125;),&#125;) åœ¨æ”¾ç½®å¤„ç†ä¸­æ ¹æ®æ‹–æ‹½ç±»å‹è¿›è¡Œåˆ¤æ–­å¤„ç†123456789const [, drop] = useDrop(&#123; accept: [DragTypes.Horizontal, DragTypes.Vertical], drop (item, monitor) &#123; // å¤„ç†å·¦å³æ‹–åŠ¨ &#125;, hover: throttle(item =&gt; &#123; // å¤„ç†ä¸Šä¸‹æ’åº &#125;, 300),&#125;) å°†å®šä¹‰å¥½çš„æ‹–åŠ¨æºå’Œæ”¾ç½®ç›®æ ‡å…³è” DOM ã€‚æœ€å¤–å±‚ DIV ä¸ºå›¾å±‚å¯æ‹–åŠ¨åŒºåŸŸå³æ”¾ç½®ç›®æ ‡ï¼Œç„¶åä¾æ¬¡ä¸ºæ°´å¹³æ‹–æ‹½å±‚ï¼Œå‚ç›´æ‹–æ‹½å±‚ 1234567891011121314&lt;div ref=&#123;drop&#125;&gt; // --- æ”¾ç½®ç›®æ ‡ DOM &lt;div ref=&#123;verticalPreview&#125;&gt; &lt;div ref=&#123;horizontalDrag&#125;&gt; // --- æ°´å¹³æ‹–æ‹½ DOM &lt;div ref=&#123;verticalDrag&#125;&gt; // --- å‚ç›´æ‹–æ‹½ DOM &lt;Icon type='drag'/&gt; &lt;/div&gt; /* å›¾å±‚å†…å®¹å±•ç¤º */ &lt;div&gt;&#123;renderLayerContent(layer)&#125;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&lt;/div&gt; ä»¥ä¸Šå…³äºå›¾å±‚ä¸Šä¸‹æ‹–åŠ¨ã€å·¦å³æ‹–åŠ¨çš„å¤§ä½“æ¡†æ¶å·²ç»å®ç°ã€‚ ä¸Šä¸‹æ‹–åŠ¨æ’åºæ—¶ï¼Œä¸ºäº†æ‹–åŠ¨è¿‡ç¨‹ä¸­ä¸å±•ç¤ºæ‹–åŠ¨æºåªä¿ç•™ç”Ÿæˆçš„å±å¹•å¿«ç…§ï¼Œå¯ä»¥æ ¹æ®å½“å‰çš„æ‹–åŠ¨çŠ¶æ€å°†æ‹–åŠ¨æºçš„é€æ˜åº¦è®¾ç½®ä¸º 0 12345678&lt;div ref=&#123;drop&#125;&gt; // --- æ”¾ç½®ç›®æ ‡ DOM &lt;div ref=&#123;verticalPreview&#125; style=&#123;&#123; opacity: isVerticalDragging ? 0 : 1 &#125;&#125; &gt; ... &lt;/div&gt;&lt;/div&gt; æ°´å¹³æ‹–åŠ¨æ—¶ï¼Œè®¾ç½®æ‹–åŠ¨æºåŠé€æ˜ï¼Œå¤„ç†æ–¹å¼ä¸ä¸Šä¸‹æ‹–åŠ¨æ—¶åŒç†ã€‚ å›¾å±‚å†…å›¾å±‚å†…æœ‰ä¸¤ä¸ªåŒºåŸŸï¼Œä¸‹æ–¹åŒºåŸŸå¯é€šè¿‡å·¦å³ä¸¤ç«¯çš„æ“ä½œç‚¹è¿›è¡Œæ‹‰ä¼¸ï¼Œä¸Šæ–¹åŒºåŸŸå¯ä»¥åœ¨ä¸‹æ–¹åŒºåŸŸçš„å®½åº¦å†…å·¦å³ç§»åŠ¨ä»¥åŠåŒæ ·é€šè¿‡å·¦å³ä¸¤ç«¯çš„æ“ä½œç‚¹è¿›è¡Œæ‹‰ä¼¸ã€‚ç§»åŠ¨çš„å®ç°æ–¹å¼å‰é¢å·²ç»ä»‹ç»è¿‡å°±ä¸é‡å¤äº†ï¼Œé’ˆå¯¹æ‹‰ä¼¸çš„æ“ä½œï¼Œæˆ‘ä»¬å°è£…ä¸€ä¸ª Stretch ç±»æ¥ç»Ÿä¸€å¤„ç†12345678910111213141516171819202122232425function Stretch (&#123; children, left, width, onStretchEnd, onStretchMove,&#125;) &#123; function handleMouseDown (align) &#123; // è®¡ç®—åç§» &#125; return ( &lt;div&gt; &#123;children&#125; &lt;div className=&#123;classnames(styles.stretch, styles.stretchHead)&#125; onMouseDown=&#123;handleMouseDown('head')&#125; /&gt; &lt;div className=&#123;classnames(styles.stretch, styles.stretchEnd)&#125; onMouseDown=&#123;handleMouseDown('end')&#125; /&gt; &lt;/div&gt; )&#125; å°†éœ€è¦æ”¯æŒæ‹‰ä¼¸çš„åŒºåŸŸä½œä¸ºä½œä¸º Stretch çš„ children ä¼ é€’è¿›æ¥12345678&lt;div&gt; &lt;div&gt; &#123;motions.map((motion, i) =&gt; &lt;Stretch key=&#123;i&#125;&gt;&#123;/* ä¸Šæ–¹æŸä¸ªåŒºåŸŸ */&#125;&lt;/Stretch&gt;)&#125; &lt;/div&gt; &lt;div&gt; &lt;Stretch&gt;&#123;/* ä¸‹æ–¹åŒºåŸŸ */&#125;&lt;/Stretch&gt; &lt;/div&gt;&lt;/div&gt; ä½“éªŒä¼˜åŒ–æ·»åŠ å¿«æ·é”®æ•´ä¸ªç¼–è¾‘å™¨å†…å®¹æ¯”è¾ƒçš„å¤šï¼Œå¯¹é¢‘ç¹çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™å¸¸ç”¨å¿«æ·é”®çš„æ“ä½œä¹ æƒ¯ã€‚å¦‚ç©ºæ ¼æ’­æ”¾ã€delete åˆ é™¤ç­‰ç­‰ï¼Œè¯¥åŠŸèƒ½æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ react-hot-keys å®ç°ã€‚ é¦–å…ˆå¼•å…¥è¯¥å¿«æ·é”®åº“ï¼Œç„¶åæŒ‡å®šç»‘å®šçš„å¿«æ·é”®ï¼Œæ·»åŠ äº‹ä»¶å¤„ç†ã€‚123456789import Hotkeys from 'react-hot-keys'&lt;Hotkeys keyName='space' onKeyDown=&#123;(keyName, e) =&gt; &#123; e.preventDefault() play() &#125;&#125;/&gt; æ–‡æœ¬è½¬ SVGå¦å¤–å›¾å±‚å†…å®¹å±•ç¤ºæ—¶æœ‰ä¸ªå°æŠ€å·§ï¼Œäº§å“éœ€æ±‚ä¸­æ–‡æ¡ˆå›¾å±‚å¹³é“ºå±•ç¤ºã€‚å¯æ€œæˆ‘æœ€åˆç«Ÿç„¶æ˜¯é€šè¿‡æ–‡æœ¬é•¿åº¦ä»¥åŠè½¨é“é•¿åº¦è®¡ç®—å‡ºæ–‡æœ¬å±•ç¤ºæ¬¡æ•°ï¼Œç„¶åå†æ”¾åˆ° push åˆ°èŠ‚ç‚¹ä¸­ã€‚ç»å¤§ä½¬æ”¹é€ åæ‰æ˜ç™½å¯ä»¥å°†æ–‡æœ¬è½¬åŒ–ä¸º SVG ç„¶åä»¥èƒŒæ™¯å›¾å±•ç¤ºï¼ŒçœŸé¦™ï¼1234567891011&lt;div className=&#123;styles.contentText&#125; style=&#123;&#123; backgroundImage: `url(\"data:image/svg+xml;utf8, &lt;svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='$&#123;size(layer.text) * 12 + 15&#125;px' height='35px'&gt; &lt;text x='10' y='22' fill='black' font-size='12'&gt; $&#123;layer.text&#125; &lt;/text&gt; &lt;/svg&gt;\")`, &#125;&#125;/&gt; å®ç°æ•ˆæœï¼š é¡¹ç›®æ€»ç»“æœ¬æ–‡è®²è¿°äº†è§†é¢‘ç¼–è¾‘å™¨ä¸­æ“ä½œåŒºä¸»è¦æ¨¡å—çš„å¤„ç†ã€‚å…³äºçŠ¶æ€ç®¡ç†ï¼Œæˆ‘ä»¬ä¸»è¦éœ€è¦æ˜ç¡®å¼•å…¥ç®¡ç†å·¥å…·çš„æ˜¯å¦å¿…è¦ä»¥åŠä½¿ç”¨çŠ¶æ€ç®¡ç†å·¥å…·åæ˜¯å¦æ‰€æœ‰çŠ¶æ€éƒ½å¿…é¡»ç§»å…¥storeä¸­ç­‰ç­‰ã€‚å¦å¤–å¯¹äºå¤æ‚çš„å›¾å±‚æ‹–æ‹½åŠŸèƒ½ï¼Œè¦åƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆå±‚å±‚æ‹†è§£ï¼Œä»è€Œå±‚å±‚å®Œå–„å…¶ç»“æ„ã€‚å¯¹é¡¹ç›®è€Œè¨€ï¼Œæ‹¿åˆ°éœ€æ±‚åï¼Œæˆ‘ä»¬ä»æ•´ä½“åˆ°å±€éƒ¨è¿›è¡Œåˆ†æï¼Œä¼˜å…ˆç¡®å®šæ•´ä½“çš„æ¡†æ¶ã€æ ¸å¿ƒåŠŸèƒ½çš„å®ç°æ–¹å¼ç­‰ï¼Œè¿›è€Œè€ƒè™‘å¦‚ä½•æé«˜ç”¨æˆ·ä½“éªŒåº¦ã€‚éœ€æ±‚åˆ†æ¸…ä¸»æ¬¡ï¼Œä»¥ä¾¿äºæˆ‘ä»¬æ’åˆ—ä¼˜å…ˆçº§ä»è€Œå¼€å‘æé«˜æ•ˆç‡ã€‚","pubDate":"Tue, 01 Sep 2020 06:36:00 GMT","guid":"https://aotu.io/notes/2020/09/01/video-editor-summary/","category":"Webå¼€å‘"},{"title":"Taro ç‰ˆæœ¬å‡çº§æƒå¨æŒ‡å—","link":"https://aotu.io/notes/2020/08/31/taro-versions/","description":"Taro æ˜¯ä¸€æ¬¾ç”±äº¬ä¸œå‡¹å‡¸å®éªŒå®¤æ¨å‡ºçš„å¼€æ”¾å¼è·¨ç«¯è·¨æ¡†æ¶è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºè§£å†³å°ç¨‹åºã€H5ã€React Native çš„è·¨ç«¯åŒæ„é—®é¢˜ï¼Œæ”¯æŒåŒæ—¶ä½¿ç”¨ React å’Œ Vue æ¥è¿›è¡Œå¼€å‘ã€‚æœ¬æ–‡ç”± Taro å›¢é˜Ÿæˆå‘˜éš”å£è€ææ’°å†™ï¼Œæ—¨åœ¨å¸®åŠ© Taro å¼€å‘è€…å˜æ¸…å½“å‰ Taro å¤šç‰ˆæœ¬ä¹‹é—´å…³ç³»çš„é‚£äº›äº‹å„¿ï¼ŒåŒæ—¶è§£ç­”æœ‰å…³ Taro 3ã€Taro RN æ”¯æŒä»¥åŠ Taro UI çš„ä¸€äº›å›°æƒ‘ã€‚ è‡ªä» Taro åœ¨ä»Šå¹´ 7 æœˆä»½æ¨å‡º 3.0 ç‰ˆæœ¬ï¼Œå®£å¸ƒåŒæ—¶æ”¯æŒ React å’Œ Vue æ¥å¼€å‘è·¨ç«¯åº”ç”¨ä¹‹åï¼ŒTaro çš„å…³æ³¨åº¦å¾—åˆ°äº†è¿›ä¸€æ­¥åœ°æå‡ï¼Œå¾ˆå¤šå¼€å‘è€…å¼€å§‹å°è¯•å‡çº§è‡ªèº«é¡¹ç›®åˆ° 3.0 æ¥ä½“éªŒæ–°çš„ç‰¹æ€§ï¼ŒåŒæ—¶ï¼ŒTaro ç¤¾åŒºä¹Ÿå¼€å§‹è¿æ¥ä¸€äº›æ–°æœ‹å‹ï¼Œä¸šç•Œæœ‰å¾ˆå¤š Vue å¼€å‘è€…åœ¨åšæŠ€æœ¯é€‰å‹æ—¶å¼€å§‹å°†ç›®å…‰æŠ•å‘ Taroã€‚ ä½†ç”±äº Taro å¤§ç‰ˆæœ¬ä¹‹é—´å·®å¼‚è¾ƒå¤§ï¼Œè€Œç¤¾åŒºå†…å¾ˆå¤šå…³äº Taro çš„æ•™ç¨‹æ–‡ç« ä»¥åŠç¤ºä¾‹é¡¹ç›®ç›®å‰è¿˜åœç•™ Taro 1/2 æ—¶ä»£ï¼Œå¯¼è‡´å¾ˆå¤šå¼€å‘è€…ä½¿ç”¨ Taro 3.0 å°è¯•æ—¶å‡ºç°å¥‡æ€ªçš„é—®é¢˜ï¼Œæ‰€ä»¥ Taro å›¢é˜Ÿæƒ³é€šè¿‡æœ¬æ–‡å¸®åŠ©å¤§å®¶ç†è§£ Taro å„ä¸ªç‰ˆæœ¬ä¹‹é—´çš„è”ç³»ï¼ŒååŠ©å¤§å®¶æ›´å¥½åœ°å®Œæˆç‰ˆæœ¬è¿ç§»ï¼Œé¿å…å‡ºç°ä¸€äº›éš¾ä»¥è§£å†³çš„å¥‡æ€ªé—®é¢˜ã€‚ åŒºåˆ† Taro ç‰ˆæœ¬çš„ç«çœ¼é‡‘ç›Taro ç›®å‰æœ‰ 3 ä¸ªå¤§ç‰ˆæœ¬ï¼Œä½†å¦‚æœæŒ‰ç…§æ¶æ„æ¥çœŸæ­£åˆ’åˆ†æ—¶ä»£çš„è¯ï¼ŒTaro 1/2 å±äºç¬¬ä¸€ä»£æ¶æ„ï¼Œè€Œ Taro 3 åˆ™å±äºç¬¬äºŒä»£æ¶æ„ï¼Œä¸¤ä»£æ¶æ„å·®å¼‚å·¨å¤§ï¼Œç”šè‡³å¯ä»¥å®Œå…¨è®¤ä¸ºæ˜¯ 2 ä¸ªæ¡†æ¶ã€‚å½“ç„¶ï¼Œè¿™åªæ˜¯å¯¹äºæ¡†æ¶å†…æ ¸è€Œè¨€ï¼Œå¯¹äºå¼€å‘è€…ï¼ŒTaro å›¢é˜Ÿå·²ç»å°½é‡åœ¨ä¿è¯å¤§ç‰ˆæœ¬ä¹‹é—´çš„å…¼å®¹æ€§ï¼Œç€åŠ›é™ä½ç‰ˆæœ¬è¿ç§»çš„éš¾åº¦ã€‚ Taro 1/2Taro 1/2 å±äºç¼–è¯‘å‹æ¶æ„ï¼Œä¸»è¦é€šè¿‡å¯¹ç±» React ä»£ç è¿›è¡Œè¯­æ³•ç¼–è¯‘è½¬æ¢åœ°æ–¹å¼ï¼Œå¾—åˆ°å„ä¸ªç«¯å¯ä»¥è¿è¡Œçš„ä»£ç ï¼Œå†é…åˆéå¸¸è½»é‡çš„è¿è¡Œæ—¶é€‚é…ï¼Œä»¥åŠæ ¹æ®æ ‡å‡†ç»„ä»¶åº“ã€API è¿›è¡Œå·®å¼‚æŠ¹å¹³ï¼Œä»è€Œå®ç°å¤šç«¯é€‚é…çš„ç›®çš„ï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹ã€‚ è€Œ Taro 1 ä¸ Taro 2 çš„éƒ½æ˜¯åŸºäºè¿™ç§æ¶æ„å»ºç«‹çš„æ–¹æ¡ˆï¼Œä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æ˜¯ Taro 1 åœ¨å°ç¨‹åºç«¯æ˜¯è‡ªå»ºæ„å»ºä½“ç³»ï¼Œè€Œ Taro 2 åˆ™æ˜¯æ‰€æœ‰ç«¯éƒ½é‡‡ç”¨ Webpack è¿›è¡Œç¼–è¯‘ï¼Œå¯ä»¥é™ä½ Taro è‡ªèº«ç¼–è¯‘ç³»ç»Ÿçš„å¤æ‚åº¦ï¼ŒåŒæ—¶èƒ½å¤Ÿè®©å¼€å‘è€…ä½¿ç”¨ Webpack çš„ç”Ÿæ€æ¥è‡ªå®šä¹‰ç¼–è¯‘è¿‡ç¨‹å’Œç»“æœï¼Œå¯ä»¥è®¤ä¸º Taro 2 æ˜¯ Taro 1 å’Œ 3 ä¹‹é—´çš„ä¸€ä¸ªè¿‡æ¸¡æ€§ç‰ˆæœ¬ã€‚ Taro 3Taro 3 åˆ™å¯ä»¥å¤§è‡´ç†è§£ä¸ºè§£é‡Šå‹æ¶æ„ï¼ˆç›¸å¯¹äº Taro 1/2 è€Œè¨€ï¼‰ï¼Œä¸»è¦é€šè¿‡åœ¨å°ç¨‹åºç«¯æ¨¡æ‹Ÿå®ç° DOMã€BOM API æ¥è®©å‰ç«¯æ¡†æ¶ç›´æ¥è¿è¡Œåœ¨å°ç¨‹åºç¯å¢ƒä¸­ï¼Œä»è€Œè¾¾åˆ°å°ç¨‹åºå’Œ H5 ç»Ÿä¸€çš„ç›®çš„ï¼Œè€Œå¯¹äºç”Ÿå‘½å‘¨æœŸã€ç»„ä»¶åº“ã€APIã€è·¯ç”±ç­‰å·®å¼‚ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡å®šä¹‰ç»Ÿä¸€æ ‡å‡†ï¼Œå„ç«¯è´Ÿè´£å„è‡ªå®ç°çš„æ–¹å¼æ¥è¿›è¡ŒæŠ¹å¹³ã€‚è€Œæ­£å› ä¸º Taro 3 çš„åŸç†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ Taro 3 ä¸­åŒæ—¶æ”¯æŒ Reactã€Vue ç­‰æ¡†æ¶ï¼Œç”šè‡³æˆ‘ä»¬è¿˜æ”¯æŒäº† jQueryï¼Œåœ¨ä¸ä¹…çš„å°†æ¥æˆ‘ä»¬è¿˜èƒ½æ”¯æŒè®©å¼€å‘è‡ªå®šä¹‰åœ°å»æ‹“å±•å…¶ä»–æ¡†æ¶çš„æ”¯æŒï¼Œæ¯”å¦‚ Angularï¼ŒTaro 3 æ•´ä½“æ¶æ„å¦‚ä¸‹ã€‚ ç‰ˆæœ¬é€‰æ‹©çš„å–èˆé€šè¿‡ä¸Šè¿°å†…å®¹å¯ä»¥çœ‹å‡ºï¼ŒTaro ä¸¤ä»£æ¶æ„ä¹‹é—´å·®å¼‚å·¨å¤§ï¼Œä»è€Œä¹Ÿå°±å¯¼è‡´äº†ä»–ä»¬ä¹‹é—´çš„ç‰¹æ€§ä¹Ÿå¾ˆä¸ä¸€æ ·ã€‚Taro 1/2 å’Œ Taro 3 ä¹‹é—´ç‰¹æ€§çš„å·®å¼‚ä¸»è¦ä½“ç°åœ¨å¼€å‘ä½“éªŒä¸æ€§èƒ½ä¸Šã€‚ ä»å¼€å‘ä½“éªŒä¸Šçœ‹ï¼ŒTaro 3 æ˜æ˜¾æ˜¯ä¼˜äº Taro 1/2 çš„ï¼Œå—ç›Šäº Taro 3 æ¶æ„çš„åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Taro 3 ä¸­ä½¿ç”¨å®Œæ•´çš„ Reactã€Vue è¯­æ³•ç‰¹æ€§æ¥è¿›è¡Œå¼€å‘ï¼Œä»è€Œåœ¨å¼€å‘ä½“éªŒä¸Šè®©å¤šç«¯å¼€å‘æ— é™æ¥è¿‘äº Web å¼€å‘ï¼Œè¿™å¯¹æ·±è€• Web è€Œåˆæ¬¡æ¥è§¦å°ç¨‹åºçš„å¼€å‘è€…æ¥è¯´æ˜¯éå¸¸å‹å¥½çš„ã€‚è€Œå¯¹ Taro ç†Ÿæ‚‰çš„æœ‹å‹è‚¯å®šçŸ¥é“ Taro 1/2 åœ¨å¼€å‘æ—¶ä¼šæœ‰è¯¸å¤šé™åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨ JSX ä¹¦å†™ä¸Šï¼Œæˆ‘ä»¬æ€»ä¼šéœ€è¦ä¸€äº›æ‰‹æ®µæ¥ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œè¿™å°±å¯¼è‡´å¼€å‘ä½“éªŒå°æœ‰ä¸è¶³ã€‚ ä»æ€§èƒ½ä¸Šçœ‹ï¼ŒæŸäº›æƒ…å†µä¸‹ Taro 1/2 ä¼šä¼˜äº Taro 3ï¼Œå¦‚æœä½ çš„åº”ç”¨éå¸¸å¤æ‚ï¼Œé¡µé¢èŠ‚ç‚¹éå¸¸å¤šï¼Œæœ‰éå¸¸å¤šçš„å¤§è§„æ¨¡æ›´æ–°æ“ä½œï¼Œå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒè‹›åˆ»çš„è¯ï¼ŒTaro 1/2 ä¼šæ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œè€Œ Taro 1 å’Œ 2 æˆ‘ä»¬æ›´æ¨èä½¿ç”¨ Taro 2ã€‚å½“ç„¶ï¼Œæ ¹æ®æˆ‘ä»¬çš„æµ‹è¯•ï¼Œå¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´ Taro 1/2 å’Œ Taro 3 çš„æ€§èƒ½å·®å¼‚å¹¶ä¸æ˜æ˜¾ï¼Œæˆ‘ä»¬åç»­ä¼šç»™å‡º benchmark æ¥å°è¯è¿™ä¸€ç‚¹ï¼Œè€Œä¸”ï¼Œå¯¹äº Taro 3 æœ¬èº«åœ¨æ€§èƒ½å­˜åœ¨åŠ£åŠ¿çš„åœºæ™¯ï¼ŒTaro å®˜æ–¹å›¢é˜Ÿå·²ç»ç»™å‡ºäº†ç›¸åº”çš„è§£å†³æ–¹æ¡ˆæ¥åº”å¯¹ã€‚æ¯”å¦‚ï¼Œæå‡é¦–æ¬¡æ¸²æŸ“é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„æ¸²æŸ“ï¼›å¯¹äºæ— é™æ»šåŠ¨åŠ è½½çš„åˆ—è¡¨åœºæ™¯ï¼Œæˆ‘ä»¬æä¾›äº†è™šæ‹Ÿåˆ—è¡¨ç»„ä»¶ã€‚ å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå¼€å‘ä½“éªŒå’Œæ€§èƒ½å¾€å¾€æ˜¯éœ€è¦æƒè¡¡æ¥å¯»æ‰¾å¹³è¡¡ç‚¹çš„ï¼Œç¼ºä¸€ä¸å¯ï¼Œæ‰€ä»¥ç°é˜¶æ®µï¼Œæˆ‘ä»¬æ›´åŠ æ¨èä½¿ç”¨ Taro 3 æ¥å¼€å‘å¤šç«¯åº”ç”¨ã€‚è€Œä¸”ç°é˜¶æ®µ Taro å›¢é˜Ÿçš„ç ”å‘é‡å¿ƒä¸»è¦æ”¾åœ¨ Taro 3 ä¸Šï¼Œæ–°çš„ç‰¹æ€§ä¼šä¼˜å…ˆåœ¨ Taro 3 ä¸Šè¿›è¡Œå°è¯•ï¼Œæ‰€ä»¥ï¼Œåœ¨æœªæ¥ Taro 3 å°†æ›´å…·æœ‰æƒ³è±¡åŠ›ï¼Œä¼šæœ‰æ›´å¤šå¥½ç©çš„ä¸œè¥¿æ¨å‡ºæ¥ã€‚ å¹³æ»‘å‡çº§ä¸å®Œå…¨æŒ‡å—Taro 2 å’Œ Taro 3 éƒ½æœ‰å¯¹åº”çš„è¿ç§»æŒ‡å—ï¼Œæ ¹æ®è¿ç§»æŒ‡å—å¾€å¾€èƒ½è§„é¿å¤§éƒ¨åˆ†çš„é—®é¢˜ã€‚ Taro 1 å‡çº§åˆ° Taro 2 çš„è¿ç§»æŒ‡å—ã€‚ Taro 1/2 å‡çº§åˆ° Taro 3 çš„è¿ç§»æŒ‡å—ã€‚ å½“ç„¶ï¼Œè¿ç§»æŒ‡å—è‚¯å®šæ— æ³•è¦†ç›–åˆ°æ‰€æœ‰é—®é¢˜æ‰€æœ‰æƒ…å†µï¼Œæˆ‘ä»¬åœ¨ Taro äº¤æµç¾¤çš„æ—¥å¸¸äº¤æµä¸­æ€»æ˜¯èƒ½è§‚å¯Ÿåˆ°ä¸€äº›è¿ç§»çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ¢³ç†ä¸€éè¿ç§»æŒ‡å—ï¼ŒåŒæ—¶å°±ä¸€äº›å¸¸è§çš„é—®é¢˜ï¼Œå†åšä¸€äº›è¯´æ˜è¡¥å……ï¼Œæ¥è§£ç­”å¼€å‘è€…ä»¬çš„å‡çº§å›°æƒ‘ã€‚ Taro 1 å‡çº§åˆ° Taro 2Taro 1 å‡ Taro 2 æ‰€éœ€è¦åšçš„å·¥ä½œå¹¶ä¸å¤šï¼Œæ ¹æ®è¿ç§»æŒ‡å—ï¼Œä¸»è¦æ˜¯æ–°å¢äº†ä¸€ä¸ª @tarojs/mini-runner ä¾èµ–ï¼Œä»¥åŠå¯¹ç¼–è¯‘é…ç½®çš„è°ƒæ•´ï¼Œè€Œåœ¨è¿™é‡Œå®¹æ˜“å‡ºé—®é¢˜çš„å¾€å¾€æ˜¯åœ¨ç¼–è¯‘é…ç½®è°ƒæ•´ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ€»ç»“äº†ä¸€ä¸‹é’ˆå¯¹ç¼–è¯‘é…ç½®çš„è°ƒæ•´å†…å®¹ã€‚ plugins é…ç½®è°ƒæ•´ï¼Œè°ƒæ•´å‰æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè°ƒæ•´åä¸ºä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥é…ç½® Taro æ’ä»¶ï¼Œéå¸¸å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªé…ç½®è¯·ä¸ babel é…ç½®é‡Œçš„ plugins åŒºåˆ†å¼€æ¥ï¼Œåè€…æ˜¯ç”¨æ¥é…ç½® babel æ’ä»¶çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„é…ç½®é”™è¯¯ babelã€cssoã€uglify ç­‰é…ç½®ä»æ—§çš„ plugins é…ç½®ä¸­ç§»å‡ºæ¥äº†ï¼Œè°ƒæ•´ä¸ºä¸ sourceRoot å’Œ outputRoot ç­‰åŒçº§çš„é…ç½®é¡¹ weapp é…ç½®é¡¹æ”¹åä¸º mini postcss é…ç½®é¡¹ä¸‹å»æ‰ module è¿™ä¸€çº§é…ç½®ï¼ŒåŸ module ä¸‹çš„é…ç½®é¡¹ç›´æ¥ç½®äº postcss ä¸‹ å…³äº async functions çš„ä½¿ç”¨åŒæ—¶ï¼Œä» Taro 2 å¼€å§‹ï¼Œä½¿ç”¨ async functions ä¸å†éœ€è¦å®‰è£… @tarojs/async-await ä¾èµ–äº†ï¼Œè€Œæ˜¯é€šè¿‡å®‰è£… babel æ’ä»¶ babel-plugin-transform-runtime é…åˆ babel-runtime æ¥å®ç°æ”¯æŒï¼Œå…·ä½“è¯·æŸ¥çœ‹æ–‡æ¡£å¼‚æ­¥ç¼–ç¨‹æŒ‡å—ã€‚ è€Œåœ¨ Taro 3 ä¸­åˆ™ä¸å†éœ€è¦æ‰‹åŠ¨å®‰è£…é…ç½®ï¼ŒTaro çš„å®˜æ–¹ babel é¢„è®¾ babel-preset-taro å·²ç»å†…ç½®äº†ç›¸å…³é…ç½®ã€‚ Taro 1/2 å‡çº§åˆ° Taro 3Taro 1/2 å‡çº§åˆ° Taro 3 åˆ™ç›¸å¯¹æ¥è¯´è¦éº»çƒ¦è®¸å¤šï¼Œä½†æ˜¯è¿ç§»æŒ‡å—ä¸­å…¶å®ä»‹ç»å¾—å·²ç»éå¸¸è¯¦ç»†äº†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹éœ€è¦è°ƒæ•´çš„å†…å®¹ã€‚ æ–‡ä»¶è°ƒæ•´æ–‡ä»¶è°ƒæ•´ä¸»è¦å¦‚ä¸‹ï¼š babel é…ç½®ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹æ–°å¢äº† babel.config.js é…ç½®æ–‡ä»¶æ¥é…ç½® babelï¼Œä¸ºæ­¤ï¼Œè¯·å»æ‰ç¼–è¯‘é…ç½®ï¼ˆconfig/index.jsï¼‰ä¸­çš„ babel é…ç½®ï¼Œè¯·å‚è§è¯´æ˜ é¡¹ç›®/é¡µé¢é…ç½®ï¼Œæ–°å¢é¡¹ç›®/é¡µé¢åŒåçš„é…ç½®æ–‡ä»¶ *.config.jsï¼ˆæˆ–è€… *.config.tsï¼‰, * ä»£è¡¨é¡µé¢/é¡¹ç›®æ–‡ä»¶çš„æ–‡ä»¶åï¼Œconfig æ–‡ä»¶å¿…é¡»å’Œé¡µé¢/é¡¹ç›®æ–‡ä»¶åœ¨åŒä¸€æ–‡ä»¶å¤¹ï¼Œè¯·å‚è§è¯´æ˜ ç¼–è¯‘é…ç½®è°ƒæ•´ä¸»è¦å‚è€ƒä¸Šè¿° Taro 1 å‡çº§åˆ° Taro 2 æ—¶çš„è°ƒæ•´ï¼Œæ–°å¢ Taro 3 ç‰¹æœ‰é…ç½® framework é…ç½®ï¼Œå–å€¼ä¸ºä½¿ç”¨çš„æ¡†æ¶ï¼ˆreact, nerv, vue, vue3ï¼‰ï¼Œè¯·å‚è§è¯´æ˜ é¡¹ç›®ä¾èµ–è°ƒæ•´åœ¨ Taro 3 ä¸­æœ‰å¾ˆå¤šæ—§çš„é¡¹ç›®ä¾èµ–å·²ç»ä¸å†éœ€è¦äº†ï¼Œä¾‹å¦‚ä¹‹å‰åšå¹³å°è¿è¡Œæ—¶å…¼å®¹çš„ @tarojs/taro-weappã€@tarojs/taro-alipay ç­‰ç­‰ï¼Œè€ŒåŒæ—¶ä¹Ÿæ–°å¢äº†ä¸€äº›æ–°ä¾èµ–é¡¹ï¼Œä¾‹å¦‚ @tarojs/runtime ç­‰ï¼Œå…·ä½“ Taro 3 ä¼šéœ€è¦å“ªäº›ä¾èµ–ï¼Œå¯ä»¥é€šè¿‡åˆ›å»º Taro ç¤ºä¾‹é¡¹ç›®çœ‹åˆ°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ—å‡ºäº† Taro 3 ç›®å‰ä»éœ€ä½¿ç”¨çš„ NPM åŒ…ååŠå…¶å…·ä½“ä½œç”¨ã€‚ NPM åŒ… æè¿° babel-preset-taro ç»™ Taro é¡¹ç›®ä½¿ç”¨çš„ babel preset @tarojs/taro æš´éœ²ç»™åº”ç”¨å¼€å‘è€…çš„ Taro æ ¸å¿ƒ API @tarojs/shared Taro å†…éƒ¨ä½¿ç”¨çš„ utils @tarojs/api æš´éœ²ç»™ @tarojs/taro çš„æ‰€æœ‰ç«¯çš„å…¬æœ‰ API @tarojs/taro-h5 æš´éœ²ç»™ @tarojs/taro çš„ H5 ç«¯ API @tarojs/router Taro H5 è·¯ç”± @tarojs/react åŸºäº react-reconciler çš„å°ç¨‹åºä¸“ç”¨ React æ¸²æŸ“å™¨ @tarojs/cli Taro å¼€å‘å·¥å…· @tarojs/extend Taro æ‰©å±•ï¼ŒåŒ…å« jQuery API ç­‰ @tarojs/helper å†…éƒ¨ç»™ CLI å’Œ runner ä½¿ç”¨è¾…åŠ©æ–¹æ³•é›† @tarojs/service Taro æ’ä»¶åŒ–å†…æ ¸ @tarojs/taro-loader éœ²ç»™ @tarojs/mini-runner å’Œ @tarojs/webpack-runner ä½¿ç”¨çš„ Webpack loader @tarojs/runner-utils æš´éœ²ç»™ @tarojs/mini-runner å’Œ @tarojs/webpack-runner çš„å…¬ç”¨å·¥å…·å‡½æ•° @tarojs/webpack-runner Taro H5 ç«¯ Webpack æ‰“åŒ…ç¼–è¯‘å·¥å…· @tarojs/mini-runner Taro å°ç¨‹åº ç«¯ Webpack æ‰“åŒ…ç¼–è¯‘å·¥å…· @tarojs/components Taro æ ‡å‡†ç»„ä»¶åº“ï¼ŒH5 ç‰ˆ @tarojs/taroize Taro å°ç¨‹åºåå‘ç¼–è¯‘å™¨ @tarojs/with-weapp åå‘è½¬æ¢çš„è¿è¡Œæ—¶é€‚é…å™¨ eslint-config-taro Taro ESLint è§„åˆ™ eslint-plugin-taro Taro ESLint æ’ä»¶ ä»£ç è°ƒæ•´ä»£ç è°ƒæ•´ä¸»è¦å¦‚ä¸‹ï¼š API å¼•å…¥ï¼Œå‰ç«¯æ¡†æ¶ï¼ˆReact/Nerv/Vueï¼‰è‡ªèº«çš„ API ç›´æ¥ä»æ¡†æ¶å¼•å…¥ï¼Œä¸ Web ä¿æŒä¸€è‡´ï¼Œåªæœ‰ Taro æä¾›çš„ç›¸å…³ APIï¼Œè¿˜æ˜¯ä» @tarojs/taro å¼•å…¥ï¼Œè¯·å‚è§è¯´æ˜ App ä»£ç è°ƒæ•´ï¼Œå¯¹äº React/Nerv é¡¹ç›®ï¼Œé¡¹ç›®å…¥å£ App çš„ render å‡½æ•°å›ºå®šä¿®æ”¹ä¸ºè¿”å› this.props.childrenï¼Œå¦‚ä¸‹ 123456789import &#123; Component &#125; from 'react'import './app.scss'class App extends Component &#123; render() &#123; return this.props.children &#125;&#125;export default App è·¯ç”±åŠŸèƒ½ï¼Œä½¿ç”¨ getCurrentInstance().router æ›¿ä»£ this.$routerï¼ŒgetCurrentInstance ä½œä¸ºæ–° API ä» @tarojs/taro å¼•å…¥ï¼Œè¯·å‚è§è¯´æ˜ ç”Ÿå‘½å‘¨æœŸï¼Œä¸»è¦æ˜¯ä½¿ç”¨ React åï¼Œå¸¦æ¥çš„ç”Ÿå‘½å‘¨æœŸè°ƒæ•´ï¼Œè¯·å‚è§è¯´æ˜ ä½¿ç”¨ç¬¬ä¸‰æ–¹ React åº“ï¼Œå¯¹äº reduxã€mobx ç­‰ React ç”Ÿæ€åº“ï¼Œå¯ä»¥ç›´æ¥åƒ Web å¼€å‘é‚£æ ·ç›´æ¥ä½¿ç”¨ï¼Œè¯·å‚è§è¯´æ˜ Ref &amp; DOMï¼Œè¯·å‚è§è¯´æ˜ ä¸å†éœ€è¦ä¼ å…¥ $scopeï¼Œåœ¨ Taro 1/2 æ—¶è°ƒç”¨æŸäº› API éœ€è¦ä¼ å…¥ this.$scopeï¼Œç›¸å½“äºä¼ å…¥ç»„ä»¶å¯¹åº”çš„å°ç¨‹åºåŸç”Ÿå¯¹è±¡ï¼Œè€Œ Taro 3 åˆ™ä¸å†éœ€è¦ï¼Œå…·ä½“è¯·å‚è§è¯´æ˜ æ ·å¼è°ƒæ•´ï¼Œç»„ä»¶ç›´æ¥å—å…¨å±€æ ·å¼å½±å“ï¼Œä¸å†éœ€è¦è®¾ç½® addGlobalClassesï¼Œè¯·å‚è§è¯´æ˜ å½“ç„¶ï¼Œè¿ç§»æŒ‡å—å†…å®¹å¹¶ä¸ä»…ä»…å±€é™äºç‰ˆæœ¬è¿ç§»ï¼Œç”±äº Taro 3 ç›¸å¯¹ä¸ Taro 1/2 æœ‰å¾ˆå¤š breaking changesï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ Taro 3 çš„å¼€å‘è€…éƒ½èƒ½åœ¨å¼€å‘å‰é˜…è¯»ä¸€éè¿ç§»æŒ‡å—ã€‚ ä¸å¾—ä¸å” å¨ä¸€ä¸‹ Taro 3 çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿æ­£å¦‚å‰æ–‡æ‰€æåˆ°çš„ï¼Œç›®å‰æœ‰å¾ˆå¤šå¼€å‘è€…æ˜¯ä» Taro 3 æ‰å¼€å§‹æ¥è§¦ Taroï¼Œè€Œç›®å‰å¸‚é¢ä¸Šå¾ˆå¤š Taro ç›¸å…³çš„æ•™ç¨‹å’Œé¡¹ç›®éƒ½æ˜¯ Taro 1/2 çš„ï¼Œè¿™å¯¹äºå¾ˆå¤šå¼€å‘è€…æ¥è¯´ä¼šé€ æˆä¸å°çš„å›°æƒ‘ï¼Œæ‰€ä»¥è¡Œæ–‡åˆ°æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ—ä¸¾ä¸€äº›å¸¸è§é—®é¢˜æ¥å¸®åŠ©å¼€å‘è€…è§„é¿æ‰ä¸€äº›ä¸å¿…è¦çš„é”™è¯¯ã€‚ Taro å¤šç‰ˆæœ¬å…±å­˜é—®é¢˜å¾ˆå¤šå¼€å‘æ›¾ç»ä½¿ç”¨ Taro æ—§ç‰ˆæœ¬å¼€å‘è¿‡é¡¹ç›®ï¼Œå·²ç»åœ¨å…¨å±€å®‰è£…äº† Taroï¼Œä½†æ˜¯æƒ³åŒæ—¶ä½“éªŒåˆ° Taro 3ï¼Œåº”è¯¥å¦‚ä½•è¿›è¡Œæ“ä½œï¼Ÿ æˆ‘ä»¬æä¾›äº†ä¸¤ç§æ€è·¯ï¼š å¦‚æœæ˜¯éœ€è¦æ–°åˆ›å»º Taro 3 é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ nvm æ¥ç®¡ç† node ç‰ˆæœ¬ï¼Œé€šè¿‡å®‰è£…ä¸åŒ node ç‰ˆæœ¬æ¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ Taro CLIï¼Œä»è€Œè§£å†³ Taro å¤šç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ å¦‚æœæ˜¯éƒ¨åˆ†å·²æœ‰é¡¹ç›®éœ€è¦å‡çº§åˆ° Taro 3ï¼Œå¯ä»¥åœ¨è¿™äº›é¡¹ç›®æœ¬åœ°å®‰è£…ç›¸åº”ç‰ˆæœ¬çš„ Taro CLIï¼Œè¿™æ ·é€šè¿‡ yarn æˆ–è€… npm æ‰§è¡Œå‘½ä»¤çš„è¯å°±ä¼šç›´æ¥ä½¿ç”¨æœ¬åœ°å®‰è£…çš„ Taro CLIï¼Œå®‰è£…æ–¹å¼ yarn add @tarojs/cli å°† Taro CLI ç‰ˆæœ¬ä¸é¡¹ç›®ä¸­ Taro ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´è¯·æ—¶åˆ»æ³¨æ„å°† Taro CLI ç‰ˆæœ¬ä¸é¡¹ç›®ä¸­ Taro ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ CLI ä¸é¡¹ç›®ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´æ˜¯å¯¼è‡´å¾ˆå¤šé—®é¢˜å‡ºç°çš„æºå¤´ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼ŒTaro CLI ç‰ˆæœ¬ä¸º 3.0.8ï¼Œé‚£ä¹ˆ Taro ç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ä¹Ÿå¿…é¡»æ˜¯ 3.0.8ï¼ŒTaro ç›¸å…³åŒ…åå¯ä»¥ä»è¿™ä¸ªåˆ—è¡¨å¾—çŸ¥ï¼Œå…·ä½“ä¾èµ–é¡¹ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ taro info å‘½ä»¤æˆ–è€…é€šè¿‡ package.json å°±èƒ½çŸ¥æ™“ã€‚ å¦‚æœå‘ç°ä¸ä¸€è‡´çš„æƒ…å†µå¯ä»¥ä½¿ç”¨ Taro å‡çº§å‘½ä»¤ taro update self [ç‰ˆæœ¬å·] å’Œ taro update project [ç‰ˆæœ¬å·]æ¥åˆ†åˆ«å°† CLI å’Œé¡¹ç›®ä¾èµ–å‡çº§åˆ°æŒ‡å®šç‰ˆæœ¬ï¼›æˆ–è€…ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®‰è£…ç›¸åº”ç‰ˆæœ¬ CLIï¼Œä¿®æ”¹ package.json ä¾èµ–ç‰ˆæœ¬å·ï¼Œç„¶åé‡è£…ä¾èµ–æ¥è§£å†³ã€‚ ä½¿ç”¨è·¯ç”±åœ¨ Taro 3 ä¸­ä½¿ç”¨è·¯ç”±åœ¨å‰æ–‡çš„ç‰ˆæœ¬è¿ç§»éƒ¨åˆ†å·²æœ‰æåŠï¼ŒåŒæ—¶éœ€è¦äº†è§£æ›´å¤šå†…å®¹å¯ä»¥å‰å¾€å®˜æ–¹æ–‡æ¡£æŸ¥çœ‹ã€‚ éå¸¸å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºæ˜¯è·å–é¡¹ç›®ä¼ å…¥å‚æ•°è¿˜æ˜¯é¡µé¢å…¥å‚ï¼Œéƒ½æ˜¯é€šè¿‡ getCurrentInstance().router æ¥è·å–çš„ï¼Œå…·ä½“ä½¿ç”¨å¦‚ä¸‹ã€‚ 12345678import &#123; getCurrentInstance &#125; from '@tarojs/taro'import React, &#123; Component &#125; from 'react'export default class C extends Component &#123; componentDidMount () &#123; console.log(getCurrentInstance().router.params) &#125;&#125; å¦‚ä½•è·å–é¡µé¢èŠ‚ç‚¹ä¿¡æ¯ç”±äº Taro 3 è®¾è®¡æœºåˆ¶çš„åŸå› ï¼Œéœ€è¦åœ¨æ–°å¢çš„ onReady ç”Ÿå‘½å‘¨æœŸå†…æ‰èƒ½è°ƒç”¨ Taro API æ­£ç¡®è·å–é¡µé¢èŠ‚ç‚¹ä¿¡æ¯ï¼Œå°ç¨‹åºå’Œ H5 éƒ½æ˜¯å¦‚æ­¤ã€‚ è€ŒåŒæ—¶ï¼Œåœ¨å¾®ä¿¡å°ç¨‹åºä¸­å½“é¡µé¢èŠ‚ç‚¹åµŒå¥—è¿‡æ·±æ—¶ï¼Œè¶…è¿‡ä¸€å®šå±‚çº§ï¼ˆé»˜è®¤ 16 çº§ï¼Œå¯ä»¥é€šè¿‡ç¼–è¯‘é…ç½® baseLevel æ¥æ§åˆ¶ï¼‰æ—¶ï¼ŒTaro å°†è½¬è€Œä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶ï¼Œç„¶åå†å¼€å¯æ–°çš„å¾ªç¯ï¼Œåœ¨è¿™ç§æƒ…å†µè¦äº‰å–è·å–é¡µé¢èŠ‚ç‚¹ä¿¡æ¯çš„è¯ï¼Œéœ€è¦ä½¿ç”¨ è·¨è‡ªå®šä¹‰ç»„ä»¶çš„åä»£é€‰æ‹©å™¨ æ¥è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥å‚è§ Taro ç›¸å…³ issueã€‚ Taro UI æ˜¯ä¸æ˜¯ä¸æ”¯æŒ Taro 3 äº†åœ¨ Taro 3 ä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨ Taro UIï¼Œç›®å‰éœ€è¦å®‰è£… Taro UI çš„ alpha ç‰ˆæœ¬ã€‚ 1$ yarn add taro-ui@next Taro UI ä½œä¸º Taro çš„å®˜æ–¹ UI åº“ï¼Œä¾ç„¶å¤„äºç»´æŠ¤çŠ¶æ€ï¼Œç›®å‰ä¸»è¦ä¾é ç¤¾åŒºåŠ›é‡åœ¨è¿›è¡Œç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿéå¸¸æ¬¢è¿æ›´å¤šç¤¾åŒºå¼€å‘äººå‘˜å…±åŒå‚ä¸åˆ° Taro UI çš„è¿­ä»£ä¸­æ¥ã€‚ Taro UI æœ‰æ²¡æœ‰ Vue ç‰ˆæœ¬ç›®å‰ï¼ŒTaro å®˜æ–¹æ²¡æœ‰æ¨å‡º Vue ç‰ˆæœ¬çš„ Taro UI åº“ï¼Œä½†åœ¨ç¤¾åŒºä¸­æœ‰ Vue ç‰ˆæœ¬çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœä½¿ç”¨ Vue è¿›è¡Œå¼€å‘å¯ä»¥å°è¯• taro-ui-vueã€‚ ä¸ºä»€ä¹ˆ Taro 3 æ‰“åŒ…å‡ºæ¥çš„åº”ç”¨ä½“ç§¯å·¨å¤§å¾ˆå¤šæœ‹å‹ä¼šå‘ç° Taro 3 çš„é¡¹ç›®åœ¨é¢„è§ˆçš„æ—¶å€™æ‰“åŒ…å‡ºæ¥çš„åŒ…å¤§å°ç›¸æ¯” Taro 1/2 è¦å¤§ä¸Šå¾ˆå¤šï¼Œç„¶åéå¸¸ç´§å¼ ç”¨äº† Taro 3 ä¼šä¸ä¼šå¯¼è‡´è‡ªå·±çš„ä¸»åŒ…è¶…é™ã€‚ è¯šç„¶ï¼Œåœ¨é¢„è§ˆçš„æ—¶å€™ Taro 3 é»˜è®¤ç”Ÿæˆçš„åŒ…ä¼šæ¯”è¾ƒå¤§ï¼Œä¸»è¦æ˜¯å› ä¸ºä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œé¢„è§ˆæ—¶å¼•ç”¨çš„ React å’Œ Vue ç”¨çš„æ˜¯è°ƒè¯•ç”¨åº“ï¼Œè€Œä¸”åŒæ—¶é¢„è§ˆæ—¶ä¼šç”Ÿæˆ sourceMapï¼Œè¿™å°±å¯¼è‡´é¢„è§ˆæ—¶ç”Ÿæˆçš„åŒ…ä¼šå¤§å¾ˆå¤šï¼Œä½†æ˜¯åœ¨æ‰“åŒ…ç”Ÿäº§åŒ…ï¼ˆå»æ‰ â€“watchï¼‰æ—¶ï¼Œæœ€ç»ˆç”ŸæˆåŒ…è¿˜æ˜¯ä¼šå¾ˆå°çš„ï¼Œå¯¹çº¿ä¸Šä¸ä¼šæœ‰å¤ªå¤§å½±å“ï¼ŒåŒæ—¶ Taro å›¢é˜Ÿä¹Ÿæ­£åœ¨å°è¯•ä¸æ–­ä¼˜åŒ–ç”Ÿäº§åŒ…å¤§å°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ– Taro æ€§èƒ½ã€‚ å¦‚æœæƒ³è¦åœ¨é¢„è§ˆæ—¶é™ä½åŒ…å¤§å°ï¼Œå¯ä»¥è®¾ç½® NODE_ENV ä¸º production æ¥å¼€å¯å‹ç¼©ï¼Œä¾‹å¦‚ç¼–è¯‘å¾®ä¿¡å°ç¨‹åº 12345# Mac$ NODE_ENV=production taro build --type weapp --watch# Windows$ set NODE_ENV=production &amp;&amp; taro build --type weapp --watch åœ¨ Taro 3 ä¸­ä½¿ç”¨å°ç¨‹åºåŸç”Ÿé¡µé¢åŠç»„ä»¶åœ¨ Taro 3 ä¸­ä¾ç„¶å¯ä»¥åƒ Taro 1/2 é‚£æ ·å¼•å…¥å°ç¨‹åºåŸç”Ÿé¡µé¢åŠç»„ä»¶ï¼Œä¸”ä½¿ç”¨æ–¹å¼å¤§ä½“ä¸€è‡´ï¼Œä¸è¿‡åœ¨æŸäº›æƒ…å†µæœ‰äº›ç»†å¾®å·®åˆ«ï¼Œæ¯”å¦‚ slot çš„ä½¿ç”¨ï¼Œåœ¨ Taro 1/2 ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ slot æ ‡ç­¾ï¼Œè€Œåœ¨ Taro 3 ä¸­åˆ™éœ€è¦ä» @tarojs/components ä¸­å¼•å…¥ Slot ç»„ä»¶ç„¶åå†è¿›è¡Œä½¿ç”¨ã€‚ 1234567891011121314151617181920212223242526272829import Taro from '@tarojs/taro'import React, &#123; Component &#125; from 'react'import &#123; View, Text, Slot &#125; from '@tarojs/components'export default class Index extends Component &#123; state = &#123; show: false, date: '' &#125; render () &#123; const &#123; show, date &#125; = this.state return ( &lt;View className='index'&gt; &lt;van-button type='primary' onClick=&#123;this.showCalendar&#125;&gt;æ˜¾ç¤ºæ—¥å†&lt;/van-button&gt; &lt;van-calendar show=&#123;show&#125; showConfirm type='range' onClose=&#123;this.closeCalendar&#125; onConfirm=&#123;this.onConfirm&#125; &gt; &lt;Slot name='title'&gt; &lt;View&gt;Hello world&lt;/View&gt; &lt;/Slot&gt; &lt;/van-calendar&gt; &lt;/View&gt; ) &#125;&#125; å…·ä½“ä½¿ç”¨æƒ…å†µå¯ä»¥å‚è€ƒé¡¹ç›® taro3-vant-sampleã€‚ æœ‰å“ªäº› Taro å®˜æ–¹çš„ç¤ºä¾‹é¡¹ç›®ç›®å‰ Taro 3 çš„ç¤¾åŒºç¤ºä¾‹é¡¹ç›®è¿˜åœ¨å®Œå–„ä¸­ï¼ŒTaro å®˜æ–¹åˆ™åˆ†åˆ«é’ˆå¯¹ React å’Œ Vue æä¾›äº†ç¤ºä¾‹çš„ç»„ä»¶åº“é¡¹ç›®ä»¥ä¾›å‚è€ƒï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Taro CLIï¼Œåœ¨åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©ç¤¾åŒºä¼˜è´¨æ¨¡æ¿æºåˆ›å»ºå³å¯è¿›è¡Œä½“éªŒã€‚ åŒæ—¶ï¼ŒTaro å®˜æ–¹è¿˜æä¾›äº†ä¸€ä¸ª TodoMVC é¡¹ç›®ä»¥ä¾›å‚è€ƒå­¦ä¹ ï¼ŒReact å’Œ Vue ç¤ºä¾‹åˆ†åˆ«åœ¨ react å’Œ vue åˆ†æ”¯ä¸Šã€‚ Taro ç‰©æ–™å¸‚åœºä¸­å“ªäº›ç‰©æ–™èƒ½åœ¨ Taro 3 ä¸­ä½¿ç”¨ç›®å‰ Taro ç‰©æ–™å¸‚åœºæ²¡æœ‰åšå¥½é’ˆå¯¹ç‰©æ–™çš„ç‰ˆæœ¬åŒºåˆ†ï¼Œæˆ‘ä»¬ä¼šå°½å¿«å¯åŠ¨è¿™ä¸€é¡¹å·¥ä½œï¼Œä¸ºæ¯ä¸ªç‰©æ–™æ‰“ä¸Šç‰ˆæœ¬æ ‡è¯†ï¼Œå½“ä¸‹è¦è¯†åˆ«å“ªäº›ç‰©æ–™èƒ½åœ¨ Taro 3 ä¸­ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡ç‰©æ–™æœ¬èº«çš„ Taro ä¾èµ–é¡¹æ¥è¿›è¡Œè¯†åˆ«ã€‚ å†èŠèŠ Taro çš„è¿‘æœŸåŠ¨ä½œTaro ç¤¾åŒºåŠå®˜æ–¹å›¢é˜Ÿç›®å‰ä¸»è¦åœ¨é›†ä¸­äººåŠ›åšä»¥ä¸‹å‡ é¡¹å·¥ä½œ å®ç°æ”¯æŒå¹³å°ä¸æ¡†æ¶çš„è‡ªå®šä¹‰æ‰©å±•ç»†å¿ƒçš„æœ‹å‹åº”è¯¥å·²ç»å‘ç°ï¼Œè¿›å…¥ Taro 3 æ—¶ä»£ï¼ŒTaro çš„æ¨å¹¿ Slogan å·²ç»ç”±ã€Œå¤šç«¯ç»Ÿä¸€å¼€å‘è§£å†³æ–¹æ¡ˆã€å˜æˆäº†ã€Œå¼€æ”¾å¼è·¨ç«¯è·¨æ¡†æ¶è§£å†³æ–¹æ¡ˆã€ï¼Œé‚£ä¹ˆè¿™ä¸¤è€…ä¹‹é—´æœ‰ä½•å·®å¼‚å‘¢ï¼Ÿ å¯ä»¥çœ‹å‡ºã€Œå¼€æ”¾å¼è·¨ç«¯è·¨æ¡†æ¶è§£å†³æ–¹æ¡ˆã€åŒ…å«äº†å¤šç«¯ç»Ÿä¸€å¼€å‘çš„ç‰¹æ€§ï¼ŒåŒæ—¶æ”¯æŒè·¨æ¡†æ¶å¼€å‘ï¼Œè€Œä¸”æ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿæˆä¸ºä¸€ä¸ªå¼€æ”¾å¼çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¸Œæœ›å¼€å‘è€…å¯ä»¥æ ¹æ® Taro æä¾›çš„ API å¼€å‘ä¸€ä¸ªæ’ä»¶å°±èƒ½å®ç°è‡ªå·±å»ä¸º Taro æ‰©å±•æ›´å¤šå¹³å°ä¸å‰ç«¯æ¡†æ¶çš„æ”¯æŒï¼Œä¾‹å¦‚æœªæ¥æœ‰äº›æ–°çš„å¹³å°æ¨å‡ºå°ç¨‹åºï¼Œæˆ–è€…æœ‰äººå¸Œæœ›èƒ½åœ¨ Taro ä¸­ä½¿ç”¨ Angular ç­‰æ›´å¤šçš„å‰ç«¯æ¡†æ¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ Taro çš„å¼€æ”¾å¼æœºåˆ¶æ¥è‡ªè¡Œæ‰©å±•ï¼Œè€Œä¸ç”¨ç­‰å¾… Taro å®˜æ–¹æ¥è¿›è¡Œæ”¯æŒï¼ŒTaro å°†åªä½œä¸ºä¸€ä¸ªè·¨ç«¯é€‚é…çš„å¹³å°ï¼Œæ‰€æœ‰çš„å¯èƒ½æ€§éƒ½å¯ä»¥è®©ç¤¾åŒºè‡ªå·±å»è‡ªç”±å‘æ˜ã€‚ å®ç°å°ç¨‹åºä¸ Web çš„åŒæ„åœ¨å½“å‰ Taro çš„è®¾è®¡ä¸‹ï¼Œä½¿ç”¨ Taro å¼€å‘å¿…é¡»ä½¿ç”¨ Taro æ ‡å‡†ç»„ä»¶åº“ä¸­çš„ç»„ä»¶ï¼Œè€Œä¸èƒ½ç›´æ¥ä½¿ç”¨å¤§å®¶ç†Ÿæ‚‰çš„ HTML æ ‡ç­¾ã€‚æˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ‰“ç ´è¿™ä¸€è—©ç¯±ï¼Œå¯»æ±‚æ”¯æŒè®©å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨ HTML æ ‡ç­¾æ¥å¼€å‘å°ç¨‹åºçš„æ–¹æ¡ˆã€‚ è¿™æ ·ï¼Œæ—¢èƒ½è¿›ä¸€æ­¥è®© Taro çš„å¼€å‘ä½“éªŒæ¥è¿‘ Webï¼Œ åŒæ—¶ä¹Ÿèƒ½è®©ä¸€äº› Web ç”Ÿæ€èµ„æºå¯ä»¥ç›´æ¥è¿è¡Œåœ¨å°ç¨‹åºä¸­ï¼Œæå¤§é™ä½ä» Web è¿ç§»åˆ°å°ç¨‹åºçš„æˆæœ¬ã€‚ è¯´è¯´ç¼ºå¸­çš„ Taro 3 RN æ”¯æŒå¾ˆå¤šæœ‹å‹åœ¨å‡çº§åˆ° Taro 3 ä¹‹åéƒ½ä¼šå‘å‡ºç–‘é—®ï¼šRN æ˜¯ä¸å†æ”¯æŒäº†å—ï¼Ÿ Taro 3 æ²¡æœ‰æ”¯æŒ RN é€‚é…ï¼Œè®©å¾ˆå¤šä½¿ç”¨ Taro å¼€å‘ RN åº”ç”¨çš„æœ‹å‹æªæ‰‹ä¸åŠï¼Œç»å¸¸åœ¨ç¾¤é‡Œèƒ½çœ‹åˆ°ä¸Šè¿°çµé­‚æ‹·é—®ã€‚ äº‹å®ä¸Š Taro å¹¶æ²¡æœ‰æŠ›å¼ƒ RNï¼Œç›®å‰ Taro 3 RN é€‚é…å·¥ä½œå·²ç»ç”± ã€Œ58 åŒåŸã€å¼€å‘å›¢é˜Ÿæ¥ç®¡ï¼Œè¿›è¡Œé€‚é…æ”¯æŒï¼Œç›®å‰è¿™é¡¹å·¥ä½œå·²ç»æ­£åœ¨ç´§é”£å¯†é¼“è¿›è¡Œï¼Œç›¸ä¿¡ä¸ä¹…çš„å°†æ¥å°±èƒ½çœ‹åˆ°åœ¨ Taro 3 ä¸­ RN çš„æ”¯æŒç‹è€…å½’æ¥ã€‚è€Œè¿™ä¸€æ¬¡çš„é€šåŠ›åä½œä¹Ÿæ„å‘³ç€ Taro æ ¸å¿ƒå›¢é˜Ÿæ­£ä¸æ–­æˆé•¿ä¸ºä¸€ä¸ªè·¨å…¬å¸çš„å›¢é˜Ÿï¼Œåœ¨æœªæ¥ä¸€å®šä¼šæœ‰æ›´å¤šçµæ„Ÿçš„ç¢°æ’ï¼Œä¸ºç¤¾åŒºå¼€å‘è€…å¸¦æ¥æ›´å¤šç²¾å½©çš„åŠŸèƒ½ã€‚ æ€»ç»“ä¸€ä¸‹ä»ç›®å‰çš„ä¸šç•Œåé¦ˆä¸ Taro è‡ªèº«è§„åˆ’æ¥çœ‹ï¼ŒTaro 3 æ˜¯ä¸€ä¸ªéå¸¸å€¼å¾—å°è¯•å’ŒæœŸå¾…çš„ç‰ˆæœ¬ï¼Œå·²ç»æœ‰éå¸¸å¤šçš„å¼€å‘è€…å¼€å§‹ä½¿ç”¨ Taro 3 å¼€å‘åº”ç”¨ï¼Œåœ¨æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šä¸æ–­å®Œå–„åŠŸèƒ½ä¸æ–‡æ¡£ï¼Œä¸ºå¤§å®¶å¸¦æ¥æ›´æ£’çš„å¼€å‘ä½“éªŒã€‚å‡çº§åˆ° Taro 3 çš„è¿‡ç¨‹æˆ–è®¸ç¨æ˜¾è‰°è¾›ï¼Œä½†æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿å¤§å®¶é€šè¿‡äº¤æµç¾¤å’Œ GitHub issues å‘æˆ‘ä»¬è¿›è¡Œåé¦ˆã€‚ åŒæ—¶ï¼Œè¯šæŒšé‚€è¯·æ‚¨ä¸ Taro å®˜æ–¹å›¢é˜Ÿäº¤æµæ‚¨çš„ä½¿ç”¨æƒ…å†µï¼Œæ‚¨çš„åé¦ˆæ˜¯ Taro å‰è¿›çš„åŠ¨åŠ›ï¼è¯·æˆ³æ­¤å®Œæˆ Taro ä½¿ç”¨è°ƒç ”é—®å·ï¼Œæäº¤é—®å·ï¼Œå°†æœ‰å¯èƒ½è·å¾— Taro å›¢é˜Ÿçš„çº¢åŒ…å“¦ï¼ï¼æ„Ÿè°¢ä¸€è·¯ç›¸ä¼´ï¼ŒTaro æœ‰ä½ æ›´ç²¾å½©ï¼","pubDate":"Mon, 31 Aug 2020 16:00:00 GMT","guid":"https://aotu.io/notes/2020/08/31/taro-versions/","category":"ç§»åŠ¨å¼€å‘"},{"title":"ä¸‰åˆ†é’Ÿæ‰“é€ ä¸ƒå¤•ä¸“å±çš„æ’ä»¶åŒ–è„šæ‰‹æ¶","link":"https://aotu.io/notes/2020/08/25/valentine-plugin-cli/","description":"èƒŒæ™¯ä¸ƒå¤•èŠ‚å°†è‡³ï¼Œä½ æ˜¯å¦è¿˜å› æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„è¡¨ç™½æœºä¼šè€Œè‹¦æ¼ï¼Œè¿˜æ˜¯è¯´åœ¨çº ç»“äºä¸ºä¼´ä¾£æŒ‘é€‰åˆé€‚çš„æƒ…äººèŠ‚ç¤¼ç‰©ã€‚é‚£ä¹ˆä»Šå¤©ä½ æ¥å¯¹åœ°æ–¹äº†ã€‚ç›¸ä¿¡åœ¨è¯»å®Œè¿™ç¯‡æ–‡ç« åï¼Œä½ å°±å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ‰“é€ å‡ºä¸€ä¸ªä¸“å±äºä»–/å¥¹/å®ƒçš„ä¸ƒå¤•ä¸“å±æ’ä»¶åŒ–è„šæ‰‹æ¶ï¼Œé€šè¿‡æœ¬ç¯‡æ–‡ç« ï¼Œä¸ä»…å¯ä»¥è½»æ¾æ‹‰è¿‘ä½ ä¸ä½ çˆ±äººçš„è·ç¦»ï¼Œè¿˜èƒ½é¡ºä¾¿å­¦ä¼šæ’ä»¶åŒ–è„šæ‰‹æ¶çš„ç›¸å…³çŸ¥è¯†ã€‚ æ¸©é¦¨æé†’æœ¬ç¯‡æ–‡ç« éœ€è¦ä¸€å®šçš„å‘½ä»¤è¡ŒçŸ¥è¯†ï¼Œè‹¥åœ¨é˜…è¯»æœ¬ç¯‡æ–‡ç« æ—¶æœ‰ä»»ä½•çš„ç–‘æƒ‘ï¼Œå¯ä»¥é€šè¿‡è‡ªè¡Œæœç´¢ç›¸å…³å†…å®¹æˆ–è€…é˜…è¯»ä»¥ä¸‹çš„æ–‡ç« æ¥è§£æƒ‘ï¼šhttps://aotu.io/notes/2016/08/09/command-line-development/index.html åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ é¡¹ç›®ç›®å½•ç»“æ„1234567891011121314151617181920.â”œâ”€â”€ lerna.jsonâ”œâ”€â”€ package.jsonâ”œâ”€â”€ packagesâ”‚ â”œâ”€â”€ cli // ä¸ƒå¤•ä¸“å±æ’ä»¶åŒ–cliâ”‚ â”‚ â”œâ”€â”€ api â”‚ â”‚ â”‚ â”œâ”€â”€ commandAPI.js â”‚ â”‚ â”‚ â”œâ”€â”€ operateHooks.js â”‚ â”‚ â”‚ â””â”€â”€ share-utils.jsâ”‚ â”‚ â”œâ”€â”€ bin â”‚ â”‚ â”‚ â””â”€â”€ valentineâ”‚ â”‚ â”œâ”€â”€ commandsâ”‚ â”‚ â”‚ â””â”€â”€ happy.jsâ”‚ â”‚ â””â”€â”€ package.jsonâ”‚ â””â”€â”€ confession // confessionæ’ä»¶â”‚ â”œâ”€â”€ command.config.jsâ”‚ â””â”€â”€ package.jsonâ”œâ”€â”€ scriptsâ”‚ â””â”€â”€ np.js // ç”¨äºæ‰¹é‡éƒ¨ç½²å‘å¸ƒè„šæ‰‹æ¶å’Œæ’ä»¶çš„å®šåˆ¶è„šæœ¬â””â”€â”€ yarn.lock ç¼–å†™æ’ä»¶åŒ–è„šæ‰‹æ¶é¡¹ç›®ä»£ç æ–°å»ºä¸ƒå¤•é¡¹ç›® æ–°å»ºä¸€ä¸ªåä¸ºvalentineçš„ç©ºç›®å½•å¹¶è¿›å…¥è¯¥ç›®å½•ï¼Œé€šè¿‡æ‰§è¡Œyarn init -yåˆå§‹åŒ–ç›®å½•ï¼ˆæ²¡å®‰è£…yarnçš„éœ€è¦å®‰è£…ä¸€ä¸‹yarnï¼‰ï¼ŒåŒæ—¶ä¿è¯nodeç‰ˆæœ¬&gt;=10ã€‚ ç”±äºè¿™ä¸ªé¡¹ç›®ä¸ä»…æœ‰æˆ‘ä»¬çš„æ ¸å¿ƒè„šæ‰‹æ¶ï¼Œè¿˜å­˜åœ¨ç€ä¸€äº›â€œç”¨äºè¡¨æ˜å¿ƒæ„â€çš„æ’ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨monorepoçš„ä»“åº“ç»“æ„ï¼Œå¹¶å®‰è£…lernaæ¥è¿›è¡Œä»“åº“çš„ç®¡ç†ï¼Œè¿™é‡Œä½¿ç”¨lernaæ˜¯å› ä¸ºlernaèƒ½å¯¹å¤šä¸ªpackagesè¿›è¡Œç»Ÿä¸€çš„ç‰ˆæœ¬çš„ç®¡ç†ã€‚åœ¨ç›®å½•ä¸‹æ‰§è¡Œyarn add --dev lernaã€‚ åœ¨ç›®å½•ä¸‹æ–°å»ºlerna.jsonæ–‡ä»¶ï¼Œå¯¹lernaè¿›è¡Œä»¥ä¸‹é…ç½®ï¼š 12345678&#123; \"packages\": [ \"packages/*\" ], \"version\": \"0.0.1\", \"npmClient\": \"yarn\", \"useWorkspaces\": true&#125; åœ¨é¡¹ç›®æ ¹ç›®å½•çš„package.jsonä¸‹æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š 123456&#123; \"private\": true, \"workspaces\": [ \"packages/*\" ]&#125; åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºpackagesçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢ç”¨æ¥å­˜æ”¾æˆ‘ä»¬çš„æ ¸å¿ƒè„šæ‰‹æ¶ä»¥åŠæ’ä»¶çš„packageã€‚ all rightï¼Œä¸‡äº‹ä¿±å¤‡~ åˆå§‹åŒ–è„šæ‰‹æ¶packageç›®å½• è¿›å…¥packagesæ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ªåä¸ºcliçš„æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¸»è¦åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹å†…ï¼Œå¯¹æˆ‘ä»¬çš„è„šæ‰‹æ¶æ ¸å¿ƒé€»è¾‘è¿›è¡Œç¼–å†™ã€‚ è¿›å…¥åˆ°cliæ–‡ä»¶å¤¹å†…ï¼Œæ–°å»ºpackage.jsonæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š 12345678910111213141516171819&#123; \"name\": \"@o2team/valentine-cli\", \"version\": \"0.0.1\", \"main\": \"index.js\", \"license\": \"MIT\", \"bin\": &#123; \"valentine\": \"./bin/valentine\" &#125;, \"scripts\": &#123; \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, \"author\": \"\", \"description\": \"\", \"dependencies\": &#123; \"chalk\": \"^4.1.0\", \"commander\": \"^5.1.0\", \"tapable\": \"^1.1.3\" &#125;&#125; åœ¨cliæ–‡ä»¶å¤¹å†…æ–°å»ºbinæ–‡ä»¶å¤¹ï¼Œå¹¶è¿›å…¥binæ–‡ä»¶å¤¹å†…æ–°å»ºvalentineæ–‡ä»¶ï¼Œé€šè¿‡chmod +x ./valentineä¸ºå…¶æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼Œå¹¶åœ¨æ–‡ä»¶å†…å†™å…¥ç®€å•çš„ä»£ç ï¼š 12#!/usr/bin/env nodeconsole.log('-------- æƒ…äººèŠ‚å¿«ä¹ --------') åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ./packages/cli/bin/valentineï¼Œé¡ºåˆ©çš„è¯ï¼Œä½ å°†åœ¨ç»ˆç«¯çœ‹åˆ°â€œæƒ…äººèŠ‚å¿«ä¹â€ã€‚ å®Œå–„è„šæ‰‹æ¶æ ¸å¿ƒé€»è¾‘å½“ç„¶ï¼Œåªèƒ½æ‰“å°å‡ºä¸€ä¸ªå¦‚æ­¤ç®€å•çš„ç¥ç¦ï¼Œæ˜¯å®Œå…¨ä¸èƒ½è¾¾ä¸åˆ°æˆ‘ä»¬å¼€å§‹çš„é¢„æœŸçš„ï¼Œç”šè‡³ä¸èƒ½ç§°å¾—ä¸Šæ˜¯ä¸€ä¸ªè„šæ‰‹æ¶ã€‚ ä¸è¿‡ä¸è¦ç€æ€¥ï¼Œæ¥ä¸‹æ¥ï¼Œå®¹æˆ‘å…ˆç¨å¾®ä»‹ç»ä¸€ä¸‹æ’ä»¶åŒ–è„šæ‰‹æ¶çš„è¦ç‚¹ï¼Œå¹¶åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­å¯¹è¿™äº›è¦ç‚¹è¿›è¡Œå®ç°ã€‚ æ’ä»¶åŒ–çš„æ ¸å¿ƒè¦ç‚¹ä¸€èˆ¬æ¥è¯´ï¼Œè¦å®ç°æ’ä»¶åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å…³å¿ƒä»¥ä¸‹ä¸‰ç‚¹ï¼š æ’ä»¶çš„å®‰è£…å’Œå¸è½½ æ’ä»¶çš„è·å–å’Œç®¡ç† æ’ä»¶é—´çš„é€šä¿¡ è€Œç”±äºæˆ‘ä»¬ç›®å‰éœ€è¦æ’ä»¶åŒ–çš„æ˜¯è„šæ‰‹æ¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡é¡¹ç›®ä¾èµ–çš„æ–¹å¼æ¥å®ç°æ’ä»¶çš„å®‰è£…å’Œå¸è½½ï¼Œè€Œè„šæ‰‹æ¶æœ¬èº«åªéœ€è¦åœ¨å®ƒæ‰§è¡Œå‘½ä»¤çš„é¡¹ç›®çš„ä¾èµ–å†…å¯»æ‰¾éœ€è¦åŠ è½½çš„æ’ä»¶å³å¯ã€‚ æœ€åvalentineå†…çš„å¤§è‡´é€»è¾‘åº”å˜ä¸ºï¼š1234567891011#!/usr/bin/env nodeconst &#123; getAllCommands,&#125; = require('../api/commandAPI.js')console.log('-------- æƒ…äººèŠ‚å¿«ä¹ --------')// è·å–æ‰€æœ‰çš„å‘½ä»¤ï¼ˆé¢„è®¾+æ’ä»¶ï¼‰getAllCommands().forEach(cwd =&gt; &#123; // æ’ä»¶æ³¨å†Œå‘½ä»¤è¡Œ&#125;) ç¼–å†™è·å–æ’ä»¶é€»è¾‘æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å»å®ç°getAllCommandsçš„é€»è¾‘ï¼š é¦–å…ˆæˆ‘ä»¬åœ¨cliæ–‡ä»¶å¤¹å†…æ–°å»ºä¸€ä¸ªåä¸ºapiçš„æ–‡ä»¶å¤¹ï¼Œç”¨äºåœ¨é‡Œé¢å­˜æ”¾ä¸€äº›è·å–å’ŒåŠ è½½æ’ä»¶çš„é€»è¾‘ï¼Œå¹¶åœ¨apiæ–‡ä»¶å¤¹å†…æ–°å»ºcommandAPI.jsæ–‡ä»¶ã€‚ åœ¨commandAPI.jsæ–‡ä»¶å†…å®ç°getAllCommandsçš„é€»è¾‘ï¼š123456789101112131415161718192021222324252627const fs = require('fs')const path = require('path')// è·å–æ‰€æœ‰å‘½ä»¤è¡Œå‘½ä»¤ï¼ŒåŒ…æ‹¬é¢„è®¾çš„ä»¥åŠæ’ä»¶çš„module.exports.getAllCommands = () =&gt; &#123; const cwdFns = [] const localCwdPath = path.join(__dirname, '..', 'commands') const localCwdNames = [...fs.readdirSync(localCwdPath)] localCwdNames.forEach(name =&gt; &#123; const cwdPath = path.join(localCwdPath, name) cwdFns.push(require(cwdPath)) &#125;) const &#123; getAllPluginIdOfPackageJson &#125; = require('./share-utils') getAllPluginIdOfPackageJson().forEach(name =&gt; &#123; const command = path.join(process.cwd(), 'node_modules', name, 'command.config.js') try &#123; const cwd = require(command) cwdFns.push(cwd) &#125; catch (error) &#123; console.log(`$&#123;command&#125; ä¸å­˜åœ¨`) &#125; &#125;) return cwdFns&#125; åœ¨é˜…è¯»ä¸Šè¿°ä»£ç çš„æ—¶å€™ï¼Œä½ ä¹Ÿè®¸ä¼šæœ‰å‡ ç‚¹ç–‘é—®ï¼š localCwdæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦è·å–å®ƒï¼ŸlocalCwdæ˜¯è„šæ‰‹æ¶é™¤äº†æ’ä»¶å¤–åŸæœ¬æ‰€åŒ…å«çš„ä¸€äº›å‘½ä»¤åŠŸèƒ½ï¼Œä¸ºäº†ä¿è¯å¼•å…¥çš„ä¸€è‡´æ€§ï¼Œå› æ­¤å®ƒä¸æ’ä»¶çš„ç»“æ„æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä¼šåœ¨è·å–æ’ä»¶å‘½ä»¤çš„æ—¶å€™ä¸€å¹¶è·å–ã€‚ share-utilsæ–‡ä»¶æ‰€å¯¼å‡ºçš„å‡½æ•°åšäº†ä»€ä¹ˆï¼Ÿæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿshare-utilsæ‰€å¯¼å‡ºçš„getAllPluginIdOfPackageJsonå‡½æ•°ä¸»è¦æ˜¯åˆ©ç”¨æ­£åˆ™æ¥åŒ¹é…å½“å‰é¡¹ç›®ä¸‹ç¬¦åˆæ’ä»¶å‘½åçš„ä¾èµ–ï¼Œå¹¶æŠŠè¿™äº›ä¾èµ–æ•´åˆå¯¼å‡ºï¼Œä¾›è„šæ‰‹æ¶ä½¿ç”¨ã€‚ 12345678910111213141516171819202122const fs = require('fs')const path = require('path')const pkPluginRE = /^(@o2team\\/)valentine-plugin-/ exports.pkPluginRE = pkPluginRE exports.getAllPluginIdOfPackageJson = () =&gt; &#123; const pkgJsonPath = path.join(process.cwd(), 'package.json') const deps = &#123;&#125; const plugins = [] if (fs.existsSync(pkgJsonPath)) &#123; const pkg = require(pkgJsonPath) Object.assign(deps, pkg.devDependencies || &#123;&#125;, pkg.dependencies || &#123;&#125;) Object.keys(deps).forEach(dep =&gt; &#123; pkPluginRE.test(dep) &amp;&amp; plugins.push(dep) &#125;) &#125; return plugins &#125; è¿™ä¸ªgetAllCommandså‡½æ•°çš„æ•´ä½“é€»è¾‘æ˜¯æ€ä¹ˆæ ·çš„ï¼ŸgetAllCommandsçš„å…¶å®ä¸€å…±åšäº†ä¸‰ä»¶äº‹æƒ…ï¼š ä¸€ï¼Œè·å–è„šæ‰‹æ¶å†…ç½®çš„å‘½ä»¤åŠŸèƒ½ï¼› äºŒï¼ŒåŒ¹é…å½“å‰é¡¹ç›®ä¸‹ç¬¦åˆæ’ä»¶å‘½åçš„ä¾èµ–ï¼Œå¯¹è¿™äº›ä¾èµ–è¿›è¡Œæ•´åˆå¹¶å¯¼å‡ºï¼› ä¸‰ï¼Œéå†è¿™äº›æ’ä»¶ä¾èµ–ï¼Œä¸å†…ç½®çš„å‘½ä»¤åŠŸèƒ½ä¸€èµ·ï¼Œå°†å®ƒä»¬çš„æ³¨å†Œå‡½æ•°cwdå¯¼å…¥åˆ°ä¸€ä¸ªæ•°ç»„å†…ï¼Œå¹¶å°†è¯¥æ•°ç»„å¯¼å‡ºã€‚ ç¼–å†™æ³¨å†Œæ’ä»¶å’Œè§£æå‘½ä»¤é€»è¾‘è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è„šæ‰‹æ¶å·²ç»å¯ä»¥æ‹¿åˆ°ä¸å½“å‰é¡¹ç›®æœ‰å…³çš„æ‰€æœ‰æ’ä»¶çš„æ³¨å†Œå‡½æ•°äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦ç»™è¿™äº›æ³¨å†Œå‡½æ•°ä¼ å…¥æˆ‘ä»¬çš„æ³¨å†Œå‘½ä»¤ä»¥åŠç›¸å…³å¸®åŠ©å‡½æ•°ï¼Œå¹¶åœ¨æ³¨å†Œå®Œæˆåå¯¹ç»ˆç«¯è¾“å…¥çš„å‘½ä»¤è¿›è¡Œè§£æï¼Œé‚£ä¹ˆè¿™ä¸ªä¸ƒå¤•ä¸“å±çš„æ’ä»¶åŒ–è„šæ‰‹æ¶å°±åŸºæœ¬å®Œæˆäº†ã€‚ åŒæ ·çš„ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å†™ä¸€ä¸‹cli/bin/ç›®å½•ä¸‹çš„valentineæ–‡ä»¶ï¼Œæ”¹å†™å†…å®¹å¦‚ä¸‹ï¼š1234567891011121314151617#!/usr/bin/env nodeconst &#123; injectCommand, getAllCommands, commandComplete&#125; = require('../api/commandAPI.js')console.log('-------- æƒ…äººèŠ‚å¿«ä¹ --------')// è·å–æ‰€æœ‰çš„å‘½ä»¤ï¼ˆé¢„è®¾+æ’ä»¶ï¼‰getAllCommands().forEach(cwd =&gt; &#123; // æ’ä»¶æ³¨å†Œå‘½ä»¤è¡Œ cwd(&#123; injectCommand &#125;)&#125;)// å‘½ä»¤è¡Œæ³¨å†Œå®ŒæˆcommandComplete() åœ¨commandAPI.jsæ–‡ä»¶å†…æ·»åŠ injectCommandå‡½æ•°å’ŒcommandCompleteå‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°çš„é€»è¾‘å¹¶ä¸å¤æ‚ï¼Œç›¸ä¿¡è¯»è€…é˜…è¯»ä¸€æ¬¡å°±èƒ½è½»æ¾ç†è§£:123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475const fs = require('fs')const path = require('path')const program = require('commander')const packageConfig = require('../package.json')let status = 'pending'let cliConfig = &#123; name: 'å°å±', hobby: 'å‡è‚¥' &#125;const commandNames = ['-V', '--version', '-h', '--help']program .usage('&lt;command&gt; [options]') .version(packageConfig.version)module.exports.operateHooks = operateHooks// ä¸ºæ¯ä¸ªå‘½ä»¤çš„æ³¨å…¥å‡½æ•°æä¾›æ‰€éœ€çš„å‚æ•°ï¼Œå¦‚programç­‰å¯¹è±¡module.exports.injectCommand = (cmd) =&gt; &#123; if (status === 'done') return console.error('æ³¨å†Œå‘½ä»¤è¡Œæ—¶æœºå·²ç»æ˜¯ doneï¼Œè¯·æå‰æ³¨å†Œï½') if (typeof cmd !== 'function') return console.error(cmd, 'å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°') cmd(&#123; program, cliConfig &#125;)&#125;// æ³¨å†Œå®Œæ‰€æœ‰å‘½ä»¤åï¼Œæ£€æµ‹å½“å‰å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œå¹¶æ›´æ”¹è„šæ‰‹æ¶çŠ¶æ€module.exports.commandComplete = function() &#123; commandValidate() parseArgv() status = 'done'&#125;function parseArgv() &#123; program.parse(process.argv) program.commands.forEach(c =&gt; c.on('--help', () =&gt; console.log()))&#125;function commandValidate() &#123; program.commands.map(command =&gt; commandNames.push(command._name)) const commandName = process.argv[2] if (commandName &amp;&amp; !commandNames.includes(commandName)) &#123; console.log(chalk.red(` æ²¡æœ‰æ‰¾åˆ° $&#123;process.argv[2]&#125; å‘½ä»¤ \\n`)) program.help() &#125; if (!process.argv[2]) &#123; program.help() &#125;&#125;// è·å–æ‰€æœ‰å‘½ä»¤è¡Œå‘½ä»¤ï¼ŒåŒ…æ‹¬é¢„è®¾çš„ä»¥åŠæ’ä»¶çš„module.exports.getAllCommands = () =&gt; &#123; const cwdFns = [] const localCwdPath = path.join(__dirname, '..', 'commands') const localCwdNames = [...fs.readdirSync(localCwdPath)] localCwdNames.forEach(name =&gt; &#123; const cwdPath = path.join(localCwdPath, name) cwdFns.push(require(cwdPath)) &#125;) const &#123; getAllPluginIdOfPackageJson &#125; = require('./share-utils') getAllPluginIdOfPackageJson().forEach(name =&gt; &#123; const command = path.join(process.cwd(), 'node_modules', name, 'command.config.js') try &#123; const cwd = require(command) cwdFns.push(cwd) &#125; catch (error) &#123; console.log(`$&#123;command&#125; ä¸å­˜åœ¨`) &#125; &#125;) return cwdFns&#125; ç¼–å†™å†…ç½®æ’ä»¶è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æ’ä»¶åŒ–è„šæ‰‹æ¶å·²ç»å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†ï¼Œè®©æˆ‘ä»¬æ¥è¯•ç€å†™ä¸€ä¸ªå†…ç½®çš„æ’ä»¶ï¼Œåœ¨cliç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªcommandsæ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢æ–°å»ºä¸€ä¸ªhappy.jsï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š123456789101112131415module.exports = (&#123; injectCommand, operateHooks &#125;) =&gt; &#123; const &#123; hooksMap, createHook &#125; = operateHooks createHook('happyStartHook') injectCommand(function(&#123; program, cliConfig &#125;) &#123; program .command('happy') .description('æƒ…äººèŠ‚ç¥ç¦') .action(async () =&gt; &#123; const &#123; name, hobby &#125; = cliConfig await hooksMap.happyStartHook.promise() console.log(`å–œæ¬¢$&#123;hobby&#125;çš„$&#123;name&#125;, ç¥ä½ æƒ…äººèŠ‚å¿«ä¹~`) &#125;) &#125;)&#125; ç„¶åæˆ‘ä»¬åœ¨cliç›®å½•ä¸‹å¯åŠ¨ç»ˆç«¯ï¼Œå¹¶è¿è¡Œ./bin/valentine happyï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š ç¼–å†™éå†…ç½®æ’ä»¶æ¥ç€ï¼Œæˆ‘ä»¬å°†æ–°å»ºä¸€ä¸ªéå†…ç½®çš„æ’ä»¶ï¼Œå¹¶éšåè®²è§£æ’ä»¶é—´æ˜¯å¦‚ä½•åšåˆ°é€šä¿¡çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªpackageï¼Œå³è¿›å…¥åˆ°packagesç›®å½•ï¼Œæ–°å»ºä¸€ä¸ªconfessionæ–‡ä»¶å¤¹ï¼Œè¿›å…¥confessionæ–‡ä»¶å¤¹ï¼Œæ–°å»ºpackage.jsonæ–‡ä»¶ï¼Œå’Œcliç±»ä¼¼çš„å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š1234567891011&#123; \"name\": \"@o2team/valentine-plugin-confession\", \"version\": \"0.0.1\", \"main\": \"index.js\", \"license\": \"MIT\", \"scripts\": &#123; \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;, \"author\": \"\", \"description\": \"\"&#125; åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œpackage.jsoné‡Œçš„nameå­—æ®µå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ï¼Œä½†ä¸€å®šè¦å’Œä¹‹å‰è„šæ‰‹æ¶çš„share-utilså†…å®šä¹‰çš„æ­£åˆ™ç›¸åŒ¹é…ï¼Œä»¥ä¾¿è¢«è„šæ‰‹æ¶è·å–æ’ä»¶æ—¶è¯†åˆ«ã€‚ä¹‹åï¼Œæ–°å»ºä¸€ä¸ªåä¸ºcommand.config.jsçš„æ–‡ä»¶ï¼ŒåŒæ ·çš„ï¼Œå†™å…¥æ³¨å†Œå‡½æ•°çš„å†…å®¹ï¼š123456789101112131415161718192021module.exports = (&#123; injectCommand &#125;) =&gt; &#123; injectCommand(function(&#123; program &#125;) &#123; program .command('love') .description('æƒ…äººèŠ‚è¡¨ç™½') .action(() =&gt; &#123; logLove() &#125;) &#125;)&#125;function logLove () &#123; console.log(` ____ __ ____ _ ________ __ ______ __ __ / _/ / / / __ \\\\ | / / ____/ \\\\ \\\\/ / __ \\\\/ / / / / / / / / / / / | / / __/ \\\\ / / / / / / / _/ / / /___/ /_/ /| |/ / /___ / / /_/ / /_/ / /___/ /_____/\\\\____/ |___/_____/ /_/\\\\____/\\\\____/ `)&#125; ä¸€ä¸ªâ€œæƒ…äººèŠ‚è¡¨ç™½â€æ’ä»¶å°±è¿™æ ·å®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªpackageéƒ½ä¸Šä¼ è‡³npmï¼Œå¹¶å®‰è£…åˆ°ä¸€ä¸ªæ–°çš„é¡¹ç›®ä¸­ï¼Œåœ¨é¡¹ç›®ä¸‹æ‰§è¡Œ./node_modules/.bin/valentine loveï¼Œä¾¿èƒ½çœ‹åˆ°confessionæ’ä»¶å‘½ä»¤è¢«æ‰§è¡Œäº†ï¼š å®Œæˆæ’ä»¶é—´çš„é€šè®¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯æ¬¡valentine happyå‘½ä»¤è¢«æ‰§è¡Œæ—¶ï¼Œèƒ½å…ˆæ‰§è¡Œæ’ä»¶valentine loveå‘½ä»¤ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¾€æˆ‘ä»¬çš„æ’ä»¶åŒ–è„šæ‰‹æ¶ä¸­åŠ å…¥ç»„ä»¶çš„é€šä¿¡æœºåˆ¶äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨tapableæ¥å®ç°æ’ä»¶é—´çš„é€šä¿¡ï¼Œtapableæ˜¯ä¸€ä¸ªç±»ä¼¼äºNode.jsä¸­çš„EventEmitterçš„åº“ï¼Œä½†æ›´ä¸“æ³¨äºè‡ªå®šä¹‰äº‹ä»¶çš„è§¦å‘å’Œå¤„ç†ã€‚å…·ä½“çš„ç”¨æ³•å¸Œæœ›è¯»è€…å¯ä»¥è‡ªè¡Œæœç´¢ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»ã€‚ å…³äºtapableçš„ä½¿ç”¨ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æˆ³è¿™é‡Œäº†è§£ä¸€ä¸‹ï¼š æˆ³è¿™é‡Œ æˆ‘ä»¬åœ¨apiç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸ºoperateHooksçš„jsæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š1234567891011121314151617181920212223242526272829const &#123; AsyncSeriesHook &#125; = require('tapable')module.exports = class OperateHooks &#123; constructor () &#123; this.hooksMap = &#123;&#125; this.hooksTapList = [] this.tapHook = this.tapHook.bind(this) this.bindHooks = this.bindHooks.bind(this) this.createHook = this.createHook.bind(this) &#125; createHook (nameSpace) &#123; this.hooksMap[nameSpace] = new AsyncSeriesHook() &#125; tapHook (hookName, eventName, cb) &#123; this.hooksTapList.push(&#123; hookName, eventName, cb &#125;) &#125; bindHooks () &#123; this.hooksTapList.forEach(hook =&gt; &#123; const &#123; hookName, eventName, cb &#125; = hook this.hooksMap[hookName].tapPromise(eventName, async () =&gt; &#123; await cb() &#125;) &#125;) &#125;&#125; ä¹‹åï¼Œåœ¨commandAPIä¸­ï¼Œå¯¹OperateHooksç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¹¶åœ¨commandCompleteæ‰§è¡ŒoperateHookså®ä¾‹çš„bindHooksæ–¹æ³•ï¼Œæœ€åå¯¼å‡ºè¯¥å®ä¾‹ã€‚12345678910const operateHooks = new OperateHooks()module.exports.operateHooks = operateHooksmodule.exports.commandComplete = function() &#123; commandValidate() operateHooks.bindHooks() parseArgv() status = 'done'&#125; åœ¨valentineæ–‡ä»¶ä¸­å¼•å…¥è¯¥å®ä¾‹ï¼Œåœ¨è¿›è¡Œæ’ä»¶å‘½ä»¤æ³¨å†Œæ—¶å°†è¯¥å®ä¾‹ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚123456789101112131415161718#!/usr/bin/env nodeconst &#123; injectCommand, getAllCommands, commandComplete, operateHooks&#125; = require('../api/commandAPI.js')console.log('-------- æƒ…äººèŠ‚å¿«ä¹ --------')// è·å–æ‰€æœ‰çš„å‘½ä»¤ï¼ˆé¢„è®¾+æ’ä»¶ï¼‰getAllCommands().forEach(cwd =&gt; &#123; // æ’ä»¶æ³¨å†Œå‘½ä»¤è¡Œ cwd(&#123; injectCommand, operateHooks &#125;)&#125;)// å‘½ä»¤è¡Œæ³¨å†Œå®ŒæˆcommandComplete() æœ€ååˆ†åˆ«åœ¨happy.jså’Œconfession/command.config.jså¯¹operateHookså®ä¾‹è¿›è¡Œå¯¹åº”é’©å­çš„åˆ›å»ºå’Œç»‘å®šå³å¯ï¼š12345678910111213141516// happy.jsmodule.exports = (&#123; injectCommand, operateHooks &#125;) =&gt; &#123; const &#123; hooksMap, createHook &#125; = operateHooks createHook('happyStartHook') injectCommand(function(&#123; program, cliConfig &#125;) &#123; program .command('happy') .description('æƒ…äººèŠ‚ç¥ç¦') .action(async () =&gt; &#123; const &#123; name, hobby &#125; = cliConfig await hooksMap.happyStartHook.promise() console.log(`å–œæ¬¢$&#123;hobby&#125;çš„$&#123;name&#125;, ç¥ä½ æƒ…äººèŠ‚å¿«ä¹~`) &#125;) &#125;)&#125; 12345678910111213141516171819202122232425// confession/command.config.jsmodule.exports = (&#123; injectCommand, operateHooks &#125;) =&gt; &#123; operateHooks.tapHook('happyStartHook', 'love', async () =&gt; &#123; logLove() &#125;) injectCommand(function(&#123; program &#125;) &#123; program .command('love') .description('æƒ…äººèŠ‚è¡¨ç™½') .action(() =&gt; &#123; logLove() &#125;) &#125;)&#125;function logLove () &#123; console.log(` ____ __ ____ _ ________ __ ______ __ __ / _/ / / / __ \\\\ | / / ____/ \\\\ \\\\/ / __ \\\\/ / / / / / / / / / / / | / / __/ \\\\ / / / / / / / _/ / / /___/ /_/ /| |/ / /___ / / /_/ / /_/ / /___/ /_____/\\\\____/ |___/_____/ /_/\\\\____/\\\\____/ `)&#125; å¾…ä¼˜åŒ–é¡¹ç›®å‰è¿™ä¸ªæ’ä»¶åŒ–è„šæ‰‹æ¶è¿˜å­˜åœ¨ç€ä¸€äº›é—®é¢˜å’Œå¯ä¼˜åŒ–ç‚¹ï¼š æ’ä»¶çš„è·å–æ˜¯é€šè¿‡æ­£åˆ™åŒ¹é…æ¥è¿›è¡Œçš„ï¼Œè¿™æ ·çš„åšæ³•åœ¨ä¾èµ–è¾ƒå¤šçš„ä»“åº“ä¸­æ•ˆç‡ä¼šéå¸¸ä½ä¸‹ã€‚ ç›®å‰æ’ä»¶çš„è·å–å½¢å¼åœ¨é‡åˆ°monorepoå½¢æ€çš„é¡¹ç›®æ—¶ï¼Œä¼šå¼•å‘é¡¹ç›®è·Ÿç›®å½•å’Œå‘½ä»¤æ‰§è¡Œç›®å½•ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ ç›®å‰æ’ä»¶åªæ”¯æŒé¡¹ç›®æ’ä»¶ï¼Œç¼ºå°‘äº†å…¨å±€æ’ä»¶çš„æ”¯æŒã€‚ è¿™äº›ä¼˜åŒ–é¡¹çš„å¯å®ç°æ–¹æ³•å¾ˆå¤šï¼Œç”±äºè€ƒè™‘åˆ°ç¯‡å¹…é—®é¢˜ï¼Œå¸Œæœ›è¯»è€…å¯ä»¥è‡ªå·±å»æ€è€ƒï¼Œç„¶åè‡ªè¡Œè§£å†³å’Œä¼˜åŒ–ã€‚ æœ€åä½†æ˜¯ï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼Œä¸€ä¸ªä¸ƒå¤•ä¸“å±çš„æ’ä»¶åŒ–è„šæ‰‹æ¶å¯ä»¥è¯´å·²ç»å®Œæˆäº†ï¼Œæœ€ç»ˆæ•ˆæœï¼š å¿«ç‚¹æ‹¿ç€å®ƒå’Œä½ æœ€çˆ±çš„é‚£ä¸ªä»–/å¥¹/å®ƒè¡¨ç™½å§~ é¡¹ç›®ä»“åº“æˆ³è¿™é‡Œ","pubDate":"Tue, 25 Aug 2020 07:21:00 GMT","guid":"https://aotu.io/notes/2020/08/25/valentine-plugin-cli/","category":"Webå¼€å‘"},{"title":"äº¬å–œå°ç¨‹åºä½“éªŒè¯„åˆ†ä¼˜åŒ–å®è·µ","link":"https://aotu.io/notes/2020/08/25/jx-audit-grade-optimization/","description":"èƒŒæ™¯ä½“éªŒè¯„åˆ† Audits æ˜¯å¾®ä¿¡å¼€å‘è€…å·¥å…·å†…ç½®çš„ä¸€é¡¹åŠŸèƒ½ï¼Œä¼šåœ¨å°ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å®æ—¶æ£€æŸ¥ï¼Œåˆ†æå‡ºä¸€äº›å¯èƒ½å¯¼è‡´ä½“éªŒä¸å¥½çš„åœ°æ–¹ï¼Œå¹¶ä¸”å®šä½å‡ºå“ªé‡Œæœ‰é—®é¢˜ï¼Œä»¥åŠç»™å‡ºä¸€äº›ä¼˜åŒ–å»ºè®®ã€‚ äº¬å–œå°ç¨‹åºä½œä¸ºäº¬ä¸œæˆ˜ç•¥çº§ä¸šåŠ¡ï¼Œæ‹¥æœ‰åƒä¸‡çº§åˆ«çš„æµé‡å…¥å£ï¼Œç»è¿‡é•¿æ—¶é—´çš„ä¸šåŠ¡è¿­ä»£ï¼Œä»£ç é€»è¾‘å·²ç»ååˆ†å¤æ‚è‡ƒè‚¿ï¼Œæœ‰è¿«åˆ‡çš„æ€§èƒ½ä¼˜åŒ–éœ€æ±‚ã€‚å› æ­¤ï¼Œç»“åˆä½“éªŒè¯„åˆ†åŠŸèƒ½ï¼Œä»¥äº¬å–œé¦–é¡µåšè¯•ç‚¹ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸€æ¬¡ä½“éªŒè¯„åˆ†çš„ä¼˜åŒ–å®è·µã€‚ç›®çš„æ˜¯æ¢ç´¢å°ç¨‹åºä½“éªŒè¯„åˆ†çš„æŒ‡æ ‡åŸåˆ™ï¼šæ‹¿åˆ°100åˆ†çš„å°ç¨‹åºåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼›åŒæ—¶å¸Œæœ›å€Ÿæ­¤ç»™é¡¹ç›®ä¼˜åŒ–æä¾›æ›´å¤šæ€è·¯ã€‚ æˆ‘ä¼šæŒ‰ç…§ã€Œäº†è§£é¦–é¡µè¯„åˆ†ç°çŠ¶ï¼Œåˆ†ææ‰£åˆ†é¡¹è§„åˆ™ï¼Œè§£å†³æ‰£åˆ†é¡¹ã€è¿™ä¸ªæ€è·¯æ¥ä»‹ç»ï¼Œå°±è®©æˆ‘ä»¬å¼€å§‹å§ï½ äº¬å–œé¦–é¡µè¯„åˆ†ç°çŠ¶æ‰“å¼€å°ç¨‹åºå¼€å‘è€…å·¥å…·-è°ƒè¯•å™¨-Auditsï¼Œç‚¹å‡»è¿è¡Œï¼Œæ“ä½œé¡µé¢æ»šä¸€æ»šç‚¹ä¸€ç‚¹ï¼Œç„¶åç‚¹å‡»ç»“æŸã€‚ è¯„åˆ†ç»“æœä¼šæ ¹æ®è¯„æµ‹é¡µé¢å†…å®¹å·®å¼‚ã€æ“ä½œä¹ æƒ¯ã€æœ‰æ— ç¼“å­˜æœ‰ä¸€å®šæµ®åŠ¨ï¼Œä¸‹å›¾æ˜¯äº¬å–œé¦–é¡µçš„ä¸€æ¬¡è¯„åˆ†ï¼šæ€»åˆ†68ï¼Œæ€§èƒ½ã€ä½“éªŒã€æœ€ä½³å®è·µéƒ½æœ‰æ‰£åˆ†ï¼Œåˆè®¡8é¡¹æ‰£åˆ†é¡¹ï¼Œåé¢æˆ‘ä»¬æ¥é€æ¡åˆ†æè¿™äº›æ‰£åˆ†é¡¹ã€‚ æ‰£åˆ†é¡¹åˆ†æå’Œä¼˜åŒ–1ã€ä½¿ç”¨äº†è¿‡å¤§çš„ WXML èŠ‚ç‚¹æ•°ç›® å¾—åˆ†æ ‡å‡†ï¼šé¡µé¢ WXML èŠ‚ç‚¹å°‘äº 1000 ä¸ªï¼ŒèŠ‚ç‚¹æ ‘æ·±åº¦å°‘äº 30 å±‚ï¼Œå­èŠ‚ç‚¹æ•°ä¸å¤§äº 60 ä¸ªã€‚ é¡µé¢èŠ‚ç‚¹æŒ‡æ ‡çš„æ„ä¹‰åœ¨äºï¼Œè¿‡å¤§çš„èŠ‚ç‚¹æ•°ï¼Œè¿‡å¤šè¿‡æ·±çš„èŠ‚ç‚¹ç»„æˆï¼Œéƒ½ä¼šå¢åŠ å†…å­˜ä½¿ç”¨ï¼Œæ ·å¼é‡æ’æ—¶é—´æ›´é•¿ï¼Œå½±å“ä½“éªŒã€‚ ç°æœ‰èŠ‚ç‚¹2500+ï¼Œæƒ³è¦è¿›è¡Œä¼˜åŒ–ï¼Œé¦–å…ˆéœ€è¦äº†è§£é¡µé¢å„ä¸ªæ¨¡å—çš„èŠ‚ç‚¹æ•°åˆ†å¸ƒã€‚ å¦‚ä½•ç»Ÿè®¡æ¯ä¸ªæ¨¡å—çš„èŠ‚ç‚¹æ•°å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨ã€Œæ§åˆ¶å˜é‡æ³•ã€ï¼Œåˆ©ç”¨æ€§èƒ½è¯„æµ‹å·¥å…·ä¸­ï¼ŒèŠ‚ç‚¹æ•°è¶…è¿‡1000æ—¶ä¼šåˆ—å‡ºèŠ‚ç‚¹æ€»æ•°çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ€»æŒ‡æ ‡è¶…è¿‡1000çš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡éšè—ä¸€ä¸ªæ¨¡å—ï¼š â€‹ ç›®æ ‡æ¨¡å—èŠ‚ç‚¹æ•° = åŸæ€»èŠ‚ç‚¹æ•° - å½“å‰èŠ‚ç‚¹æ•° ï¼ˆå®æµ‹èŠ‚ç‚¹æ•°ä¼šæœ‰å°èŒƒå›´æµ®åŠ¨ï¼Œå¯ä»¥æµ‹3æ¬¡å–å¹³å‡å€¼ï¼‰ é¦–é¡µçš„æ¨¡å—åˆ†æå›¾å¦‚ä¸‹ï¼š â€‹ ï¼ˆç¬¬ä¸€å±ï¼‰ ï¼ˆç¬¬äºŒå±ï¼‰ ç®€åŒ–æ•°æ®å¦‚ä¸‹ï¼š è§‚å¯Ÿåˆ—è¡¨å¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼šé¦–é¡µåˆ†ä¸ºå±•ç¤ºçŠ¶æ€äº’æ–¥çš„ç¬¬ä¸€å±å’Œç¬¬äºŒå±ï¼›åˆ—è¡¨æ¨¡å—çš„èŠ‚ç‚¹æ•°æ˜¯å¤§å¤´ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°ä¼˜åŒ–çš„ä¸¤ä¸ªæ–¹å‘ï¼š é¡µé¢å…ƒç´ æŒ‰éœ€åŠ è½½ï¼Œä¸å±•ç¤ºæ—¶ä¸æ¸²æŸ“ é•¿åˆ—è¡¨å‡å°‘å…ƒç´ ä¸ªæ•° ç¬¬ä¸€ä¸ªä¼˜åŒ–é¡¹å¯ä»¥é€šè¿‡å˜é‡æ§åˆ¶ç»„ä»¶æ˜¾ç¤ºéšè—ï¼ŒæŒ‰éœ€åŠ è½½å¸è½½ã€‚ ç¬¬äºŒä¸ªä¼˜åŒ–é¡¹é¦–å…ˆæƒ³åˆ°çš„æ˜¯å‡å°‘åˆ—è¡¨æ¥å£åˆ†é¡µæ•°å€¼ï¼Œæ¯”å¦‚ä¸€æ¬¡è¯·æ±‚20æ¡æ•°æ®æ”¹ä¸ºè¯·æ±‚5æ¡ã€‚ä½†æ˜¯å¦‚æœæ¥å£ä¸æ”¯æŒè‡ªå®šä¹‰åˆ†é¡µï¼Œè¿˜å¯ä»¥å®ç°æ›´å°çš„åˆ†é¡µæ‹‰å–å—ï¼Ÿ é‚£å°±è‡ªå·±å†™ä¸€ä¸ªåˆ†é¡µæ–¹æ³•çš„ä»£ç†å§ï½ æ€è·¯å¦‚ä¸‹ï¼š ä¸Šæ–¹ä¸ºåŸå§‹è¯·æ±‚ï¼Œæ¯æ¬¡20æ¡æ•°æ®ï¼Œä¸‹æ–¹ä¸ºä»£ç†è¯·æ±‚çš„å®ç°ï¼Œæ¯æ¬¡è¿”å›5æ¡ã€‚ç°è‰²è™šçº¿æ¡†æ˜¯çœŸå®çš„è¯·æ±‚æ•°æ®åŠ¨ä½œï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ªå…¨é‡æ•°æ®ï¼Œéœ€è¦å“ªé¡µå–å“ªé¡µï¼Œè¿™æ˜¯ç¤ºä¾‹ä»£ç ï¼š é€šè¿‡ä»¥ä¸Šä¸¤ä¸ªä¼˜åŒ–ï¼Œå¯ä»¥æˆåŠŸçš„æŠŠé¦–é¡µçš„é¡µé¢èŠ‚ç‚¹æ•°ç˜¦èº«ä¸€ä¸‹äº†ï¼Œæœ€åæˆ‘ä»¬æˆåŠŸè¾¾åˆ° wxml èŠ‚ç‚¹æ€»æ•°ä¸å¤§äº1000çš„ç›®æ ‡ã€‚ 2ã€å­˜åœ¨å›¾ç‰‡å¤ªå¤§è€Œæœ‰æ•ˆæ˜¾ç¤ºåŒºåŸŸè¾ƒå° å¾—åˆ†æ ‡å‡†ï¼šå›¾ç‰‡å®½é«˜ä¹˜ç§¯ &lt;= å®é™…æ˜¾ç¤ºå®½é«˜ä¹˜ç§¯ * (è®¾å¤‡åƒç´ æ¯” ^ 2) ç®€å•ç†è§£æ˜¯å›¾ç‰‡å°ºå¯¸å¤ªå¤§è€Œå±•ç¤ºå°ºå¯¸å¤ªå°ï¼Œå¯¼è‡´æµªè´¹ç½‘ç»œè¯·æ±‚æ—¶é—´å’Œå†…å­˜èµ„æºã€‚ è§£å†³æ–¹æ¡ˆï¼šcdnæœåŠ¡å•†ä¸€èˆ¬éƒ½æ”¯æŒé€šè¿‡å‚æ•°è·å–ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œå‰ç«¯å¯ä»¥åŒ…è£…ä¸€ä¸ªå…¬å…±æ–¹æ³•ï¼Œæ ¹æ®é¡µé¢å…ƒç´ å°ºå¯¸æ‹‰å–åˆé€‚å¤§å°çš„å›¾ç‰‡ã€‚ æ­¤å¤–ï¼Œè¡¥å……ä¸€ä¸‹å›¾ç‰‡ä½“ç§¯çš„å†…å®¹ï¼Œé™¤äº†å…³æ³¨å›¾ç‰‡å°ºå¯¸ï¼Œå…·ä½“çš„ä½“ç§¯å¤§å°å…¶å®æ›´å€¼å¾—å…³æ³¨ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªç‚¹å¯ä»¥äº†è§£ä¸‹ï¼š å›¾ç‰‡ç±»å‹çš„é€‰æ‹©å¤§æœ‰æ–‡ç« ï¼Œjpg/png/gif è¿˜æœ‰ webp åº”è¯¥æ€ä¹ˆé€‰å‘¢ï¼Ÿå…ˆæ”¾ä¸€å¼  google çš„å›¾ è¿™å¼ å›¾é‡Œæœªè€ƒè™‘ webpï¼ŒåŠ ä¸Š webp å…¶ä»–ç±»å‹ç«äº‰åŠ›ç¬é—´ä¸è¶³äº†ï¼Œç§»åŠ¨ç«¯ androd æ”¯æŒç‡åŸºæœ¬å¯ç”¨ï¼Œå¯ä»¥è€ƒè™‘æ ¹æ®è®¾å¤‡ç±»å‹æ¸è¿›å¼ä½¿ç”¨ï¼š åˆ©ç”¨ä¸€äº›å‹ç¼©æŠ€æœ¯å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œpng æ¨è https://tinypng.com/ ï¼Œå‹ç¼©å°ºå¯¸å¯è§‚ï¼Œä½†å¯¹å›¾ç‰‡æ˜¾ç¤ºè´¨é‡å½±å“ç”šå¾®ã€‚ 3ã€å­˜åœ¨å¯ç‚¹å‡»å…ƒç´ çš„å“åº”åŒºåŸŸè¿‡å° å¾—åˆ†æ ‡å‡†ï¼šå¯ç‚¹å‡»å…ƒç´ çš„å®½é«˜éƒ½ä¸å°äº 20px ç§»åŠ¨ç«¯æ“ä½œå…¨é æ‰‹æŒ‡ï¼Œè¿‡å°çš„äº¤äº’åŒºåŸŸä¼šå¸¦æ¥ä¸å¥½çš„ä½“éªŒï¼Œå¯ä»¥é€šè¿‡å¢å¤§å…ƒç´ å“åº”çƒ­åŒºçš„æ–¹å¼æ¥ä¼˜åŒ–ï¼Œä»¥ä¸‹æ–¹å¼éƒ½å¯ä»¥ï¼š padding é€æ˜çš„border box-shadow 4ã€å¯¹ç½‘ç»œè¯·æ±‚åšå¿…è¦çš„ç¼“å­˜å¾—åˆ†æ ‡å‡†ï¼š3 åˆ†é’Ÿä»¥å†…åŒä¸€ä¸ªurlè¯·æ±‚ä¸å‡ºç°ä¸¤æ¬¡å›åŒ…å¤§äº 128KB ä¸”ä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ è¿™ä¸€é¡¹çš„ç†ç”±æ˜¯ï¼Œå‘èµ·ç½‘ç»œè¯·æ±‚æ€»ä¼šè®©ç”¨æˆ·ç­‰å¾…ï¼Œå¯èƒ½é€ æˆä¸å¥½çš„ä½“éªŒï¼Œåº”å°½é‡é¿å…å¤šä½™çš„è¯·æ±‚ï¼Œæ¯”å¦‚å¯¹åŒæ ·çš„è¯·æ±‚è¿›è¡Œç¼“å­˜ã€‚ ä¼˜åŒ–æ–¹å¼ï¼š å–„ç”¨å°ç¨‹åºçš„ storage èƒ½åŠ›ï¼Œåšå¥½æ›´æ–°å’Œè¿‡æœŸç®¡ç†åï¼Œå°½å¯èƒ½ç¼“å­˜è¯·æ±‚åˆ°çš„æ•°æ®ã€‚ é’ˆå¯¹ç¡®å®éœ€è¦å¤šæ¬¡è¯·æ±‚çš„æ—¥å¿—ç±»æ¥å£ï¼Œå¯ä»¥é€šè¿‡åœ¨å‚æ•°å†…æ·»åŠ éšæœºæ•°æˆ–è€…æ—¶é—´æˆ³çš„æ–¹å¼è¿›è¡ŒåŒºåˆ†ï¼Œé¿å…è¯¯åˆ¤ã€‚ 5ã€å­˜åœ¨çŸ­æ—¶é—´å†…å‘èµ·å¤ªå¤šçš„è¯·æ±‚å¾—åˆ†æ ‡å‡†ï¼šé€šè¿‡wx.requestå‘èµ·çš„è€—æ—¶è¶…è¿‡ 300ms çš„è¯·æ±‚å¹¶å‘æ•°ä¸è¶…è¿‡ 10 ä¸ªã€‚ ä¸åŒäºä¸Šä¸€é¡¹ï¼Œè¿™ä¸€é¡¹å…³æ³¨çš„æ˜¯æ¥å£å¹¶å‘æ•°ï¼š wx.request ï¼ˆHTTP è¿æ¥ï¼‰çš„æœ€å¤§å¹¶å‘é™åˆ¶æ˜¯ 10 ä¸ª wx.connectSocket ï¼ˆWebSocket è¿æ¥ï¼‰çš„æœ€å¤§å¹¶å‘é™åˆ¶æ˜¯ 5 ä¸ª ä¼˜åŒ–æ–¹å¼ï¼š è®¡ç®—é€»è¾‘åç§»ï¼Œ æ¥å£èšåˆ å¯¹äºèŒè´£ç±»ä¼¼çš„ç½‘ç»œè¯·æ±‚ï¼Œæœ€å¥½é‡‡ç”¨èŠ‚æµçš„æ–¹å¼ï¼Œå…ˆåœ¨ä¸€å®šæ—¶é—´é—´éš”å†…æ”¶é›†æ•°æ®ï¼Œå†åˆå¹¶åˆ°ä¸€ä¸ªè¯·æ±‚ä½“ä¸­å‘é€ç»™æœåŠ¡ç«¯ 6ã€å­˜åœ¨æœªç»‘å®šåœ¨wxmlä¸Šçš„å˜é‡ å¾—åˆ†æ ‡å‡†ï¼šsetDataä¼ å…¥çš„æ‰€æœ‰æ•°æ®éƒ½åœ¨æ¨¡æ¿æ¸²æŸ“ä¸­æœ‰ç›¸å…³ä¾èµ– è¿™ä¸€é¡¹è€ƒå¯Ÿçš„æ˜¯ data å†—ä½™çš„é—®é¢˜ï¼Œå°ç¨‹åºè®¾è®¡äº†æ¸²æŸ“å’Œé€»è¾‘åˆ†ç¦»çš„åŒçº¿ç¨‹ï¼Œä¸¤è¾¹é€šè®¯é€šè¿‡ evaluateJavascript è½¬æ¢å­—ç¬¦ä¸²å†è¿›è¡Œæ‹¼æ¥å®ç°ï¼Œéœ€è¦éå¸¸å°å¿ƒä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´é€šè®¯çš„æ•°æ®é‡ã€‚å› æ­¤ï¼Œæœªç»‘å®šwxmlçš„å˜é‡ï¼Œæœ€å¥½ä¼˜åŒ–æˆä¸ä½¿ç”¨ setDataã€‚ æ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥åšçš„ä¼˜åŒ–æœ‰ï¼š ä¸é¡µé¢å±•ç¤ºæ— å…³çš„å†…éƒ¨å˜é‡ï¼Œå¯ä»¥æŒ‚è½½åœ¨ç»„ä»¶å®ä¾‹ä¸Šï¼Œæ¯”å¦‚ç»´æŠ¤ä¸€ä¸ª this.privateData å¯¹è±¡ ä½¿ç”¨å°ç¨‹åºæ–°ç‰ˆæœ¬æ”¯æŒçš„ã€Œçº¯æ•°æ®å­—æ®µã€ï¼šè¯¥å­—æ®µä¸ä¼šè¢«ä¼ é€’åˆ° wxml å†…ï¼Œé…ç½®æ­£åˆ™åˆ’å®šå®ƒçš„åŒ¹é…èŒƒå›´ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ setData æ–¹æ³•ï¼Œå…·ä½“ç”¨æ³•å‚è§æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/pure-data.html ä½†æ˜¯ï¼Œå¦‚æœä½ åƒæˆ‘ä¸€æ ·é‡åˆ°ä¸Šé¢ç­–ç•¥æ— æ³•è¦†ç›–çš„åœºæ™¯å‘¢ï¼Ÿ éœ€è¦ä¿®æ”¹æ—§ä»£ç ï¼Œé…ç½®çº¯æ•°æ®å­—æ®µçš„æ­£åˆ™å½±å“å¤ªå¤§ äº¬å–œé¦–é¡µä½¿ç”¨äº† Taro åšå¤šç«¯é€‚é…ï¼ŒTaro ç¼–è¯‘å¤æ‚é€»è¾‘çš„æ•°ç»„åä¼šå‡ºç°ã€Œå½±å­å˜é‡ã€å»ä»£ç†é€»è¾‘ï¼ŒåŸæœ¬çš„æ•°ç»„å˜é‡è¢«æ¶ç©ºå¯¼è‡´æ‰£åˆ† é‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªç»ˆæ hack çš„æ–¹æ³•ï¼š è¿™æ · list ä¼šè¢«åˆ¤æ–­ä¸ºæœ‰ç»‘å®šèŠ‚ç‚¹ï¼Œå°±ä¸ä¼šæ‰£åˆ†äº† 7ã€å‘èµ·å¤ªå¤šçš„å›¾ç‰‡è¯·æ±‚å¾—åˆ†æ ‡å‡†ï¼šåŒåŸŸåè€—æ—¶è¶…è¿‡ 100ms çš„å›¾ç‰‡è¯·æ±‚å¹¶å‘æ•°ä¸è¶…è¿‡ 20 ä¸ª æœ€åè¿™ä¸€é¡¹ä¹Ÿæ˜¯å›¾ç‰‡ç›¸å…³ï¼Œå‘èµ·å¤ªå¤šå›¾ç‰‡è¯·æ±‚ä¼šè§¦å‘æµè§ˆå™¨å¹¶è¡ŒåŠ è½½çš„é™åˆ¶ï¼Œå¯èƒ½å¯¼è‡´å›¾ç‰‡åŠ è½½æ…¢ï¼Œç”¨æˆ·ä¸€ç›´å¤„äºç­‰å¾…ä¸­ã€‚ ä¼˜åŒ–æ–¹å¼ï¼š é›ªç¢§å›¾ å›¾ç‰‡æ‡’åŠ è½½ï¼šå°ç¨‹åº Image ç»„ä»¶æ”¯æŒé€šè¿‡é…ç½® lazy-load å‚æ•°æ¥å®ç°æ‡’åŠ è½½ï¼ˆhttps://developers.weixin.qq.com/miniprogram/dev/component/image.html ï¼‰ï¼Œå…·ä½“åˆ¤å®šé€»è¾‘æ˜¯å›¾ç‰‡è¿›å…¥ä¸Šä¸‹ä¸‰å±å°±å¼€å§‹åŠ è½½ã€‚å¦‚æœéœ€è¦æ›´å¯æ§çš„å®ç°ï¼Œå¯ä»¥è‡ªå·±æ„å»ºç»„ä»¶æ¥å¤„ç†ã€‚ æ€»ç»“åšå®Œè¿™äº›ä¼˜åŒ–ï¼Œå†æµ‹ä¸€ä¸‹ä½“éªŒè¯„åˆ†ï¼š ä»¥ä¸Šå°±æ˜¯äº¬å–œé¦–é¡µåœ¨å°ç¨‹åºä½“éªŒè¯„åˆ†ä¼˜åŒ–æ–¹é¢è¿›è¡Œçš„å®è·µå†…å®¹äº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå°ç¨‹åºæ€§èƒ½è¯„åˆ†å¯ä»¥ä»æŒ‡æ ‡å’Œå®é™…æ•°æ®ä¸Šç»™æˆ‘ä»¬çš„é¡¹ç›®ä¼˜åŒ–æä¾›ä¸€äº›å»ºè®®ï¼Œæœ¬æ–‡ä¸»è¦ä»è¯„åˆ†è§’åº¦å»åˆ†æäº†å„ç§ä¼˜åŒ–å¯èƒ½ï¼Œå¸Œæœ›èƒ½ä¸ºå„ä½å°ç¨‹åºå¼€å‘è€…å¸¦æ¥å‚è€ƒä»·å€¼ã€‚ å‚è€ƒèµ„æ–™[1] å°ç¨‹åºå¼€å‘æ–‡æ¡£ï¼šhttps://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%AE%80%E4%BB%8B [2] Images: Your easiest page speed win: https://searchengineland.com/images-easiest-page-speed-win-269742 [3] Tiny Png: https://tinypng.com/","pubDate":"Tue, 25 Aug 2020 02:36:00 GMT","guid":"https://aotu.io/notes/2020/08/25/jx-audit-grade-optimization/","category":"å°ç¨‹åº"},{"title":"Design Tokens â€”â€” è®¾è®¡ä¸å¼€å‘ç¢°æ’çš„ç«èŠ±","link":"https://aotu.io/notes/2020/08/18/design-tokens/","description":"å‰è¨€åœ¨å‰ç«¯çš„å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå’Œå‰ç«¯åˆä½œæœ€ç´§å¯†çš„èŒä½åº”è¯¥å°±æ˜¯è®¾è®¡å¸ˆäº†ã€‚åœ¨ä¸šåŠ¡æµç¨‹ä¸­ï¼Œè®¾è®¡å¸ˆå°†è‡ªå·±çš„äº¤äº’ç¨¿ã€è§†è§‰ç¨¿ä»¥ 1px ä»¥å†…è¯¯å·®çš„æœŸæœ›äº¤ç»™å¼€å‘è€…ã€‚ä½†åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼š è®¾è®¡ç¨¿å¯æ‹†è§£ä¸ºå¸ƒå±€ã€å›¾æ¡ˆã€æ–‡å­—ã€é¢œè‰²ç­‰ã€‚å…¶ä¸­å¸ƒå±€ã€æ–‡å­—ä»¥åŠé¢œè‰²è¿™ä¸‰è€…çš„æ ·å¼ç¼–ç éœ€è¦èŠ±è´¹å‰ç«¯å¼€å‘è€…å¤§é‡çš„æ—¶é—´ã€‚è™½è¯´è¿‘å‡ å¹´éšç€è“æ¹–ç­‰è®¾è®¡ååŒå·¥ä½œå¹³å°çš„è¯ç”Ÿï¼Œå¯ä»¥åœ¨å¹³å°ä¸Šè·å–åˆ°éƒ¨åˆ† css ä»£ç ï¼Œä½†æ˜¯ä¾ç„¶ä¸èƒ½æ»¡è¶³ webã€iOSã€Android ç­‰å¤šå¹³å°çš„æƒ…å†µï¼› è®¾è®¡ç¨¿çš„æ›´æ–°æ— æ³•åŠæ—¶åœ¨å¼€å‘è€…çš„ä»£ç ä¸­ä½“ç°ï¼Œä¸€æ˜¯å› ä¸ºå¼€å‘é¦–å…ˆéœ€è¦æ‹¿åˆ°æ–°çš„è®¾è®¡ç¨¿ï¼Œå†æ ¹æ®æ ‡æ³¨ç”šè‡³è‚‰çœ¼åˆ¤æ–­åŒºåˆ«åæ›´æ–°ä»£ç ï¼›å¦ä¸€æ–¹é¢ï¼Œè®¾è®¡ç¨¿ä¸­çœ‹ä¼¼ç®€å•çš„æ”¹åŠ¨å¯èƒ½å¯¼è‡´è¾ƒå¤§èŒƒå›´çš„ä»£ç æ”¹åŠ¨ï¼Œä¾‹å¦‚å­—ä½“å¤§å°ç­‰ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼Œå®Œå–„è®¾è®¡å’Œå¼€å‘ä¹‹é—´çš„åä½œæµç¨‹ï¼ŒDesign Tokens åº”è¿è€Œç”Ÿã€‚ ä»€ä¹ˆæ˜¯ Design Tokensåœ¨äº†è§£ Design Tokens ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹ Design System ï¼ˆå³è®¾è®¡ç³»ç»Ÿï¼‰çš„æ¦‚å¿µã€‚è¿™ä¸ªæ¦‚å¿µåœ¨è®¾è®¡å’Œå¼€å‘çš„æ²Ÿé€šæµç¨‹ä¸­å·²ç»æµè¡Œè®¸ä¹…ï¼Œåœ¨å›¢é˜Ÿè®¾è®¡ä½“ç³»å·¥ç¨‹åŒ–çš„è¿‡ç¨‹ä¸­ä¸å¯æˆ–ç¼ºã€‚ A Design System is the single source of truth which groups all the elements that will allow the teams to design, realize and develop a product. è®¾è®¡ç³»ç»Ÿèƒ½å¤Ÿä¿è¯é¡¹ç›®ä¸­è®¾è®¡ç¨¿ä¸å¼€å‘ä»£ç çš„ä¸€è‡´â€”â€”è®¾è®¡å¸ˆå°†è®¾è®¡ç¨¿ä»¶ä¸­çš„å†…å®¹ç»„ä»¶åŒ–ï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ä¸Šä¼ æ¯ä¸ªç»„ä»¶çš„æ ·å¼ã€æ–‡å­—å±æ€§ã€é¢œè‰²è‰²å€¼ç­‰ã€‚è€Œå¼€å‘è€…å¯ä»¥é€šè¿‡è¿™ä¸ªç³»ç»Ÿè·å–è‡ªå·±éœ€è¦çš„ç»„ä»¶å†…å®¹ã€‚ä½†æ˜¯è¿™æ ·ä»…ä»…æ˜¯å®ç°äº†ä¸€ä¸ªåä½œå¹³å°ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³å‰æ–‡æåˆ°çš„ä¸¤ä¸ªé—®é¢˜å‘¢ï¼Ÿ Design Tokens å°±æ˜¯è§£å†³é—®é¢˜çš„æ ¸å¿ƒã€‚ Design tokens are the visual design atoms of the design system. Design Tokens ç»Ÿä¸€äº†æ ·å¼å±æ€§å’Œå‰ç«¯è¯­è¨€ï¼ŒæŠŠæ¯ç§å±æ€§éƒ½å½“æˆæ˜¯ä¸€ä¸ªå‰ç«¯å˜é‡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå°†ä¸€ç§é¢œè‰²è‰²å€¼ä¼ åˆ°ç³»ç»Ÿä¸­ï¼Œç„¶åè½¬æ¢æˆ token ï¼Œå‰ç«¯å°±å¯ä»¥ç›´æ¥å–è¿™ä¸ªå˜é‡ä½¿ç”¨ã€‚å³ä½¿æ˜¯è‰²å€¼è¢«ä¿®æ”¹ï¼Œå½“å˜é‡åä¸å˜æ—¶ï¼Œå¯¹æ•´ä½“ä»£ç æ˜¯æ¯«æ— å½±å“çš„ï¼Œå¼€å‘è€…è¦åšçš„ä»…ä»…æ˜¯é‡æ–°å¯¼å…¥ä¸€ä»½ tokenã€‚ å…¶ä¸­ token çš„è¯­è¨€ç±»å‹å¯ä»¥æ˜¯ cssã€scssã€yml ç­‰ã€‚ å¦‚ä½•å¼€å‘ Design Tokensåœ¨å·²çŸ¥ Design Tokens æœ¬è´¨æ˜¯ä¸€ç§å˜é‡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†é¢œè‰²è‰²å€¼å’Œæ–‡å­—å±æ€§å˜æˆå¯¹åº”çš„å˜é‡ã€‚ å…¶ä¸­æ–‡å­—å±æ€§æœ‰æ¯”è¾ƒç‰¹åˆ«çš„åœ°æ–¹ï¼Œå®ƒé™¤äº†è¦æŠŠ font-familyã€font-size ç­‰è½¬æ¢æˆå˜é‡ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†è¿™äº›å˜é‡é›†åˆåœ¨ä¸€ä¸ª mixin é‡Œé¢ï¼Œæ–¹ä¾¿æ•´ä½“ä½¿ç”¨ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å®Œæˆçš„äº‹æƒ…æœ‰å¦‚ä¸‹å››æ­¥ï¼Œè·å–å±æ€§ã€ç”Ÿæˆå˜é‡ã€ç”Ÿæˆ mixin ã€è¾“å‡ºç»“æœã€‚å…¶ä¸­è·å–å±æ€§ä¸ç”¨å¤šè¯´ï¼Œç›´æ¥ä»æ•°æ®åº“ä¸­æ‹¿åˆ°è‰²å€¼å’Œæ–‡å­—çš„æ•°æ®ï¼Œç„¶ååˆ†åˆ«å†™å…¥ json æ–‡ä»¶ä¿å­˜å³å¯ã€‚ 1.ç”Ÿæˆå˜é‡æˆ‘ä»¬è½¬æ¢çš„å˜é‡ç±»å‹æœ‰ cssã€scssã€lessã€stylusã€jsonã€yamlã€Androidã€iOS å…«ç§ï¼Œå…¶ä¸­ cssã€scssã€lessã€stylusã€Android è¿™äº”ç§é€šè¿‡ Theo åº“æ¥å®ç°ï¼Œå…¶ä½™ä¸ºä»£ç æ‰‹åŠ¨å®ç°ã€‚ Theoå…ˆæ¥ä»‹ç»ä¸€ä¸‹ Theo,ä¸€ä¸ªèƒ½å¤Ÿå¯¹æ ·å¼è¿›è¡Œ transform å’Œ formatï¼Œéšåè¾“å‡ºå¯¹åº”å˜é‡çš„åº“ã€‚å®ƒçš„å®ç°åŸç†å¤§è‡´ä¸ºï¼Œå…ˆå°† json æ–‡ä»¶ä¸­çš„å€¼è¿›è¡Œå¤„ç†â€”â€”è‰²å€¼å¤„ç†ä¸º rgb æˆ–è€… rgbaï¼Œå…¶ä½™æ ·å¼å±æ€§çš„æ•°å€¼è¿›è¡Œå•ä½ç»Ÿä¸€ã€‚éšåå°†å¤„ç†è¿‡çš„å€¼ä¾æ®ä¸€å®šè§„åˆ™å†™å…¥ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­ã€‚è¿™ä¸ªå¯¹è±¡å°±æ˜¯ Design Tokensã€‚ ç›´æ¥ä¸Šä»£ç ï¼š 123456789101112131415161718192021static async formatWebOrtAndroid (type: string) &#123; const res = await theo .convert(&#123; transform: &#123; // è¿™é‡Œæ˜¯ç±»å‹ï¼Œå¯ä»¥æ˜¯ webæˆ–è€…æ˜¯ android type: 'web', file: path.resolve(__dirname, 'data.json'), &#125;, format: &#123; // è¿™é‡Œæ˜¯éœ€è¦è¾“å‡ºçš„å˜é‡è¯­è¨€ç±»å‹ï¼Œcssã€scssã€lessã€stylusã€Android ç­‰ type, &#125; &#125;) .then(data =&gt; &#123; // è¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ•°æ®å¤„ç† return data &#125;) .catch(error =&gt; console.log(`Something went wrong: $&#123;error&#125;`)) return res&#125; è‡ªå®šä¹‰æ–¹æ³•å…¶ä½™çš„ jsonã€yamlã€iOS è¿™ä¸‰ç§éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ã€‚json å’Œ yaml çš„å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦ç¨å¾®å¤„ç†ä¸€ä¸‹æ•°æ®ä¸ºæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ï¼Œç„¶åå†™å…¥ json æˆ–è€… yaml æ–‡ä»¶å³å¯ã€‚ iOS ç•¥å¾®å¤æ‚ï¼Œå®ƒæ”¯æŒ Objective-c å’Œ Swift ä¸¤ç§ç±»å‹çš„è¯­è¨€ï¼Œæ‰€ä»¥è¦åˆ†åˆ«å¤„ç†è¿™ä¸¤ç§è¯­è¨€ã€‚ Objective-c éœ€è¦åˆ†ä¸º .h å’Œ .m ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¯¹è‰²å€¼è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼š 12345678910// å…ˆå°†å˜é‡åç§°å†™å…¥let colorsH += `- (UIColor *)$&#123;colorName&#125;;\\n`// å¤„ç†å¯¹åº”çš„å˜é‡åç§°ä¸‹çš„è‰²å€¼let colorsM += `- (UIColor *)$&#123;colorName&#125; &#123;return [UIColor colorWithRed:($&#123;red&#125;)/255 green:($&#123;green&#125;)/255 blue:($&#123;blue&#125;)/255 alpha:($&#123;alpha&#125;)];&#125;\\n\\n`// å¤„ç†é¦–å°¾colorsH = `@interface UIColor (Colors)\\n\\n$&#123;colorsH&#125;\\n@end`colorsM = `#import \"designTokenColor.h\"\\n\\n@implementation UIColor (Colors)\\n\\n$&#123;colorsM&#125;\\n@end\\n` Swift çš„å¤„ç†æ–¹æ³•ç±»ä¼¼ï¼Œç›´æ¥ä¸Šä»£ç ï¼š 12345// å…ˆå°†å˜é‡åç§°å†™å…¥ï¼Œå¹¶å¤„ç†è‰²å€¼let colorsSwift += `class func $&#123;colorName&#125;() -&gt; UIColor&#123;\\nreturn UIColor( red: ($&#123;red&#125;)/255, green: ($&#123;green&#125;)/255, blue: ($&#123;blue&#125;)/255, alpha: ($&#123;alpha&#125;) );&#125;\\n\\n`colorsSwift = `import UIKit;\\n\\nextension UIColor&#123;\\n\\n$&#123;colorsSwift&#125;\\n&#125;\\n` å…¶å®ä¸Šè¿°çš„è‡ªå®šä¹‰æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥å®šä¹‰åœ¨ Theo ä¸­ï¼Œå› ä¸º Theo æ”¯æŒæ³¨å†Œè‡ªå®šä¹‰ transform äº‹ä»¶ä»¥åŠè‡ªå®šä¹‰ format äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è·å–åˆ°çš„æ•°æ®è¿›è¡ŒäºŒæ¬¡å¤„ç†ã€‚ 2.ç”Ÿæˆ mixinmixin æ˜¯ scss ä¸­çš„åç§°ï¼Œå…¶å®å°±æ˜¯å˜é‡çš„é›†åˆï¼Œèƒ½å¤Ÿä½¿å¾—ä¸€ç³»åˆ—å±æ€§èƒ½å¤Ÿè¢«æ•´ä½“åº”ç”¨ã€‚ç”±äº Theo æ²¡æœ‰æä¾›å¯¹åº”æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹é‡‡ç”¨æ‰‹åŠ¨ç”Ÿæˆçš„æ–¹å¼ã€‚ç›®å‰åªé’ˆå¯¹æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„æ–‡å­—å±æ€§è¿›è¡Œäº†æ„å»ºã€‚ æˆ‘ä»¬åœ¨ç¬¬ä¸€æ­¥æ—¶å·²ç»ç”Ÿæˆäº†æ‰€æœ‰å±æ€§çš„å˜é‡ï¼Œæ‰€ä»¥åœ¨æ„å»º mixin æ—¶åªéœ€å°†å¯¹åº”å˜é‡ç»„åˆåœ¨ä¸€èµ·å³å¯ï¼Œå·¥ä½œé‡å¹¶ä¸å¤§ã€‚ä½†æ˜¯ç”±äºéœ€è¦æ„å»ºçš„è¯­è¨€ç±»å‹è¾ƒå¤šï¼Œé’ˆå¯¹ä¸åŒè¯­è¨€è¦è¾“å‡ºä¸åŒæ ¼å¼ï¼Œæ‰€ä»¥ä¾ç„¶å†™äº†éƒ¨åˆ†ç›¸ä¼¼ä»£ç ã€‚ ä»¥ä¸‹ä¸ºä¸åŒè¯­è¨€ä¸‹çš„å†…å®¹ç”Ÿæˆä»£ç ï¼š css 12345678910111213--aotu: &#123; font-family: var(--aotu-font-family); font-size: var(--aotu-font-size); font-style: var(--aotu-font-style); font-weight: var(--aotu-font-weight); letter-spacing: var(--aotu-letter-spacing); line-height: var(--aotu-line-height); opacity: var(--aotu-opacity); text-align: var(--aotu-text-align); color: var(--aotu-text-color); text-decoration: var(--aotu-text-decoration); text-transform: var(--aotu-text-transform);&#125;; scss 12345678910111213@mixin aotu () &#123; font-family: $aotu-font-family; font-size: $aotu-font-size; font-style: $aotu-font-style; font-weight: $aotu-font-weight; letter-spacing: $aotu-letter-spacing; line-height: $aotu-line-height; opacity: $aotu-opacity; text-align: $aotu-text-align; color: $aotu-text-color; text-decoration: $aotu-text-decoration; text-transform: $aotu-text-transform;&#125; less 12345678910111213.aotu () &#123; font-family: @aotu-font-family; font-size: @aotu-font-size; font-style: @aotu-font-style; font-weight: @aotu-font-weight; letter-spacing: @aotu-letter-spacing; line-height: @aotu-line-height; opacity: @aotu-opacity; text-align: @aotu-text-align; color: @aotu-text-color; text-decoration: @aotu-text-decoration; text-transform: @aotu-text-transform;&#125; Android 12345678910111213// è¿™é‡Œé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­åŒ…å«äº†å„ç§æ•°å€¼&lt;style name=$&#123;aotu.name&#125;&gt; &lt;item name=\"android:fontFamily\"&gt;$&#123;aotu.fontFamily&#125;&lt;/item&gt; &lt;item name=\"android:textSize\"&gt;$&#123;aotu.fontSize&#125;&lt;/item&gt; &lt;item name=\"android:letterSpacing\"&gt;$&#123;aotu.letterSpacing&#125;&lt;/item&gt; &lt;item name=\"android:lineHeight\"&gt;$&#123;aotu.lineHeight&#125;&lt;/item&gt; &lt;item name=\"android:textStyle\"&gt;$&#123;aotu.fontStyle&#125;&lt;/item&gt; &lt;item name=\"android:textFontWeight\"&gt;$&#123;aotu.fontWeight&#125;&lt;/item&gt; &lt;item name=\"android:gravity\"&gt;$&#123;aotu.textAlign&#125;&lt;/item&gt; &lt;item name=\"android:textAllCaps\"&gt;$&#123;aotu.textTransform === 'uppercase'&#125;&lt;/item&gt; &lt;item name=\"android:alpha\"&gt;$&#123;aotu.opacity&#125;&lt;/item&gt; &lt;item name=\"android:textColor\"&gt;$&#123;aotu.color&#125;&lt;/item&gt;&lt;/style&gt; è‡³æ­¤ï¼ŒDesign Tokens çš„ç”Ÿæˆå·²ç»å®Œæˆã€‚ 3.è¾“å‡ºç»“æœæˆ‘ä»¬å°†è¾“å‡ºçš„å„ç§è¯­è¨€ç»“æœä¿å­˜åœ¨ä¸åŒæ–‡ä»¶ä¸­ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå°†å†…å®¹å’Œè·å–é“¾æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡é“¾æ¥ä¸‹è½½æ–‡ä»¶è¿›è¡Œä½¿ç”¨ï¼Œä¹Ÿå¯æ‰‹åŠ¨å¤åˆ¶å†…å®¹åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­è¿›è¡Œä½¿ç”¨ã€‚å½“è®¾è®¡å¸ˆæ”¹å˜è®¾è®¡ç¨¿æ—¶ï¼Œä»–ä»¬éœ€è¦é‡æ–°ä¸Šä¼ ç»„ä»¶å†…å®¹ï¼ŒDesign Tokens çš„å†…å®¹ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚è€Œå¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œåªéœ€è¦é‡æ–°å¯¼å…¥ä¸€ä¸ªæ–°çš„é“¾æ¥ï¼Œå°±å¯ä»¥ç›´æ¥å®Œæˆå¤§é‡ä»£ç çš„æ›´æ–°ï¼Œå¤§å¤§æå‡äº†è®¾è®¡å¸ˆä»¥åŠå¼€å‘è€…çš„æ•ˆç‡ï¼Œå‡å°‘äº†å¼€å‘è€…çš„é‡å¤å·¥ä½œï¼Œé™ä½äº†åŒæ–¹æ²Ÿé€šæˆæœ¬å’Œç‰ˆæœ¬è¿­ä»£æˆæœ¬ã€‚ Design Tokens åº”ç”¨Design Tokens å·²ç»è¢«åº”ç”¨åœ¨å‡¹å‡¸çš„å·¥ä½œæµä¸­ã€‚ ä¸€ä¸ªé¡¹ç›®å¼€å¯çš„æ—¶å€™ï¼Œéœ€è¦å…ˆåœ¨å†…éƒ¨å¤¸å…‹å¹³å°åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®æˆå‘˜åŒ…æ‹¬è®¾è®¡å¸ˆä¸å‰ç«¯å¼€å‘ã€‚éšåè®¾è®¡å¸ˆä½¿ç”¨å¤¸å…‹å¹³å°æä¾›çš„ Sketch æ’ä»¶å°†é¡¹ç›®ä¸­éœ€è¦çš„è‰²å€¼å’Œæœ¬æ–‡æ ·å¼éƒ½ä¿å­˜åˆ°é¡¹ç›®ä¸­ã€‚ä»¥ä¸‹ä¸ºæ’ä»¶ä¸­å±•ç¤ºæ•ˆæœï¼š è®¾è®¡å¸ˆå®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œå¼€å‘è€…è¿›å…¥å¤¸å…‹å¹³å°ï¼Œåœ¨å¯¹åº”é¡¹ç›®ä¸­å¯æŸ¥çœ‹è‰²å€¼å’Œæ–‡å­—æ ·å¼ã€‚å…¶ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸ªå±æ€§å¯¹åº”çš„å˜é‡åï¼Œå¹¶ä¸”å¯ä»¥å¯¹å˜é‡åä½œå‡ºä¿®æ”¹ã€‚ æ‰€æœ‰çš„ Design Tokens ä¼šé›†ä¸­å±•ç¤ºåœ¨å•ç‹¬é¡µé¢ä¸­ï¼Œå…¶ä¸­åŒ…æ‹¬äº†ä¸‹è½½é“¾æ¥ï¼Œå¼€å‘è€…ç›´æ¥é€šè¿‡é“¾æ¥ä¸‹è½½å†…å®¹ï¼Œç„¶ååº”ç”¨åˆ°è‡ªå·±çš„é¡¹ç›®ä»£ç ä¸­å³å¯ã€‚ æ€»ç»“Design System å¯èƒ½ä¼šæ˜¯å°†æ¥è®¾è®¡å¸ˆä¸å¼€å‘è€…åˆä½œçš„ä¸€ç§æ¨¡å¼ï¼Œç›®å‰ç›¸åº”çš„åº”ç”¨è¿˜ä¸æ˜¯éå¸¸å¹¿æ³›ã€‚å¹¶ä¸”ä¸€äº›å°é¡¹ç›®ä¸­ï¼Œå¤§å®¶æ›´å€¾å‘äºå£å¤´äº¤æµã€æ–‡ä»¶äº¤æµç­‰ï¼Œè€Œä¸æ˜¯èŠ±æ—¶é—´å…ˆå»æ„å»ºä¸€ä¸ªè®¾è®¡ç³»ç»Ÿã€‚ä½†æ˜¯éšç€å…¬å¸æˆ–è€…éƒ¨é—¨é¡¹ç›®æ‰©å¼ ï¼Œç§¯ç´¯å˜å¤šï¼Œä¸€ä¸ªå®Œå–„çš„è®¾è®¡ç³»ç»Ÿä»¥åŠé«˜æ•ˆçš„æ²Ÿé€šå¹³å°å°†ä¼šæ˜¯å¿…é¡»çš„ã€‚Design System ä»¥åŠ Design Tokens ç»™æˆ‘ä»¬å¸¦æ¥äº†æ–°çš„æ–¹å¼å’Œæ–°çš„å¯èƒ½ï¼Œæˆ‘ä»¬å°†ä¼šç»§ç»­æ¢ç´¢å®ƒã€‚","pubDate":"Tue, 18 Aug 2020 11:44:02 GMT","guid":"https://aotu.io/notes/2020/08/18/design-tokens/","category":"Webå¼€å‘"},{"title":"ä½¿ç”¨react-docgenè‡ªåŠ¨ç”Ÿæˆç»„ä»¶æ–‡æ¡£","link":"https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/","description":"èƒŒæ™¯æœ€è¿‘åœ¨æ¥åˆ°ä¸€ä¸ªå¼€å‘ React ç»„ä»¶åº“çš„éœ€æ±‚ï¼Œç»„ä»¶åº“åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆšå†™å®Œä¸€ä¸ªç»„ä»¶æ‰“ç®—ç»™åŒäº‹ç”¨ï¼ŒåŒäº‹ç«‹é©¬æ¥äº†ä¸ªçµé­‚æ‹·é—®â€œå•Šï¼Ÿè¿™ä¸ªç»„ä»¶æ€ä¹ˆç”¨â€ã€‚emmmï¼Œæˆ‘å¯»æ€ç›´æ¥å‘Šè¯‰å®ƒä¸‹ä¸€æ¬¡åˆå¿˜äº†ï¼Œè¿˜æ˜¯è€è€å®å®å†™ä¸ªæ–‡æ¡£å§ã€‚ æ–‡æ¡£å†™åˆ°ä¸€åŠï¼Œ@#%#Â¥â€¦â€¦#@éº»çƒ¦æ­»äº†ã€‚è¿™ä¹ˆå¤šç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½éœ€è¦æœ‰å¯¹åº”çš„æ–‡æ¡£ï¼Œå†™èµ·æ¥å¤ªè€—æ—¶äº†ï¼Œæ‰‹å†™æ–‡æ¡£æ¯”å†™ä¸ªç»„ä»¶è¿˜éº»çƒ¦ã€‚ä¸ºäº†èƒ½å¿«ç‚¹å®Œï¼ˆxiaï¼‰æˆï¼ˆbanï¼‰ä»»ï¼ˆhuiï¼‰åŠ¡ï¼ˆjiaï¼‰ã€‚äºæ˜¯ç ”ç©¶ä¸‹é‚£äº›ä¼˜ç§€çš„ç»„ä»¶åº“åˆ°åº•æ˜¯æ€ä¹ˆåšçš„ï¼Œçœ‹äº†ä¸‹äº¬ä¸œå‡¹å‡¸å®éªŒå®¤çš„Quarkå¤¸å…‹ç»„ä»¶åº“çš„æ–‡æ¡£ç”Ÿæˆï¼Œå¤§å—å¯å‘ï¼Œä»¥ä¸‹å†…å®¹æ˜¯è®²è®²å…³äºå¦‚ä½•ä¼˜é›…åœ°å·æ‡’å¹¶æŠŠç»„ä»¶æ–‡æ¡£éƒ½åšå¥½çš„ã€‚ ä¸ºä»€ä¹ˆè¦è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£èŠè¿™ä¸ªäº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ–‡æ¡£å¸Œæœ›é•¿ä»€ä¹ˆæ ·å­ ç»„ä»¶æ–‡æ¡£éœ€è¦ä»€ä¹ˆå†…å®¹ æä¾›ç»„ä»¶çš„ä»‹ç»è¯´æ˜ æä¾›ç»„ä»¶çš„å±æ€§åˆ—è¡¨ propTypes æä¾›ç»„ä»¶è°ƒç”¨çš„æ¡ˆä¾‹ usage æä¾›ç»„ä»¶è°ƒç”¨çš„æ¼”ç¤ºæ¡ˆä¾‹/æºç  å¦‚æœè¦æŠŠè¿™äº›å†…å®¹éƒ½é€šè¿‡ markdown å»å†™ï¼Œå†™å®Œè€—è´¹çš„æ—¶é—´å¯èƒ½æ¯”åšä¸€ä¸ªç®€å•çš„ç»„ä»¶è¿˜å¤šï¼Œä¸ºäº†æŠŠæ›´å¤šçš„ç²¾åŠ›æŠ•å…¥åˆ°å¼€å‘æ›´ä¼˜è´¨çš„ç»„ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ–‡æ¡£ç”Ÿæˆè‡ªåŠ¨åŒ–ã€‚ æ–‡æ¡£è‡ªåŠ¨åŒ–åèƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Ÿ ç»Ÿä¸€æ–‡æ¡£æ ¼å¼ï¼ŒæŠ¹å¹³ä¸åŒå¼€å‘è€…å†™æ–‡æ¡£çš„æ ¼å¼å·®å¼‚ èŠ‚çœå†™æ–‡æ¡£çš„æ—¶é—´æ¥åšæ›´å¤šæœ‰æ„ï¼ˆtouï¼‰ä¹‰ï¼ˆlanï¼‰çš„äº‹æƒ… æˆ‘ä»¬æ‹¿ä¸€ä¸ªå°æ¡ˆä¾‹æ¥å°è¯•ä¸€ä¸‹ react-docgenå¼€å§‹è¿›å…¥æ­£é¢˜ï¼Œå…ˆç®€å•ä»‹ç»ä¸‹æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆçš„ä¸»è§’ react-docgen ï¼Œå®˜æ–¹å¯¹äºå®ƒçš„ä»‹ç»æ˜¯è¿™æ ·çš„ï¼š react-docgen æ˜¯ä¸€ä¸ª CLI å’Œå·¥å…·ç®±ï¼Œå¯å¸®åŠ©ä» React ç»„ä»¶ä¸­æå–ä¿¡æ¯å¹¶ä»ä¸­ç”Ÿæˆæ–‡æ¡£ã€‚å®ƒä½¿ç”¨ ast ç±»å‹å’Œ@ babel / parser å°†æºè§£æä¸º ASTï¼Œå¹¶æä¾›å¤„ç†æ­¤ AST çš„æ–¹æ³•ä»¥æå–æ‰€éœ€çš„ä¿¡æ¯ã€‚è¾“å‡º/è¿”å›å€¼æ˜¯ä¸€ä¸ª JSON blob / JavaScript å¯¹è±¡ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ï¼šå®ƒèƒ½æå–ç»„ä»¶çš„ç›¸å…³ä¿¡æ¯ å®‰è£…ç”¨ yarn æˆ– npm å®‰è£…æ¨¡å—ï¼š 123yarn add react-docgen --devnpm install --save-dev react-docgen å…³äºå®ƒçš„ API å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ https://www.npmjs.com/package/react-docgen å·å·å†åˆ†äº«ä¸€ä¸ªé«˜çº§ç‰ˆçš„ react-styleguidist https://github.com/styleguidist/react-styleguidist ä¾‹å­æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªäººç‰©çš„ç»„ä»¶ï¼Œé‡Œé¢åŒ…å« å§“åã€çˆ±å¥½ã€äº‹ä»¶å›è°ƒ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// ./Persion/index.jsximport React, &#123; Component &#125; from 'react'import PropTypes from 'prop-types'/*** äººç‰©ç»„ä»¶* @description è¿™æ˜¯å…³äºäººç‰©ç»„ä»¶çš„æè¿°å†…å®¹* @class Persion* @extends &#123;Component&#125;*/class Persion extends Component &#123; /** * å¤„ç†ç¡è§‰çš„å›è°ƒ * @param &#123;string&#125; name å§“å */ handleSleep = (name) =&gt; &#123; console.log(`$&#123;name&#125; å¼€å§‹ç¡è§‰`) this.props.onSleep() &#125; render() &#123; const &#123; name, hobbies &#125; = this.props return ( &lt;div onClick=&#123;this.handleSleep.bind(this, name)&#125;&gt; &lt;p&gt;å§“åï¼š&#123;name&#125;&lt;/p&gt; &lt;p&gt;çˆ±å¥½ï¼š&#123;hobbies.join(',')&#125;&lt;/p&gt; &lt;/div&gt; ) &#125;&#125;Persion.propTypes = &#123; /** * å§“å */ name: PropTypes.string.isRequired, /** * çˆ±å¥½ */ hobbies: PropTypes.array, /** * ç¡è§‰çš„äº‹ä»¶å›è°ƒ */ onSleep: PropTypes.func&#125;Persion.defaultProps = &#123; name: 'å¼ ä¸‰', hobbies: ['ç¡è§‰', 'æ‰“ç‹è€…']&#125;export default Persion æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªäººç‰©çš„ç»„ä»¶ï¼Œåœ¨ç»„ä»¶ç±»æ³¨é‡Šä¸­æè¿°äº†ç»„ä»¶çš„åŸºæœ¬ä¿¡æ¯, åŒæ—¶åœ¨propTypeså’ŒdefaultTypesä¸­ä¹Ÿå¯¹ç»„ä»¶çš„å±æ€§å‚æ•°è¿›è¡Œäº†å®šä¹‰å’Œå±æ€§æ³¨é‡Š ç»„ä»¶çš„åŸºæœ¬ä¿¡æ¯éƒ½å†™çš„å·®ä¸å¤šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆå¼€å§‹ä½¿ç”¨react-docgenå»æå–ç»„ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚ 12345678910111213// ./docgen.jsconst path = require('path')const fs = require('fs-extra')const reactDocs = require('react-docgen')const prettier = require('prettier')// è¯»å–æ–‡ä»¶å†…å®¹const content = fs.readFileSync(path.resolve('./Persion/index.jsx'), 'utf-8')// æå–ç»„ä»¶ä¿¡æ¯const componentInfo = reactDocs.parse(content)// æ‰“å°ä¿¡æ¯console.log(componentInfo) è¿™é‡Œå†™äº†ä¸€ä¸ªç®€å•çš„è¯»å–æ–‡ä»¶å’Œè§£æçš„è¿‡ç¨‹ï¼Œå¹¶æŠŠæå–åˆ°çš„ä¿¡æ¯æ‰“å°å‡ºæ¥ï¼Œä»¥ä¸‹æ˜¯ç»„ä»¶ä¿¡æ¯æå–åçš„å†…å®¹ componentInfo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364&#123; \"description\":\" äººç‰©ç»„ä»¶ @description è¿™æ˜¯å…³äºäººç‰©ç»„ä»¶çš„æè¿°å†…å®¹ @class Persion @extends &#123;Component&#125;\" , \"displayName\":\"Persion\", \"methods\":[ &#123; \"name\":\"handleSleep\", \"docblock\":\" å¤„ç†ç¡è§‰çš„å›è°ƒ @param name å§“å \", \"modifiers\":[ ], \"params\":[ &#123; \"name\":\"name\", \"description\":\"å§“å\", \"type\":&#123; \"name\":\"string\" &#125;, \"optional\":false &#125; ], \"returns\":null, \"description\":\"å¤„ç†ç¡è§‰çš„å›è°ƒ\" &#125; ], \"props\":&#123; \"name\":&#123; \"type\":&#123; \"name\":\"string\" &#125;, \"required\":false, \"description\":\"å§“å\", \"defaultValue\":&#123; \"value\":\"'å¼ ä¸‰'\", \"computed\":false &#125; &#125;, \"hobbies\":&#123; \"type\":&#123; \"name\":\"array\" &#125;, \"required\":false, \"description\":\"çˆ±å¥½\", \"defaultValue\":&#123; \"value\":\"['ç¡è§‰', 'æ‰“ç‹è€…']\", \"computed\":false &#125; &#125;, \"onSleep\":&#123; \"type\":&#123; \"name\":\"func\" &#125;, \"required\":false, \"description\":\"ç¡è§‰çš„äº‹ä»¶å›è°ƒ\" &#125; &#125;&#125; å…³äº react-docgen æå–çš„ä¿¡æ¯ä¸­ï¼Œè§£é‡Šä¸‹ä¸‹é¢å‡ ä¸ªå‚æ•° displayName ç»„ä»¶åç§° description ç»„ä»¶çš„ç±»æ³¨é‡Š methods ç»„ä»¶å®šä¹‰çš„æ–¹æ³• props ç»„ä»¶çš„å±æ€§å‚æ•° å…¶ä¸­è¿™é‡Œçš„propsæ˜¯æˆ‘ä»¬ç»„ä»¶æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹ï¼Œåœ¨æå–çš„å†…å®¹ä¸­ï¼Œå·²ç»æ¶µç›–äº†å±æ€§çš„ å±æ€§åã€å±æ€§æè¿°ã€ç±»å‹ã€é»˜è®¤å€¼ã€æ˜¯å¦å¿…ä¼ ã€‚è¿™äº›å†…å®¹æ»¡è¶³æˆ‘ä»¬é˜…è¯»ç»„ä»¶æ–‡æ¡£æ‰€éœ€è¦çš„å±æ€§ä¿¡æ¯ã€‚ æœ‰äº†æ‰€éœ€çš„componentInfoä¿¡æ¯ä¹‹åï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦æŠŠå®ƒè½¬æ¢æˆ markdown ï¼ˆè‡³äºä¸ºä»€ä¹ˆè¦ç”¨ markdown æˆ‘å°±ä¸è§£é‡Šäº† 8ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// ./docgen.js// ç”Ÿæˆmarkdownæ–‡æ¡£fs.writeFileSync(path.resolve('./Persion/index.md'), commentToMarkDown(componentInfo))// æŠŠreact-docgenæå–çš„ä¿¡æ¯è½¬æ¢æˆmarkdownæ ¼å¼function commentToMarkDown(componentInfo) &#123; let &#123; props &#125; = componentInfo const markdownInfo = renderMarkDown(props) // ä½¿ç”¨prettierç¾åŒ–æ ¼å¼ const content = prettier.format(markdownInfo, &#123; parser: 'markdown' &#125;) return content&#125;function renderMarkDown(props) &#123; return `## å‚æ•° Props | å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | æè¿° | | --- | --- | --- | --- | ---| $&#123;Object.keys(props) .map((key) =&gt; renderProp(key, props[key])) .join('')&#125; `&#125;function getType(type) &#123; const handler = &#123; enum: (type) =&gt; type.value.map((item) =&gt; item.value.replace(/'/g, '')).join(' \\\\| '), union: (type) =&gt; type.value.map((item) =&gt; item.name).join(' \\\\| ') &#125; if (typeof handler[type.name] === 'function') &#123; return handler[type.name](type).replace(/\\|/g, '') &#125; else &#123; return type.name.replace(/\\|/g, '') &#125;&#125;// æ¸²æŸ“1è¡Œå±æ€§function renderProp( name, &#123; type = &#123; name: '-' &#125;, defaultValue = &#123; value: '-' &#125;, required, description &#125;) &#123; return `| $&#123;name&#125; | $&#123;getType(type)&#125; | $&#123;defaultValue.value.replace( /\\|/g, '&lt;span&gt;|&lt;/span&gt;' )&#125; | $&#123;required ? 'âœ“' : 'âœ—'&#125; | $&#123;description || '-'&#125; | `&#125; ä¸Šé¢çš„è½¬æ¢ markdown çš„ä»£ç å…¶å®åšçš„äº‹æƒ…æ¯”è¾ƒå°‘ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ éå†propså¯¹è±¡ä¸­çš„æ¯ä¸ªå±æ€§ï¼Œ è§£æå±æ€§propï¼Œæå–å±æ€§åã€ç±»å‹ã€é»˜è®¤å€¼ã€å¿…å¡«ã€æè¿°ã€ç”Ÿæˆå¯¹åº”çš„ markdown è¡¨æ ¼è¡Œã€‚ ç”Ÿæˆ markdown å†…å®¹ï¼Œé€šè¿‡prettierç¾åŒ– markdown ä»£ç ã€‚ ç»è¿‡è½¬æ¢åæœ€ç»ˆç”Ÿæˆæˆ‘ä»¬è¿™ä¸ª markdown çš„æ–‡ä»¶ 1234567## å‚æ•° Props| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | æè¿° || ------- | ------ | ------------------ | ---- | -------------- || name | string | 'å¼ ä¸‰' | âœ— | å§“å || hobbies | array | ['ç¡è§‰', 'æ‰“ç‹è€…'] | âœ— | çˆ±å¥½ || onSleep | func | - | âœ— | ç¡è§‰çš„äº‹ä»¶å›è°ƒ | æ‹“å±•ä¼˜åŒ–è¿™ä¸ªæ¡ˆä¾‹åªç®€å•è®²è¿°äº†å¦‚ä½•è§£æpropså¹¶ç”Ÿæˆ markdown çš„å‚æ•° Propsæ¨¡å—çš„æµç¨‹ï¼Œåœ¨ç°å®é¡¹ç›®ä¸­ï¼Œä»¥ä¸Šæµç¨‹è¿˜æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„ç©ºé—´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¾ˆå¤šè‡ªå®šä¹‰è§„åˆ™è¿›è¡Œå„ç§éªšæ“ä½œã€‚ æ¯”å¦‚æˆ‘ä»¬ä¸å¸Œæœ›æŠŠå‚æ•°çš„æ•°æ®å±æ€§ï¼ˆnameã€hobbiesï¼‰å’Œå›è°ƒå±æ€§ï¼ˆonSleepï¼‰éƒ½æ”¾åˆ°åŒä¸€ä¸ª Props è¡¨æ ¼ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥è¿›è¡Œå±æ€§ä¸Šçš„åˆ†ç±»ã€‚ åœ¨å±æ€§æè¿°çš„æ³¨é‡Šä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ @xx ï¼ˆæˆ–è€… Â¥%#@^!ã€ã€‘â€¦â€¦ä½ å–œæ¬¢å°±å¥½ï¼‰è¿›è¡Œä¸åŒçš„æè¿°å®šä¹‰å’Œåˆ†ç±»ï¼Œæœ€ç»ˆåœ¨å±æ€§è§£æçš„æ­¥éª¤ä¸­è¿›è¡Œä¿¡æ¯çš„æ·±åº¦çš„æ‹†åˆ†è§£æåˆ†ç±»ï¼Œç”Ÿæˆæ›´åŠ å¤æ‚å¤šå…ƒçš„æ–‡æ¡£ã€‚ ç»è¿‡ä¸€äº›æ”¹é€ åï¼Œæˆ‘ä»¬é€šè¿‡åœ¨æ³¨é‡Šä¸­æ·»åŠ ä¸åŒè§„åˆ™çš„å®šä¹‰æè¿°ï¼Œå¾—åˆ°æ›´ä¼˜é›…ç¾è§‚çš„æ–‡æ¡£æ¨¡å— 1234567891011121314151617Persion.propTypes = &#123; /** * @text å§“å * @category data */ name: PropTypes.string.isRequired, /** * @text çˆ±å¥½ * @category data */ hobbies: PropTypes.array, /** * @text ç¡è§‰çš„äº‹ä»¶å›è°ƒ * @category event */ onSleep: PropTypes.func&#125; 123456789101112## æ•°æ® Data| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | æè¿° || ------- | ------ | ------------------ | ---- | ---- || name | string | 'å¼ ä¸‰' | âœ— | å§“å || hobbies | array | ['ç¡è§‰', 'æ‰“ç‹è€…'] | âœ— | çˆ±å¥½ |## äº‹ä»¶ Event| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | å¿…å¡« | æè¿° || ------- | ---- | ------ | ---- | -------------- || onSleep | func | - | âœ— | ç¡è§‰çš„äº‹ä»¶å›è°ƒ | å½“ç„¶è¿˜æœ‰å¾ˆå¤šæ¯”å¦‚descriptionæˆ–è€…methodsç­‰éƒ½å¯ä»¥è¿›è¡Œä¸åŒçš„è§£æå¹¶ç”Ÿæˆå¯¹åº”çš„markdownæ¨¡å—ï¼Œæ•°æ®ä¿¡æ¯æå–å‡ºæ¥äº†ï¼Œå…¶å®æœ€ç»ˆæ€ä¹ˆè¿›è¡Œastè§£æå–å†³è‡ªèº«çš„å…·ä½“ä¸šåŠ¡è¦æ±‚ã€‚ å°ç»“åœ¨æ—¥å¸¸å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é™¤äº†ç»„ä»¶çš„ä»£ç ç¼–å†™å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šæµç¨‹ä¸Šã€è¾¹è§’ä¸Šçš„å·¥ä½œéœ€è¦åšï¼Œè¿™äº›äº‹æƒ…å¾€å¾€éƒ½æ¯”è¾ƒçç¢åˆå¿…é¡»è¦åšã€‚æˆ‘ä»¬å¤šå€ŸåŠ©å·¥å…·å»è§£å†³æˆ‘ä»¬çš„å·¥ä½œä¸­é‚£äº›é›¶æ˜Ÿç®€å•çš„ä»»åŠ¡ï¼Œä»è€Œè¾¾åˆ°é«˜ï¼ˆjiuï¼‰æ•ˆï¼ˆxiangï¼‰å®Œï¼ˆkuaiï¼‰æˆï¼ˆdianï¼‰å·¥ï¼ˆxiaï¼‰ä½œï¼ˆbanï¼‰çš„ç›®æ ‡ã€‚å¼€å‘è€…éƒ½æ˜¯æ‡’æƒ°çš„ï¼ˆå¯èƒ½åªæœ‰æˆ‘ï¼Ÿï¼Ÿï¼‰ï¼Œä¸ç„¶æ€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šè‡ªåŠ¨åŒ–çš„äº§ç‰©å‘¢ï½ å‚è€ƒèµ„æ–™ï¼š[1] react-docgen ä»“åº“æ–‡æ¡£ https://github.com/reactjs/react-docgen#readme","pubDate":"Mon, 27 Jul 2020 01:00:00 GMT","guid":"https://aotu.io/notes/2020/07/27/how-to-use-react-docgen/","category":"ç»éªŒåˆ†äº«"},{"title":"å‡ ç§ç§»åŠ¨ç«¯å¤šå¹³å°å…ƒç´ å‚ç›´å±…ä¸­è§£å†³æ–¹æ¡ˆæ€»ç»“","link":"https://aotu.io/notes/2020/07/24/line-height-in-all-hardware/","description":"å‰è¨€åœ¨PCæ—¶ä»£ï¼Œå‚ç›´å±…ä¸­å°±æ˜¯ä¸€ä¸ªä¼šå¼•èµ·å¾ˆå¤šè®¨è®ºçš„é—®é¢˜ï¼Œä¾‹å¦‚ç»å…¸é—®é¢˜ï¼šå¦‚ä½•åœ¨ä»»ä½•å®¹å™¨é‡Œï¼Œè®©ä»»æ„è¡Œæ•°çš„å…ƒç´ éƒ½èƒ½å‚ç›´å±…ä¸­ï¼Œç›¸ä¿¡å¾ˆå¤šåŒå­¦å¯¹äºè¿™ä¸ªé—®é¢˜è¿˜è®°å¿†å°¤æ·±ã€‚å¦‚ä»Šç§»åŠ¨ç«¯å·²ç»æˆä¸ºäº†æˆ‘ä»¬çš„ä¸»è¦å¹³å°ï¼Œéšä¹‹è€Œæ¥çš„é—®é¢˜ä¹Ÿæ›´åŠ å¤æ‚ã€‚ è€Œä½œä¸ºå¤§ä¿ƒå‰ç«¯ï¼Œæˆ‘ä»¬çš„é—®é¢˜æ›´åŠ å¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦å…¼å®¹å¤§é‡ä¸åŒå¹³å°çš„æ‰‹æœºï¼Œä¾‹å¦‚ï¼šå®‰å“4.4ç³»ç»Ÿã€IOS8ã€IOS9ç­‰ç­‰è¿œå¤æ‰‹æœºã€‚å¯èƒ½æœ‰åŒå­¦å¾ˆå¥½å¥‡ä¸ºä½•è¿˜éœ€è¦èŠ±è´¹æ—¶é—´å»å…¼å®¹è¿™äº›æ‰‹æœºï¼ŒåŸå› å¾ˆç®€å•ï¼šæ•°æ®æ”¯æ’‘ï¼Œäº¬ä¸œå¤§ä¿ƒçš„ç”¨æˆ·é‡çº§éå¸¸å·¨å¤§ï¼Œè™½ç„¶è¿™äº›æ‰‹æœºç”¨æˆ·å æ¯”å¾ˆå°‘ï¼Œä½†æ˜¯å½“ç”¨æˆ·åŸºæ•°è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œå³ä½¿å æ¯”å¾ˆå°ï¼Œæ•°é‡ä¹Ÿæ˜¯å¾ˆå¯è§‚çš„ï¼Œå¯¹åº”è€Œæ¥çš„å°±æ˜¯å„ç§å®¢è¯‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å…¼å®¹è¿™äº›æ‰‹æœºã€‚ æœ¬æ–‡å°†ä»ä»¥ä¸‹åœºæ™¯è®¨è®ºé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚ ä¸»è¦è¯‰æ±‚ï¼š æ–‡å­—å°äº12pxåœ¨å®‰å“å’Œiosè¡¨ç°ä¸åŒï¼› æ–‡å­—åœ¨ä¸€å®šå®½åº¦ä¸‹è‡ªé€‚åº”ï¼Œè¶…è¿‡ä¸€å®šå®½åº¦éœ€è¦æˆªæ–­ï¼› æ–‡å­—é…å›¾æ ‡æˆ–è€…å…¶ä»–å…ƒç´ ï¼› ä¸ä½¿ç”¨JSï¼Œçº¯CSSï¼› domèŠ‚ç‚¹åªæœ‰2å±‚ï¼Œæ¯”å¦‚ 1&lt;div&gt;&lt;span&gt;ä»»ä½•å…ƒç´ &lt;span&gt;&lt;span class=\"tag\"&gt;å†…å®¹&lt;/span&gt;&lt;/div&gt;ï¼› å¿…é¡»å…¼å®¹IOS9åŠä»¥ä¸‹å’Œå®‰å“4.4.4ï¼Œæ‰€ä»¥é¦–å…ˆè¢«æ’é™¤çš„æ–¹æ³•å°±æ˜¯flexå¸ƒå±€ï¼› PS. æœ¬æ–‡ä¸è®¨è®ºPCä¸‹çš„å±•ç¤ºæ•ˆæœ ä¸»è¦é—®é¢˜ï¼š å‡å¦‚è®¾è®¡ç¨¿é«˜åº¦ä¸º28pxï¼Œæˆ‘ä»¬å¦‚æœæŠŠè¡Œé«˜å†™æˆ28pxï¼Œé‚£ä¹ˆåœ¨IOSå’Œå®‰å“ä¸‹ï¼Œå¿…ç„¶æ˜¯ä¼šå‡ºbugçš„ï¼Œç›¸ä¿¡å®è·µè¿‡çš„æœ‹å‹éƒ½çŸ¥é“ï¼ŒåŒæ ·çš„è¡Œé«˜ï¼ŒIOSä¸‹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨å®‰å“ä¸‹ï¼Œæ–‡å­—æ˜¯åä¸Šçš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š ç»å…¸é—®é¢˜äº†ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Œæ ¹æ®ç½‘ä¸Šçš„ç»éªŒï¼Œéƒ½æ˜¯å»ºè®®ä½¿ç”¨flexå¸ƒå±€çš„align-itemsæ¥å¸ƒå±€ï¼Œä½†æ˜¯è¿™ç§å¸ƒå±€ä¸æ”¯æŒ4.4.4çš„å®‰å“æ‰‹æœºï¼Œæ‰€ä»¥ä¸è¡Œï¼ŒåŒç†gridä¹Ÿæ˜¯ä¸è¡Œã€‚ æ–¹æ³•ä¸€ï¼štableå¸ƒå±€æˆ‘å°è¯•ä½¿ç”¨äº†tableæ¥è¿›è¡Œå¸ƒå±€ï¼Œå¦‚æœä¸è€ƒè™‘æˆªæ–­çš„é—®é¢˜ï¼Œæ˜¯å¯è¡Œçš„ï¼Œç¼ºç‚¹æ˜¯å¿…é¡»2å±‚ç»“æ„ï¼Œå¦åˆ™æ— æ³•å®ç°æ–‡å­—æˆªæ–­çš„æ•ˆæœï¼Œæ•ˆæœå¦‚ä¸‹ï¼š ä»£ç å¦‚ä¸‹ï¼š1&lt;div class=\"word\"&gt;&lt;span&gt;æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—&lt;/span&gt;&lt;/div&gt; 1234567891011121314151617.word &#123; font-size: 10px; background: red; color: white; display: inline-table; padding: 0 10px; table-layout: fixed; width: 100px;&#125;.word span &#123; display: table-cell; height: 22px; vertical-align: middle; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;&#125; PS:tableå¸ƒå±€åŒæ ·é€‚ç”¨äº2è¡Œçº¯æ–‡å­—ï¼Œä½†æ˜¯æ— æ³•æˆªæ–­ã€‚ æ–¹æ³•äºŒï¼šline-height: normalæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨line-height: normalçš„æ–¹æ³•æ¥å®ç°ï¼Œæ•ˆæœå¦‚ä¸‹ï¼šä»£ç å¦‚ä¸‹ï¼š1234567891011121314.word &#123; font-size: 10px; background: red; color: white; display: inline-block; padding: 3px 10px; width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;&#125;.word span &#123; line-height: normal;&#125; ç¼ºç‚¹ï¼šå¿…é¡»å¤šå¥—ä¸€å±‚ç»“æ„ PS:line-height: normalçš„å…ƒç´ ä¸èƒ½è®¾ç½®é«˜åº¦ï¼Œåªèƒ½ä½¿ç”¨paddingæˆ–è€…marginæ¥æ¨¡æ‹Ÿé«˜åº¦ æ–¹æ³•ä¸‰ï¼šï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå®‰å“ä¸‹çš„æ–‡å­—æ˜¯åä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘å°±æŠŠline-heightåŠ é«˜äº†å‡ ä¸ªåƒç´ ï¼Œå¥‡è¿¹å‘ç”Ÿäº†ï¼Œå®‰å“ä¸‹å±…ä¸­äº†ï¼ŒIOSåŸºæœ¬æ²¡å˜ï¼Œç»äº†ï¼ç»è¿‡è¯•éªŒï¼Œline-heightå€¼éœ€è¦æ¯”heightå€¼å¤§2pxå³å¯ï¼ŒIOSå¯¹è¿™ä¸ªå€¼çš„æ•æ„Ÿåº¦éå¸¸å°ï¼Œåªè¦ä¸å¤§äºè¿™ä¸ªå€¼ï¼Œå°±å‡ ä¹ä¸å˜ã€‚ å®‰å“ï¼šIOSï¼š1234567891011121314&lt;div class=\"word\"&gt;æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—æ–‡å­—&lt;/div&gt;.word &#123; font-size: 10px; background: red; color: white; display: inline-block; padding: 0 10px; line-height: 24px; height: 22px; width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;&#125; è¿™ä¸ªæ–¹æ³•çš„åº”ç”¨åœºæ™¯åœ¨å“ªå‘¢ï¼Œæ–‡å­—+icon+éœ€è¦æˆªæ–­+è‡ªå®šä¹‰å®½åº¦ï¼Œç»è¿‡ç ”ç©¶ï¼Œæˆ‘å‘ç°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä¸ä½¿ç”¨jsæˆ–è€…hackï¼Œæ˜¯ä¸å¯èƒ½ä½¿ç”¨çº¯CSSçš„åŠæ³•å®Œç¾è§£å†³çš„ï¼Œæ‰€ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¯ä»¥ä¿è¯åœ¨æ‰€æœ‰å®‰å“å’ŒIOSçš„å·®è·ä¿æŒåœ¨ä¸€ä¸ªè®¾è®¡å¸ˆå¯ä»¥æ¥å—çš„èŒƒå›´å†…ã€‚ æ•ˆæœå¦‚ä¸‹ï¼šå®‰å“ï¼šIOSï¼šä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031.word &#123; display: inline-block; border-radius: 4px; color: #fff; background: #E8220E; text-align: left; overflow: hidden; font-size: 20px; max-width: 180px; white-space: nowrap; vertical-align: top; padding: 0 6px 0 6px; height: 28px; line-height: 32px; &amp;__pre &#123; display: inline-block; vertical-align: top; padding-right: 4px; line-height: 30px; &#125; &amp;__text &#123; display: inline-block; vertical-align: top; width: calc(100% - 20px); text-overflow: ellipsis; white-space: nowrap; overflow: hidden; table-layout: fixed; &#125;&#125; è¯¥æ–¹æ³•ä½¿ç”¨äº†calcæ¥è®¡ç®—æ•´ä½“å®½åº¦ï¼Œæ¥å®ç°æ–‡å­—æˆªæ–­ã€‚è¿™ç§æ–¹æ³•èƒ½å¤Ÿå…¼å®¹ä¸€è¡Œä¸‹çš„å¤§éƒ¨åˆ†æƒ…å†µï¼Œæ”¯æŒå›¾æ ‡+æ–‡å­—ã€æ–‡å­—+æ–‡å­—ã€‚ç¼ºç‚¹ï¼šIOSä¸‹å¯èƒ½è¿˜æ˜¯ä¼šç¨åä¸€ç‚¹ç‚¹ï¼Œä½†æ˜¯æ ¹æ®æˆ‘ä»¬è®¾è®¡å¸ˆçš„åé¦ˆï¼Œè¯¥è¯¯å·®å¯ä»¥æ¥å—ï¼Œä¸”è¯¥æ–¹æ³•æ”¯æŒä¸€è¡Œå¤šä¸ªåŒæ—¶å‡ºç°ã€‚ æ€»ç»“ æ ¹æ®å®è·µï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ–¹æ³•3æ˜¯è¦†ç›–é¢æ¯”è¾ƒå¹¿çš„æ–¹æ³•ï¼Œline-heightçš„å€¼ &gt; heightçš„å€¼å³å¯ï¼› å¦‚æœåªæœ‰ä¸€è¡Œæ–‡å­—ï¼Œå»ºè®®ä½¿ç”¨line-height: normalï¼› å¤šè¡Œæ–‡å­—å»ºè®®ä½¿ç”¨tableå¸ƒå±€ï¼Œæ§åˆ¶å­—æ•°ï¼Œå› ä¸ºæ— æ³•æˆªæ–­ï¼›","pubDate":"Fri, 24 Jul 2020 10:00:00 GMT","guid":"https://aotu.io/notes/2020/07/24/line-height-in-all-hardware/","category":"ç»éªŒåˆ†äº«"},{"title":"ç§»åŠ¨ç«¯å¸é¡¶å¯¼èˆªç»„ä»¶çš„å®ç°","link":"https://aotu.io/notes/2020/07/23/mobile-top-nav/","description":"å‰è¨€å¸é¡¶å¯¼èˆªæ˜¯è¥é”€ä¼šåœºç±»æœ€å¸¸ç”¨çš„ç»„ä»¶ä¹‹ä¸€ï¼Œ ç°åœ¨çš„ä¼šåœºé¡µé¢æ˜¯è¶Šæ¥è¶Šé•¿ï¼Œå¦‚æœä»ç¬¬ä¸€å±æ‰‹åŠ¨æ»‘åˆ°æœ€åä¸€å±ï¼Œè¿˜æ˜¯ä¸€ä¸ªæŒºç´¯çš„æ“ä½œï¼Œæ‰€ä»¥å¸é¡¶å¯¼èˆªè¿˜æ˜¯å¾ˆæœ‰å¿…è¦å­˜åœ¨çš„ï¼Œç»„ä»¶å¾ˆå¸¸è§ï¼Œä½†æ˜¯å¼€æºçš„ä¸å¤šï¼Œè€Œä¸”å¤§å¤šæ˜¯PCç‰ˆï¼Œå‡ ä¹éƒ½ä¸èƒ½æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œæ‰€ä»¥å†³å®šè‡ªå·±å†™ä¸€ä¸ªã€‚ å…ˆçœ‹ä¸‹ç»„ä»¶æ•ˆæœ demo åŠŸèƒ½æ‹†è§£æ¢³ç†ä¸‹ç»„ä»¶éœ€è¦å®ç°çš„åŠŸèƒ½ åˆ°è¾¾é¦–å±‚å¸é¡¶å’Œæœ€åä¸€å±‚å–æ¶ˆå¸é¡¶ å½“å‰æ¥¼å±‚é«˜äº®æ˜¾ç¤º é€‰ä¸­å¯¼èˆªå±…ä¸­æ˜¾ç¤º é»˜è®¤æ˜¾ç¤ºæˆ–æ»‘åˆ°é¦–å±‚æ‰æ˜¾ç¤º æ»‘åŠ¨è¿‡ç¨‹ä¸­æ§åˆ¶éšè—æ˜¾ç¤º å±•å¼€æ˜¾ç¤ºæ›´å¤š åŠŸèƒ½å®ç°ä¸‹é¢æˆ‘ä¼šä»‹ç»ä¸‹å…¶ä¸­å‡ ä¸ªåŠŸèƒ½çš„å®ç°æ–¹æ³•ï¼Œå…¨éƒ¨æºç æœ‰å…´è¶£çš„è¯å¯ä»¥ç‚¹å‡»è¿™é‡Œ å¯¼èˆªé€‰ä¸­å±…ä¸­1. å¦‚ä½•å±…ä¸­é¦–å…ˆæˆ‘ä»¬å¯ä»¥å…ˆè€ƒè™‘æ€ä¹ˆå±…å·¦ï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸€é¡¹è·ç¦»å·¦è¾¹çš„å®½åº¦æ˜¯mï¼Œé‚£å±…å·¦å°±æ˜¯-m,å±…ä¸­å°±æ˜¯å†å‡ä¸­çº¿çš„ä½ç½®ï¼Œä¸­çº¿çš„ä½ç½®å¦‚æœæ˜¯Mï¼Œé‚£å°±æ˜¯M-mã€‚ 2. å¤„ç†è¾¹ç•Œçš„æƒ…å†µé€šè¿‡M-mï¼Œæˆ‘ä»¬å†æ¥å¤„ç†åˆ°è¾¾è¾¹ç•Œçš„é—®é¢˜ï¼Œä¸»è¦ä¸¤ç§æƒ…å†µ 1.å½“M-m&gt;0çš„æ—¶å€™ï¼Œåˆ™å·²ç»åˆ°è¾¾æœ€å·¦è¾¹ 2.å½“M-m &gt;äºå¯æ»šåŠ¨çš„è·ç¦»ï¼ˆæ»šåŠ¨æ¡é•¿åº¦-å¯è§†é•¿åº¦ï¼‰ï¼Œå°±æ˜¯åˆ°è¾¾æœ€å³è¾¹ å®ç°ä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132/*ä»¥ä¸‹ä»£ç ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç•¥æœ‰åˆ å‡*//* * å¯¼èˆªåˆ‡æ¢ */watch()&#123; translateX(value)&#123; //æ»šåŠ¨æ¡ä½ç½®ä¿®æ”¹ this.scrollView.scrollLeft = Math.abs(value) &#125;&#125;,methods:&#123; center(index)&#123; //å½“å‰é€‰ä¸­é¡¹ const activeItem = this.$refs.navitem[index] //é€‰ä¸­é¡¹è·ç¦»å·¦è¾¹çš„è·ç¦»å’Œå®½åº¦ const &#123;offsetLeft,offsetWidth&#125; = activeItem //å¯¼èˆªæ¡å¯è§çš„å®½åº¦ const touchWidth = this.stickyNav.offsetWidth //å¯æ»šåŠ¨å®½åº¦ = æ•´ä¸ªæ»šåŠ¨å®½åº¦ - å¯¼èˆªæ¡å¯è§çš„å®½åº¦ const scrollWidth = this.scrollView.scrollWidth - touchWidth //å¯¼èˆªæ¡ä¸­ç‚¹ const half = (touchWidth - offsetWidth) / 2 //éœ€è¦æ»šåŠ¨çš„é•¿åº¦ let scrollLeft = half - offsetLeft //åˆ°è¾¾æœ€å·¦è¾¹ scrollLeft &gt; 0 &amp;&amp; (scrollLeft = 0); //åˆ°è¾¾æœ€å³è¾¹ scrollLeft &lt; -scrollWidth &amp;&amp; (scrollLeft = -scrollWidth) this.translateX = scrollLeft &#125;&#125; å¯¼èˆªç¼“åŠ¨å®ç°äº†å¯¼èˆªå±…ä¸­åæˆ‘ä»¬å†ç»™ä»–åŠ ä¸€ä¸ªç¼“åŠ¨çš„æ•ˆæœï¼Œä¸Šé¢å·²ç»é€šè¿‡ç›‘å¬æ»šåŠ¨çš„å€¼å»ä¿®æ”¹æ»šåŠ¨æ¡scrollLeftæ”¹å˜ä½ç½®ï¼Œç”±äºwatchå¯ä»¥ç›‘å¬å€¼çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å–åˆ°åˆå§‹å€¼å’Œç»“æŸå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€ç»™æ•°å­—å˜åŒ–æ·»åŠ ä¸€ä¸ªç¼“åŠ¨çš„è¿‡ç¨‹ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶tweenjsæ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚1234567891011121314151617181920212223242526272829import tween from '@tweenjs/tween.js\"watch:&#123; translateX(star, end) &#123; this.tween(star,end) &#125;&#125;methods:&#123; tween(start,end)&#123; new TWEEN.Tween(&#123; number: start &#125;) .to(&#123; number: end &#125;, 100) .onUpdate(tween =&gt; &#123; //æ”¹å˜æ»šåŠ¨ä½ç½® this.scrollView.scrollLeft = -tween.number; &#125;) .start(); function animate()&#123; if (TWEEN.update()) &#123; requestAnimationFrame(animate) &#125; &#125; animate() &#125;&#125; æ»šåŠ¨è¿‡ç¨‹ä¸­çš„éšè—å’Œæ˜¾ç¤ºå®ç°è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬éœ€è¦çŸ¥é“ç”¨æˆ·å½“å‰çš„æ“ä½œæ˜¯ä¸Šåˆ’è¿˜æ˜¯ä¸‹åˆ’ï¼ŒåŒæ ·å€ŸåŠ©äºvueä¸­çš„watchåŠŸèƒ½ï¼Œæˆ‘ä»¬ç›‘å¬å½“å‰å±å¹•æ»šåŠ¨çš„è·ç¦»scrollTop,å¯ä»¥å¾—åˆ°ä¸€ä¸ªå½“å‰å€¼å’Œè¿‡å»å€¼ï¼Œå°†ä¸¤ä¸ªå€¼å¯¹æ¯”ï¼Œå½“å‰å€¼å¤§äºè¿‡å»å€¼çš„æ—¶å€™ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·æ‰‹æŒ‡æ˜¯å‘ä¸Šæ»‘ï¼ˆå±å¹•å¾€ä¸‹æ»šåŠ¨ï¼‰çš„ï¼Œåä¹‹å‘ä¸‹ï¼Œä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031/*ä»¥ä¸‹ä»£ç ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç•¥æœ‰åˆ å‡*/data()&#123; //æ§åˆ¶å¯¼èˆªæ˜¯å¦æ˜¾ç¤ºéšè—çš„å˜é‡ scrollHide:false, //éœ€è¦è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“ç”¨æˆ·ä¸€æ®µæ—¶é—´æ²¡æ“ä½œçš„æ—¶å€™ï¼Œæ˜¾ç¤ºå¯¼èˆªæ¡ scrollTimer:false &#125;,watch:&#123; scrollTop(newValue, oldValue)&#123; const delay = 2000 //å‘ä¸‹æ»šåŠ¨ if(newValue &gt; oldvalue)&#123; //æ”¹å˜å±æ€§ï¼Œæ§åˆ¶éšè—æ˜¾ç¤º this.scrollHide = true //æ¸…é™¤å®šæ—¶å™¨ clearTimeout(this.scrollTimer) this.scrollTimer = null //å‘ä¸Š &#125;else&#123; this.scrollHide = fasle &#125; if(!this.scrollTimer)&#123; this.scrollTimer = setTimeout(()=&gt;&#123; this.scrollHide = fasle &#125;) &#125; &#125;&#125; å‘ä¸‹æ»šåŠ¨éšè—çš„åŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“ç‚¹å‡»å¯¼èˆªæ çš„æ—¶å€™é¡µé¢ä¹Ÿæ˜¯å‘ä¸‹æ»šçš„ï¼Œè¿™æ—¶å€™è¿˜ä¼šè§¦å‘ä¸Šé¢çš„å‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™ä½“éªŒæ•ˆæœæœ‰ç‚¹å¥‡æ€ªï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¼˜åŒ–ä¸‹ï¼Œå½“ç”¨æˆ·çš„æ“ä½œæ˜¯ç‚¹å‡»å±å¹•çš„æ—¶å€™ä¸å»æ‰§è¡Œéšè—å¯¼èˆªçš„åŠŸèƒ½ æ”¹è¿›ç‰ˆ1234567891011121314151617181920212223242526272829303132333435363738394041424344/*ä»¥ä¸‹ä»£ç ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œç•¥æœ‰åˆ å‡*/data()&#123; //æ§åˆ¶å¯¼èˆªæ˜¯å¦æ˜¾ç¤ºéšè—çš„å˜é‡ scrollHide:false, //éœ€è¦è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“ç”¨æˆ·ä¸€æ®µæ—¶é—´æ²¡æ“ä½œçš„æ—¶å€™ï¼Œæ˜¾ç¤ºå¯¼èˆªæ¡ scrollTimer:false, //æ˜¯å¦ç‚¹å‡»äº‹ä»¶ isClickScroll: false&#125;,methods:&#123; //ç‚¹å‡»æ—¶è§¦å‘ change(index) &#123; this.isClickScroll = true; &#125;&#125;,watch:&#123; scrollTop(newValue, oldValue)&#123; if(this.isClickScroll)&#123; setTimeout(() =&gt; &#123; this.isClickScroll = false &#125;, 10); &#125; if (this.isClickScroll) return; const delay = 2000 //å‘ä¸‹æ»šåŠ¨ if(newValue &gt; oldvalue)&#123; //æ”¹å˜å±æ€§ï¼Œæ§åˆ¶éšè—æ˜¾ç¤º this.scrollHide = true; //æ¸…é™¤å®šæ—¶å™¨ clearTimeout(this.scrollTimer); this.scrollTimer = null; //å‘ä¸Š &#125;else&#123; this.scrollHide = fasle; &#125; if(!this.scrollTimer)&#123; this.scrollTimer = setTimeout(()=&gt;&#123; this.scrollHide = fasle; this.isClickScroll = false; &#125;) &#125; &#125;&#125; é‡åˆ°çš„ä¸€äº›é—®é¢˜äº¬ä¸œAPPæ²‰æµ¸å¼å…¼å®¹é—®é¢˜æ²‰æµ¸å¼æ•ˆæœï¼š æ²‰æµ¸å¼å°±æ˜¯å»æ‰äº†é¦–å±æ ‡é¢˜æ çš„ä¸€ç§æ²‰æµ¸å¼ä½“éªŒï¼Œï¼Œå¦‚æœå¼€å¯äº†æ²‰æµ¸å¼ï¼Œé‚£ä¹ˆé¦–å±æ ‡é¢˜æ æ˜¯ä¸€ä¸ªé€æ˜çš„çŠ¶æ€ï¼Œæ•´ä¸ªé¡µé¢çš„é«˜åº¦å°±ä¼šä¸Šç§»ï¼Œç„¶åå½“ä½ å¾€ä¸‹æ»‘åŠ¨çš„æ—¶å€™æ ‡é¢˜æ ä¼šå‡ºç°ï¼Œè¿™æ—¶å€™å¯¼èˆªæ å¦‚æœå¸é¡¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡é¢˜æ ç»™æŒ¡ä½çœ‹ä¸åˆ°äº†ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯éœ€è¦å¢åŠ å¯¼èˆªæ è·ç¦»é¡¶éƒ¨çš„é«˜åº¦ï¼Œè€Œä¸”æ˜¯åŠ¨æ€ä¿®æ”¹çš„ï¼Œå› ä¸ºåœ¨APPä¸­è·å–æ ‡é¢˜æ çš„é«˜åº¦æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œï¼ŒåŸå…ˆç»„ä»¶ä¸­å¹¶æ²¡è€ƒè™‘éœ€è¦åŠ¨æ€ä¿®æ”¹é«˜åº¦çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦ç‚¹å°ä¿®æ”¹ï¼Œå…ˆçœ‹ä¸‹ä¸€å¼€å§‹æ˜¯æ€ä¹ˆåˆå§‹åŒ–ç»„ä»¶çš„ï¼š 12345678&lt;StickyNav :options=\"options\"/&gt;options:&#123; disabled:false, stickyTop:0, //è·ç¦»é¡¶éƒ¨ zIndex:1000, ...&#125; æˆ‘ä»¬æ˜¯é€šè¿‡stickyTopå±æ€§æ¥æ§åˆ¶å¯¼èˆªæ è·ç¦»é¡¶éƒ¨çš„è·ç¦»ï¼Œä½†æ˜¯å¦‚æœå¼‚æ­¥å»ä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„å€¼æ˜¯æ²¡æœ‰ä»»ä½•å˜åŒ–çš„ï¼Œå› ä¸ºvueä¸­æ˜¯æ— æ³•æ£€æµ‹åˆ°å¯¹è±¡çš„ä¿®æ”¹ï¼Œ 1.é€šè¿‡watchçš„deepå±æ€§ï¼Œè®¾ç½®ä¸ºtrueå¯ä»¥ç›‘å¬optionså¯¹è±¡çš„ä¿®æ”¹,å†é‡æ–°å¤åˆ¶åˆ°æ–°å¯¹è±¡12345678watch&#123; options:&#123; handler(value)&#123; assign(this.stickyOptions,value) &#125;, deep:true &#125;&#125; 2.æˆ–è€…æŠŠstickyTopå•ç‹¬ä½œä¸ºä¸€ä¸ªpropå±æ€§ä¼ ç»™ç»„ä»¶ï¼Œè¿™æ ·å¯ä»¥å®æ—¶å˜åŒ– ä½ç«¯æœºå…¼å®¹æ€§é—®é¢˜å…¼å®¹æ€§é—®é¢˜é€šå¸¸å‡ºç°åœ¨ä¸€äº›å¾ˆä½ç«¯çš„æ‰‹æœºä¸Šï¼Œæ¯”å¦‚android4.0,ios8ã€ä¸è¿‡å¦‚æœåšåˆ°ä»¥ä¸‹3ç‚¹åŸºæœ¬ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ 1.ES6å…¼å®¹é€šå¸¸æˆ‘ä»¬webpackä¸Šå·²ç»é…ç½®äº†babelè½¬æ¢ï¼Œä½†å…¶å®åªæ˜¯å¯¹è¯­æ³•çš„ç¼–è¯‘ï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°ç­‰å¦‚æœä½ ä½¿ç”¨äº†Promiseã€Object.assignã€includesç­‰å…¨å±€æ–¹æ³•å…¶å®éƒ½ä¸èƒ½è¢«è½¬æ¢çš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•å¯ä»¥å…¨å±€å¼•å…¥polyfill 12npm install babel-polyfill --saveimport 'babel-polyfill' æˆ–è€…ä½ çš„é¡¹ç›®ä¸­åªæ˜¯ç”¨äº†ä¸€ä¸¤ä¸ªæ–¹æ³•ï¼Œå¼•å…¥æ•´ä¸ªpolyfillå¤ªæµªè´¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ lodash/includes 2.CSSè‡ªåŠ¨ -webkit- å‰ç¼€è¿˜æœ‰å°±æ˜¯æ ·å¼ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œä¸€èˆ¬æˆ‘ä»¬ç°åœ¨éƒ½æ˜¯åœ¨webpackå·¥ç¨‹ä¸­é…ç½®autoprefixerå»è‡ªåŠ¨åŠ å‰ç¼€ï¼Œä¸è¿‡è¦æ³¨æ„ä¿®æ”¹ä¸‹package.jsonä¸‹çš„browserslist1234\"browserslist\": [ \"Android &gt;= 4.4\", \"iOS 8\" ] 3.å°½é‡ä¸è¦ä½¿ç”¨flexå¸ƒå±€flexå¸ƒå±€æœ‰æŸäº›å¾ˆè€çš„æœºå‹è¿˜æ˜¯æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼Œç”¨inline-blockæ¥ä»£æ›¿ ç»“æŸæœ¬æ–‡åˆ°è¿™é‡Œå°±ç»“æŸå•¦ï¼Œç»„ä»¶vue-stivky-navå·²ç»å¼€æºåˆ°npmä¸Šï¼Œæ¬¢è¿ä½¿ç”¨å’Œæé—®é¢˜,å¦‚æœæ‚¨å¯¹æœ¬æ–‡æœ‰ä»€ä¹ˆé—®é¢˜ä¹Ÿå¯ä»¥åœ¨åº•ä¸‹ç•™è¨€è®¨è®ºã€‚","pubDate":"Thu, 23 Jul 2020 10:00:00 GMT","guid":"https://aotu.io/notes/2020/07/23/mobile-top-nav/","category":"ç»éªŒåˆ†äº«"},{"title":"å¦‚ä½•ä½¿ç”¨Grid Layout","link":"https://aotu.io/notes/2020/07/23/how-to-use-grid-layout/","description":"å¦‚ä½•ä½¿ç”¨Grid Layoutå‰è¨€CSS Grid Layoutæ˜¯ä¸€ç§æ …æ ¼å¸ƒå±€ï¼Œéšç€å„å¤§æµè§ˆå™¨çš„å…¼å®¹ï¼Œåœ¨å¯åº”ç”¨èŒƒå›´è¶Šæ¥è¶Šå¹¿ã€‚å¾ˆå¤šäººå°±ä¼šé—®èƒ½ä¸èƒ½ä»£æ›¿Flexboxå¼¹æ€§å¸ƒå±€ï¼Ÿè™½ç„¶ä»–ä»¬æœ‰ç‚¹ç›¸ä¼¼ï¼Œä½†å€¼å¾—ä¸€æçš„æ˜¯ä»–å¹¶ä¸èƒ½ä»£æ›¿Flexboxå¼¹æ€§å¸ƒå±€ï¼Œå®ƒå¯ä»¥åœ¨å¤æ‚çš„åº”ç”¨åœºæ™¯ä¸‹ä¸Flexboxå¼¹æ€§å¸ƒå±€ç›¸è¾…ç›¸æˆã€‚è¯¥å±æ€§çš„ç†å¿µæœ‰ç‚¹ç±»ä¼¼ä»¥å¾€åœ¨ç½‘é¡µè®¾è®¡ä¸­çš„æ …æ ¼å¸ƒå±€ï¼Œå¦‚æœä»¥å‰æ¥è§¦è¿‡ç½‘é¡µçš„æ …æ ¼ç³»ç»Ÿä¼šå¸®åŠ©ç†è§£CSS Grid Layoutã€‚ å…¼å®¹æ€§æˆªæ­¢åˆ°20å¹´7æœˆ14æ—¥ï¼Œcaniuseçš„å…¼å®¹å›¾ã€‚å¦‚å›¾æ‰€ç¤ºï¼š åº”ç”¨åœºæ™¯å…ˆæ¥çœ‹çœ‹åº”ç”¨åœºæ™¯ï¼Œä¸ªäººååˆ†æ¨èå®ƒç”¨äºå¤§å‹é¡µé¢æ¡†æ¶æ„å»ºæˆ–è€…ç”µå•†ä¸­çš„skuåˆ—è¡¨æ‘†æ”¾ã€‚å…·ä½“å¯ä»¥æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªdemoå›¾éƒ½é™„å½•äº†æºç åœ°å€ã€‚ Demo é“¾æ¥ Demo é“¾æ¥ é‡è¦å±æ€§ä»‹ç»â‘ .display: grid/inline-grid;éœ€è¦åœ¨åŒ…è£¹å­å…ƒç´ çš„çˆ¶å®¹å™¨ä¸Šåšå‡ºå£°æ˜ï¼Œè¯¥å±æ€§å£°æ˜ä¸ºCSS Grid Layoutæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å—çŠ¶å…ƒç´ display: gridï¼Œä¸€ç§æ˜¯è¡Œå†…å—çŠ¶å…ƒç´ display: inline-gridã€‚è¯¥å±æ€§å£°æ˜åå…¶ä»–å±æ€§æ‰ä¼šæœ‰æ•ˆã€‚å¦‚å›¾æ‰€ç¤ºï¼š Demo é“¾æ¥ â‘¡.grid-template-areas: none/itemnames;æŒ‡å®šä¸€ä¸ªåºåˆ—è¿›è¡Œå­å…ƒç´ æ’åˆ— â‘¢.grid-template-rowså’Œgrid-template-columnsrowsæ˜¯ä»£æŒ‡è¡Œï¼Œcolumnsæ˜¯ä»£æŒ‡åˆ—ï¼Œç”¨æ¥å£°æ˜é«˜æˆ–å®½ ç»å¯¹å€¼ å¦‚%ï¼Œpxï¼Œvwç­‰å•ä½ repeat() grid-template-rows: repeat(å‡ ä¸ª, æ•°å€¼); grid-template-rows: repeat(å‡ ä¸ª, å¤šä¸ªæ•°å€¼); fr å¦‚æœå£°æ˜çš„å®½åº¦ä¸º1frï¼Œ2frï¼Œåè€…æ˜¯å‰è€…2å€ï¼Œè‡ªåŠ¨åˆ’åˆ† auto-fill ç»“åˆrepeatä½¿ç”¨ çˆ¶çº§å®½åº¦é«˜åº¦é™å®šæƒ…å†µä¸‹ï¼Œæ¯ä¸ªitemå›ºå®šå®½é«˜å°½å¯èƒ½å¡«å…… â‘£.grid-gapæŒ‡å®šæ …æ ¼ä¹‹é—´çš„é—´è· â‘¤.grid-auto-flow: row/columné»˜è®¤æ˜¯rowï¼Œç”¨äºæŒ‡å®šå¡«æ»¡çš„è¡Œæˆ–åˆ—çš„ä¼˜å…ˆçº§ã€‚ ä»¥ä¸Šâ‘¡-â‘¤å±æ€§å¯ä»¥æŸ¥çœ‹è¿™ä¸ªDemo é“¾æ¥ æ‰©å±•é˜…è¯» CSS Grid Layout Module Level 1 CSS Grid Layout Module Level 2","pubDate":"Thu, 23 Jul 2020 10:00:00 GMT","guid":"https://aotu.io/notes/2020/07/23/how-to-use-grid-layout/","category":"ç»éªŒåˆ†äº«"},{"title":"618å‰ç«¯ç«å“åˆ†æç ”ç©¶ï¼ˆäº’åŠ¨ç¯‡ï¼‰","link":"https://aotu.io/notes/2020/07/21/618-what-taobao-do/","description":"æ™ºèƒ½åŒ–æµ‹è¯•åœ¨äº’åŠ¨ä¸­ç»å¸¸éœ€è¦ç»´æŠ¤å¤§é‡çš„çŠ¶æ€ï¼Œå¯¹è¿™äº›çŠ¶æ€è¿›è¡Œæµ‹è¯•éªŒè¯æˆæœ¬è¾ƒé«˜ï¼Œå°¤å…¶æ˜¯å½“æœ‰åŠŸèƒ½å˜åŠ¨éœ€è¦å›å½’æµ‹è¯•çš„æ—¶å€™ã€‚ä¸ºäº†é™ä½å¼€å‘æµ‹è¯•çš„æˆæœ¬ï¼Œåœ¨è¿™æ–¹é¢ä½¿ç”¨å¼ºåŒ–å­¦ä¹ æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºï¼Œåœ¨ä¸¤ä¸ªæ–¹é¢ææ•ˆï¼š mockæ¥å£ï¼šå°†å­¦ä¹ è¿‡ç¨‹ä¸­çš„çŠ¶æ€ä½œä¸ºæœåŠ¡æ¥å£çš„æµ‹è¯•æ•°æ®ï¼› å›å½’æµ‹è¯•ï¼šæ ¹æ®mockæ¥å£æ•°æ®å›æº¯åˆ°ç‰¹å®šçŠ¶æ€ï¼ŒPuppeteeræ ¹æ®å¼ºåŒ–å­¦ä¹ è§¦å‘å‰ç«¯æ“ä½œï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼› ä»€ä¹ˆæ˜¯å¼ºåŒ–å­¦ä¹ å‘¢ï¼Ÿ å¼ºåŒ–å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªé¢†åŸŸï¼Œå®ƒå¼ºè°ƒå¦‚ä½•åŸºäºç¯å¢ƒè¡ŒåŠ¨ï¼Œè·å–æœ€å¤§åŒ–çš„é¢„æœŸåˆ©ç›Šã€‚å¼ºåŒ–å­¦ä¹ éå¸¸é€‚ç”¨äºè¿‘å‡ å¹´æ¯”è¾ƒæµè¡Œçš„ç”µå•†äº’åŠ¨æœºåˆ¶ï¼šåšä»»åŠ¡/åšæ¸¸æˆ -&gt; å¾—åˆ°ä¸åŒçš„å¥–åŠ±å€¼ -&gt; æœ€ç»ˆç›®æ ‡å¤§å¥–ï¼Œåœ¨è¿™ç±»å‹çš„äº’åŠ¨æ¸¸æˆä¸­ï¼Œå¥–åŠ±æ˜¯å¯é¢„æœŸçš„ï¼Œç”¨æˆ·çš„ç›®æ ‡æ˜¯ä½¿å¾—è‡ªå·±çš„å¥–åŠ±æœ€å¤§åŒ–ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥æŠ½è±¡ä¸ºé©¬å°”ç§‘å¤«å†³ç­–æ¨¡å‹ï¼šç©å®¶ï¼ˆagentï¼‰é€šè¿‡ä¸åŒçš„äº¤äº’è¡Œä¸ºï¼ˆactionï¼‰ï¼Œæ”¹å˜æ¸¸æˆï¼ˆenvironmentï¼‰çš„çŠ¶æ€ï¼ˆstateï¼‰ï¼Œåé¦ˆç»™ç©å®¶ä¸åŒçš„å¥–åŠ± ï¼ˆrewardï¼‰ï¼›è¿™ä¸ªè¿‡ç¨‹ä¸æ–­å¾ªç¯è¿­ä»£ï¼Œ ç©å®¶çš„æœ€ç»ˆç›®æ ‡æ˜¯å¥–åŠ±æœ€å¤§åŒ–ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒç®€å•çš„Q-learningï¼Œæ¥å®ç°ç±»ä¼¼çš„æ™ºèƒ½åŒ–æµ‹è¯•ç›®çš„ã€‚ Q-learningå¯¹äºä¸åŒçŠ¶æ€ä¸‹ï¼ŒQ-learningçš„Q(s,a)è¡¨ç¤ºåœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„sçŠ¶æ€ä¸‹ï¼Œé‡‡å–åŠ¨ä½œaå¯ä»¥å¾—åˆ°çš„æ”¶ç›ŠæœŸæœ›ï¼Œç®—æ³•çš„ä¸»è¦æ€æƒ³æ˜¯å°†stateå’Œationæ„å»ºä¸€å¼ Q-tableæ¥å­˜å‚¨Qå€¼ï¼Œæ ¹æ®Qå€¼æ¥é€‰å–èƒ½å¤Ÿè·å¾—æœ€å¤§æ”¶ç›Šçš„åŠ¨ä½œã€‚Qå€¼çš„å…¬å¼è®¡ç®—å¦‚ä¸‹ï¼š å…¶ä¸­ï¼Œsè¡¨ç¤ºstateï¼Œaè¡¨ç¤ºactionï¼ŒÎ±ä¸ºå­¦ä¹ ç‡ï¼ŒÎ³ä¸ºè¡°å‡ç‡ï¼Œrè¡¨ç¤ºactionèƒ½å¸¦æ¥çš„æ”¶ç›Šã€‚ è¿™ä¸ªå…¬å¼è¡¨ç¤ºå½“å‰çŠ¶æ€çš„Qå€¼ç”±â€œè®°å¿†ä¸­â€çš„åˆ©ç›Šï¼ˆmax Q[sâ€™,a]ï¼‰å’Œå½“å‰åˆ©ç›Šï¼ˆrï¼‰ç»“åˆå½¢æˆã€‚è¡°å‡ç‡Î³è¶Šé«˜ï¼Œâ€œè®°å¿†ä¸­â€çš„åˆ©ç›Šå½±å“è¶Šå¤§ï¼›å­¦ä¹ ç‡Î±è¶Šå¤§ï¼Œå½“å‰åˆ©ç›Šå½±å“è¶Šå¤§ã€‚Q-learningçš„ç›®æ ‡æ˜¯é€šè¿‡ä¸æ–­è®­ç»ƒï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªèƒ½æ‹¿åˆ°æœ€å¤šå¥–åŠ±çš„æœ€ä¼˜åŠ¨ä½œåºåˆ—ã€‚ åœ¨èµ›è½¦æ¸¸æˆä¸­ï¼Œç©å®¶çš„äº¤äº’è¡Œä¸ºåŒ…å«è´­ä¹°è½¦å¢ã€åˆæˆè½¦å¢ã€åšä»»åŠ¡è·å¾—é‡‘å¸ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæ­¤å¤„ç®€åŒ–ä¸ºä¸€ä¸ªä»»åŠ¡ï¼‰ï¼›ç©å®¶ä»åˆå§‹åŒ–çŠ¶æ€å¼€å§‹ï¼Œé€šè¿‡é‡å¤â€œaction -&gt; æ›´æ–°stateâ€çš„è¿‡ç¨‹ï¼Œä»¥ä¸‹çš„ä¼ªä»£ç ç®€å•çš„è¯´æ˜æˆ‘ä»¬æ€ä¹ˆå¾—åˆ°ä¸€ä¸ªå°½é‡å®Œç¾çš„Qè¡¨æ ¼ï¼š 1234567891011// action: [ è´­ä¹°è½¦å¢ï¼Œåˆæˆè½¦å¢ï¼Œåšä»»åŠ¡è·å¾—é‡‘å¸ ]// state: åŒ…å«ç­‰çº§ã€æ‹¥æœ‰è½¦å¢ç­‰çº§ã€å‰©ä½™é‡‘å¸è¡¨ç¤ºåˆå§‹åŒ– Q = &#123;&#125;while Qæœªæ”¶æ•›ï¼š åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€state while èµ›è½¦æ²¡æœ‰è¾¾åˆ°50çº§ï¼š ä½¿ç”¨ç­–ç•¥Ï€ï¼Œè·å¾—åŠ¨ä½œa = Ï€(S) ä½¿ç”¨åŠ¨ä½œaï¼Œè·å¾—æ–°çš„æ¸¸æˆçŠ¶æ€state æ›´æ–°Qï¼ŒQ[s,a] â† (1-Î±)*Q[s,a] + Î±*(R(s,a) + Î³* max Q[s',a]) æ›´æ–°çŠ¶æ€state ç®€å•çš„demoåœ°å€ï¼šhttps://github.com/winniecjy/618taobao Puppeteerç”±ä¸Šé¢Q-learningçš„è®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—çš„ä¸­é—´æ€æ¥å£ä½œä¸ºmockæ•°æ®ï¼Œå¯ä»¥å¾ˆå¿«çš„å›æº¯åˆ°ç‰¹å®šçŠ¶æ€è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä¸€ç‚¹åœ¨å›å½’æµ‹è¯•çš„æ—¶å€™ååˆ†æœ‰ç”¨ã€‚ä½†æ˜¯ä»…ä»…åªæ˜¯è‡ªåŠ¨mockæ•°æ®å¯¹æ•ˆç‡æå‡è¿˜æ˜¯æœ‰é™ï¼Œåœ¨618äº’åŠ¨ä¸­ï¼Œå‹å•†çš„äº’åŠ¨å›¢é˜Ÿç»“åˆPuppeteerå¯¹æ•´ä¸ªæµç¨‹è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚Puppeteeræ˜¯chromeå›¢é˜Ÿæ¨å‡ºçš„ä¸€ä¸ªå·¥å…·å¼•æ“ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„APIæ§åˆ¶Chromeï¼Œå¯ä»¥è‡ªåŠ¨æäº¤è¡¨å•ã€é”®ç›˜è¾“å…¥ã€æ‹¦æˆªä¿®æ”¹è¯·æ±‚ã€ä¿å­˜UIå¿«ç…§ç­‰ã€‚ ç»“åˆPuppeteerçš„ä¸€ç³»åˆ—æ“ä½œé€»è¾‘ï¼Œéƒ¨åˆ†æ˜¯å¯ä»¥æ²‰æ·€æˆä¸ºä¸€ä¸ªé€šç”¨çš„æµ‹è¯•ç¯å¢ƒçš„ï¼Œæ¯”å¦‚ï¼š ä¸åŒç”¨æˆ·ç±»å‹ï¼Œå¦‚ç™»å½•ã€éç™»å½•ã€é£é™©ã€ä¼šå‘˜ç­‰ï¼› æ¥å£æ‹¦æˆªmocké€»è¾‘ï¼› é¡µé¢å¿«ç…§ç•™å­˜ï¼› é¡µé¢æ€§èƒ½æ•°æ®ç•™å­˜ï¼› å…¶ä»–å¸¸è§çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚äº’åŠ¨ä»»åŠ¡ä½“ç³»ï¼Œè·³è½¬åç­‰å‡ ç§’åè¿”å›ï¼ŒåŠ ç§¯åˆ†ï¼› â€¦ å¼¹çª—è§„æ¨¡åŒ–åœ¨äº’åŠ¨ä¸­ï¼Œå¼¹çª—ä¸€ç›´æ˜¯è§†è§‰è¡¨ç°çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¯¹UIæœ‰æ¯”è¾ƒå¼ºçš„å®šåˆ¶éœ€æ±‚ã€‚ å‹å•†çš„æ€è·¯æ˜¯å°†æ‰€æœ‰çš„é€»è¾‘å°½å¯èƒ½çš„æ²‰æ·€ã€‚å¯¹äºç”µå•†åœºæ™¯æ¥è¯´ï¼Œå¼¹çª—çš„ä¸šåŠ¡é€»è¾‘æ˜¯å¯ç©·ä¸¾ã€å¯å›ºåŒ–çš„ï¼Œè€Œäº’åŠ¨åœºæ™¯ä¹‹ä¸‹ï¼ŒUIå®šåˆ¶åŒ–éœ€æ±‚å¾ˆé«˜ï¼Œæ‰€ä»¥å°†UIå±‚æŠ½ç¦»ï¼Œ ä»…å¯¹å¯å¤ç”¨çš„é€»è¾‘è¿›è¡Œå›ºåŒ–ï¼Œä»¥DSL + Runtimeçš„æœºåˆ¶åŠ¨æ€ä¸‹å‘ã€‚ ç»“åˆè¿™ä¸€å¥—é€»è¾‘å±‚æ¨¡å‹ï¼Œè¡¨è¾¾å±‚/UIå±‚ä¹Ÿå¯ä»¥ç›¸åº”çš„ç»“æ„åŒ–ã€‚æ ¹æ®é¡¹ç›® &gt; åœºæ™¯ &gt; å›¾å±‚çš„ç»´åº¦ï¼Œé™æ€é…ç½®å’ŒåŠ¨æ€ç»‘å®šç›¸ç»“åˆï¼Œæ­é…å¯¹åº”çš„é…ç½®å¹³å°å°±å¯ä»¥å®ç°åŠ¨æ€ä¸‹å‘ã€‚ æ€»ç»“å¯¹äºæ™ºèƒ½åŒ–æµ‹è¯•ï¼Œ80%çš„æµç¨‹å…¶å®æˆæœ¬æ˜¯ç›¸å¯¹è¾ƒä½çš„ï¼Œä»æµ‹è¯•ç”¨ä¾‹çš„ç”Ÿæˆåˆ°puppeteerè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œéƒ½æ˜¯å¯ä»¥å‚è€ƒå­¦ä¹ çš„ï¼Œå›¾åƒå¯¹æ¯”çš„éƒ¨åˆ†éœ€è¦è¾ƒå¤šè®­ç»ƒï¼Œå¯¹äºå›ºåŒ–çš„åŠŸèƒ½å¯ä»¥è¿›è¡Œæ¢ç´¢ï¼Œå¦‚æœæ˜¯æ–°çš„æ¨¡å¼æ€§ä»·æ¯”è¾ƒä½ã€‚ å¯¹äºå¼¹çª—è§„æ¨¡åŒ–ï¼Œéƒ¨é—¨å†…éƒ¨çš„åšæ³•æ˜¯å°†å¼¹çª—æ²‰æ·€æˆä¸€ä¸ªé€šç”¨çš„ç»„ä»¶ï¼ŒåªåŒ…å«é€šç”¨çš„å…¼å®¹é€»è¾‘ï¼ŒåŒ…æ‹¬æ˜¾ç¤º/éšè—ã€å¼¹çª—å‡ºç°åº•å±‚ç¦æ­¢æ»šåŠ¨ã€å¤šå¼¹çª—å±‚çº§é—®é¢˜ç­‰ã€‚å¯¹äºUIå’Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ï¼Œå¤ç”¨æ€§è¾ƒä½ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½æ˜¯é‡å†™ã€‚è¿™ç§åšæ³•å°½å¯èƒ½åœ°ä¿æŒäº†ç»„ä»¶çš„é€šç”¨æ€§ï¼Œåœ¨ä¼šåœºçº¿æ¯”è¾ƒé€‚ç”¨ï¼Œå› ä¸ºä¼šåœºçº¿çš„å¼¹çª—ä¸€èˆ¬ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æŠ½å¥–ã€PKç­‰ï¼‰ï¼Œä½†æ˜¯å¯¹äºäº’åŠ¨çº¿æ¥è¯´ï¼Œå¤ç”¨çš„å†…å®¹ç›¸è¾ƒäºå¼¹çª—çš„â€œé‡é‡â€æ¥è¯´æ˜¾å¾—æœ‰äº›å¾®ä¸è¶³é“ã€‚ å‹å•†çš„æ²‰æ·€æ€è·¯å‰æåœ¨äºä¸Šæ¸¸æ¥å£çš„é€»è¾‘éœ€è¦å¯å¤ç”¨ï¼Œä¸Šæ¸¸é€»è¾‘å¦‚æœæ— æ³•å›ºå®šä¸‹æ¥ï¼Œå‰ç«¯çš„äº’åŠ¨é€»è¾‘ä¹Ÿè¾ƒéš¾å›ºåŒ–ã€‚æ€»ä½“æ¥è¯´ï¼Œå‹å•†åœ¨äº’åŠ¨æ–¹é¢çš„æ²‰æ·€æ€è·¯å¤§éƒ¨åˆ†æ˜¯ä»å¼€å‘ææ•ˆå‡ºå‘ï¼Œä¸»è¦ä¾›ç»™å†…éƒ¨ä½¿ç”¨ï¼›äº¬ä¸œå†…éƒ¨å·²æœ‰ç±»ä¼¼çš„äº’åŠ¨ææ•ˆæ–¹æ¡ˆç»ˆæç›®æ ‡æ˜¯ç›ˆåˆ©ï¼Œå¦‚äº¬å–œçš„ç¤¾äº¤é­”æ–¹å¹³å°å’Œæœ€è¿‘æ­£åœ¨æˆå‹çš„æ»¡å¤©æ˜Ÿå¹³å°ï¼Œæ‰€ä»¥æ²‰æ·€æ–¹å¼éƒ½æ˜¯ä»¥æˆå¥—çš„H5ã€‚ å‚è€ƒ[1] ç”Ÿäº§åŠ›å†æé€Ÿï¼Œ618äº’åŠ¨é¡¹ç›®è¿›åŒ–ä¹‹è·¯[2] æœºå™¨å­¦ä¹ ç›¸å…³æ•™ç¨‹ - è«çƒ¦[3] Puppeteer docs","pubDate":"Tue, 21 Jul 2020 10:00:00 GMT","guid":"https://aotu.io/notes/2020/07/21/618-what-taobao-do/","category":"ç»éªŒåˆ†äº«"},{"title":"WebpackåŸç†æµ…æ","link":"https://aotu.io/notes/2020/07/17/webpack-analize/","description":"èƒŒæ™¯Webpack è¿­ä»£åˆ°4.xç‰ˆæœ¬åï¼Œå…¶æºç å·²ç»ååˆ†åºå¤§ï¼Œå¯¹å„ç§å¼€å‘åœºæ™¯è¿›è¡Œäº†é«˜åº¦æŠ½è±¡ï¼Œé˜…è¯»æˆæœ¬ä¹Ÿæ„ˆå‘æ˜‚è´µã€‚ä½†æ˜¯ä¸ºäº†äº†è§£å…¶å†…éƒ¨çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬å°è¯•ä»ä¸€ä¸ªæœ€ç®€å•çš„ webpack é…ç½®å…¥æ‰‹ï¼Œä»å·¥å…·è®¾è®¡è€…çš„è§’åº¦å¼€å‘ä¸€æ¬¾ä½é…ç‰ˆçš„ Webpackã€‚","pubDate":"Fri, 17 Jul 2020 06:34:02 GMT","guid":"https://aotu.io/notes/2020/07/17/webpack-analize/","category":"Webå¼€å‘"},{"title":"äº¬å–œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹è·¯(å°ç¨‹åºç¯‡)","link":"https://aotu.io/notes/2020/07/13/jx-automated-testing-weapp/","description":"å¦‚æœä½ å·²ç»é˜…è¯»è¿‡ â€œäº¬å–œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹è·¯ï¼ˆä¸€ï¼‰â€ï¼Œå¯è·³è¿‡å‰è¨€éƒ¨åˆ†é˜…è¯»ã€‚ å‰è¨€äº¬å–œï¼ˆåŸäº¬ä¸œæ‹¼è´­ï¼‰é¡¹ç›®ï¼Œä½œä¸ºäº¬ä¸œæˆ˜ç•¥çº§ä¸šåŠ¡ï¼Œæ‹¥æœ‰åƒä¸‡çº§åˆ«çš„æµé‡å…¥å£ã€‚ä¸ºäº†ä¿éšœçº¿ä¸Šä¸šåŠ¡çš„ç¨³å®šè¿è¡Œï¼Œæ¯æœˆä¾‹è¡Œå¼€å±•å‰ç«¯å®¹ç¾æ¼”ä¹ ï¼Œä¸»è¦åŒ…å«å°ç¨‹åºåŠ H5 ç‰ˆæœ¬ï¼Œè¦æ±‚å„é¡µé¢å„æ¨¡å—åœ¨å¼‚å¸¸æƒ…å†µä¸‹è¿›è¡Œé€‚å½“çš„é™çº§å¤„ç†ï¼Œä¸èƒ½å‡ºç°ç©ºçª—ã€æ ·å¼é”™ä¹±ã€ä¸åˆç†çš„é”™è¯¯æç¤ºç­‰ä½“éªŒé—®é¢˜ã€‚ å®¹ç¾æ¼”ä¹ æ˜¯ä¸€é¡¹é•¿æœŸæŒç»­çš„å·¥ä½œï¼Œä¸”æ¶‰åŠé¡µé¢åŠŸèƒ½åŠåœºæ™¯å¤šï¼Œäººå·¥çš„åˆ‡æ¢åœºæ™¯æ¨¡æ‹Ÿå¼‚å¸¸å¯¼è‡´æ¼”ä¹ æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤æƒ³é€šè¿‡å¼€å‘è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·æ¥æå‡æ¼”ä¹ æ•ˆç‡ï¼Œè®©å®¹ç¾æ¼”ä¹ å·¥ä½œéšæ—¶å¯ä»¥è½»æ¾å¼€å±•ã€‚ç”±äºäº¬å–œ H5 å’Œå°ç¨‹åºåœºæ™¯å·®å¼‚æ¯”è¾ƒå¤§ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•åˆ† H5 å’Œå°ç¨‹åºä¸¤éƒ¨åˆ†è¿›è¡Œã€‚å‰æœŸå·²ç»åˆ†äº«è¿‡ H5 çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆ â€”â€” äº¬å–œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹è·¯ï¼ˆä¸€ï¼‰ï¼Œæœ¬æ–‡åˆ™ä¸»è¦è®²è¿°å°ç¨‹åºç‰ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¸Œæœ›äº¬å–œå°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å¯ä»¥æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š è®¿é—®ç›®æ ‡é¡µé¢ï¼Œå¯¹é¡µé¢è¿›è¡Œæˆªå›¾ï¼› æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ã€æ»‘åŠ¨é¡µé¢æ“ä½œï¼› ç½‘ç»œæ‹¦æˆªã€æ¨¡æ‹Ÿå¼‚å¸¸æƒ…å†µï¼ˆæ¥å£å“åº”ç  500ã€æ¥å£è¿”å›æ•°æ®å¼‚å¸¸ï¼‰ï¼› æ“ä½œç¼“å­˜æ•°æ®ï¼ˆæ¨¡æ‹Ÿæœ‰æ— ç¼“å­˜çš„åœºæ™¯ç­‰ï¼‰ã€‚ å°ç¨‹åºè‡ªåŠ¨åŒ– SDKèŠåˆ°å°ç¨‹åºçš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¾®ä¿¡å®˜æ–¹ä¸ºå¼€å‘è€…æä¾›äº†ä¸€å¥—å°ç¨‹åºè‡ªåŠ¨åŒ– SDK â€”â€” miniprogram-automator ï¼Œ æˆ‘ä»¬ä¸éœ€è¦å…³æ³¨æŠ€æœ¯é€‰å‹ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚ å°ç¨‹åºè‡ªåŠ¨åŒ– SDK ä¸ºå¼€å‘è€…æä¾›äº†ä¸€å¥—é€šè¿‡å¤–éƒ¨è„šæœ¬æ“æ§å°ç¨‹åºçš„æ–¹æ¡ˆï¼Œä»è€Œå®ç°å°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç›®çš„ã€‚ å¦‚æœä½ ä¹‹å‰ä½¿ç”¨è¿‡ Selenium WebDriver æˆ–è€… Puppeteerï¼Œé‚£ä½ å¯ä»¥å¾ˆå®¹æ˜“å¿«é€Ÿä¸Šæ‰‹ã€‚å°ç¨‹åºè‡ªåŠ¨åŒ– SDK ä¸å®ƒä»¬çš„å·¥ä½œåŸç†æ˜¯ç±»ä¼¼çš„ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ§åˆ¶å¯¹è±¡ç”±æµè§ˆå™¨æ¢æˆäº†å°ç¨‹åºã€‚ ç‰¹æ€§ é€šè¿‡è¯¥ SDKï¼Œä½ å¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š æ§åˆ¶å°ç¨‹åºè·³è½¬åˆ°æŒ‡å®šé¡µé¢ è·å–å°ç¨‹åºé¡µé¢æ•°æ® è·å–å°ç¨‹åºé¡µé¢å…ƒç´ çŠ¶æ€ è§¦å‘å°ç¨‹åºå…ƒç´ ç»‘å®šäº‹ä»¶ å¾€ AppService æ³¨å…¥ä»£ç ç‰‡æ®µ è°ƒç”¨ wx å¯¹è±¡ä¸Šä»»æ„æ¥å£ â€¦ ç¤ºä¾‹123456789101112131415const automator = require('miniprogram-automator')automator .launch(&#123; cliPath: '/Applications/wechatwebdevtools.app/Contents/MacOS/cli', // å·¥å…· cli ä½ç½®ï¼ˆç»å¯¹è·¯å¾„ï¼‰ projectPath: 'path/to/project', // é¡¹ç›®æ–‡ä»¶åœ°å€ï¼ˆç»å¯¹è·¯å¾„ï¼‰ &#125;) .then(async miniProgram =&gt; &#123; const page = await miniProgram.reLaunch('/pages/index/index') await page.waitFor(500) const element = await page.$('.banner') console.log(await element.attribute('class')) await element.tap() await miniProgram.close() &#125;) ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„ SDK â€”â€” miniprogram-automator å¼€å‘å°ç¨‹åºçš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œé€šè¿‡ SDK æä¾›çš„ä¸€ç³»åˆ— API ï¼Œå®ç°è®¿é—®ç›®æ ‡é¡µé¢ã€æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯ã€ç”Ÿæˆæˆªå›¾çš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚æœ€åå†é€šè¿‡äººå·¥æ¯”å¯¹æˆªå›¾ï¼Œåˆ¤æ–­é¡µé¢é™çº§å¤„ç†æ˜¯å¦ç¬¦åˆé¢„é¢„æœŸã€ç”¨æˆ·ä½“éªŒæ˜¯å¦å‹å¥½ã€‚ å®ç°æ–¹æ¡ˆåŸæ¥çš„å®¹ç¾æ¼”ä¹ è¿‡ç¨‹ï¼š å°ç¨‹åºçš„é€šä¿¡æ–¹å¼æ”¹æˆ HTTPS ï¼Œé€šè¿‡ Whistle å¯¹æ¥å£è¿”å›è¿›è¡Œä¿®æ”¹æ¥æ¨¡æ‹Ÿå¼‚å¸¸æƒ…å†µï¼ŒéªŒè¯å„é¡µé¢å„æ¨¡å—çš„é™çº§å¤„ç†ç¬¦åˆé¢„æœŸã€‚ ç°é˜¶æ®µçš„å®¹ç¾æ¼”ä¹ è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼š æˆ‘ä»¬å°†å®¹ç¾æ¼”ä¹ è¿‡ç¨‹åˆ†ä¸ºè‡ªåŠ¨åŒ–æµç¨‹å’Œäººå·¥æ“ä½œä¸¤éƒ¨åˆ†ã€‚ è‡ªåŠ¨åŒ–æµç¨‹ï¼š å¯åŠ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼ˆå¼€å‘ç‰ˆï¼‰; è®¿é—®ç›®æ ‡é¡µé¢ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ã€æ»‘åŠ¨ç­‰è¡Œä¸ºï¼› æ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯ï¼šæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œä¿®æ”¹æ¥å£è¿”å›æ•°æ®ï¼ˆæ¥å£è¿”å› 500ã€å¼‚å¸¸æ•°æ®ç­‰ï¼‰ï¼› ç”Ÿæˆæˆªå›¾ã€‚ äººå·¥æ“ä½œï¼š è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œäººå·¥æ¯”å¯¹å„ä¸ªåœºæ™¯çš„æˆªå›¾ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ æ–¹æ¡ˆæµç¨‹å›¾ï¼š å¼€å‘å®å½•å¿«é€Ÿåˆ›å»ºæµ‹è¯•ç”¨ä¾‹ä¸ºäº†æé«˜æµ‹è¯•è„šæœ¬çš„å¯ç»´æŠ¤æ€§ã€æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å°†æµ‹è¯•ç”¨ä¾‹çš„ä¿¡æ¯éƒ½é…ç½®åˆ° JSON æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç¼–å†™æµ‹è¯•è„šæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€å…³æ³¨æµ‹è¯•æµç¨‹çš„å®ç°ã€‚ æµ‹è¯•ç”¨ä¾‹ JSON æ•°æ®é…ç½®åŒ…æ‹¬å…¬ç”¨æ•°æ®ï¼ˆglobalï¼‰å’Œç§æœ‰æ•°æ®ï¼š å…¬ç”¨æ•°æ®ï¼ˆglobalï¼‰ï¼šå„æµ‹è¯•ç”¨ä¾‹éƒ½éœ€è¦ç”¨åˆ°çš„æ•°æ®ï¼Œå¦‚ï¼šæ¨¡æ‹Ÿè®¿é—®çš„ç›®æ ‡é¡µé¢åœ°å€ã€åå­—ã€æè¿°ã€è®¾å¤‡ç±»å‹ç­‰ã€‚ ç§æœ‰æ•°æ®ï¼š å„æµ‹è¯•ç”¨ä¾‹ç‰¹å®šçš„æ•°æ®ï¼Œå¦‚æµ‹è¯•æ¨¡å—ä¿¡æ¯ã€api åœ°å€ã€æµ‹è¯•åœºæ™¯ã€é¢„æœŸç»“æœã€æˆªå›¾åå­—ç­‰æ•°æ®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344&#123; \"global\": &#123; \"url\": \"/pages/index/index\", \"pageName\": \"index\", \"pageDesc\": \"é¦–é¡µ\", \"device\": \"iPhone X\" &#125;, \"homePageApi\": &#123; \"id\": 1, \"module\": \"home_page_api\", \"moduleDesc\": \"é¦–é¡µä¸»æ¥å£\", \"api\": \"https://xxx\", \"operation\": \"æ¨¡æ‹Ÿå“åº”ç  500\", \"expectRules\": [ \"1. æœ‰ç¼“å­˜æ•°æ®ï¼Œæ˜¾ç¤ºå®¹ç¾å…œåº•æ•°æ®\", \"2. è¯·æ±‚å®¹ç¾æ¥å£ï¼Œæ˜¾ç¤ºå®¹ç¾å…œåº•æ•°æ®\", \"3. å®¹ç¾æ¥å£å¼‚å¸¸ï¼Œæ˜¾ç¤ºä¿¡å¼‚å¸¸æ¯ã€åˆ·æ–°æŒ‰é’®\", \"4. æ¢å¤ç½‘ç»œï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œæ˜¾ç¤ºæ­£å¸¸æ•°æ®\" ], \"screenshot\": [ &#123; \"name\": \"normal\", \"desc\": \"æ­£å¸¸åœºæ™¯\" &#125;, &#123; \"name\": \"500_cache\", \"desc\": \"æœ‰ç¼“å­˜-ä¸»æ¥å£è¿”å›500\" &#125;, &#123; \"name\": \"500_no_cache\", \"desc\": \"æ— ç¼“å­˜-ä¸»æ¥å£è¿”å›500-å®¹ç¾å…œåº•æ•°æ®\" &#125;, &#123; \"name\": \"500_no_cache_500_disaster\", \"desc\": \"æ— ç¼“å­˜-ä¸»æ¥å£è¿”å›500-å®¹ç¾å…œåº•æ¥å£è¿”å›500\" &#125;, &#123; \"name\": \"500_no_cache_recover\", \"desc\": \"æ— ç¼“å­˜-è¿”å›500-æ¢å¤ç½‘ç»œ\" &#125; ] &#125;, â€¦&#125; ç¼–å†™æµ‹è¯•è„šæœ¬æˆ‘ä»¬ä»¥äº¬å–œé¦–é¡µä¸»æ¥å£çš„æµ‹è¯•ç”¨ä¾‹ä¸ºä¾‹å­ï¼Œé€šè¿‡æ¨¡æ‹Ÿä¸»æ¥å£è¿”å› 500 å“åº”ç çš„å¼‚å¸¸åœºæ™¯ï¼ŒéªŒè¯ä¸»æ¥å£çš„å¼‚å¸¸å¤„ç†æœºåˆ¶æ˜¯å¦å®Œå–„ã€ç”¨æˆ·ä½“éªŒæ˜¯å¦å‹å¥½ã€‚ é¢„æœŸæ•ˆæœï¼š ä¸»æ¥å£å¼‚å¸¸ï¼Œæœ‰ç¼“å­˜æ•°æ®ï¼Œæ˜¾ç¤ºç¼“å­˜æ•°æ® ä¸»æ¥å£å¼‚å¸¸ï¼Œæ— ç¼“å­˜æ•°æ®ï¼Œåˆ™è¯·æ±‚å®¹ç¾æ¥å£ï¼Œæ˜¾ç¤ºå®¹ç¾å…œåº•æ•°æ® ä¸»æ¥å£ã€å®¹ç¾æ¥å£å¼‚å¸¸ï¼Œæ— ç¼“å­˜æ•°æ®ï¼Œæ˜¾ç¤ºä¿¡å¼‚å¸¸æ¯ã€åˆ·æ–°æŒ‰é’® æ¢å¤ç½‘ç»œï¼Œç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œæ˜¾ç¤ºæ­£å¸¸æ•°æ® æµ‹è¯•æµç¨‹ï¼š åœºæ™¯å®ç°ï¼š æ ¹æ®æµ‹è¯•æµç¨‹ä»¥åŠé…ç½®çš„æµ‹è¯•ç”¨ä¾‹ä¿¡æ¯ï¼Œç¼–å†™æµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹Ÿæµ‹è¯•ç”¨ä¾‹åœºæ™¯: è®¿é—®é¡µé¢ 123456const miniProgram = await automator.launch(&#123; cliPath: '/Applications/wechatwebdevtools.app/Contents/MacOS/cli', // å¼€å‘è€…å·¥å…·å‘½ä»¤è¡Œå·¥å…·ï¼ˆç»å¯¹è·¯å¾„ï¼‰ projectPath: 'jx_project', // é¡¹ç›®åœ°å€ï¼ˆç»å¯¹è·¯å¾„ï¼‰&#125;)await miniProgram.reLaunch('/pages/index/index') ç”Ÿæˆæˆªå›¾ 123await miniProgram.screenshot(&#123; path: 'jx_weapp_index_home_page_500.png'&#125;) æ¨¡æ‹Ÿå¼‚å¸¸æ•°æ® 12345678910111213141516171819202122232425262728293031323334353637383940414243const getMockData = (url, mockType, mockValue) =&gt; &#123; const result = &#123; data: 'test', cookies: [], header: &#123;&#125;, statusCode: 200, &#125; switch (mockType) &#123; case 'data': result.data = getMockResponse(url, mockValue) // ä¿®æ”¹è¿”å›æ•°æ® break case 'cookies': result.cookies = mockValue // ä¿®æ”¹è¿”å›æ•°æ® break case 'header': result.header = mockValue // ä¿®æ”¹è¿”å›å“åº”å¤´ break case 'statusCode': result.statusCode = mockValue // ä¿®æ”¹è¿”å›å“åº”å¤´ break &#125; return &#123; rule: url, result &#125; &#125; // ä¿®æ”¹æœ¬åœ°å­˜å‚¨æ•°æ® const mockValue = &#123; data: &#123; modules: [&#123; tpl:'3000', content: [] &#125;] &#125; &#125; const mockData = [ getMockData(api1, 'statusCode', 500), // æ¨¡æ‹Ÿæ¥å£è¿”å› 500 getMockData(api2, 'data', mockValue) // æ¨¡æ‹Ÿæ¥å£è¿”å›å¼‚å¸¸æ•°æ® ... ] æ‹¦æˆªæ¥å£è¯·æ±‚ï¼Œä¿®æ”¹è¿”å›æ•°æ® 123456789101112131415161718192021222324252627282930const interceptAPI = async (miniProgram, url, mockData) =&gt; &#123; try &#123; await miniProgram.mockWxMethod( 'request', function(obj, data) &#123; // å¤„ç†è¿”å›å‡½æ•° for (let i = 0, len = data.length; i &lt; len; i++) &#123; const item = data[i] // å‘½ä¸­è§„åˆ™çš„è¿”å› mockData if (obj.url.indexOf(item.rule) &gt; -1) &#123; return item.result &#125; &#125; // æ²¡å‘½ä¸­è§„åˆ™çš„çœŸå®è®¿é—®åå° return new Promise(resolve =&gt; &#123; obj.success = res =&gt; resolve(res) obj.fail = res =&gt; resolve(res) / origin æŒ‡å‘åŸå§‹æ–¹æ³• this.origin(obj) &#125;) &#125;, mockData, // ä¼ å…¥ mock æ•°æ® ) &#125; catch (e) &#123; console.error(`æ‹¦æˆªã€$&#123;url&#125;ã€‘APIæŠ¥é”™`) console.error(e) &#125; &#125;await interceptAPI(interceptAPI, url, mockData) miniProgram.mockWxMethodï¼šè¦†ç›– wx å¯¹è±¡ä¸ŠæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨ç»“æœã€‚åˆ©ç”¨è¯¥ APIï¼Œå¯ä»¥è¦†ç›– wx.request APIï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œä¿®æ”¹è¿”å›æ•°æ®ã€‚ ç›®å‰æ˜¯æœ¬åœ°å­˜å‚¨ä¸€ä»½æ¥å£è¿”å›çš„ JSON æ•°æ®ï¼Œé€šè¿‡ä¿®æ”¹æœ¬åœ°çš„ JSON æ•°æ®ç”Ÿæˆ mockDataã€‚è‹¥éœ€è¦ä¿®æ”¹æ¥å£å®æ—¶è¿”å›çš„æ•°æ®ï¼Œå¯åœ¨ obj.success ä¸­è·å–å®æ—¶æ•°æ®å¹¶ä¿®æ”¹ã€‚ æ¸…é™¤ç¼“å­˜ 123456try &#123; await miniProgram.callWxMethod('clearStorage')&#125; catch (e) &#123; await console.log(`æ¸…é™¤ç¼“å­˜æŠ¥é”™: `) await console.log(e)&#125; ç‚¹å‡»åˆ·æ–°æŒ‰é’® 123const page = await miniProgram.currentPage()const $refreshBtn = await page.$('.page-error__refresh-btn') // åŒ WXSSï¼Œä»…æ”¯æŒéƒ¨åˆ† CSS é€‰æ‹©å™¨await $refreshBtn.tap() å–æ¶ˆæ‹¦æˆªï¼Œæ¢å¤ç½‘ç»œ 12345678910const cancelInterceptAPI = async (miniProgram) =&gt; &#123; try &#123; await miniProgram.restoreWxMethod('request') // é‡ç½® wx.request ï¼Œæ¶ˆé™¤ mockWxMethod è°ƒç”¨çš„å½±å“ã€‚ &#125; catch (e) &#123; console.error(`å–æ¶ˆæ‹¦æˆªã€$&#123;url&#125;ã€‘APIæŠ¥é”™`) console.error(e) &#125;&#125;await cancelInterceptAPI(miniProgram) å¯åŠ¨è‡ªåŠ¨åŒ–æµ‹è¯•ç”±äºç¬¬ä¸€é˜¶æ®µçš„æµ‹è¯•å·¥å…·å°šæœªå¹³å°åŒ–ï¼Œå…ˆé€šè¿‡åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤è¡Œï¼Œè¿è¡Œè„šæœ¬çš„æ–¹å¼ï¼Œå¯åŠ¨è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ åœ¨é¡¹ç›®çš„ package.json æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ scripts å­—æ®µå®šä¹‰è„šæœ¬å‘½ä»¤ï¼š 123\"scripts\": &#123; \"start\": \"node pages/index/index.js\" &#125;, è¿è¡Œç¯å¢ƒï¼š å®‰è£… Node.js å¹¶ä¸”ç‰ˆæœ¬å¤§äº 8.0 åŸºç¡€åº“ç‰ˆæœ¬ä¸º 2.7.3 åŠä»¥ä¸Š å¼€å‘è€…å·¥å…·ç‰ˆæœ¬ä¸º 1.02.1907232 åŠä»¥ä¸Š è¿è¡Œï¼š åœ¨ç»ˆç«¯åˆ‡å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•è·¯å¾„ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤è¡Œï¼Œå°±å¯ä»¥å¯åŠ¨æµ‹è¯•å·¥å…·ï¼Œè¿è¡Œæµ‹è¯•è„šæœ¬ã€‚ 1$ npm run start æµ‹è¯•ç»“æœäººå·¥æ¯”å¯¹æˆªå›¾ç»“æœï¼š è¿è¡Œè„šæœ¬ç¤ºä¾‹ï¼š ä½¿ç”¨ SDKï¼Œä½ å¿…é¡»çŸ¥é“ Shadow DOMå½“æˆ‘ä»¬æƒ³æ§åˆ¶å°ç¨‹åºé¡µé¢æ—¶ï¼Œéœ€è·å–é¡µé¢å®ä¾‹ pageï¼Œåˆ©ç”¨ page æä¾›çš„æ–¹æ³•æ§åˆ¶é¡µé¢å†…çš„å…ƒç´ ã€‚ æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬æƒ³ç‚¹å‡»é¡µé¢ä¸­æœç´¢æ¡†æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆåšï¼š123const page = await miniProgram.currentPage()const $searchBar = await page.$('search-bar')await $searchBar.tap() ä½†è¿™æ ·çœŸçš„å¯è¡Œå—ï¼Ÿç­”æ¡ˆæ˜¯ï¼š è¯•è¯•å°±çŸ¥é“äº†ã€‚ è¿è¡Œè¿™æ®µæµ‹è¯•è„šæœ¬åç”Ÿæˆçš„æˆªå›¾ï¼š æˆ‘ä»¬å¾—åˆ°çš„ç»“æœæ˜¯ï¼šæ ¹æœ¬æ²¡æœ‰è§¦å‘ç‚¹å‡»äº‹ä»¶ã€‚ Shadow DOMï¼š å®ƒæ˜¯ HTML çš„ä¸€ä¸ªè§„èŒƒï¼Œå®ƒå…è®¸åœ¨æ–‡æ¡£( document )æ¸²æŸ“æ—¶æ’å…¥ä¸€é¢—DOMå…ƒç´ å­æ ‘ï¼Œä½†æ˜¯è¿™ä¸ªå­æ ‘ä¸åœ¨ä¸» DOM æ ‘ä¸­ã€‚ å®ƒå…è®¸æµè§ˆå™¨å¼€å‘è€…å°è£…è‡ªå·±çš„ HTML æ ‡ç­¾ã€css æ ·å¼å’Œç‰¹å®šçš„ javascript ä»£ç ã€åŒæ—¶å¼€å‘äººå‘˜ä¹Ÿå¯ä»¥åˆ›å»ºç±»ä¼¼ &lt;input&gt;ã€&lt;video&gt;ã€&lt;audio&gt; ç­‰ã€è¿™æ ·çš„è‡ªå®šä¹‰çš„ä¸€çº§æ ‡ç­¾ã€‚åˆ›å»ºè¿™äº›æ ‡ç­¾å†…å®¹ç›¸å…³çš„ APIï¼Œå¯ä»¥è¢«å«åš Web Componentã€‚ Shadow DOM çš„å…³é”®æ‰€åœ¨ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªéšè—çš„ã€ç‹¬ç«‹çš„ DOM é™„åŠ åˆ°ä¸€ä¸ªå…ƒç´ ä¸Šã€‚ Shadow host: ä¸€ä¸ªå¸¸è§„ DOM èŠ‚ç‚¹ï¼ŒShadow DOM ä¼šè¢«é™„åŠ åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯ Shadow DOM çš„ä¸€ä¸ªå®¿ä¸»å…ƒç´ ã€‚æ¯”å¦‚ï¼š&lt;input /&gt;ã€&lt;audio&gt;ã€&lt;video&gt; æ ‡ç­¾ï¼Œå°±æ˜¯ Shadow DOM çš„å®¿ä¸»å…ƒç´ ã€‚ Shadow tree: Shadow DOM å†…éƒ¨çš„ DOM æ ‘ã€‚ Shadow root: Shadow DOM çš„æ ¹èŠ‚ç‚¹ã€‚é€šè¿‡ createShadowRoot è¿”å›çš„æ–‡æ¡£ç‰‡æ®µè¢«ç§°ä¸º shadow-root , å®ƒå’Œå®ƒçš„åä»£å…ƒç´ ï¼Œéƒ½ä¼šå¯¹ç”¨æˆ·éšè—ã€‚ å›åˆ°æˆ‘ä»¬åˆšåˆšçš„é—®é¢˜ï¼š ç”±äºå°ç¨‹åºä½¿ç”¨äº† Shadow DOMï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ç›´æ¥é€šè¿‡ page å®ä¾‹è·å–åˆ°æœç´¢æ¡†çœŸå® DOMã€‚æˆ‘ä»¬çœ‹åˆ°çš„é¡µé¢ä¸­æ¸²æŸ“çš„æœç´¢æ¡†ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ª Shadow DOMã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆè·å–åˆ°æœç´¢æ¡† Shadow DOM çš„å®¿ä¸»å…ƒç´ ï¼Œå¹¶é€šè¿‡å®¿ä¸»å…ƒç´ è·å–åˆ°æœç´¢æ¡†çœŸå®çš„ DOMï¼Œæœ€åè§¦å‘çœŸå® DOM çš„ç‚¹å‡»äº‹ä»¶ã€‚ 1234const page = await miniProgram.currentPage()const $searchBarShadow = await page.$('search-bar')const $searchBar = await $searchBarShadow.$('.search-bar')const &#123; height &#125; = await $searchBar.size() è¿è¡Œè¿™æ®µæµ‹è¯•è„šæœ¬åç”Ÿæˆçš„æˆªå›¾ï¼š ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œè§¦å‘äº†æœç´¢æ¡†çš„ç‚¹å‡»äº‹ä»¶ã€‚ æ›´å¤šæµ‹è¯•åœºæ™¯å®ç°1. ä¸‹æ‹‰åˆ·æ–°12345678const pullDownRefresh = async (miniProgram) =&gt; &#123; try &#123; await miniProgram.callWxMethod('startPullDownRefresh') &#125; catch (e) &#123; console.error('ä¸‹æ‹‰åˆ·æ–°æ“ä½œå¤±è´¥') console.error(e) &#125;&#125; 2. æ»šåŠ¨åˆ°æŒ‡å®š DOM 12345const page = await miniProgram.currentPage() // è·å–é¡µé¢å®ä¾‹const $recommendTabShadow = await page.$('recommend-tab') // è·å–Shadow DOMconst $recommendTab = await $recommendTabShadow.$('.recommend') // è·å–çœŸå® DOMconst &#123; top &#125; = await $recommendTab.offset() // è·å–DOM å®šä½await miniProgram.pageScrollTo(top) // æ»šåŠ¨åˆ°æŒ‡å®šDOM 3. äº‹ä»¶ æ—¥å¿—æ‰“å°ï¼› ç›‘å¬é¡µé¢å´©æºƒäº‹ä»¶ 12345678910// æ—¥å¿—æ‰“å°æ—¶è§¦å‘miniProgram.on('console', msg =&gt; &#123; console.log(msg.type, msg.args) &#125;)&#125;)// é¡µé¢ JS å‡ºé”™æ—¶è§¦å‘page.on('error', (e) =&gt; &#123; console.log(e)&#125;) ç»“è¯­ç¬¬ä¸€é˜¶æ®µçš„å°ç¨‹åºè‡ªåŠ¨åŒ–æµ‹è¯•ä¹‹è·¯å‘Šä¸€æ®µè½ã€‚å’Œ H5 è‡ªåŠ¨åŒ–æµ‹è¯•ä¸€æ ·ï¼Œå®¹ç¾æ¼”ä¹ å·²å®ç°äº†åŠè‡ªåŠ¨åŒ–ï¼Œå¯é€šè¿‡åœ¨ç»ˆç«¯è¿è¡Œæµ‹è¯•è„šæœ¬ï¼Œæ¨¡æ‹Ÿå¼‚å¸¸åœºæ™¯è‡ªåŠ¨ç”Ÿæˆæˆªå›¾ï¼Œå†é…åˆäººå·¥æ¯”å¯¹æˆªå›¾æ“ä½œï¼Œåˆ¤æ–­æ¼”ä¹ ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ç›®å‰å·²æŠ•å…¥åˆ°æ¯ä¸ªæœˆçš„å®¹ç¾æ¼”ä¹ ä¸­ä½¿ç”¨ã€‚ ç”±äº H5 å’Œå°ç¨‹åºçš„å·®å¼‚æ¯”è¾ƒå¤§ï¼Œç¬¬ä¸€é˜¶æ®µçš„è‡ªåŠ¨åŒ–æµ‹è¯•åˆ†ä¸¤ç«¯è¿›è¡Œï¼Œæµ‹è¯•è„šæœ¬è¯­æ³•ä¹Ÿæ˜¯æˆªç„¶ä¸åŒï¼Œéœ€è¦åŒæ—¶ç»´æŠ¤ä¸¤å¥—æµ‹è¯•å·¥å…·ã€‚ä¸ºäº†é™ä½ç»´æŠ¤æˆæœ¬ï¼Œæå‡æµ‹è¯•è„šæœ¬çš„å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”å‘ç¬¬äºŒé˜¶æ®µçš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œä¸€å¥—ä»£ç æ”¯æŒä¸¤ç«¯æµ‹è¯•ï¼Œç›®å‰å·²ç»è¿›å…¥å†…æµ‹é˜¶æ®µã€‚æ›´å¤šå½©è›‹ï¼Œæ•¬è¯·æœŸå¾…ç¬¬äºŒé˜¶æ®µè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·â€”â€”å¤šç«¯è‡ªåŠ¨åŒ–æµ‹è¯• SDK ã€‚","pubDate":"Mon, 13 Jul 2020 09:58:08 GMT","guid":"https://aotu.io/notes/2020/07/13/jx-automated-testing-weapp/","category":"å°ç¨‹åº"},{"title":"Taro 3 æ­£å¼ç‰ˆå‘å¸ƒï¼šå¼€æ”¾å¼è·¨ç«¯è·¨æ¡†æ¶è§£å†³æ–¹æ¡ˆ","link":"https://aotu.io/notes/2020/06/30/taro-3-0-0/","description":"Taro 3 æ­£å¼ç‰ˆå‘å¸ƒï¼šå¼€æ”¾å¼è·¨ç«¯è·¨æ¡†æ¶è§£å†³æ–¹æ¡ˆä» Taro ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒåˆ°ç°åœ¨ï¼ŒTaro å·²ç»æ¥å—äº†æ¥è‡ªäºå¼€æºç¤¾åŒºä¸¤å¹´å¤šçš„è€ƒéªŒã€‚ä»Šå¤©æˆ‘ä»¬å¾ˆé«˜å…´åœ°åœ¨å…šçš„ç”Ÿæ—¥å‘å¸ƒ Taro 3ï¼ˆTaro Nextï¼‰æ­£å¼ç‰ˆï¼Œå¸Œæœ› Taro æœªæ¥çš„æ›´å¤šä¸¤å¹´èƒ½åƒä¸€åå…±äº§ä¸»ä¹‰æˆ˜å£«ä¸€æ ·ç»å—ä½æ›´å¤šçš„è€ƒéªŒã€‚ä»¥ä¸‹æ˜¯ Taro 3 çš„ä¸€äº›æ–°å¢ç‰¹æ€§ï¼š","pubDate":"Tue, 30 Jun 2020 16:00:00 GMT","guid":"https://aotu.io/notes/2020/06/30/taro-3-0-0/","category":"å°ç¨‹åº"},{"title":"æ‰‹æŠŠæ‰‹æ•™ä½ å†™ä¸ªå°ç¨‹åºå®šæ—¶å™¨ç®¡ç†åº“","link":"https://aotu.io/notes/2020/06/22/timer-miniprogram/","description":"èƒŒæ™¯å‡¹å‡¸æ›¼æ˜¯ä¸ªå°ç¨‹åºå¼€å‘è€…ï¼Œä»–è¦åœ¨å°ç¨‹åºå®ç°ç§’æ€å€’è®¡æ—¶ã€‚äºæ˜¯ä»–ä¸å‡æ€ç´¢ï¼Œå†™äº†ä»¥ä¸‹ä»£ç ï¼š 123456789Page(&#123; init: function () &#123; clearInterval(this.timer) this.timer = setInterval(() =&gt; &#123; // å€’è®¡æ—¶è®¡ç®—é€»è¾‘ console.log('setInterval') &#125;) &#125;,&#125;) å¯æ˜¯ï¼Œå‡¹å‡¸æ›¼å‘ç°é¡µé¢éšè—åœ¨åå°æ—¶ï¼Œå®šæ—¶å™¨è¿˜åœ¨ä¸æ–­è¿è¡Œã€‚äºæ˜¯å‡¹å‡¸æ›¼ä¼˜åŒ–äº†ä¸€ä¸‹ï¼Œåœ¨é¡µé¢å±•ç¤ºçš„æ—¶å€™è¿è¡Œï¼Œéšè—çš„æ—¶å€™å°±æš‚åœã€‚ 1234567891011121314151617181920Page(&#123; onShow: function () &#123; if (this.timer) &#123; this.timer = setInterval(() =&gt; &#123; // å€’è®¡æ—¶è®¡ç®—é€»è¾‘ console.log('setInterval') &#125;) &#125; &#125;, onHide: function () &#123; clearInterval(this.timer) &#125;, init: function () &#123; clearInterval(this.timer) this.timer = setInterval(() =&gt; &#123; // å€’è®¡æ—¶è®¡ç®—é€»è¾‘ console.log('setInterval') &#125;) &#125;,&#125;) é—®é¢˜çœ‹èµ·æ¥å·²ç»è§£å†³äº†ï¼Œå°±åœ¨å‡¹å‡¸æ›¼å¼€å¿ƒåœ°æ“æ“å°æ‰‹æš—æš—æ¬¢å–œæ—¶ï¼Œçªç„¶å‘ç°å°ç¨‹åºé¡µé¢é”€æ¯æ—¶æ˜¯ä¸ä¸€å®šä¼šè°ƒç”¨ onHide å‡½æ•°çš„ï¼Œè¿™æ ·å®šæ—¶å™¨ä¸å°±æ²¡æ³•æ¸…ç†äº†ï¼Ÿé‚£å¯æ˜¯ä¼šé€ æˆå†…å­˜æ³„æ¼çš„ã€‚å‡¹å‡¸æ›¼æƒ³äº†æƒ³ï¼Œå…¶å®é—®é¢˜ä¸éš¾è§£å†³ï¼Œåœ¨é¡µé¢ onUnload çš„æ—¶å€™ä¹Ÿæ¸…ç†ä¸€éå®šæ—¶å™¨å°±å¯ä»¥äº†ã€‚ 123456Page(&#123; ... onUnload: function () &#123; clearInterval(this.timer) &#125;,&#125;) è¿™ä¸‹é—®é¢˜éƒ½è§£å†³äº†ï¼Œä½†æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨å°ç¨‹åºä½¿ç”¨å®šæ—¶å™¨éœ€è¦å¾ˆè°¨æ…ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚åå°çš„å®šæ—¶å™¨ç§¯ç´¯å¾—è¶Šå¤šï¼Œå°ç¨‹åºå°±è¶Šå¡ï¼Œè€—ç”µé‡ä¹Ÿè¶Šå¤§ï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå¡æ­»ç”šè‡³å´©æºƒã€‚ç‰¹åˆ«æ˜¯å›¢é˜Ÿå¼€å‘çš„é¡¹ç›®ï¼Œå¾ˆéš¾ç¡®ä¿æ¯ä¸ªæˆå‘˜éƒ½æ­£ç¡®æ¸…ç†äº†å®šæ—¶å™¨ã€‚å› æ­¤ï¼Œå†™ä¸€ä¸ªå®šæ—¶å™¨ç®¡ç†åº“æ¥ç®¡ç†å®šæ—¶å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°†å¤§æœ‰è£¨ç›Šã€‚ æ€è·¯æ•´ç†é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè®¾è®¡å®šæ—¶å™¨çš„ API è§„èŒƒï¼Œè‚¯å®šæ˜¯è¶Šæ¥è¿‘åŸç”Ÿ API è¶Šå¥½ï¼Œè¿™æ ·å¼€å‘è€…å¯ä»¥æ— ç—›æ›¿æ¢ã€‚ 1234function $setTimeout(fn, timeout, ...arg) &#123;&#125;function $setInterval(fn, timeout, ...arg) &#123;&#125;function $clearTimeout(id) &#123;&#125;function $clearInterval(id) &#123;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬ä¸»è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ å¦‚ä½•å®ç°å®šæ—¶å™¨æš‚åœå’Œæ¢å¤ å¦‚ä½•è®©å¼€å‘è€…æ— é¡»åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤„ç†å®šæ—¶å™¨ å¦‚ä½•å®ç°å®šæ—¶å™¨æš‚åœå’Œæ¢å¤æ€è·¯å¦‚ä¸‹: å°†å®šæ—¶å™¨å‡½æ•°å‚æ•°ä¿å­˜ï¼Œæ¢å¤å®šæ—¶å™¨æ—¶é‡æ–°åˆ›å»º ç”±äºé‡æ–°åˆ›å»ºå®šæ—¶å™¨ï¼Œå®šæ—¶å™¨ ID ä¼šä¸åŒï¼Œå› æ­¤éœ€è¦è‡ªå®šä¹‰å…¨å±€å”¯ä¸€ ID æ¥æ ‡è¯†å®šæ—¶å™¨ éšè—æ—¶è®°å½•å®šæ—¶å™¨å‰©ä½™å€’è®¡æ—¶æ—¶é—´ï¼Œæ¢å¤æ—¶ä½¿ç”¨å‰©ä½™æ—¶é—´é‡æ–°åˆ›å»ºå®šæ—¶å™¨ é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª Timer ç±»ï¼ŒTimer å¯¹è±¡ä¼šå­˜å‚¨å®šæ—¶å™¨å‡½æ•°å‚æ•°ï¼Œä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324class Timer &#123; static count = 0 /** * æ„é€ å‡½æ•° * @param &#123;Boolean&#125; isInterval æ˜¯å¦æ˜¯ setInterval * @param &#123;Function&#125; fn å›è°ƒå‡½æ•° * @param &#123;Number&#125; timeout å®šæ—¶å™¨æ‰§è¡Œæ—¶é—´é—´éš” * @param &#123;...any&#125; arg å®šæ—¶å™¨å…¶ä»–å‚æ•° */ constructor (isInterval = false, fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; this.id = ++Timer.count // å®šæ—¶å™¨é€’å¢ id this.fn = fn this.timeout = timeout this.restTime = timeout // å®šæ—¶å™¨å‰©ä½™è®¡æ—¶æ—¶é—´ this.isInterval = isInterval this.arg = arg &#125; &#125; // åˆ›å»ºå®šæ—¶å™¨ function $setTimeout(fn, timeout, ...arg) &#123; const timer = new Timer(false, fn, timeout, arg) return timer.id &#125; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç°å®šæ—¶å™¨çš„æš‚åœå’Œæ¢å¤ï¼Œå®ç°æ€è·¯å¦‚ä¸‹ï¼š å¯åŠ¨å®šæ—¶å™¨ï¼Œè°ƒç”¨åŸç”Ÿ API åˆ›å»ºå®šæ—¶å™¨å¹¶è®°å½•ä¸‹å¼€å§‹è®¡æ—¶æ—¶é—´æˆ³ã€‚ æš‚åœå®šæ—¶å™¨ï¼Œæ¸…é™¤å®šæ—¶å™¨å¹¶è®¡ç®—è¯¥å‘¨æœŸè®¡æ—¶å‰©ä½™æ—¶é—´ã€‚ æ¢å¤å®šæ—¶å™¨ï¼Œé‡æ–°è®°å½•å¼€å§‹è®¡æ—¶æ—¶é—´æˆ³ï¼Œå¹¶ä½¿ç”¨å‰©ä½™æ—¶é—´åˆ›å»ºå®šæ—¶å™¨ã€‚ ä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344class Timer &#123; constructor (isInterval = false, fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; this.id = ++Timer.count // å®šæ—¶å™¨é€’å¢ id this.fn = fn this.timeout = timeout this.restTime = timeout // å®šæ—¶å™¨å‰©ä½™è®¡æ—¶æ—¶é—´ this.isInterval = isInterval this.arg = arg &#125; /** * å¯åŠ¨æˆ–æ¢å¤å®šæ—¶å™¨ */ start() &#123; this.startTime = +new Date() if (this.isInterval) &#123; /* setInterval */ const cb = (...arg) =&gt; &#123; this.fn(...arg) /* timerId ä¸ºç©ºè¡¨ç¤ºè¢« clearInterval */ if (this.timerId) this.timerId = setTimeout(cb, this.timeout, ...this.arg) &#125; this.timerId = setTimeout(cb, this.restTime, ...this.arg) return &#125; /* setTimeout */ const cb = (...arg) =&gt; &#123; this.fn(...arg) &#125; this.timerId = setTimeout(cb, this.restTime, ...this.arg) &#125; /* æš‚åœå®šæ—¶å™¨ */ suspend () &#123; if (this.timeout &gt; 0) &#123; const now = +new Date() const nextRestTime = this.restTime - (now - this.startTime) const intervalRestTime = nextRestTime &gt;=0 ? nextRestTime : this.timeout - (Math.abs(nextRestTime) % this.timeout) this.restTime = this.isInterval ? intervalRestTime : nextRestTime &#125; clearTimeout(this.timerId) &#125;&#125; å…¶ä¸­ï¼Œæœ‰å‡ ä¸ªå…³é”®ç‚¹éœ€è¦æç¤ºä¸€ä¸‹ï¼š æ¢å¤å®šæ—¶å™¨æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯é‡æ–°åˆ›å»ºäº†ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœç›´æ¥ç”¨ setTimeout è¿”å›çš„ ID è¿”å›ç»™å¼€å‘è€…ï¼Œå¼€å‘è€…è¦ clearTimeoutï¼Œè¿™æ—¶å€™æ˜¯æ¸…é™¤ä¸äº†çš„ã€‚å› æ­¤éœ€è¦åœ¨åˆ›å»º Timer å¯¹è±¡æ—¶å†…éƒ¨å®šä¹‰ä¸€ä¸ªå…¨å±€å”¯ä¸€ ID this.id = ++Timer.countï¼Œå°†è¯¥ ID è¿”å›ç»™ å¼€å‘è€…ã€‚å¼€å‘è€… clearTimeout æ—¶ï¼Œæˆ‘ä»¬å†æ ¹æ®è¯¥ ID å»æŸ¥æ‰¾çœŸå®çš„å®šæ—¶å™¨ ID (this.timerId)ã€‚ è®¡æ—¶å‰©ä½™æ—¶é—´ï¼Œtimeout = 0 æ—¶ä¸å¿…è®¡ç®—ï¼›timeout &gt; 0 æ—¶ï¼Œéœ€è¦åŒºåˆ†æ˜¯ setInterval è¿˜æ˜¯ setTimeoutï¼ŒsetInterval å› ä¸ºæœ‰å‘¨æœŸå¾ªç¯ï¼Œå› æ­¤éœ€è¦å¯¹æ—¶é—´é—´éš”è¿›è¡Œå–ä½™ã€‚ setInterval é€šè¿‡åœ¨å›è°ƒå‡½æ•°æœ«å°¾è°ƒç”¨ setTimeout å®ç°ï¼Œæ¸…é™¤å®šæ—¶å™¨æ—¶ï¼Œè¦åœ¨å®šæ—¶å™¨å¢åŠ ä¸€ä¸ªæ ‡ç¤ºä½ï¼ˆthis.timeId = â€œâ€ï¼‰è¡¨ç¤ºè¢«æ¸…é™¤ï¼Œé˜²æ­¢æ­»å¾ªç¯ã€‚ æˆ‘ä»¬é€šè¿‡å®ç° Timer ç±»å®Œæˆäº†å®šæ—¶å™¨çš„æš‚åœå’Œæ¢å¤åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å°†å®šæ—¶å™¨çš„æš‚åœå’Œæ¢å¤åŠŸèƒ½è·Ÿç»„ä»¶æˆ–é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸç»“åˆèµ·æ¥ï¼Œæœ€å¥½æ˜¯æŠ½ç¦»æˆå…¬å…±å¯å¤ç”¨çš„ä»£ç ï¼Œè®©å¼€å‘è€…æ— é¡»åœ¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°å¤„ç†å®šæ—¶å™¨ã€‚ç¿»é˜…å°ç¨‹åºå®˜æ–¹æ–‡æ¡£ï¼Œå‘ç° Behavior æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ Behaviorbehaviors æ˜¯ç”¨äºç»„ä»¶é—´ä»£ç å…±äº«çš„ç‰¹æ€§ï¼Œç±»ä¼¼äºä¸€äº›ç¼–ç¨‹è¯­è¨€ä¸­çš„ â€œmixinsâ€ æˆ– â€œtraitsâ€ã€‚æ¯ä¸ª behavior å¯ä»¥åŒ…å«ä¸€ç»„å±æ€§ã€æ•°æ®ã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°å’Œæ–¹æ³•ï¼Œç»„ä»¶å¼•ç”¨å®ƒæ—¶ï¼Œå®ƒçš„å±æ€§ã€æ•°æ®å’Œæ–¹æ³•ä¼šè¢«åˆå¹¶åˆ°ç»„ä»¶ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¹Ÿä¼šåœ¨å¯¹åº”æ—¶æœºè¢«è°ƒç”¨ã€‚æ¯ä¸ªç»„ä»¶å¯ä»¥å¼•ç”¨å¤šä¸ª behaviorï¼Œbehavior ä¹Ÿå¯ä»¥å¼•ç”¨å…¶ä»– behavior ã€‚ 123456789101112131415161718192021222324// behavior.js å®šä¹‰behaviorconst TimerBehavior = Behavior(&#123; pageLifetimes: &#123; show () &#123; console.log('show') &#125;, hide () &#123; console.log('hide') &#125; &#125;, created: function () &#123; console.log('created')&#125;, detached: function() &#123; console.log('detached') &#125;&#125;)export &#123; TimerBehavior &#125;// component.js ä½¿ç”¨ behaviorimport &#123; TimerBehavior &#125; from '../behavior.js'Component(&#123; behaviors: [TimerBehavior], created: function () &#123; console.log('[my-component] created') &#125;, attached: function () &#123; console.log('[my-component] attached') &#125;&#125;) å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œç»„ä»¶ä½¿ç”¨ TimerBehavior åï¼Œç»„ä»¶åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šä¾æ¬¡è°ƒç”¨ TimerBehavior.created() =&gt; Component.created() =&gt; TimerBehavior.show()ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ TimerBehavior ç”Ÿå‘½å‘¨æœŸå†…è°ƒç”¨ Timer å¯¹åº”çš„æ–¹æ³•ï¼Œå¹¶å¼€æ”¾å®šæ—¶å™¨çš„åˆ›å»ºé”€æ¯ API ç»™å¼€å‘è€…å³å¯ã€‚æ€è·¯å¦‚ä¸‹ï¼š ç»„ä»¶æˆ–é¡µé¢åˆ›å»ºæ—¶ï¼Œæ–°å»º Map å¯¹è±¡æ¥å­˜å‚¨è¯¥ç»„ä»¶æˆ–é¡µé¢çš„å®šæ—¶å™¨ã€‚ åˆ›å»ºå®šæ—¶å™¨æ—¶ï¼Œå°† Timer å¯¹è±¡ä¿å­˜åœ¨ Map ä¸­ã€‚ å®šæ—¶å™¨è¿è¡Œç»“æŸæˆ–æ¸…é™¤å®šæ—¶å™¨æ—¶ï¼Œå°† Timer å¯¹è±¡ä» Map ç§»é™¤ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚ é¡µé¢éšè—æ—¶å°† Map ä¸­çš„å®šæ—¶å™¨æš‚åœï¼Œé¡µé¢é‡æ–°å±•ç¤ºæ—¶æ¢å¤ Map ä¸­çš„å®šæ—¶å™¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556const TimerBehavior = Behavior(&#123; created: function () &#123; this.$store = new Map() this.$isActive = true &#125;, detached: function() &#123; this.$store.forEach(timer =&gt; timer.suspend()) this.$isActive = false &#125;, pageLifetimes: &#123; show () &#123; if (this.$isActive) return this.$isActive = true this.$store.forEach(timer =&gt; timer.start(this.$store)) &#125;, hide () &#123; this.$store.forEach(timer =&gt; timer.suspend()) this.$isActive = false &#125; &#125;, methods: &#123; $setTimeout (fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; const timer = new Timer(false, fn, timeout, ...arg) this.$store.set(timer.id, timer) this.$isActive &amp;&amp; timer.start(this.$store) return timer.id &#125;, $setInterval (fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; const timer = new Timer(true, fn, timeout, ...arg) this.$store.set(timer.id, timer) this.$isActive &amp;&amp; timer.start(this.$store) return timer.id &#125;, $clearInterval (id) &#123; const timer = this.$store.get(id) if (!timer) return clearTimeout(timer.timerId) timer.timerId = '' this.$store.delete(id) &#125;, $clearTimeout (id) &#123; const timer = this.$store.get(id) if (!timer) return clearTimeout(timer.timerId) timer.timerId = '' this.$store.delete(id) &#125;, &#125;&#125;) ä¸Šé¢çš„ä»£ç æœ‰è®¸å¤šå†—ä½™çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥å†ä¼˜åŒ–ä¸€ä¸‹ï¼Œå•ç‹¬å®šä¹‰ä¸€ä¸ª TimerStore ç±»æ¥ç®¡ç†ç»„ä»¶æˆ–é¡µé¢å®šæ—¶å™¨çš„æ·»åŠ ã€åˆ é™¤ã€æ¢å¤ã€æš‚åœåŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132333435class TimerStore &#123; constructor() &#123; this.store = new Map() this.isActive = true &#125; addTimer(timer) &#123; this.store.set(timer.id, timer) this.isActive &amp;&amp; timer.start(this.store) return timer.id &#125; show() &#123; /* æ²¡æœ‰éšè—ï¼Œä¸éœ€è¦æ¢å¤å®šæ—¶å™¨ */ if (this.isActive) return this.isActive = true this.store.forEach(timer =&gt; timer.start(this.store)) &#125; hide() &#123; this.store.forEach(timer =&gt; timer.suspend()) this.isActive = false &#125; clear(id) &#123; const timer = this.store.get(id) if (!timer) return clearTimeout(timer.timerId) timer.timerId = '' this.store.delete(id) &#125;&#125; ç„¶åå†ç®€åŒ–ä¸€é TimerBehavior 1234567891011121314151617181920212223242526const TimerBehavior = Behavior(&#123; created: function () &#123; this.$timerStore = new TimerStore() &#125;, detached: function() &#123; this.$timerStore.hide() &#125;, pageLifetimes: &#123; show () &#123; this.$timerStore.show() &#125;, hide () &#123; this.$timerStore.hide() &#125; &#125;, methods: &#123; $setTimeout (fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; const timer = new Timer(false, fn, timeout, ...arg) return this.$timerStore.addTimer(timer) &#125;, $setInterval (fn = () =&gt; &#123;&#125;, timeout = 0, ...arg) &#123; const timer = new Timer(true, fn, timeout, ...arg) return this.$timerStore.addTimer(timer) &#125;, $clearInterval (id) &#123; this.$timerStore.clear(id) &#125;, $clearTimeout (id) &#123; this.$timerStore.clear(id) &#125;, &#125;&#125;) æ­¤å¤–ï¼ŒsetTimeout åˆ›å»ºçš„å®šæ—¶å™¨è¿è¡Œç»“æŸåï¼Œä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼Œæˆ‘ä»¬éœ€è¦å°†å®šæ—¶å™¨ä» Map ä¸­ç§»é™¤ã€‚ç¨å¾®ä¿®æ”¹ä¸‹ Timer çš„ start å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324class Timer &#123; // çœç•¥è‹¥å¹²ä»£ç  start(timerStore) &#123; this.startTime = +new Date() if (this.isInterval) &#123; /* setInterval */ const cb = (...arg) =&gt; &#123; this.fn(...arg) /* timerId ä¸ºç©ºè¡¨ç¤ºè¢« clearInterval */ if (this.timerId) this.timerId = setTimeout(cb, this.timeout, ...this.arg) &#125; this.timerId = setTimeout(cb, this.restTime, ...this.arg) return &#125; /* setTimeout */ const cb = (...arg) =&gt; &#123; this.fn(...arg) /* è¿è¡Œç»“æŸï¼Œç§»é™¤å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ */ timerStore.delete(this.id) &#125; this.timerId = setTimeout(cb, this.restTime, ...this.arg) &#125;&#125; æ„‰å¿«åœ°ä½¿ç”¨ä»æ­¤ï¼ŒæŠŠæ¸…é™¤å®šæ—¶å™¨çš„å·¥ä½œäº¤ç»™ TimerBehavior ç®¡ç†ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒå°ç¨‹åºè¶Šæ¥è¶Šå¡ã€‚ 123456789101112131415161718192021222324252627import &#123; TimerBehavior &#125; from '../behavior.js'// åœ¨é¡µé¢ä¸­ä½¿ç”¨Page(&#123; behaviors: [TimerBehavior], onReady() &#123; this.$setTimeout(() =&gt; &#123; console.log('setTimeout') &#125;) this.$setInterval(() =&gt; &#123; console.log('setTimeout') &#125;) &#125;&#125;)// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨Components(&#123; behaviors: [TimerBehavior], ready() &#123; this.$setTimeout(() =&gt; &#123; console.log('setTimeout') &#125;) this.$setInterval(() =&gt; &#123; console.log('setTimeout') &#125;) &#125;&#125;) npm åŒ…æ”¯æŒä¸ºäº†è®©å¼€å‘è€…æ›´å¥½åœ°ä½¿ç”¨å°ç¨‹åºå®šæ—¶å™¨ç®¡ç†åº“ï¼Œæˆ‘ä»¬æ•´ç†äº†ä»£ç å¹¶å‘å¸ƒäº† npm åŒ…ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ npm install --save timer-miniprogram å®‰è£…å°ç¨‹åºå®šæ—¶å™¨ç®¡ç†åº“ï¼Œæ–‡æ¡£åŠå®Œæ•´ä»£ç è¯¦çœ‹ https://github.com/o2team/timer-miniprogram eslint é…ç½®ä¸ºäº†è®©å›¢é˜Ÿæ›´å¥½åœ°éµå®ˆå®šæ—¶å™¨ä½¿ç”¨è§„èŒƒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é…ç½® eslint å¢åŠ ä»£ç æç¤ºï¼Œé…ç½®å¦‚ä¸‹ï¼š 123456789101112131415161718// .eslintrc.jsmodule.exports = &#123; 'rules': &#123; 'no-restricted-globals': ['error', &#123; 'name': 'setTimeout', 'message': 'Please use TimerBehavior and this.$setTimeout instead. see the link: https://github.com/o2team/timer-miniprogram' &#125;, &#123; 'name': 'setInterval', 'message': 'Please use TimerBehavior and this.$setInterval instead. see the link: https://github.com/o2team/timer-miniprogram' &#125;, &#123; 'name': 'clearInterval', 'message': 'Please use TimerBehavior and this.$clearInterval instead. see the link: https://github.com/o2team/timer-miniprogram' &#125;, &#123; 'name': 'clearTimout', 'message': 'Please use TimerBehavior and this.$clearTimout instead. see the link: https://github.com/o2team/timer-miniprogram' &#125;] &#125;&#125; æ€»ç»“åƒé‡Œä¹‹å ¤ï¼Œæºƒäºèšç©´ã€‚ ç®¡ç†ä¸å½“çš„å®šæ—¶å™¨ï¼Œå°†ä¸€ç‚¹ç‚¹æ¦¨å¹²å°ç¨‹åºçš„å†…å­˜å’Œæ€§èƒ½ï¼Œæœ€ç»ˆè®©ç¨‹åºå´©æºƒã€‚ é‡è§†å®šæ—¶å™¨ç®¡ç†ï¼Œè¿œç¦»å®šæ—¶å™¨æ³„éœ²ã€‚ å‚è€ƒå°ç¨‹åºå¼€å‘è€…æ–‡æ¡£","pubDate":"Mon, 22 Jun 2020 04:00:00 GMT","guid":"https://aotu.io/notes/2020/06/22/timer-miniprogram/","category":"Webå¼€å‘"},{"title":"å›¾å½¢å¤„ç†ï¼šç»™ Canvas æ–‡æœ¬å¡«å……çº¿æ€§æ¸å˜","link":"https://aotu.io/notes/2020/06/22/linearGradient/","description":"åœ¨ Canvas ä¸­å¯¹æ–‡æœ¬å¡«å……æ°´å¹³æˆ–å‚ç›´çš„çº¿æ€§æ¸å˜å¯ä»¥è½»æ˜“å®ç°ï¼Œè€Œå¸¦è§’åº¦çš„æ¸å˜å°±å¤æ‚å¾ˆå¤šï¼›å°±å¥½åƒä¸‹é¢è¿™æ ·ï¼Œå‡è®¾æ–‡æœ¬çŸ©å½¢å®½ä¸º W, é«˜ä¸º H, å·¦ä¸Šè§’åæ ‡ä¸º X, Yã€‚ çŒœæƒ³ä¸ç­”æ¡ˆç»™å‡ºä¸¤ä¸ªç­”æ¡ˆï¼š æ­£ç¡®ç­”æ¡ˆæ˜¯å›¾äºŒï¼Œå› ä¸ºè¿™æ ·å¾—å‡ºæ¥çš„åæ ‡ç”Ÿæˆçš„æ¸å˜æœ€ç´§æ¥æ–‡æœ¬çŸ©å½¢è¾¹ç•Œï¼Œå®ƒçš„è¿åŠ¨è½¨è¿¹å¦‚ä¸‹åŠ¨å›¾ï¼š (å›¾æ¥æºï¼šDo you really know CSS linear-gradientsï¼‰ æ¸å˜èµ·ç‚¹ä¸ç»ˆç‚¹åæ ‡çš„è®¡ç®—æ‰€ä»¥ï¼Œæ¸å˜çš„èµ·ç‚¹ä¸ç»ˆç‚¹åæ ‡è¯¥æ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿç­”: å…ˆæ±‚å¾—èµ·ç‚¹ä¸ç»ˆç‚¹çš„é•¿åº¦ï¼ˆè·ç¦»ï¼‰ã€‚ æ ¹æ®é•¿åº¦ä¸æ–‡æœ¬çŸ©å½¢çš„ä¸­å¿ƒç‚¹åæ ‡åˆ†åˆ«è®¡ç®—å‡ºèµ·ç‚¹ä¸ç»ˆç‚¹åæ ‡ã€‚ çº¿æ€§æ¸å˜é•¿åº¦çš„è®¡ç®— W3C ç»™å‡ºäº†ä¸€ä¸ªå…¬å¼ï¼ˆA è¡¨ç¤ºè§’åº¦ï¼‰ï¼š 1gradientLineLength = abs(W * sin(A)) + abs(H * cos(A)) ä¸è¿‡ï¼Œè¯¥å…¬å¼ä¸»è¦åº”ç”¨äº CSS çš„çº¿æ€§æ¸å˜è®¾ç½®ï¼Œå³ä»¥ 12 ç‚¹é’Ÿæ–¹å‘ä¸º 0Â°ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬ã€‚ è€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»¥ 3 ç‚¹é’Ÿæ–¹å‘ä¸º 0Â°ï¼Œé€†æ—¶é’ˆæ—‹è½¬ï¼Œå³å…¬å¼ä¸ºï¼š 1234gradientLineLength = abs(W * cos(A)) + abs(H * sin(A))// åŠé•¿ï¼šhalfGradientLineLength = (abs(W * cos(A)) + abs(H * sin(A))) / 2 é‚£ä¹ˆè¿™ä¸ªå…¬å¼æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿä»¥ä¸‹æ˜¯ç¬”è€…çš„æ±‚è§£ï¼š ç”±å›¾å¯å¾—ä»¥ä¸‹æ–¹ç¨‹ç»„ï¼š å› æ­¤å¯æ¨å¯¼å‡ºï¼š åŒ–ç®€åä¸ºï¼š æ‰€ä»¥ c1 + c2 ä¸ºï¼š ç”±ä¸‰è§’å‡½æ•°å¹³æ–¹å…¬å¼çŸ¥ï¼šcos(A) * cos(A) = 1 - sin(A) * sin(A)ï¼Œ ä»£å…¥ c1 + c2ï¼š ç¬¬ä¸€æ­¥åŒ–ç®€åï¼š æœ€åçš„ç»“æœå°±æ˜¯ï¼š å› ä¸º sin, cos åœ¨å‡½æ•°å‘¨æœŸå†…å­˜åœ¨è´Ÿå€¼ï¼ˆè§ä¸‹é¢è§’åº¦å¯¹åº”çš„ä¸‰è§’å‡½æ•°å‘¨æœŸå›¾ï¼‰ï¼Œæ‰€ä»¥çº¿æ€§æ¸å˜çš„é•¿åº¦éœ€è¦å–ç»å¯¹å€¼ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“äº†çº¿æ€§æ¸å˜é•¿åº¦ï¼Œæ–‡æœ¬çŸ©å½¢çš„ä¸­å¿ƒç‚¹åæ ‡å¾ˆå¥½ç®—ï¼Œå³ï¼š 12centerX = X + W / 2centerY = Y + H / 2 æ‰€ä»¥ï¼Œèµ·ç‚¹ä¸ç»ˆç‚¹çš„åæ ‡åˆ†åˆ«ä¸ºï¼š 12345startX = centerX - cos(A) * halfGradientLineLengthstartY = centerY + sin(A) * halfGradientLineLengthendX = centerX + cos(A) * halfGradientLineLengthendY = centerY - sin(A) * halfGradientLineLength çœ‹çœ‹æœ€ç»ˆæ•ˆæœ ç»éªŒæ³¨é‡Šè¿›è¡Œä¸‰è§’å‡½æ•°è®¡ç®—æ—¶ï¼Œåº”å°½é‡é¿å…å…ˆç”¨ tan, å› ä¸º tan åœ¨å…¶å‘¨æœŸå†…å­˜åœ¨æ— ç©·å€¼ï¼Œéœ€è¦åšç‰¹å®šçš„æ¡ä»¶åˆ¤æ–­ï¼Œè€Œ sin, cos æ²¡æœ‰æ­¤ç±»é—®é¢˜ï¼Œä»£ç ä¹¦å†™æ›´ä¸ºç®€æ´æ¸…æ™°å¹¶ä¸”ä¸ä¼šå› ç–å¿½äº§ç”Ÿé”™è¯¯ï¼Œè§ä¸‹é¢ä¸‰è§’å‡½æ•°ä¸è§’åº¦çš„å¯¹åº”å…³ç³»å‘¨æœŸå›¾ã€‚ å‚é˜…ï¼šDo you really know CSS linear-gradients? MDN linear-gradient W3C - CSS Images Module Level 3 # linear-gradients","pubDate":"Mon, 22 Jun 2020 02:00:00 GMT","guid":"https://aotu.io/notes/2020/06/22/linearGradient/","category":"Webå¼€å‘"},{"title":"å‘å¼ºå¤§çš„SVGè¿ˆè¿›","link":"https://aotu.io/notes/2020/06/09/strong-svg/","description":"SVG å³ Scalable Vector Graphics å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼Œä½¿ç”¨XMLæ ¼å¼å®šä¹‰å›¾å½¢ã€‚ ä¸€ã€SVGå°è±¡SVG çš„åº”ç”¨ååˆ†å¹¿æ³›ï¼Œå¾—ç›Šäº SVG å¼ºå¤§çš„å„ç§ç‰¹æ€§ã€‚ 1.1ã€ çŸ¢é‡å¯åˆ©ç”¨ SVG çŸ¢é‡çš„ç‰¹ç‚¹ï¼Œæå‡ºæ·±åœ³åœ°é“çš„è½®å»“ï¼š 1.2ã€iconfontSVG å¯ä¾æ®ä¸€å®šçš„è§„åˆ™ï¼Œè½¬æˆ iconfont ä½¿ç”¨ï¼š 1.3ã€ foreignObjectåˆ©ç”¨ SVG çš„ foreignObject æ ‡ç­¾å®ç°æˆªå›¾åŠŸèƒ½ï¼ŒåŸç†ï¼šforeignObject å†…éƒ¨åµŒå…¥ HTML å…ƒç´ ï¼š 12345&lt;svg xmlns=\"http://www.w3.org/2000/svg\"&gt; &lt;foreignObject width=\"120\" height=\"60\"&gt; &lt;p style=\"font-size:20px;margin:0;\"&gt;å‡¹å‡¸å®éªŒå®¤ æ¬¢è¿æ‚¨&lt;/p&gt; &lt;/foreignObject&gt;&lt;/svg&gt; æˆªå›¾å®ç°æµç¨‹ï¼š é¦–å…ˆå£°æ˜ä¸€ä¸ªåŸºç¡€çš„ svg æ¨¡ç‰ˆï¼Œè¿™ä¸ªæ¨¡ç‰ˆéœ€è¦ä¸€äº›åŸºç¡€çš„æè¿°ä¿¡æ¯ï¼Œæœ€é‡è¦çš„ï¼Œå®ƒè¦æœ‰ &lt;foreignObject&gt;&lt;/foreignObject&gt; è¿™å¯¹æ ‡ç­¾ï¼› å°†è¦æ¸²æŸ“çš„ DOM æ¨¡ç‰ˆæ¨¡ç‰ˆåµŒå…¥ foreignObject å³å¯ï¼› åˆ©ç”¨ Blob æ„å»º svg å¯¹è±¡ï¼› åˆ©ç”¨ URL.createObjectURL(svg) å–å‡º URLã€‚ 1.4ã€SVG SMILç”±äºå¾®ä¿¡ç¼–è¾‘å™¨ä¸å…è®¸åµŒå…¥ &lt;style&gt;&lt;script&gt;&lt;a&gt; æ ‡ç­¾ï¼Œåˆ©ç”¨SVG SMIL å¯è¿›è¡Œå¾®ä¿¡å…¬ä¼—å·æå…·åˆ›æ„çš„å›¾æ–‡æ’ç‰ˆè®¾è®¡ï¼ŒåŒ…æ‹¬åŠ¨ç”»ä¸äº¤äº’ã€‚ä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œæ ‡ç­¾é‡Œä¸å…è®¸æœ‰idï¼Œå¦åˆ™ä¼šè¢«è¿‡æ»¤æˆ–æ›¿æ¢æ‰ã€‚ ç‚¹å‡» â€œå‡¹å‡¸å®éªŒå®¤â€ åï¼Œå›´ç»• â€œå‡¹å‡¸å®éªŒå®¤â€ ä¸­å¿ƒæ—‹è½¬ 360åº¦ï¼Œç‚¹å‡»0.5ç§’å å‡ºç° https://aotu.io/ ï¼ŒåŠ¨ç”»åªè¿è¡Œä¸€æ¬¡ã€‚ ä¸‹å›¾ä¸º GIFå¾ªç¯æ¼”ç¤ºï¼š ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819&lt;svg width=\"360\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\"&gt; &lt;g&gt; &lt;!-- ç‚¹å‡»å è¿è¡Œtransformæ—‹è½¬åŠ¨ç”»ï¼Œrestart=\"never\"è¡¨ç¤ºåªè¿è¡Œä¸€æ¬¡ --&gt; &lt;animateTransform attributeName=\"transform\" type=\"rotate\" begin=\"click\" dur=\"0.5s\" from=\"0 100 80\" to=\"360 100 80\" fill=\"freeze\" restart=\"never\" /&gt; &lt;g&gt; &lt;text font-family=\"microsoft yahei\" font-size=\"20\" x=\"50\" y=\"80\"&gt; å‡¹å‡¸å®éªŒå®¤ &lt;/text&gt; &lt;/g&gt; &lt;g style=\"opacity: 0;\"&gt; &lt;!-- åŒä¸€ä¸ªåˆå§‹ä½ç½®ä»¥åŠå¤§è‡´çš„å®½é«˜ï¼Œè§¦å‘ç‚¹å‡»äº‹ä»¶ --&gt; &lt;text font-family=\"microsoft yahei\" font-size=\"20\" x=\"50\" y=\"80\"&gt;https://aotu.io/&lt;/text&gt; &lt;!-- ç‚¹å‡»å è¿è¡Œtransformç§»åŠ¨åŠ¨ç”»ï¼Œæ”¹å˜æ–‡æœ¬çš„ä½ç½® --&gt; &lt;animateTransform attributeName=\"transform\" type=\"translate\" begin=\"click\" dur=\"0.1s\" to=\"0 40\" fill=\"freeze\" restart=\"never\" /&gt; &lt;!-- ç‚¹å‡»0.5ç§’å è¿è¡Œopacityæ˜¾ç¤ºåŠ¨ç”» --&gt; &lt;animate attributeName=\"opacity\" begin=\"click+0.5s\" from=\"0\" to=\"1\" dur=\"0.5s\" fill=\"freeze\" restart=\"never\" /&gt; &lt;/g&gt; &lt;/g&gt;&lt;/svg&gt; ä»¥ä¸Šæ˜¯é„™äººå¯¹SVGçš„å¤§è‡´å°è±¡ï¼Œæœ€è¿‘çš„éœ€æ±‚å¼€å‘å†æ¬¡åˆ·æ–°äº†æˆ‘çš„è®¤çŸ¥ï¼Œé‚£å°±æ˜¯ SVGå®ç°éæ¯”ä¾‹ç¼©æ”¾ ä»¥åŠ å°ç¨‹åºä¸æ”¯æŒSVGæ ‡ç­¾çš„å¤„ç†ï¼Œä¸‹é¢å®¹æˆ‘æ¥è®²è¿°ä¸€ç•ªã€‚ äºŒã€SVG å®ç°éæ¯”ä¾‹ç¼©æ”¾æˆ‘ä»¬ç†ŸçŸ¥çš„ iconfontï¼Œå¯é€šè¿‡æ”¹å˜å­—ä½“å¤§å°ç¼©æ”¾ï¼Œä½†æ˜¯è¿™æ˜¯ æ¯”ä¾‹ç¼©æ”¾ï¼Œé‚£å¦‚ä½•å®ç° SVG çš„éæ¯”ä¾‹ç¼©æ”¾å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¦‚ä½•å°† ä¸€åªå…”å­ éæ¯”ä¾‹ç¼©æ”¾ï¼Ÿ åˆ’é‡ç‚¹ï¼šå®ç°éæ¯”ä¾‹ç¼©æ”¾ä¸»è¦æ¶‰åŠä¸‰ä¸ªçŸ¥è¯†ç‚¹ï¼šviewportã€viewBoxå’ŒpreserveAspectRatioï¼Œviewport ä¸viewBox ç»“åˆå¯å®ç°ç¼©æ”¾çš„åŠŸèƒ½ï¼ŒviewBox ä¸ preserveAspectRatio ç»“åˆå¯å®ç°éæ¯”ä¾‹çš„åŠŸèƒ½ã€‚ 2.1ã€viewportviewport è¡¨ç¤ºSVGå¯è§åŒºåŸŸçš„å¤§å°ã€‚viewport å°±åƒæ˜¯æˆ‘ä»¬çš„æ˜¾ç¤ºå™¨å±å¹•å¤§å°ï¼Œè¶…å‡ºåŒºåŸŸåˆ™éšè—ï¼ŒåŸç‚¹ä½äºå·¦ä¸Šè§’ï¼Œx è½´æ°´å¹³å‘å³ï¼Œy è½´å‚ç›´å‘ä¸‹ã€‚ é€šè¿‡ç±»ä¼¼CSSçš„å±æ€§ widthã€height æŒ‡å®šè§†å›¾å¤§å°ï¼š 1&lt;svg width=\"400\" height=\"200\"&gt;&lt;/svg&gt; 2.2ã€viewBoxviewBoxå€¼æœ‰4ä¸ªæ•°å­—ï¼šx, y, width, height ã€‚å…¶ä¸­ xï¼šå·¦ä¸Šè§’æ¨ªåæ ‡ï¼Œyï¼šå·¦ä¸Šè§’çºµåæ ‡ï¼Œwidthï¼šå®½åº¦ï¼Œheightï¼šé«˜åº¦ã€‚åŸç‚¹é»˜è®¤ä½äºå·¦ä¸Šè§’ï¼Œx è½´æ°´å¹³å‘å³ï¼Œy è½´å‚ç›´å‘ä¸‹ã€‚ 1&lt;svg width=\"400\" height=\"200\" viewBox=\"0 0 200 100\"&gt;&lt;/svg&gt; æ˜¾ç¤ºå™¨å±å¹•çš„ç”»é¢ï¼Œå¯ä»¥ç‰¹å†™ï¼Œå¯ä»¥å…¨æ™¯ï¼Œè¿™å°±æ˜¯ viewBoxã€‚viewBox å¯ä»¥æƒ³è±¡æˆæˆªå±å·¥å…·é€‰ä¸­çš„é‚£ä¸ªæ¡†æ¡†ï¼Œå’Œ viewport ä½œç”¨çš„ç»“æœå°±æ˜¯ æŠŠæ¡†æ¡†ä¸­çš„æˆªå±å†…å®¹å†æ¬¡åœ¨ æ˜¾ç¤ºå™¨ ä¸­å…¨å±æ˜¾ç¤ºã€‚ ï¼ˆå›¾ç‰‡æ¥æºï¼šSVG ç ”ç©¶ä¹‹è·¯ (23) - ç†è§£ viewport èˆ‡ viewboxï¼‰ 2.3ã€preserveAspectRatioä¸Šå›¾çš„çº¢è‰²æ¡†æ¡†å’Œè“è‰²æ¡†æ¡†ï¼Œæ°å¥½å’Œæ˜¾ç¤ºå™¨çš„æ¯”ä¾‹ç›¸åŒï¼Œå¦‚æœæ˜¯ä¸‹å›¾çš„ç»¿è‰²æ¡†æ¡†ï¼Œæ€æ ·åœ¨æ˜¾ç¤ºå™¨å±å¹•ä¸­æ˜¾ç¤ºå‘¢ï¼Ÿ 2.3.1ã€ å®šä¹‰preserveAspectRatio ä½œç”¨çš„å¯¹è±¡æ˜¯ viewBoxï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š12preserveAspectRatio=\"[defer] &lt;align&gt; [&lt;meetOrSlice&gt;]\"// ä¾‹å¦‚ preserveAspectRatio=\"xMidYMid meet\" å…¶ä¸­ defer æ­¤æ—¶ä¸æ˜¯é‡ç‚¹ï¼Œæš‚ä¸”å¿½ç•¥ï¼Œä¸»è¦äº†è§£ align å’Œ meetOrSlice çš„ ç”¨æ³•ï¼š alignï¼šç”±ä¸¤ä¸ªåè¯ç»„æˆï¼Œåˆ†åˆ«ä»£è¡¨ viewbox ä¸ viewport çš„ x æ–¹å‘ã€yæ–¹å‘çš„å¯¹é½æ–¹å¼ã€‚ å€¼ å«ä¹‰ xMin viewport å’Œ viewBox å·¦è¾¹å¯¹é½ xMid viewport å’Œ viewBox xè½´ä¸­å¿ƒå¯¹é½ xMax viewport å’Œ viewBox å³è¾¹å¯¹é½ YMin viewport å’Œ viewBox ä¸Šè¾¹ç¼˜å¯¹é½ã€‚æ³¨æ„Yæ˜¯å¤§å†™ã€‚ YMid viewport å’Œ viewBox yè½´ä¸­å¿ƒç‚¹å¯¹é½ã€‚æ³¨æ„Yæ˜¯å¤§å†™ã€‚ YMax viewport å’Œ viewBox ä¸‹è¾¹ç¼˜å¯¹é½ã€‚æ³¨æ„Yæ˜¯å¤§å†™ã€‚ meetOrSliceï¼šè¡¨ç¤ºå¦‚ä½•ç»´æŒé«˜å®½çš„æ¯”ä¾‹ï¼Œæœ‰ä¸‰ä¸ªå€¼ meetã€sliceã€noneã€‚ meet - é»˜è®¤å€¼ï¼Œä¿æŒçºµæ¨ªæ¯”ç¼©æ”¾ viewBox é€‚åº” viewportï¼Œå¯èƒ½ä¼šæœ‰ä½™ç•™çš„ç©ºç™½ã€‚ slice - ä¿æŒçºµæ¨ªæ¯”åŒæ—¶æ¯”ä¾‹å°çš„æ–¹å‘æ”¾å¤§å¡«æ»¡ viewportï¼Œè¶…å‡ºçš„éƒ¨åˆ†è¢«å‰ªè£æ‰ã€‚ none - æ‰­æ›²çºµæ¨ªæ¯”ä»¥å……åˆ†é€‚åº” viewportã€‚ 2.3.2ã€ ä¾‹å­ä¾‹å­1ï¼špreserveAspectRatio=&quot;xMidYMid meet&quot; è¡¨ç¤º ç»¿è‰²æ¡†æ¡† ä¸ æ˜¾ç¤ºå™¨çš„ x æ–¹å‘ã€yæ–¹å‘çš„ ä¸­å¿ƒç‚¹ å¯¹é½ï¼› ä¾‹å­2ï¼špreserveAspectRatio=&quot;xMidYMin slice&quot; è¡¨ç¤º ç»¿è‰²æ¡†æ¡† ä¸ æ˜¾ç¤ºå™¨çš„ x æ–¹å‘ ä¸­å¿ƒç‚¹ å¯¹é½ï¼ŒY æ–¹å‘ ä¸Šè¾¹ç¼˜å¯¹é½ï¼Œä¿æŒæ¯”ä¾‹æ”¾å¤§å¡«æ»¡ æ˜¾ç¤ºå± åè¶…å‡ºéƒ¨åˆ†éšè—ï¼› ä¾‹å­3ï¼špreserveAspectRatio=&quot;xMidYMid slice&quot; è¡¨ç¤º ç»¿è‰²æ¡†æ¡† ä¸ æ˜¾ç¤ºå™¨çš„ x æ–¹å‘ã€yæ–¹å‘çš„ ä¸­å¿ƒç‚¹ å¯¹é½ï¼Œä¿æŒæ¯”ä¾‹æ”¾å¤§å¡«æ»¡æ˜¾ç¤ºå± åè¶…å‡ºéƒ¨åˆ†éšè—ï¼› ä¾‹å­4ï¼špreserveAspectRatio=&quot;none&quot; ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œéšæ„ç¼©æ”¾ç»¿è‰²æ¡†æ¡†ï¼Œå¡«æ»¡ æ˜¾ç¤ºå±å³å¯ï¼›è¿™å°±æ˜¯éæ¯”ä¾‹ç¼©æ”¾çš„ç­”æ¡ˆäº†ã€‚ ä¸‰ã€å°ç¨‹åºä¸æ”¯æŒsvgæ ‡ç­¾æ€ä¹ˆåŠå¾®ä¿¡å°ç¨‹åºå®˜æ–¹ä¸æ”¯æŒ SVG æ ‡ç­¾çš„ï¼Œä½†æ˜¯å†³å®šæ›²çº¿æ•‘å›½ï¼Œç›¸å½“äºè‡ªå·±å®ç°äº†ä¸€ä¸ªSVGæ ‡ç­¾ï¼šä½¿ç”¨å°ç¨‹åºå†…ç½®çš„ Canvas æ¸²æŸ“å™¨ï¼Œ åœ¨ Cax ä¸­å®ç° SVG æ ‡å‡†çš„å­é›†ï¼Œä½¿ç”¨ JSX æˆ–è€… HTMï¼ˆHyperscript Tagged Markupï¼‰ æè¿° SVG ç»“æ„è¡Œä¸ºè¡¨ç°ã€‚ ä½†æ˜¯ä»Šå¤©æˆ‘æƒ³è®²è®²å…¶ä»–çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå°ç¨‹åºè™½ç„¶ä¸æ”¯æŒ SVG æ ‡ç­¾ï¼Œä½†æ˜¯æ”¯æŒ svg è½¬æˆ base64 åä½œä¸º background-image çš„ urlï¼Œå¦‚ background-image: url(&quot;data:image/svg+xml.......) ã€‚ ä½†æ˜¯æˆ‘è¿™è¾¹è¿˜æœ‰ä¸ªéœ€æ±‚ï¼Œéšæ—¶æ›´æ”¹ SVG æ¯ä¸ªè·¯å¾„çš„é¢œè‰²ï¼Œå³ é¢œè‰²å¯é…ç½®ï¼š æ¥å›è½¬ Base64 è‚¯å®šæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å‘¢ï¼Ÿç›´æ¥è´´ç­”æ¡ˆï¼šå¯¹äºSVGå›¾å½¢ï¼Œè¿˜æœ‰æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œå°±æ˜¯ç›´æ¥ä½¿ç”¨SVG XMLæ ¼å¼ä»£ç ï¼Œæ— éœ€è¿›è¡Œbase64è½¬æ¢ã€‚ 3.1ã€URL ç¼–ç ç›´æ¥ä½¿ç”¨ SVG XML æ ¼å¼ä»£ç ï¼Œé¦–å…ˆè¦äº†è§£ Data URIçš„æ ¼å¼ã€‚åˆ’é‡ç‚¹ï¼šbase64éå¿…é€‰é¡¹ï¼Œä¸æŒ‡å®šçš„æ—¶å€™ï¼Œåé¢çš„ &lt;data&gt; å°†ä½¿ç”¨ URLç¼–ç ã€‚ 3.1.1ã€å…¥é—¨ ç™¾åˆ†å·ç¼–ç (Percent-encoding), ä¹Ÿç§°ä½œURLç¼–ç (URL encoding)ï¼Œæ˜¯ç‰¹å®šä¸Šä¸‹æ–‡çš„ç»Ÿä¸€èµ„æºå®šä½ç¬¦ (URL)çš„ç¼–ç æœºåˆ¶ã€‚ åŸç†ï¼šASCII å­—ç¬¦ = % + ä¸¤ä½ ASCII ç ï¼ˆåå…­è¿›åˆ¶ï¼‰ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ a å¯¹åº”çš„ ASCII ç ä¸º 0x61ï¼Œé‚£ä¹ˆ URL ç¼–ç åå¾—åˆ° %61 ã€‚ 3.1.2ã€URL ç¼–ç å‹ç¼©å‰è¨€ï¼š Data URI çš„æ ¼å¼ä¸­çš„ &lt;data&gt; å®Œå…¨ä½¿ç”¨URL ç¼–ç ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¦‚ encodeURIComponent(&#39;&lt;svg version=&quot;1.1&quot; viewBox= â€¦&lt;/svg&gt;&#39;)ã€‚ä½†æ˜¯å’Œè½¬ä¹‰å‰åŸå§‹SVGç›¸æ¯”ï¼Œå¯è¯»æ€§å·®äº†å¾ˆå¤šï¼Œè€Œä¸”å ç”¨ä½“ç§¯ä¹Ÿå˜å¤§äº†ã€‚å¦‚æœæ·±å…¥äº†è§£URL ç¼–ç çš„è¯ï¼Œ&lt;data&gt; æ²¡å¿…è¦å…¨éƒ¨ç¼–ç çš„ã€‚ æ­£æ–‡ï¼š RFC3986æ–‡æ¡£è§„å®šï¼ŒURLä¸­åªå…è®¸åŒ…å« æœªä¿ç•™å­—ç¬¦ ä»¥åŠ æ‰€æœ‰ä¿ç•™å­—ç¬¦ã€‚ æœªä¿ç•™å­—ç¬¦ï¼šåŒ…å«è‹±æ–‡å­—æ¯ï¼ˆa-zA-Zï¼‰ã€æ•°å­—ï¼ˆ0-9ï¼‰ã€-_.~ 4ä¸ªç‰¹æ®Šå­—ç¬¦ã€‚å¯¹äºæœªä¿ç•™å­—ç¬¦ï¼Œä¸éœ€è¦ç™¾åˆ†å·ç¼–ç ã€‚ ä¿ç•™å­—ç¬¦ï¼šå…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ :/?#[]@ (åˆ†éš”Urlçš„åè®®ã€ä¸»æœºã€è·¯å¾„ç­‰ç»„ä»¶) å’Œ !$&amp;&#39;()*+,;= ï¼ˆç”¨äºåœ¨æ¯ä¸ªç»„ä»¶ä¸­èµ·åˆ°åˆ†éš”ä½œç”¨çš„ï¼Œå¦‚&amp;ç¬¦å·ç”¨äºåˆ†éš”æŸ¥è¯¢å¤šä¸ªé”®å€¼å¯¹ï¼‰ã€‚ å—é™å­—ç¬¦æˆ–ä¸å®‰å…¨å­—ç¬¦ï¼šç›´æ¥æ”¾åœ¨Urlä¸­çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¼•èµ·è§£æç¨‹åºçš„æ­§ä¹‰ï¼Œå› æ­¤è¿™éƒ¨åˆ†éœ€è¦ç™¾åˆ†å·ç¼–ç ï¼Œå¦‚%ã€ç©ºæ ¼ã€åŒå¼•å·&quot;ã€å°–å· &lt;&gt;ç­‰ç­‰ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œåªéœ€è¦å¯¹ å—é™å­—ç¬¦æˆ–ä¸å®‰å…¨å­—ç¬¦ è¿›è¡Œç¼–ç å³å¯ã€‚ JS å¤„ç†æ¯”è¾ƒç®€å•ï¼Œåˆ©ç”¨ replace å°† éœ€è¦ç¼–ç çš„å­—ç¬¦ æ›¿æ¢æ‰ å³å¯ï¼ŒåŸºæœ¬æ›¿æ¢ ä»¥ä¸‹çš„ç¬¦å· å°±å¤Ÿç”¨äº†ï¼š 1234567891011121314svgToUrl (svgData) &#123; encoded = encoded .replace(/&lt;!--(.*)--&gt;/g, '') // äº²æµ‹å¿…é¡»å»æ‰æ³¨é‡Š .replace(/[\\r\\n]/g, ' ') // äº²æµ‹æœ€å¥½å»æ‰æ¢è¡Œ .replace(/\"/g, `'`) // å•å¼•å·æ˜¯ä¿ç•™å­—ç¬¦ï¼ŒåŒå¼•å·æ”¹æˆå•å¼•å·å‡å°‘ç¼–ç  .replace(/%/g, '%25') .replace(/&amp;/g, '%26') .replace(/#/g, '%23') .replace(/&#123;/g, '%7B') .replace(/&#125;/g, '%7D') .replace(/&lt;/g, '%3C') .replace(/&gt;/g, '%3E') return `data:image/svg+xml,$&#123;encoded&#125;` &#125; å¦‚æœä½¿ç”¨åœ¨ CSS ä¸­ï¼Œå¯åˆ©ç”¨ SASSç‰ˆæœ¬3.3ä»¥ä¸Š çš„ ä¸‰ä¸ªAPI å¯¹ SVGå­—ç¬¦ä¸²åšæ›¿æ¢å¤„ç†ã€‚ str_insert(string, insert, index)ï¼š ä» $string ç¬¬ $index æ’å…¥å­—ç¬¦ $insertï¼› str_index(string, substring): è¿”å› $substring åœ¨ $string ä¸­ç¬¬ä¸€ä¸ªä½ç½®ï¼› str_slice(string, start_at, end_at = nil): è¿”å›ä»å­—ç¬¦ $string ä¸­ç¬¬ $start_at å¼€å§‹åˆ° $end_at ç»“æŸçš„ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ã€‚ å‰äººå·²æœ‰æ€»ç»“ï¼Œå¯å‰å¾€ https://github.com/leeenx/sass-svg/blob/master/sass-encodeuri.scss æŸ¥çœ‹å®Œæ•´ä»£ç ã€‚ 3.2ã€SVG å‹ç¼© ä¸€èˆ¬ä» Sketch å¯¼å‡º SVG ï¼Œå†—ä½™ä»£ç æ¯”è¾ƒå¤šï¼Œæœ‰æ¡ä»¶çš„è¯å»ºè®®ä½¿ç”¨ SVGO å‹ç¼©SVGçš„åŸæœ¬ä½“ç§¯ï¼Œæ¯”å¦‚æ¸…é™¤æ¢è¡Œã€é‡å¤ç©ºæ ¼ï¼›åˆ é™¤æ–‡æ¡£å£°æ˜ï¼›åˆ é™¤æ³¨é‡Šï¼›åˆ é™¤descæè¿°ç­‰ç­‰ã€‚ å››ã€æ€»ç»“SVGå¼ºå¤§çš„åœ°æ–¹åœ¨äºï¼Œå‡ºå…¶ä¸æ„ï¼Œç‚«é…·ï¼Œä¸ä¼—ä¸åŒã€‚ æ— è®ºæ˜¯å¾®ä¿¡å…¬ä¼—å·èŠ±å¼æ’ç‰ˆï¼ŒforeignObject æ ‡ç­¾å®ç°æˆªå›¾ï¼Œå®ç°éæ¯”ä¾‹ç¼©æ”¾ï¼Œæˆ–è€… èƒŒæ™¯å›¾ç›´æ¥ä½¿ç”¨ SVG XML æ ¼å¼ä»£ç ï¼Œè¿˜æ˜¯ä¸Šæ–‡æ²¡æœ‰æåŠçš„è·¯å¾„åŠ¨ç”»ã€æè¾¹åŠ¨ç”»ã€å›¾å½¢è£å‰ªã€æ»¤é•œç­‰ç­‰ï¼Œéƒ½å¯ä»¥ç©å‡ºæ–°çš„èŠ±æ ·ã€‚ SVG ä¸€ä¸ªå±æ€§å¯æˆå°±ä¸€ç¯‡æ–‡ç« ï¼Œå­¦ä¹  SVG å¯ä»¥è¯´æ˜¯åœ¨æŒ‘æˆ˜è‡ªå·±ï¼Œæ¬¢è¿åŠ å…¥ SVG çš„å­¦ä¹ é˜Ÿåˆ—ã€‚ äº”ã€å‚è€ƒå†…å®¹ Â· æ¨èé˜…è¯»ä¸‰çœ‹ SVG Web åŠ¨æ•ˆURLç¼–ç çš„å¥¥ç§˜å­¦ä¹ äº†ï¼ŒCSSä¸­å†…è”SVGå›¾ç‰‡æœ‰æ¯”Base64æ›´å¥½çš„å½¢å¼è¶…çº§å¼ºå¤§çš„SVG SMIL animationåŠ¨ç”»è¯¦è§£è¯¦ç»†æ•™ä½ å¾®ä¿¡å…¬ä¼—å·æ­£æ–‡é¡µSVGäº¤äº’å¼€å‘SVG ç®€ä»‹ä¸æˆªå›¾ç­‰åº”ç”¨","pubDate":"Tue, 09 Jun 2020 06:00:00 GMT","guid":"https://aotu.io/notes/2020/06/09/strong-svg/","category":"Webå¼€å‘ ç§»åŠ¨å¼€å‘"},{"title":"å‰ç«¯ä¹Ÿè¦æ‡‚ç‰©ç† â€”â€” æƒ¯æ€§æ»šåŠ¨ç¯‡","link":"https://aotu.io/notes/2020/06/08/momentum-scrolling/","description":"æˆ‘ä»¬åœ¨å¹³æ—¶ç¼–ç¨‹å¼€å‘æ—¶ï¼Œé™¤äº†éœ€è¦å…³æ³¨æŠ€æœ¯å®ç°ã€ç®—æ³•ã€ä»£ç æ•ˆç‡ç­‰å› ç´ ä¹‹å¤–ï¼Œæ›´è¦æŠŠæ‰€å­¦åˆ°çš„å­¦ç§‘çŸ¥è¯†ï¼ˆå¦‚ç‰©ç†å­¦ã€ç†è®ºæ•°å­¦ç­‰ç­‰ï¼‰çµæ´»åº”ç”¨ï¼Œæ¯•ç«Ÿç†è®ºå’Œå®è·µç›¸è¾…ç›¸æˆã€å¯†ä¸å¯åˆ†ï¼Œè¿™æ— è®ºæ˜¯å¯¹äºæˆ‘ä»¬çš„æ–¹æ¡ˆé€‰å‹ã€è¿˜æ˜¯æŠ€æœ¯å®è·µç†è§£éƒ½æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚ä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸­å­¦ç‰©ç†çŸ¥è¯†ï¼Œå¹¶çµæ´»è¿ç”¨åˆ°æƒ¯æ€§æ»šåŠ¨çš„åŠ¨æ•ˆå®ç°å½“ä¸­ã€‚ æƒ¯æ€§æ»šåŠ¨ï¼ˆä¹Ÿå« æ»šåŠ¨å›å¼¹ï¼Œmomentum-based scrollingï¼‰æœ€æ—©æ˜¯å‡ºç°åœ¨ iOS ç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡ å½“ç”¨æˆ·åœ¨ç»ˆç«¯ä¸Šæ»‘åŠ¨é¡µé¢ç„¶åæŠŠæ‰‹æŒ‡æŒªå¼€ï¼Œé¡µé¢ä¸ä¼šé©¬ä¸Šåœä¸‹è€Œæ˜¯ç»§ç»­ä¿æŒä¸€å®šæ—¶é—´çš„æ»šåŠ¨æ•ˆæœï¼Œå¹¶ä¸”æ»šåŠ¨çš„é€Ÿåº¦å’ŒæŒç»­æ—¶é—´æ˜¯ä¸æ»‘åŠ¨æ‰‹åŠ¿çš„å¼ºçƒˆç¨‹åº¦æˆæ­£æ¯”ã€‚æŠ½è±¡åœ°ç†è§£ï¼Œå°±åƒé«˜é€Ÿè¡Œé©¶çš„åˆ—è½¦åˆ¶åŠ¨åä¾ç„¶ä¼šå¾€å‰è¡Œé©¶ä¸€æ®µè·ç¦»æ‰ä¼šæœ€ç»ˆåœä¸‹ã€‚è€Œä¸”åœ¨ iOS ç³»ç»Ÿä¸­ï¼Œå½“é¡µé¢æ»šåŠ¨åˆ°é¡¶/åº•éƒ¨æ—¶ï¼Œè¿˜æœ‰å¯èƒ½è§¦å‘ â€œå›å¼¹â€ çš„æ•ˆæœã€‚è¿™é‡Œå½•åˆ¶äº†å¾®ä¿¡ APP ã€è´¦å•ã€‘é¡µé¢ä¸­çš„ iOS åŸç”Ÿæ—¶é—´é€‰æ‹©å™¨çš„æƒ¯æ€§æ»šåŠ¨æ•ˆæœï¼š ç†Ÿæ‚‰ CSS å¼€å‘çš„åŒå­¦æˆ–è®¸ä¼šçŸ¥é“ï¼Œåœ¨ Safari æµè§ˆå™¨ä¸­æœ‰è¿™æ ·ä¸€æ¡ CSS è§„åˆ™ï¼š 1-webkit-overflow-scrolling: touch; å½“å…¶æ ·å¼å€¼ä¸º touch æ—¶ï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨å…·æœ‰å›å¼¹æ•ˆæœçš„æ»šåŠ¨, å³â€œå½“æ‰‹æŒ‡ä»è§¦æ‘¸å±ä¸Šç§»å¼€ï¼Œå†…å®¹ä¼šç»§ç»­ä¿æŒä¸€æ®µæ—¶é—´çš„æ»šåŠ¨æ•ˆæœâ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä¸°å¯Œå¤šå§¿çš„ web å‰ç«¯ç”Ÿæ€ä¸­ï¼Œå¾ˆå¤šç»å…¸ç»„ä»¶çš„äº¤äº’éƒ½ä¸€å®šç¨‹åº¦åœ°æ²¿ç”¨äº†æƒ¯æ€§æ»šåŠ¨çš„æ•ˆæœï¼Œè­¬å¦‚ä¸‹é¢æåˆ°çš„å‡ ä¸ªæµè¡Œ H5 ç»„ä»¶åº“ä¸­çš„ä¾‹å­ã€‚ æµè¡Œ UI åº“æ•ˆæœä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸€ä¸ª H5 æ™®é€šé•¿åˆ—è¡¨åœ¨ iOS ç³»ç»Ÿä¸‹ï¼ˆå¼€å¯äº†æ»šåŠ¨å›å¼¹ï¼‰çš„æ»šåŠ¨è¡¨ç°ï¼š weui çš„ picker ç»„ä»¶ æ˜æ˜¾å¯è§ï¼Œweui é€‰æ‹©å™¨çš„æƒ¯æ€§æ»šåŠ¨æ•ˆæœéå¸¸å¼±ï¼ŒåŸºæœ¬ä¸Šæ‰‹ä»å±å¹•ä¸Šç§»å¼€åæ»šåŠ¨å°±å¾ˆå¿«åœæ­¢äº†ï¼Œä½“éªŒè¾ƒä¸ºä¸å¥½ã€‚ vant çš„ picker ç»„ä»¶ ç›¸æ¯”ä¹‹ä¸‹ï¼Œvant é€‰æ‹©å™¨çš„æƒ¯æ€§æ»šåŠ¨æ•ˆæœåˆ™æ˜æ˜¾æ¸…æ™°å¾—å¤šï¼Œä½†æ˜¯ç”±äºè§¦é¡¶/åº•å›å¼¹æ—¶ä¾ç„¶ç»´æŒäº†æ™®é€šæ»šåŠ¨æ—¶çš„ç³»æ•°æˆ–æŒç»­æ—¶é—´ï¼Œå¯¼è‡´æ•´ä½“æ¥è¯´å›å¼¹çš„æ•ˆæœæœ‰ç‚¹è„±èŠ‚ã€‚ åº”ç”¨ç‰©ç†å­¦æ¨¡å‹æƒ¯æ€§ ä¸€è¯æ¥æºäºç‰©ç†å­¦ä¸­çš„æƒ¯æ€§å®šå¾‹ï¼ˆå³ ç‰›é¡¿ç¬¬ä¸€å®šå¾‹ï¼‰ï¼šä¸€åˆ‡ç‰©ä½“åœ¨æ²¡æœ‰å—åˆ°åŠ›çš„ä½œç”¨çš„æ—¶å€™ï¼Œè¿åŠ¨çŠ¶æ€ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œç‰©ä½“æ‰€æ‹¥æœ‰çš„è¿™ç§æ€§è´¨å°±è¢«ç§°ä¸ºæƒ¯æ€§ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œæƒ¯æ€§æ»šåŠ¨çš„æœ¬è´¨å°±æ˜¯ç‰©ç†å­¦ä¸­çš„æƒ¯æ€§ç°è±¡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ°å½“åˆ©ç”¨ä¸­å­¦ç‰©ç†ä¸Šçš„ æ»‘å—æ¨¡å‹ æ¥æè¿°æƒ¯æ€§æ»šåŠ¨å…¨è¿‡ç¨‹ã€‚ ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠæµè§ˆå™¨æƒ¯æ€§æ»šåŠ¨æ•ˆæœä¸­çš„æ»šåŠ¨ç›®æ ‡ï¼ˆå¦‚æµè§ˆå™¨ä¸­çš„é¡µé¢å…ƒç´ ï¼‰æ¨¡æ‹Ÿæˆæ»‘å—æ¨¡å‹ä¸­çš„ æ»‘å—ã€‚è€Œä¸”åˆ†æå¾—å‡ºï¼Œæƒ¯æ€§æ»šåŠ¨çš„å…¨è¿‡ç¨‹å¯ä»¥æ¨¡æ‹Ÿä¸ºï¼ˆäººï¼‰ä½¿æ»‘å—æ»‘åŠ¨ä¸€å®šè·ç¦»ç„¶åé‡Šæ”¾çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆï¼Œå…¨æµç¨‹å¯ä»¥æ‹†è§£ä¸ºä»¥ä¸‹ä¸¤ä¸ªé˜¶æ®µï¼š ç¬¬ä¸€é˜¶æ®µï¼Œæ»‘åŠ¨æ»‘å—ä½¿å…¶ä»é™æ­¢å¼€å§‹åšåŠ é€Ÿè¿åŠ¨ï¼› åœ¨æ­¤é˜¶æ®µï¼Œæ»‘å—å—åˆ°çš„ Fæ‹‰ å¤§äº Fæ‘© ä½¿å…¶ä»å·¦åˆ°å³åŒ€åŠ é€Ÿå‰è¿›ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºæµè§ˆå™¨çš„æƒ¯æ€§æ»šåŠ¨æ¥è¯´ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…³æ³¨çš„æ˜¯ç”¨æˆ·å³å°†é‡Šæ”¾æ‰‹æŒ‡å‰çš„ä¸€å°é˜¶æ®µï¼Œè€Œéæ»šåŠ¨çš„å…¨æµç¨‹ï¼ˆå…¨æµç¨‹æ„ä¹‰ä¸å¤§ï¼‰ï¼Œè¿™ä¸€ç¬é—´é˜¶æ®µå¯ä»¥ç®€å•æ¨¡æ‹Ÿä¸ºæ»‘å—å‡è¡¡å—åŠ›åš åŒ€åŠ é€Ÿè¿åŠ¨ã€‚ ç¬¬äºŒé˜¶æ®µï¼Œé‡Šæ”¾æ»‘å—ä½¿å…¶åœ¨åªå—æ‘©æ“¦åŠ›çš„ä½œç”¨ä¸‹ç»§ç»­æ»‘åŠ¨ï¼Œç›´è‡³æœ€ç»ˆé™æ­¢ï¼› åœ¨æ­¤é˜¶æ®µï¼Œæ»‘å—åªå—åˆ°åå‘çš„æ‘©æ“¦åŠ›ï¼Œä¼šç»´æŒä»å·¦åˆ°å³çš„è¿åŠ¨æ–¹å‘å‡é€Ÿå‰è¿›ç„¶ååœä¸‹ã€‚ åŸºäºæ»‘å—æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°é€‚åˆçš„é‡åŒ–æŒ‡æ ‡æ¥å»ºç«‹æƒ¯æ€§æ»šåŠ¨çš„è®¡ç®—ä½“ç³»ã€‚ç»“åˆæ¨¡å‹å’Œå…·ä½“å®ç°ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ æ»šåŠ¨è·ç¦»ã€é€Ÿåº¦æ›²çº¿ ä»¥åŠ æ»šåŠ¨æ—¶é•¿ è¿™å‡ ä¸ªå…³é”®æŒ‡æ ‡ï¼Œä¸‹é¢ä¼šä¸€ä¸€å±•å¼€è§£æã€‚ æ»šåŠ¨è·ç¦»å¯¹äºæ»‘åŠ¨æ¨¡å‹çš„ç¬¬ä¸€é˜¶æ®µï¼Œæ»‘å—åšåŒ€åŠ é€Ÿè¿åŠ¨ï¼Œæˆ‘ä»¬ä¸å¦¨è®¾æ»‘å—çš„æ»‘åŠ¨è·ç¦»ä¸º s1ï¼Œæ»‘åŠ¨çš„æ—¶é—´ä¸º t1ï¼Œç»“æŸæ—¶çš„ä¸´ç•Œç‚¹é€Ÿåº¦ï¼ˆæœ«é€Ÿåº¦ï¼‰ä¸º v1 ï¼Œæ ¹æ®ä½ç§»å…¬å¼ å¯ä»¥å¾—å‡ºé€Ÿåº¦å…³ç³» å¯¹äºç¬¬äºŒé˜¶æ®µï¼Œæ»‘å—å—æ‘©æ“¦åŠ› Fæ‹‰ åšåŒ€å‡é€Ÿè¿åŠ¨ï¼Œæˆ‘ä»¬ä¸å¦¨è®¾æ»‘åŠ¨è·ç¦»ä¸º s2ï¼Œæ»‘åŠ¨çš„æ—¶é—´ä¸º t2ï¼Œæ»‘åŠ¨åŠ é€Ÿåº¦ä¸º aï¼Œå¦å¤–åˆé€Ÿåº¦ä¸º v1ï¼Œæœ«é€Ÿåº¦ä¸º 0m/sï¼Œç»“åˆä½ç§»å…¬å¼å’ŒåŠ é€Ÿåº¦å…¬å¼ å¯ä»¥æ¨ç®—å‡ºæ»‘åŠ¨è·ç¦» s2 ç”±äºåŒ€å‡é€Ÿè¿åŠ¨çš„åŠ é€Ÿåº¦ä¸ºè´Ÿï¼ˆå³ a &lt; 0ï¼‰ï¼Œä¸å¦¨è®¾ä¸€ä¸ªåŠ é€Ÿåº¦å¸¸é‡ Aï¼Œä½¿å…¶æ»¡è¶³ A = -2a çš„å…³ç³»ï¼Œé‚£ä¹ˆæ»‘åŠ¨è·ç¦» ç„¶è€Œåœ¨æµè§ˆå™¨å®é™…åº”ç”¨æ—¶ï¼Œv1 ç®—å¹³æ–¹ä¼šå¯¼è‡´æœ€ç»ˆè®¡ç®—å‡ºçš„æƒ¯æ€§æ»šåŠ¨è·ç¦»å¤ªå¤§ï¼ˆå³å¯¹æ»šåŠ¨æ‰‹åŠ¿çš„å¼ºåº¦æ„Ÿåº”è¿‡äºçµæ•ï¼‰ï¼Œæˆ‘ä»¬ä¸å¦¨æŠŠå¹³æ–¹è¿ç®—å»æ‰ï¼š æ‰€ä»¥ï¼Œæ±‚æƒ¯æ€§æ»šåŠ¨çš„è·ç¦»ï¼ˆå³ s2ï¼‰æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è®°å½•ç”¨æˆ·æ»šåŠ¨çš„ è·ç¦» s1 å’Œ æ»šåŠ¨æ—¶é•¿ t1ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåˆé€‚çš„ åŠ é€Ÿåº¦å¸¸é‡ A å³å¯ã€‚ ç»å¤§é‡æµ‹è¯•å¾—å‡ºï¼ŒåŠ é€Ÿåº¦å¸¸é‡ A çš„åˆé€‚å€¼ä¸º 0.003ã€‚ å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºçœŸæ­£çš„æµè§ˆå™¨æƒ¯æ€§æ»šåŠ¨æ•ˆæœæ¥è¯´ï¼Œè¿™é‡Œè®¨è®ºçš„æ»šåŠ¨è·ç¦»å’Œæ—¶é•¿æ˜¯æŒ‡èƒ½å¤Ÿä½œç”¨äºæƒ¯æ€§æ»šåŠ¨çš„èŒƒå›´å†…çš„è·ç¦»å’Œæ—¶é•¿ï¼Œè€Œéç”¨æˆ·æ»šåŠ¨é¡µé¢å…ƒç´ çš„å…¨æµç¨‹ï¼Œè¯¦ç»†çš„å¯ä»¥çœ‹ã€å¯åœæ¡ä»¶ã€‘è¿™ä¸€èŠ‚å†…å®¹ã€‚ æƒ¯æ€§æ»šåŠ¨é€Ÿåº¦æ›²çº¿é’ˆå¯¹æƒ¯æ€§æ»šåŠ¨é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒé˜¶æ®µä¸­çš„åŒ€å‡é€Ÿè¿åŠ¨ï¼Œæ ¹æ®ä½ç§»å…¬å¼å¯ä»¥å¾—åˆ°ä½ç§»å·®å’Œæ—¶é—´é—´è· T çš„å…³ç³» ä¸éš¾å¾—å‡ºï¼Œåœ¨åŒç­‰æ—¶é—´é—´è·æ¡ä»¶ä¸‹ï¼Œç›¸é‚»ä¸¤æ®µä½ç§»å·®ä¼šè¶Šæ¥è¶Šå°ï¼Œæ¢å¥è¯è¯´å°±æ˜¯æƒ¯æ€§æ»šåŠ¨çš„åç§»é‡å¢åŠ é€Ÿåº¦ä¼šè¶Šæ¥è¶Šå°ã€‚è¿™ä¸ CSS3 transition-timing-function ä¸­çš„ ease-out é€Ÿåº¦æ›²çº¿éå¸¸å»åˆï¼Œease-out ï¼ˆå³ cubic-bezier(0, 0, .58, 1)ï¼‰çš„è´å¡å°”æ›²çº¿ä¸º æ›²çº¿å›¾æ¥è‡ª åœ¨çº¿ç»˜åˆ¶è´å¡å°”æ›²çº¿ç½‘ç«™ã€‚ å…¶ä¸­ï¼Œå›¾è¡¨ä¸­çš„çºµåæ ‡æ˜¯æŒ‡ åŠ¨ç”»æ¨è¿›çš„è¿›ç¨‹ï¼Œæ¨ªåæ ‡æ˜¯æŒ‡ æ—¶é—´ï¼ŒåŸç‚¹åæ ‡ä¸º (0, 0)ï¼Œç»ˆç‚¹åæ ‡ä¸º (1, 1)ï¼Œå‡è®¾åŠ¨ç”»æŒç»­æ—¶é—´ä¸º 2 ç§’ï¼Œ(1, 1) åæ ‡ç‚¹åˆ™ä»£è¡¨åŠ¨ç”»å¯åŠ¨å 2 ç§’æ—¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•ï¼ˆ100%ï¼‰ã€‚æ ¹æ®å›¾è¡¨å¯ä»¥å¾—å‡ºï¼Œæ—¶é—´è¶Šå¾€ååŠ¨ç”»è¿›ç¨‹çš„æ¨è¿›é€Ÿåº¦è¶Šæ…¢ï¼Œç¬¦åˆåŒ€å‡é€Ÿè¿åŠ¨çš„ç‰¹æ€§ã€‚ æˆ‘ä»¬è¯•è¯•å®è·µåº”ç”¨ ease-out é€Ÿåº¦æ›²çº¿ï¼š å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·çš„é€Ÿåº¦æ›²çº¿è¿‡äºçº¿æ€§å¹³æ»‘ï¼Œå‡é€Ÿæ•ˆæœä¸æ˜æ˜¾ã€‚æˆ‘ä»¬å‚è€ƒ iOS æ»šåŠ¨å›å¼¹çš„æ•ˆæœé‡å¤æµ‹è¯•ï¼Œè°ƒæ•´è´å¡å°”æ›²çº¿çš„å‚æ•°ä¸º cubic-bezier(.17, .89, .45, 1)ï¼š è°ƒæ•´æ›²çº¿åçš„æ•ˆæœç†æƒ³å¾ˆå¤šï¼š å›å¼¹æ¥ä¸‹æ¥æ¨¡æ‹Ÿæƒ¯æ€§æ»šåŠ¨æ—¶è§¦ç¢°åˆ°å®¹å™¨è¾¹ç•Œè§¦å‘å›å¼¹çš„æƒ…å†µã€‚ æˆ‘ä»¬åŸºäºæ»‘å—æ¨¡å‹æ¥æ¨¡æ‹Ÿè¿™æ ·çš„åœºæ™¯ï¼šæ»‘å—å·¦ç«¯ä¸ä¸€æ ¹å¼¹ç°§è¿æ¥ï¼Œå¼¹ç°§å¦ä¸€ç«¯å›ºå®šåœ¨å¢™ä½“ä¸Šï¼Œåœ¨æ»‘å—å‘å³æ»‘åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œå½“æ»‘å—åˆ°è¾¾ä¸´ç•Œç‚¹ï¼ˆå¼¹ç°§å³å°†å‘ç”Ÿå½¢å˜æ—¶ï¼‰è€Œé€Ÿåº¦è¿˜æ²¡æœ‰é™åˆ° 0m/s æ—¶ï¼Œæ»‘å—ä¼šç»§ç»­æ»‘åŠ¨å¹¶æ‹‰åŠ¨å¼¹ç°§ä½¿å…¶å‘ç”Ÿå½¢å˜ï¼ŒåŒæ—¶æ»‘å—ä¼šå—åˆ°å¼¹ç°§çš„åæ‹‰åŠ›ä½œå‡é€Ÿè¿åŠ¨ï¼ˆåŠ¨èƒ½è½¬åŒ–ä¸ºå†…èƒ½ï¼‰ï¼›å½“æ»‘å—é€Ÿåº¦é™ä¸º 0m/s æ—¶ï¼Œæ­¤æ—¶å¼¹ç°§çš„å½¢å˜é‡æœ€å¤§ï¼Œç”±äºå¼¹æ€§ç‰¹è´¨å¼¹ç°§ä¼šæ¢å¤åŸçŠ¶ï¼ˆå†…èƒ½è½¬åŒ–æˆåŠ¨èƒ½ï¼‰ï¼Œå¹¶æ‹‰åŠ¨æ»‘å—åå‘ï¼ˆå·¦ï¼‰è¿åŠ¨ã€‚ ç±»ä¼¼åœ°ï¼Œå›å¼¹è¿‡ç¨‹ä¹Ÿå¯ä»¥åˆ†ä¸ºä¸‹é¢ä¸¤ä¸ªé˜¶æ®µï¼š æ»‘å—æ‹‰åŠ¨å¼¹ç°§å¾€å³åšå˜å‡é€Ÿè¿åŠ¨ï¼› æ­¤é˜¶æ®µæ»‘å—å—åˆ°æ‘©æ“¦åŠ› Fæ‘© å’Œè¶Šæ¥è¶Šå¤§çš„å¼¹ç°§æ‹‰åŠ› Få¼¹ å…±åŒä½œç”¨ï¼ŒåŠ é€Ÿåº¦è¶Šæ¥è¶Šå¤§ï¼Œå¯¼è‡´é€Ÿåº¦é™ä¸º 0m/s çš„æ—¶é—´ä¼šéå¸¸çŸ­ã€‚ å¼¹ç°§æ¢å¤åŸçŠ¶ï¼Œæ‹‰åŠ¨æ»‘å—å‘å·¦åšå…ˆå˜åŠ é€Ÿåå˜å‡é€Ÿè¿åŠ¨ï¼› æ­¤é˜¶æ®µæ»‘å—å—åˆ°çš„æ‘©æ“¦åŠ› Fæ‘© å’Œè¶Šæ¥è¶Šå°çš„å¼¹ç°§æ‹‰åŠ› Få¼¹ ç›¸äº’æŠµæ¶ˆï¼Œåˆšå¼€å§‹ Få¼¹ &gt; Fæ‘©ï¼Œæ»‘å—åšåŠ é€Ÿåº¦è¶Šæ¥è¶Šå°çš„å˜åŠ é€Ÿè¿åŠ¨ï¼›éšå Få¼¹ &lt; Fæ‘©ï¼Œæ»‘å—åšåŠ é€Ÿåº¦è¶Šæ¥è¶Šå¤§çš„å˜å‡é€Ÿè¿åŠ¨ï¼Œç›´è‡³æœ€ç»ˆé™æ­¢ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿å®é™…è®¡ç®—ï¼Œæˆ‘ä»¬ä¸å¦¨å‡è®¾ä¸€ä¸ªç†æƒ³çŠ¶æ€ï¼šå½“æ»‘å—é™æ­¢æ—¶å¼¹ç°§åˆšå¥½æ¢å¤å½¢å˜ã€‚ å›å¼¹è·ç¦»æ ¹æ®ä¸Šé¢çš„æ¨¡å‹åˆ†æï¼Œå›å¼¹çš„ç¬¬ä¸€é˜¶æ®µåšåŠ é€Ÿåº¦è¶Šæ¥è¶Šå¤§çš„å˜å‡é€Ÿç›´çº¿è¿åŠ¨ï¼Œä¸å¦¨è®¾æ­¤é˜¶æ®µçš„åˆé€Ÿåº¦ä¸º v0ï¼Œæœ«é€Ÿåº¦ä¸º v1ï¼Œé‚£ä¹ˆå¯ä»¥ä¸æ»‘å—ä½ç§»å»ºç«‹å…³ç³»ï¼š å…¶ä¸­ a ä¸ºåŠ é€Ÿåº¦å˜é‡ï¼Œè¿™é‡Œæš‚ä¸å±•å¼€è®¨è®ºã€‚é‚£ä¹ˆï¼Œæ ¹æ®ç‰©ç†å­¦çš„å¼¹æ€§æ¨¡å‹ï¼Œç¬¬äºŒé˜¶æ®µçš„å›å¼¹è·ç¦»ä¸º å¾®ç§¯åˆ†éƒ½æ¥äº†ï¼Œç®€ç›´æ²¡æ³•è®¡ç®—â€¦â€¦ ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿åŠ¨æ¨¡å‹é€‚å½“ç®€åŒ– Så›å¼¹ å€¼çš„è®¡ç®—ã€‚ç”±äº å›å¼¹ç¬¬äºŒé˜¶æ®µçš„åŠ é€Ÿåº¦ æ˜¯å¤§äº éå›å¼¹æƒ¯æ€§æ»šåŠ¨é˜¶æ®µçš„åŠ é€Ÿåº¦ï¼ˆFå¼¹ + Fæ‘© &gt; Fæ‘©ï¼‰çš„ï¼Œä¸å¦¨è®¾éå›å¼¹æƒ¯æ€§æ»šåŠ¨é˜¶æ®µçš„æ€»è·ç¦»ä¸º Sæ»‘ï¼Œé‚£ä¹ˆ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒä¸ºåˆç†çš„å¸¸é‡ Bï¼Œä½¿å…¶æ»¡è¶³è¿™æ ·çš„ç­‰å¼ï¼š ç»å¤§é‡å®è·µå¾—å‡ºï¼Œå¸¸é‡ B çš„åˆç†å€¼ä¸º 10ã€‚ å›å¼¹é€Ÿåº¦æ›²çº¿è§¦å‘å›å¼¹çš„æ•´ä¸ªæƒ¯æ€§æ»šåŠ¨è½¨è¿¹å¯ä»¥æ‹†åˆ†æˆä¸‰ä¸ªè¿åŠ¨é˜¶æ®µï¼š ç„¶è€Œï¼Œå¦‚æœè¦æŠŠé˜¶æ®µ a å’Œé˜¶æ®µ b å‡†ç¡®æç»˜æˆ CSS åŠ¨ç”»æ˜¯æœ‰å¾ˆé«˜çš„å¤æ‚åº¦çš„ï¼š é˜¶æ®µ b ä¸­çš„å˜å‡é€Ÿè¿åŠ¨éš¾ä»¥å‡†ç¡®æç»˜ï¼› è¿™ä¸¤ä¸ªé˜¶æ®µè™½è¿åŠ¨æ–¹å‘ç›¸åŒä½†åŠ¨ç”»é€Ÿåº¦æ›²çº¿ä¸è¿è´¯ï¼Œå¾ˆå®¹æ˜“é€ æˆç”¨æˆ·ä½“éªŒæ–­å±‚ï¼› ä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œæˆ‘ä»¬æŠŠé˜¶æ®µ a å’Œ b åˆå¹¶æˆä¸€ä¸ªè¿åŠ¨é˜¶æ®µï¼Œé‚£ä¹ˆç®€åŒ–åçš„è½¨è¿¹å°±å˜æˆï¼š é‰´äºåœ¨é˜¶æ®µ a æœ«ç«¯çš„åå‘åŠ é€Ÿåº¦ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥æ­¤é˜¶æ®µæ»‘å—çš„é€Ÿåº¦éª¤å‡åŒæ¯”éå›å¼¹æƒ¯æ€§æ»šåŠ¨æ›´å¿«ï¼Œå¯¹åº”çš„è´å¡å°”æ›²çº¿æœ«ç«¯å°±ä¼šæ›´é™¡ã€‚æˆ‘ä»¬é€‰æ‹©ä¸€æ¡è¾ƒä¸ºåˆç†çš„æ›²çº¿ cubic-bezier(.25, .46, .45, .94)ï¼š å¯¹äºé˜¶æ®µ bï¼Œæ»‘å—å…ˆå˜åŠ é€Ÿåå˜å‡é€Ÿï¼Œä¸ ease-in-out çš„æ›²çº¿æœ‰ç‚¹ç±»ä¼¼ï¼Œå®è·µå°è¯•ï¼š ä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å‘ç°é˜¶æ®µ a å’Œé˜¶æ®µ b çš„è¡”æ¥ä¸å¤Ÿæµç•…ï¼Œè¿™æ˜¯ç”±äº ease-in-out æ›²çº¿çš„å‰åŠæ®µç¼“å…¥å¯¼è‡´çš„ã€‚æ‰€ä»¥ï¼Œä¸ºäº†çªå‡ºæ•ˆæœæˆ‘ä»¬é€‰æ‹©åªæç»˜å˜å‡é€Ÿè¿åŠ¨çš„é˜¶æ®µ b æœ«æ®µã€‚è´å¡å°”æ›²çº¿è°ƒæ•´ä¸º cubic-bezier(.165, .84, .44, 1) å®è·µæ•ˆæœï¼š ç”±äº gif è½¬æ ¼å¼å¯¼è‡´éƒ¨åˆ†æ‰å¸§ï¼Œç¤ºä¾‹æ•ˆæœçœ‹èµ·æ¥ä¼šæœ‰ç‚¹å¡é¡¿ï¼Œå»ºè®®ç›´æ¥ä½“éªŒ demo CSS åŠ¨æ•ˆæ—¶é•¿æˆ‘ä»¬å¯¹ iOS çš„æ»šåŠ¨å›å¼¹æ•ˆæœåšå¤šæ¬¡æµ‹é‡ï¼Œå®šä¹‰å‡ºä½“éªŒè‰¯å¥½çš„åŠ¨æ•ˆæ—¶é•¿å‚æ•°ã€‚åœ¨ä¸€æ¬¡æƒ¯æ€§æ»šåŠ¨ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸‹é¢ä¸¤ç§æƒ…å†µï¼Œå¯¹åº”çš„åŠ¨æ•ˆæ—¶é—´ä¹Ÿä¸ä¸€æ ·ï¼š æ²¡æœ‰è§¦å‘å›å¼¹ æƒ¯æ€§æ»šåŠ¨çš„åˆç†æŒç»­æ—¶é—´ä¸º 2500msã€‚ è§¦å‘å›å¼¹ å¯¹äºé˜¶æ®µ aï¼Œå½“ Så›å¼¹ å¤§äºæŸä¸ªå…³é”®é˜ˆå€¼æ—¶å®šä¹‰ä¸º å¼ºå›å¼¹ï¼ŒåŠ¨æ•ˆæ—¶é•¿ä¸º 400msï¼›åä¹‹åˆ™å®šä¹‰ä¸º å¼±å›å¼¹ï¼ŒåŠ¨æ•ˆæ—¶é•¿ä¸º 800msã€‚ è€Œå¯¹äºé˜¶æ®µ bï¼Œåå¼¹çš„æŒç»­æ—¶é—´ä¸º 500ms è¾ƒä¸ºåˆç†ã€‚ å¯åœæ¡ä»¶å‰æ–‡ä¸­æœ‰æåˆ°ï¼Œå¦‚æœæŠŠç”¨æˆ·æ»šåŠ¨é¡µé¢å…ƒç´ çš„æ•´ä¸ªè¿‡ç¨‹éƒ½çº³å…¥è®¡ç®—èŒƒå›´æ˜¯éå¸¸ä¸åˆç†çš„ã€‚ä¸éš¾æƒ³è±¡ï¼Œå½“ç”¨æˆ·ä»¥éå¸¸ç¼“æ…¢çš„é€Ÿåº¦ä½¿å…ƒç´ æ»šåŠ¨æ¯”è¾ƒå¤§çš„è·ç¦»ï¼Œè¿™ç§æƒ…å†µä¸‹å…ƒç´ åŠ¨é‡éå¸¸å°ï¼Œç†åº”ä¸è§¦å‘æƒ¯æ€§æ»šåŠ¨ã€‚å› æ­¤ï¼Œæƒ¯æ€§æ»šåŠ¨çš„è§¦å‘æ˜¯æœ‰æ¡ä»¶çš„ã€‚ å¯åŠ¨æ¡ä»¶ æƒ¯æ€§æ»šåŠ¨çš„å¯åŠ¨éœ€è¦æœ‰è¶³å¤Ÿçš„åŠ¨é‡ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è®¤ä¸ºï¼Œå½“ç”¨æˆ·æ»šåŠ¨çš„è·ç¦»è¶³å¤Ÿå¤§ï¼ˆå¤§äº 15pxï¼‰å’ŒæŒç»­æ—¶é—´è¶³å¤ŸçŸ­ï¼ˆå°äº 300msï¼‰æ—¶ï¼Œå³å¯äº§ç”Ÿæƒ¯æ€§æ»šåŠ¨ã€‚æ¢æˆç¼–ç¨‹è¯­è¨€å°±æ˜¯ï¼Œæœ€åä¸€æ¬¡ touchmove äº‹ä»¶è§¦å‘çš„æ—¶é—´å’Œ touchend äº‹ä»¶è§¦å‘çš„æ—¶é—´é—´éš”å°äº 300msï¼Œä¸”ä¸¤è€…äº§ç”Ÿçš„è·ç¦»å·®å¤§äº 15px æ—¶è®¤ä¸ºå¯å¯åŠ¨æƒ¯æ€§æ»šåŠ¨ã€‚ æš‚åœæ—¶æœº å½“æƒ¯æ€§æ»šåŠ¨æœªç»“æŸï¼ˆåŒ…æ‹¬å¤„äºå›å¼¹è¿‡ç¨‹ï¼‰ï¼Œç”¨æˆ·å†æ¬¡è§¦ç¢°æ»šåŠ¨å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æš‚åœå…ƒç´ çš„æ»šåŠ¨ã€‚åœ¨å®ç°åŸç†ä¸Šï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ getComputedStyle å’Œ getPropertyValue æ–¹æ³•è·å–å½“å‰çš„ transform: matrix() çŸ©é˜µå€¼ï¼ŒæŠ½ç¦»å‡ºå…ƒç´ çš„æ°´å¹³ y è½´åç§»é‡åé‡æ–°è°ƒæ•´ translate çš„ä½ç½®ã€‚ ç¤ºä¾‹ä»£ç åŸºäº vuejs æä¾›äº†éƒ¨åˆ†å…³é”®ä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è®¿é—® codepen demo ä½“éªŒæ•ˆæœï¼ˆå®Œæ•´ä»£ç ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159&lt;html&gt; &lt;body&gt; &lt;div id=\"app\"&gt;&lt;/div&gt; &lt;template id=\"tpl\"&gt; &lt;div ref=\"wrapper\" @touchstart.prevent=\"onStart\" @touchmove.prevent=\"onMove\" @touchend.prevent=\"onEnd\" @touchcancel.prevent=\"onEnd\" @transitionend=\"onTransitionEnd\"&gt; &lt;ul ref=\"scroller\" :style=\"scrollerStyle\"&gt; &lt;li v-for=\"item in list\"&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; new Vue(&#123; el: '#app', template: '#tpl', computed: &#123; list() &#123;&#125;, scrollerStyle() &#123; return &#123; 'transform': `translate3d(0, $&#123;this.offsetY&#125;px, 0)`, 'transition-duration': `$&#123;this.duration&#125;ms`, 'transition-timing-function': this.bezier, &#125;; &#125;, &#125;, data() &#123; return &#123; minY: 0, maxY: 0, wrapperHeight: 0, duration: 0, bezier: 'linear', pointY: 0, // touchStart æ‰‹åŠ¿ y åæ ‡ startY: 0, // touchStart å…ƒç´  y åç§»å€¼ offsetY: 0, // å…ƒç´ å®æ—¶ y åç§»å€¼ startTime: 0, // æƒ¯æ€§æ»‘åŠ¨èŒƒå›´å†…çš„ startTime momentumStartY: 0, // æƒ¯æ€§æ»‘åŠ¨èŒƒå›´å†…çš„ startY momentumTimeThreshold: 300, // æƒ¯æ€§æ»‘åŠ¨çš„å¯åŠ¨ æ—¶é—´é˜ˆå€¼ momentumYThreshold: 15, // æƒ¯æ€§æ»‘åŠ¨çš„å¯åŠ¨ è·ç¦»é˜ˆå€¼ isStarted: false, // starté” &#125;; &#125;, mounted() &#123; this.$nextTick(() =&gt; &#123; this.wrapperHeight = this.$refs.wrapper.getBoundingClientRect().height; this.minY = this.wrapperHeight - this.$refs.scroller.getBoundingClientRect().height; &#125;); &#125;, methods: &#123; onStart(e) &#123; const point = e.touches ? e.touches[0] : e; this.isStarted = true; this.duration = 0; this.stop(); this.pointY = point.pageY; this.momentumStartY = this.startY = this.offsetY; this.startTime = new Date().getTime(); &#125;, onMove(e) &#123; if (!this.isStarted) return; const point = e.touches ? e.touches[0] : e; const deltaY = point.pageY - this.pointY; this.offsetY = Math.round(this.startY + deltaY); const now = new Date().getTime(); // è®°å½•åœ¨è§¦å‘æƒ¯æ€§æ»‘åŠ¨æ¡ä»¶ä¸‹çš„åç§»å€¼å’Œæ—¶é—´ if (now - this.startTime &gt; this.momentumTimeThreshold) &#123; this.momentumStartY = this.offsetY; this.startTime = now; &#125; &#125;, onEnd(e) &#123; if (!this.isStarted) return; this.isStarted = false; if (this.isNeedReset()) return; const absDeltaY = Math.abs(this.offsetY - this.momentumStartY); const duration = new Date().getTime() - this.startTime; // å¯åŠ¨æƒ¯æ€§æ»‘åŠ¨ if (duration &lt; this.momentumTimeThreshold &amp;&amp; absDeltaY &gt; this.momentumYThreshold) &#123; const momentum = this.momentum(this.offsetY, this.momentumStartY, duration); this.offsetY = Math.round(momentum.destination); this.duration = momentum.duration; this.bezier = momentum.bezier; &#125; &#125;, onTransitionEnd() &#123; this.isNeedReset(); &#125;, momentum(current, start, duration) &#123; const durationMap = &#123; 'noBounce': 2500, 'weekBounce': 800, 'strongBounce': 400, &#125;; const bezierMap = &#123; 'noBounce': 'cubic-bezier(.17, .89, .45, 1)', 'weekBounce': 'cubic-bezier(.25, .46, .45, .94)', 'strongBounce': 'cubic-bezier(.25, .46, .45, .94)', &#125;; let type = 'noBounce'; // æƒ¯æ€§æ»‘åŠ¨åŠ é€Ÿåº¦ const deceleration = 0.003; // å›å¼¹é˜»åŠ› const bounceRate = 10; // å¼ºå¼±å›å¼¹çš„åˆ†å‰²å€¼ const bounceThreshold = 300; // å›å¼¹çš„æœ€å¤§é™åº¦ const maxOverflowY = this.wrapperHeight / 6; let overflowY; const distance = current - start; const speed = 2 * Math.abs(distance) / duration; let destination = current + speed / deceleration * (distance &lt; 0 ? -1 : 1); if (destination &lt; this.minY) &#123; overflowY = this.minY - destination; type = overflowY &gt; bounceThreshold ? 'strongBounce' : 'weekBounce'; destination = Math.max(this.minY - maxOverflowY, this.minY - overflowY / bounceRate); &#125; else if (destination &gt; this.maxY) &#123; overflowY = destination - this.maxY; type = overflowY &gt; bounceThreshold ? 'strongBounce' : 'weekBounce'; destination = Math.min(this.maxY + maxOverflowY, this.maxY + overflowY / bounceRate); &#125; return &#123; destination, duration: durationMap[type], bezier: bezierMap[type], &#125;; &#125;, // è¶…å‡ºè¾¹ç•Œæ—¶éœ€è¦é‡ç½®ä½ç½® isNeedReset() &#123; let offsetY; if (this.offsetY &lt; this.minY) &#123; offsetY = this.minY; &#125; else if (this.offsetY &gt; this.maxY) &#123; offsetY = this.maxY; &#125; if (typeof offsetY !== 'undefined') &#123; this.offsetY = offsetY; this.duration = 500; this.bezier = 'cubic-bezier(.165, .84, .44, 1)'; return true; &#125; return false; &#125;, // åœæ­¢æ»šåŠ¨ stop() &#123; const matrix = window.getComputedStyle(this.$refs.scroller).getPropertyValue('transform'); this.offsetY = Math.round(+matrix.split(')')[0].split(', ')[5]); &#125;, &#125;, &#125;); &lt;/script&gt; &lt;/body&gt;&lt;/html&gt; å‚è€ƒèµ„æ–™ weui-picker better-scroll","pubDate":"Mon, 08 Jun 2020 16:00:00 GMT","guid":"https://aotu.io/notes/2020/06/08/momentum-scrolling/","category":"web å¼€å‘"},{"title":"ä» SQL åˆ° MongoDB ä¹‹èšåˆç¯‡","link":"https://aotu.io/notes/2020/06/07/sql-to-mongo-2/","description":"ç¿»è¯‘åŸæ–‡ï¼šMongoDB å®˜æ–¹æ–‡æ¡£ï¼š SQL to Aggregation Mapping Chart åœ¨ä¸Šä¸€ç¯‡ç¿»è¯‘ ä» SQL åˆ° MongoDB ä¹‹æ¦‚å¿µç¯‡ï¼Œæˆ‘ä»¬è¯¦ç»†è®²è§£äº† SQL å’Œ MongoDB çš„ä¸€äº›æ¦‚å¿µçš„å¯¹åº”å…³ç³»ï¼Œæ–¹ä¾¿å¤§å®¶å…¥é—¨å’Œç†è§£ï¼Œè¿™ä¸€ç¯‡å±äºè¿›é˜¶ç¯‡ï¼Œä¸»è¦è®²è§£äº† SQL å’Œ MongoDB å’Œ æ•°æ®èšåˆ çš„å¯¹åº”å…³ç³»ã€‚ èšåˆç®¡é“ ï¼ˆaggregation pipeline ï¼‰ è®© MongoDB æä¾›ä¸ SQL ä¸­çš„è®¸å¤šå¸¸è§æ•°æ®èšåˆæ“ä½œç›¸å¯¹åº”çš„ï¼ŒåŸç”Ÿçš„èšåˆåŠŸèƒ½ã€‚ ä¸‹è¡¨æ¦‚è¿°äº†å¸¸è§çš„ SQL èšåˆæœ¯è¯­ã€å‡½æ•°å’Œæ¦‚å¿µä»¥åŠç›¸åº”çš„ MongoDB èšåˆæ“ä½œç¬¦ï¼ˆaggregation operatorsï¼‰ï¼š SQL æœ¯è¯­ã€å‡½æ•°å’Œæ¦‚å¿µ MongoDB èšåˆæ“ä½œç¬¦ WHERE $match GROUP BY $group HAVING $match SELECT $project ORDER BY $sort LIMIT $limit SUM() $sum COUNT() $sum $sortByCount join $lookup SELECT INTO NEW_TABLE $out MERGE INTO TABLE $merge MongoDB 4.2 å¯ç”¨ æœ‰å…³æ‰€æœ‰èšåˆç®¡é“å’Œè¡¨è¾¾å¼æ“ä½œç¬¦çš„åˆ—è¡¨ï¼Œè¯·å‚è§ï¼šAggregation Pipeline Quick Referenceã€‚ å¦è§ï¼šSQL to MongoDB Mapping Chart Examplesä¸‹é¢æä¾›äº† SQL èšåˆè¯­å¥å’Œç›¸åº”çš„ MongoDB è¯­å¥ï¼Œè¡¨ä¸­çš„ä¾‹å­å‡å®šä»¥ä¸‹æ¡ä»¶ï¼š SQL ç¤ºä¾‹å‡å®šæœ‰ä¸¤ä¸ªè¡¨ï¼šorders å’Œ order_lineitemï¼Œç„¶åé€šè¿‡ order_lineitem.order_id å’Œ orders.id è¿›è¡Œ join æ“ä½œã€‚ MongoDB ç¤ºä¾‹å‡è®¾å…¶ä¸­ä¸€ä¸ªé›†åˆï¼ˆcollectionï¼‰ orders åŒ…å«ä»¥ä¸‹åŸå‹çš„æ–‡æ¡£ï¼ˆdocumentsï¼‰ï¼š 12345678&#123; cust_id: \"abc123\", ord_date: ISODate(\"2012-11-02T17:04:11.102Z\"), status: 'A', price: 50, items: [ &#123; sku: \"xxx\", qty: 25, price: 1 &#125;, &#123; sku: \"yyy\", qty: 25, price: 1 &#125; ]&#125; COUNT vs countè®¡ç®—æ‰€æœ‰ orders è®°å½•æ•°é‡ï¼š SQL ç¤ºä¾‹ 12SELECT COUNT(*) AS countFROM orders MongoDB ç¤ºä¾‹ 12345678db.orders.aggregate( [ &#123; $group: &#123; _id: null, count: &#123; $sum: 1 &#125; &#125; &#125;] ) SUM vs $sumè®¡ç®— orders ä¸­ price çš„æ€»å’Œï¼š SQL ç¤ºä¾‹ 12SELECT SUM(price) AS totalFROM orders MongoDB ç¤ºä¾‹ 12345678db.orders.aggregate( [ &#123; $group: &#123; _id: null, total: &#123; $sum: \"$price\" &#125; &#125; &#125;] ) GROUP BY vs $groupå¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ cust_idï¼Œè®¡ç®— price å­—æ®µæ€»å’Œï¼š SQL ç¤ºä¾‹ 1234SELECT cust_id, SUM(price) AS totalFROM ordersGROUP BY cust_id MongoDB ç¤ºä¾‹ 12345678db.orders.aggregate( [ &#123; $group: &#123; _id: \"$cust_id\", total: &#123; $sum: \"$price\" &#125; &#125; &#125;] ) ORDER BY vs $sortå¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ cust_idï¼Œè®¡ç®— price å­—æ®µæ€»å’Œï¼Œä¸”ç»“æœæŒ‰æ€»å’Œæ’åºï¼š SQL ç¤ºä¾‹ 12345SELECT cust_id, SUM(price) AS totalFROM ordersGROUP BY cust_idORDER BY total MongoDB ç¤ºä¾‹ 123456789db.orders.aggregate( [ &#123; $group: &#123; _id: \"$cust_id\", total: &#123; $sum: \"$price\" &#125; &#125; &#125;, &#123; $sort: &#123; total: 1 &#125; &#125;] ) GROUP BY Multiå¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ cust_idï¼ŒæŒ‰ç…§ ord_date è¿›è¡Œåˆ†ç»„ï¼Œä¸”ä¸åŒ…å«æ—¥æœŸçš„æ—¶é—´éƒ¨åˆ†ï¼Œè®¡ç®— price å­—æ®µæ€»å’Œã€‚ SQL ç¤ºä¾‹ 123456SELECT cust_id, ord_date, SUM(price) AS totalFROM ordersGROUP BY cust_id, ord_date MongoDB ç¤ºä¾‹ 1234567891011121314db.orders.aggregate( [ &#123; $group: &#123; _id: &#123; cust_id: \"$cust_id\", ord_date: &#123; $dateToString: &#123; format: \"%Y-%m-%d\", date: \"$ord_date\" &#125;&#125; &#125;, total: &#123; $sum: \"$price\" &#125; &#125; &#125;] ) HAVING vs $matchå¯¹äº cust_id å¦‚æœæœ‰å¤šä¸ªè®°å½•ï¼Œå°±è¿”å› cust_id ä»¥åŠç›¸åº”çš„è®°å½•æ•°é‡ï¼š SQL ç¤ºä¾‹ 123456SELECT cust_id, count(*)FROM ordersGROUP BY cust_idHAVING count(*) &gt; 1 MongoDB ç¤ºä¾‹ 123456789db.orders.aggregate( [ &#123; $group: &#123; _id: \"$cust_id\", count: &#123; $sum: 1 &#125; &#125; &#125;, &#123; $match: &#123; count: &#123; $gt: 1 &#125; &#125; &#125;] ) WHERE vs $matchå¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ cust_idï¼Œä¸” status = â€˜Aâ€™ï¼Œè®¡ç®— price å­—æ®µæ€»å’Œï¼Œåªæœ‰åœ¨æ€»å’Œå¤§äº 250 çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥è¿”å›ã€‚ SQL ç¤ºä¾‹ 123456SELECT cust_id, SUM(price) as totalFROM ordersWHERE status = 'A'GROUP BY cust_idHAVING total &gt; 250 MongoDB ç¤ºä¾‹ 12345678910db.orders.aggregate( [ &#123; $match: &#123; status: 'A' &#125; &#125;, &#123; $group: &#123; _id: \"$cust_id\", total: &#123; $sum: \"$price\" &#125; &#125; &#125;, &#123; $match: &#123; total: &#123; $gt: 250 &#125; &#125; &#125;] ) $unwindå¯¹äºæ¯ä¸€ä¸ªç‹¬ç‰¹çš„ cust_idï¼Œå¯¹ç›¸åº”çš„è¡Œçš„ item é¡¹æ±‚å’Œå¾—åˆ° qtyï¼š SQL ç¤ºä¾‹ 123456SELECT cust_id, SUM(li.qty) as qtyFROM orders o, order_lineitem liWHERE li.order_id = o.idGROUP BY cust_id MongoDB ç¤ºä¾‹ 123456789db.orders.aggregate( [ &#123; $unwind: \"$items\" &#125;, &#123; $group: &#123; _id: \"$cust_id\", qty: &#123; $sum: \"$items.qty\" &#125; &#125; &#125;] ) Multi aggregateå°† cust_id, ord_date åˆ†ç»„å¹¶è®¡ç®—æ•°é‡ ï¼Œä¸åŒ…æ‹¬æ—¥æœŸçš„æ—¶é—´éƒ¨åˆ†ã€‚ 1234567SELECT COUNT(*)FROM (SELECT cust_id, ord_date FROM orders GROUP BY cust_id, ord_date) as DerivedTable 12345678910111213141516171819db.orders.aggregate( [ &#123; $group: &#123; _id: &#123; cust_id: \"$cust_id\", ord_date: &#123; $dateToString: &#123; format: \"%Y-%m-%d\", date: \"$ord_date\" &#125;&#125; &#125; &#125; &#125;, &#123; $group: &#123; _id: null, count: &#123; $sum: 1 &#125; &#125; &#125;] ) å¦è§ SQL to MongoDB Mapping Chart Aggregation Pipeline Quick Reference db.collection.aggregate()","pubDate":"Sun, 07 Jun 2020 16:00:00 GMT","guid":"https://aotu.io/notes/2020/06/07/sql-to-mongo-2/","category":"å…¨æ ˆå¼€å‘"},{"title":"ä» SQL åˆ° MongoDB ä¹‹æ¦‚å¿µç¯‡","link":"https://aotu.io/notes/2020/06/07/sql-to-mongo-1/","description":"ç¿»è¯‘åŸæ–‡ï¼šMongoDB å®˜æ–¹æ–‡æ¡£ï¼šSQL to MongoDB Mapping Chart å‰è¨€å¾ˆå¤šå¼€å‘è€…é¦–æ¬¡æ¥è§¦æ•°æ®åº“ï¼ˆé€šå¸¸æ˜¯åœ¨é«˜æ ¡è¯¾å ‚ï¼‰çš„æ¦‚å¿µï¼Œæˆ–è€…è¯´æ¥è§¦ç¬¬ä¸€ä¸ªæ•°æ®åº“ï¼Œé€šå¸¸æ˜¯ SQL æ•°æ®åº“ï¼Œè€Œç°åœ¨ï¼ŒNoSQL æ•°æ®åº“è¶Šæ¥è¶Šæµè¡Œï¼Œå¾ˆå¤šåŸ SQL æ•°æ®çš„ä½¿ç”¨è€…éš¾å…æœ‰è½¬å‘ NoSQL çš„éœ€æ±‚ã€‚è€Œä½œä¸º NoSQL æ•°æ®åº“çš„ä»£è¡¨ï¼ŒMongoDB åœ¨ç¤¾åŒºè¶Šæ¥è¶Šæµè¡Œï¼Œç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨ä¹Ÿæ—¥ç›Šå¹¿æ³›ã€‚ å¯¹äº SQL è½¬æˆ˜ NoSQLçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œæœ€éš¾çš„ä¸€æ­¥å…¶å®æ˜¯å°†åŸæœ‰çš„ SQL çš„æ¦‚å¿µå’ŒçŸ¥è¯†ç›´æ¥å¤ç”¨è¿‡æ¥ï¼Œæœ€å¤§åŒ–çš„å‡å°å­¦ä¹ çš„æˆæœ¬ã€‚ å…¶å®ï¼Œè¿™ä¸€æ­¥ MongoDB å®˜æ–¹å·²ç»ä¸ºå¤§å®¶è€ƒè™‘åˆ°äº†ï¼Œé‚£å°±æ˜¯åœ¨ï¼šMongoDB CRUD Operations &gt; MongoDB CRUD Operations &gt; SQL to MongoDB Mapping Chartï¼Œè¿™ç¯‡æ–‡æ¡£éå¸¸å¥½çš„æ€»ç»“äº† SQL å¯¹åº” MongoDB çš„æœ¯è¯­å’Œæ¦‚å¿µï¼Œè¿˜æœ‰å¯æ‰§è¡Œæ–‡ä»¶ã€SQL è¯­å¥/MongoDB è¯­å¥ç­‰ï¼Œ å¯ä»¥è¯´å¯¹äº SQL æ•°æ®åº“å¼€å‘äººå‘˜ï¼Œå¦‚æœç†è§£äº†ä»–ä»¬ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œé‚£ä¹ˆå°±ä¸€åªè„šå°±è¿ˆè¿›äº† MongoDB çš„å¤§é—¨ã€‚ Terminology and Conceptsä¸‹è¡¨ä»‹ç»äº†å„ç§ SQL æœ¯è¯­å’Œæ¦‚å¿µä»¥åŠç›¸åº”çš„ MongoDB æœ¯è¯­å’Œæ¦‚å¿µ. SQLæœ¯è¯­/æ¦‚å¿µ MongoDB æœ¯è¯­/æ¦‚å¿µ database database table collection row document æˆ– BSON document column field index index table joins ï¼ˆè¡¨è”æ¥ï¼‰ $lookup, embedded documents ï¼ˆåµŒå…¥å¼æ–‡æ¡£ï¼‰ primary key æŒ‡å®šä»»ä½•å”¯ä¸€çš„åˆ—æˆ–è€…åˆ—ç»„åˆä½œä¸ºä¸»é”® primary key åœ¨ MongoDB ä¸­, ä¸»é”®è‡ªåŠ¨è®¾ç½®ä¸º _id å­—æ®µ aggregation (å¦‚ï¼šgroup by) aggregation pipeline ï¼ˆèšåˆç®¡é“ï¼‰å‚è€ƒï¼šSQL to Aggregation Mapping Chart SELECT INTO NEW_TABLE $out å‚è€ƒï¼š SQL to Aggregation Mapping Chart MERGE INTO TABLE $merge ï¼ˆä»MongoDB 4.2å¼€å§‹å¯ç”¨ï¼‰ å‚è€ƒï¼šSQL to Aggregation Mapping Chart transactions transactions TIP åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œ éè§„èŒƒåŒ–æ•°æ®æ¨¡å‹ï¼ˆåµŒå…¥å¼æ–‡æ¡£å’Œæ•°ç»„ï¼‰ denormalized data model (embedded documents and arrays) å°†ç»§ç»­æ˜¯æ‚¨æ•°æ®å’Œç”¨ä¾‹çš„æœ€ä½³é€‰æ‹©ï¼Œè€Œä¸æ˜¯å¤šæ–‡æ¡£äº‹åŠ¡. ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè®¸å¤šåœºæ™¯ï¼Œå¯¹æ•°æ®è¿›è¡Œé€‚å½“çš„å»ºæ¨¡å°†æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹ å¤šæ–‡æ¡£äº‹åŠ¡ï¼ˆmulti-document transactionsï¼‰çš„éœ€æ±‚ã€‚ Executablesä¸‹è¡¨æ˜¾ç¤ºäº†ä¸€äº›æ•°æ®åº“å¯æ‰§è¡Œæ–‡ä»¶å’Œç›¸åº”çš„ MongoDB å¯æ‰§è¡Œæ–‡ä»¶ã€‚ è¿™å¼ è¡¨å¹¶ä¸æ˜¯è¯¦å°½æ— é—çš„ã€‚ MongoDB MySQL Oracle Informix DB2 Database Server mongod mysqld oracle IDS DB2 Server Database Client mongo mysql sqlplus DB-Access DB2 Client Examplesä¸‹è¡¨æ˜¾ç¤ºäº†å„ç§ SQL è¯­å¥å’Œç›¸åº”çš„ MongoDB è¯­å¥ã€‚ è¡¨ä¸­çš„ä¾‹å­å‡å®šä»¥ä¸‹æ¡ä»¶: Sql ç¤ºä¾‹å‡è®¾ä¸€ä¸ªåä¸º people çš„è¡¨ã€‚ MongoDB çš„ç¤ºä¾‹å‡å®šä¸€ä¸ªåä¸º people çš„é›†åˆåŒ…å«ä»¥ä¸‹åŸå‹çš„æ–‡æ¡£ï¼š 123456&#123; _id: ObjectId(\"509a8fb2f3f4948bd2f983a0\"), user_id: \"abc123\", age: 55, status: 'A'&#125; Create and AlterCREATE TABLE SQL æ¨¡å¼è¯­å¥ï¼š 12345678CREATE TABLE people ( id MEDIUMINT NOT NULL AUTO_INCREMENT, user_id Varchar(30), age Number, status char(1), PRIMARY KEY (id)) MongoDB æ¨¡å¼è¯­å¥ï¼š 12345db.people.insertOne( &#123; user_id: \"abc123\", age: 55, status: \"A\" &#125; ) åœ¨ç¬¬ä¸€ä¸ª insertOne() æˆ– insertMany() æ“ä½œä¸Šéšå¼åˆ›å»ºã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®š _id å­—æ®µï¼Œåˆ™è‡ªåŠ¨æ·»åŠ ä¸»é”® _idã€‚ ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ˜¾å¼åœ°åˆ›å»ºä¸€ä¸ªé›†åˆï¼š 1db.createCollection(\"people\") ALTER TABLE / ADD SQLæ¨¡å¼è¯­å¥ï¼š 12ALTER TABLE peopleADD join_date DATETIME MongoDB æ¨¡å¼è¯­å¥ï¼š 1234db.people.updateMany( &#123; &#125;, &#123; $set: &#123; join_date: new Date() &#125; &#125;) é›†åˆä¸æè¿°æˆ–å¼ºåˆ¶æ‰§è¡Œå…¶æ–‡æ¡£çš„ç»“æ„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é›†åˆçº§åˆ«ä¸Šæ²¡æœ‰ç»“æ„ä¸Šçš„æ”¹å˜ã€‚ ä½†æ˜¯ï¼Œåœ¨æ–‡æ¡£çº§åˆ«ï¼ŒupdateMany() æ“ä½œå¯ä»¥ä½¿ç”¨ $set æ“ä½œç¬¦å‘ç°æœ‰æ–‡æ¡£æ·»åŠ å­—æ®µã€‚ ALTER TABLE / DROP COLUMN SQLæ¨¡å¼è¯­å¥ï¼š 12ALTER TABLE peopleDROP COLUMN join_date MongoDB æ¨¡å¼è¯­å¥ï¼š 1234db.people.updateMany( &#123; &#125;, &#123; $unset: &#123; \"join_date\": \"\" &#125; &#125;) é›†åˆä¸æè¿°æˆ–å¼ºåˆ¶æ‰§è¡Œå…¶æ–‡æ¡£çš„ç»“æ„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é›†åˆçº§åˆ«ä¸Šæ²¡æœ‰ç»“æ„ä¸Šçš„æ”¹å˜ã€‚ ä½†æ˜¯ï¼Œåœ¨æ–‡æ¡£çº§åˆ«ï¼ŒupdateMany() æ“ä½œå¯ä»¥ä½¿ç”¨ $unset æ“ä½œç¬¦ä»æ–‡æ¡£ä¸­åˆ é™¤å­—æ®µã€‚ CREATE INDEX SQL æ¨¡å¼è¯­å¥ï¼š 12CREATE INDEX idx_user_id_ascON people(user_id) MongoDB æ¨¡å¼è¯­å¥ï¼š 1db.people.createIndex( &#123; user_id: 1 &#125; ) CREATE INDEX / Multi SQLæ¨¡å¼è¯­å¥ï¼š 123CREATE INDEX idx_user_id_asc_age_descON people(user_id, age DESC) MongoDB æ¨¡å¼è¯­å¥ï¼š 1db.people.createIndex( &#123; user_id: 1, age: -1 &#125; ) DROP TABLE SQLæ¨¡å¼è¯­å¥ï¼š 1DROP TABLE people MongoDB æ¨¡å¼è¯­å¥ï¼š 1db.people.drop() æ›´å¤šæœ‰å…³ä½¿ç”¨çš„æ–¹æ³•å’Œæ“ä½œç¬¦çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…: db.collection.insertOne() db.collection.insertMany() db.createCollection() db.collection.updateMany() db.collection.createIndex() db.collection.drop() $set $unset å¦è§ï¼š Databases and Collections Documents Indexes Data Modeling Concepts Insertä¸‹è¡¨æ˜¾ç¤ºäº†ä¸å‘è¡¨ä¸­æ’å…¥è®°å½•ç›¸å…³çš„å„ç§ SQL è¯­å¥ä»¥åŠç›¸åº”çš„ MongoDB è¯­å¥ã€‚ SQL INSERT è¯­å¥ 123456INSERT INTO people(user_id, age, status)VALUES (\"bcd001\", 45, \"A\") Mongodb insertOne() è¯­å¥ 123db.people.insertOne( &#123; user_id: \"bcd001\", age: 45, status: \"A\" &#125;) æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ db.collection.insertOne()ã€‚ å¦è§ï¼š Insert Documents db.collection.insertMany() Databases and Collections Documents Selectä¸‹è¡¨æ˜¾ç¤ºäº†ä¸ä»è¡¨ä¸­è¯»å–è®°å½•ç›¸å…³çš„å„ç§ SQL è¯­å¥ä»¥åŠç›¸åº”çš„ MongoDB è¯­å¥ã€‚ NOTEï¼š find() æ–¹æ³•æ€»æ˜¯åŒ…å«è¿”å›æ–‡æ¡£ä¸­çš„ _id å­—æ®µï¼Œé™¤éé€šè¿‡ projection ç‰¹åˆ«æ’é™¤ã€‚ ä¸‹é¢çš„ä¸€äº› SQL æŸ¥è¯¢å¯èƒ½åŒ…å«ä¸€ä¸ª _id å­—æ®µæ¥åæ˜ è¿™ä¸€ç‚¹ï¼Œå³ä½¿è¯¥å­—æ®µæ²¡æœ‰åŒ…å«åœ¨ç›¸åº”çš„ find() æŸ¥è¯¢ä¸­ã€‚ SELECT â€¦ WHERE SQL è¯­å¥ 1234SELECT user_id, statusFROM peopleWHERE status = \"A\" Mongodb è¯­å¥ 1234db.people.find( &#123; status: \"A\" &#125;, &#123; user_id: 1, status: 1, _id: 0 &#125;) SELECT â€¦ AND SQL è¯­å¥ 1234SELECT *FROM peopleWHERE age &gt; 25AND age &lt;= 50 Mongodb è¯­å¥ 123db.people.find( &#123; age: &#123; $gt: 25, $lte: 50 &#125; &#125;) SELECT â€¦ OR SQL è¯­å¥ 1234SELECT *FROM peopleWHERE status = \"A\"OR age = 50 Mongodb è¯­å¥ 123db.people.find( &#123; $or: [ &#123; status: \"A\" &#125; , &#123; age: 50 &#125; ] &#125;) SELECT â€¦ LIKE SQL è¯­å¥ 12FROM peopleWHERE user_id like \"%bc%\" Mongodb è¯­å¥ 12345db.people.find( &#123; user_id: /bc/ &#125; )-or-db.people.find( &#123; user_id: &#123; $regex: /bc/ &#125; &#125; ) SELECT â€¦ OEDER BY SQL è¯­å¥ 1234SELECT *FROM peopleWHERE status = \"A\"ORDER BY user_id ASC Mongodb è¯­å¥ 1db.people.find( &#123; status: \"A\" &#125; ).sort( &#123; user_id: 1 &#125; ) SELECT â€¦ COUNT SQL è¯­å¥ 12SELECT COUNT(user_id)FROM people Mongodb è¯­å¥ 12345db.people.count( &#123; user_id: &#123; $exists: true &#125; &#125; )ordb.people.find( &#123; user_id: &#123; $exists: true &#125; &#125; ).count() SELECT DISTINCT SQL è¯­å¥ 12SELECT DISTINCT(status)FROM people Mongodb è¯­å¥ 123456db.people.aggregate( [ &#123; $group : &#123; _id : \"$status\" &#125; &#125; ] )æˆ–è€…ï¼Œå¯¹äºä¸åŒçš„ä¸è¶…è¿‡ [BSON å¤§å°é™åˆ¶](https://docs.mongodb.com/manual/reference/limits/#limit-bson-document-size) çš„å€¼é›†db.people.distinct( \"status\" ) SELECT â€¦ LIMIT SKIP SQL è¯­å¥ 1234SELECT *FROM peopleLIMIT 5SKIP 10 Mongodb è¯­å¥ 1db.people.find().limit(5).skip(10) EXPLAIN SELECT SQL è¯­å¥ 123EXPLAIN SELECT *FROM peopleWHERE status = \"A\" Mongodb è¯­å¥ 1db.people.find( &#123; status: \"A\" &#125; ).explain() æœ‰å…³æ‰€ä½¿ç”¨çš„æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š db.collection.find() db.collection.distinct() db.collection.findOne() limit() skip() explain() sort() count() è¿ç®—ç¬¦ï¼ˆoperatorsï¼‰ï¼š $ne $and $or $gt $lt $exists $lte $regex å¦è§ï¼š Query Documents Query and Projection Operators mongo Shell Methods Update Recordsä¸‹é¢æ˜¾ç¤ºäº†ä¸æ›´æ–°è¡¨ä¸­ç°æœ‰è®°å½•ç›¸å…³çš„å„ç§ SQL è¯­å¥ä»¥åŠç›¸åº”çš„ MongoDB è¯­å¥ã€‚ UPDATE â€¦ SET SQL è¯­å¥ 123UPDATE peopleSET status = \"C\"WHERE age &gt; 25 Mongodb è¯­å¥ 1234db.people.updateMany( &#123; age: &#123; $gt: 25 &#125; &#125;, &#123; $set: &#123; status: \"C\" &#125; &#125;) UPDATE â€¦ INC SQL è¯­å¥ 123UPDATE peopleSET age = age + 3WHERE status = \"A\" Mongodb è¯­å¥ 1234db.people.updateMany( &#123; status: \"A\" &#125; , &#123; $inc: &#123; age: 3 &#125; &#125;) æœ‰å…³ç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ–¹æ³•å’Œè¿ç®—ç¬¦çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š db.collection.updateMany() $gt $set $inc å¦è§ï¼š Update Documents Update Operators db.collection.updateOne() db.collection.replaceOne() Delete Recordsä¸‹é¢æ˜¾ç¤ºäº†ä¸ä»è¡¨ä¸­åˆ é™¤è®°å½•ç›¸å…³çš„å„ç§ SQL è¯­å¥ä»¥åŠç›¸åº”çš„ MongoDB è¯­å¥ã€‚ DELETE WHERE SQL è¯­å¥ 12DELETE FROM peopleWHERE status = \"D\" Mongodb è¯­å¥ 1db.people.deleteMany( &#123; status: \"D\" &#125; ) DELETE SQL è¯­å¥ 1DELETE FROM people Mongodb è¯­å¥ 1db.people.deleteMany(&#123;&#125;) æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ db.collection.deleteMany()ã€‚ Delete Documents db.collection.deleteOne() çœ‹åˆ°è¿™é‡Œï¼Œæƒ³å¿…å¤§å®¶åº”è¯¥å·²ç»å°†è„‘æµ·ä¸­ SQL ç›¸å…³çš„çŸ¥è¯†å’Œ MongoDB ä¸€ä¸€å¯¹åº”èµ·æ¥äº†ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±éœ€è¦å¤§å®¶å¤šå¤šçš„å®è·µï¼Œæ·±å…¥æŒ–æ˜ã€‚ ä½†æ˜¯æ— è®ºä½•æ—¶ï¼Œéƒ½è¦è®°ä½ï¼ŒMongoDB å®˜æ–¹æ–‡æ¡£ ç»å¯¹æ˜¯ä½ èƒ½æ‰¾åˆ°çš„æœ€æƒå¨ã€æœ€å…¨é¢çš„èµ„æ–™ã€‚","pubDate":"Sun, 07 Jun 2020 16:00:00 GMT","guid":"https://aotu.io/notes/2020/06/07/sql-to-mongo-1/","category":"å…¨æ ˆå¼€å‘"}]}